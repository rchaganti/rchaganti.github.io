<!DOCTYPE html>
<html lang="en-us">
<head>
  
  <script>
    (function() {
      const stored = localStorage.getItem('theme-preference');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = stored || (prefersDark ? 'dark' : 'light');

      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Google ADK - Sessions, state, and memory | Ravikanth Chaganti</title>

  
  <meta name="description" content="Imagine you built a travel-booking agent. A user says, &ldquo;Find flights to Paris, and the agent returns options. Then the user says, &ldquo;Book the second one.&rdquo; Without any memory of the previous turn, the agent has no idea what &ldquo;the second one&rdquo; refers to. The conversation is dead. This is the fundamental problem with LLMs. LLMs are stateless. Every API call to an LLM is independent. The model does not inherently remember what was said before. Yet meaningful conversations are inherently multi-turn, contextual, and stateful. This is where agent memory comes into play. Agent memory is the system built around the LLM to allow it to retain information, learn from past interactions, and maintain continuity within and across conversations.">
  <meta name="author" content="Ravikanth Chaganti">

  
  
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  

  
  <meta property="og:title" content="Google ADK - Sessions, state, and memory">
  <meta property="og:description" content="Imagine you built a travel-booking agent. A user says, &ldquo;Find flights to Paris, and the agent returns options. Then the user says, &ldquo;Book the second one.&rdquo; Without any memory of the previous turn, the agent has no idea what &ldquo;the second one&rdquo; refers to. The conversation is dead. This is the fundamental problem with LLMs. LLMs are stateless. Every API call to an LLM is independent. The model does not inherently remember what was said before. Yet meaningful conversations are inherently multi-turn, contextual, and stateful. This is where agent memory comes into play. Agent memory is the system built around the LLM to allow it to retain information, learn from past interactions, and maintain continuity within and across conversations.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://ravichaganti.com/blog/google-adk-sessions-state-and-memory/">
  <meta property="og:site_name" content="Ravikanth Chaganti">
  <meta property="og:locale" content="en_US">
  
  <meta property="og:image" content="https://ravichaganti.com/images/adk.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Google ADK - Sessions, state, and memory">

  
  
    <meta property="article:published_time" content="2025-12-05T00:00:00Z">
    <meta property="article:modified_time" content="2025-12-05T00:00:00Z">
    <meta property="article:author" content="Ravikanth Chaganti">
    <meta property="article:section" content="Google">
    
  

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Google ADK - Sessions, state, and memory">
  <meta name="twitter:description" content="Imagine you built a travel-booking agent. A user says, &ldquo;Find flights to Paris, and the agent returns options. Then the user says, &ldquo;Book the second one.&rdquo; Without any memory of the previous turn, the agent has no idea what &ldquo;the second one&rdquo; refers to. The conversation is dead. This is the fundamental problem with LLMs. LLMs are stateless. Every API call to an LLM is independent. The model does not inherently remember what was said before. Yet meaningful conversations are inherently multi-turn, contextual, and stateful. This is where agent memory comes into play. Agent memory is the system built around the LLM to allow it to retain information, learn from past interactions, and maintain continuity within and across conversations.">
  <meta name="twitter:image" content="https://ravichaganti.com/images/adk.png">
  <meta name="twitter:site" content="@ravikanth">

  
  <link rel="canonical" href="https://ravichaganti.com/blog/google-adk-sessions-state-and-memory/">

  
  <link rel="alternate" type="application/rss+xml" href="https://ravichaganti.com/index.xml">

  
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate icon" type="image/x-icon" href="/favicon.ico">

  
  <link rel="stylesheet" href="/css/main.css">

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  
  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Google ADK - Sessions, state, and memory",
  "description": "Imagine you built a travel-booking agent. A user says, \u0026ldquo;Find flights to Paris, and the agent returns options. Then the user says, \u0026ldquo;Book the second one.\u0026rdquo; Without any memory of the …",
  "articleBody": "\"Imagine you built a travel-booking agent. A user says, \\u0026ldquo;Find flights to Paris, and the agent returns options. Then the user says, \\u0026ldquo;Book the second one.\\u0026rdquo; Without any memory of the previous turn, the agent has no idea what \\u0026ldquo;the second one\\u0026rdquo; refers to. The conversation is dead. This is the fundamental problem with LLMs. LLMs are stateless. Every API call to an LLM is independent. The model does not inherently remember what was said before. Yet meaningful conversations are inherently multi-turn, contextual, and stateful. This is where agent memory comes into play. Agent memory is the system built around the LLM to allow it to retain information, learn from past interactions, and maintain continuity within and across conversations.\\nAgent memory At a high-level, there are three types of memory.\\nShort-term or working memory is what\\u0026rsquo;s currently visible within the model\\u0026rsquo;s context window. This is needed for continuity in the current conversation. It includes the current prompt, the immediate conversation history, and a scratch pad where the agent reasons through a problem. This memory is volatile. The information in this memory will be lost once the conversation ends or the context limit is reached. There are methods to compact the context and continue the conversation. Long-term memory is usually stored externally, mostly in a vector database, and retrieved when needed using techniques such as RAG. This is used to store events \\u0026amp; experiences (episodic memory) and facts \\u0026amp; knowledge (semantic memory). This allows an agent to recall user preferences, past decisions, and specific interaction history. Procedural memory is the implicit knowledge of how to perform tasks. This is usually represented by the available tools and instructions for using them. When developing agents with Google ADK, sessions and memory enable the agent to retain information, learn from past interactions, and maintain continuity within and across conversations. Let us dive into these concepts.\\nSessions A session in Google ADK is a single, ongoing interaction between the user and your agent. Think of it as one chat thread. It contains the chronological history of everything that happened (as Events) and a scratchpad of data relevant to this conversation (State). A Session object is the container for one conversation thread. Some of the key properties of the Session object are:\\nProperty Type Purpose id str Unique identifier for this specific conversation app_name str Which agent application does this belong to user_id str Which user owns this conversation state dict Key-value scratchpad events list[Event] Chronological history of all interactions last_update_time float Timestamp of the most recent event To create and manage sessions, we use the SessionService.\\n1 2 3 4 5 6 7 8 9 10 from google.adk.sessions import InMemorySessionService session_service = InMemorySessionService() # Create a new session session = await session_service.create_session( app_name=\\u0026#34;travel_agent\\u0026#34;, user_id=\\u0026#34;user_123\\u0026#34;, state={\\u0026#34;user:name\\u0026#34;: \\u0026#34;Ravi\\u0026#34;} ) You can list all sessions for a user using the list_sessions method.\\n1 2 3 4 5 6 7 sessions = await session_service.list_sessions( app_name=\\u0026#34;my_app\\u0026#34;, user_id=\\u0026#34;user_42\\u0026#34; ) for s in sessions.sessions: print(f\\u0026#34;Session {s.id} — last updated: {s.last_update_time}\\u0026#34;) To get an existing session, we use the get_session method.\\n1 2 3 4 5 6 7 8 session = await session_service.get_session( app_name=\\u0026#34;my_app\\u0026#34;, user_id=\\u0026#34;user_42\\u0026#34;, session_id=\\u0026#34;custom_id_optional\\u0026#34; ) print(session.state) print(len(session.events)) We can use the delete_session method to delete a session.\\n1 2 3 4 5 await session_service.delete_session( app_name=\\u0026#34;my_app\\u0026#34;, user_id=\\u0026#34;user_42\\u0026#34;, session_id=\\u0026#34;custom_id_optional\\u0026#34; ) InMemorySessionService stores all session data directly in the application\\u0026rsquo;s memory; therefore, all conversation history will be lost if the application restarts. The DatabaseSessionService and VertextAiSessionService provide session persistence. The InMemorySessionService service is a good fit for quick development and local testing.\\nAs discussed, a Session object is a container for a conversation thread. This object contains state and events.\\nState The state is the agent\\u0026rsquo;s working memory for the current conversation, and it is a dictionary holding key-value pairs. This is the agent\\u0026rsquo;s scratchpad, which is updated during a conversation. This scratchpad can be used to track and recall information such as user preferences and task execution progress, and to store any information that will be useful during an agent\\u0026rsquo;s execution. For the state, the keys must be strings. The values associated with these must be serializable.\\nYou can organize session state into multiple scopes. This is determined using the prefix on the state keys. Scope determines who can see the state and how long it lives.\\nSession Scope When the state key has no prefix, it becomes a part of the current session scope. This is useful for tracking progress on the current task or for temporary flags.\\nsession.state['current_step'] = 'payment' sets the current_step key to payment in the current session.\\nUser Scope When the state keys has user: prefix, it becomes a user state. It gets tied to user_id and is shared across all sessions for that user within the same application (app_name). This scoped state is best for storing user preferences and task-specific details for the user.\\nsession.state['user:preferred_payment_mode'] = 'card' sets and tracks user\\u0026rsquo;s payment mode preference.\\nApp Scope You can use the app scope when you need state that is shared across all users and sessions for an application. This is useful for global settings that apply to all users and all sessions.\\nsession.state['app:payment_api'] = 'http://payments.yourbank.com' sets app-wide the payments API endpoint.\\nTemporary Scope Finally, if you want to track the state within the current invocation only, use the temp prefix. For example, state variables such as tool call results, which are relevant only to the current invocation, can be set as a temp scope.\\nsession.state['temp:raw_api_response'] = {...} sets raw_api_response as a state variable in the current invocation.\\nExcept for the temporary scoped state, other scoped states can be persisted when using the database or Vertex AI services as a session service.\\nYour agent code sees a single, flat session.state dictionary. The SessionService handles the magic of merging state from different scopes behind the scenes. When you read session.state['user:name'], the service fetches it from the user-level store. When you read session.state['cart_total'], it comes from the session-level store. It\\u0026rsquo;s all transparent.\\nEvents Everything that happens in a session is recorded as an event. Events are the fundamental units of information flow in Google ADK agents. They carry user messages, agent responses, tool calls, tool results, state changes, and control signals. An event loop is at the heart of the ADK runtime and facilitates the communication between the Runner component and the agent execution. When a user prompt arrives, the Runner hands it over to the agent for processing. The agent runs until it has something to yield, at which point it emits an event. The Runner receives the event, processes any associated actions, calls the session service to append the event to the current state, and forwards the event. After the Runner completes event processing, the agent resumes from where it was paused and continues this loop until it has no more events to yield. The Runner component is the central orchestrator of this event loop. The agent or execution logic running within the event loop yields or emits events. An event has the following structure.\\nWe will dive into Runner and its architecture in a later part of this series.\\nField Purpose id Unique identifier for this specific event invocation_id Groups all events from one user-request-to-final-response cycle author 'user' or agent name (e.g., 'WeatherAgent') content The payload (text, function calls, or function responses) actions Side effects (state_delta, artifact_delta, transfer_to_agent, escalate) timestamp When this event was created partial True if this is a streaming chunk, not yet complete Besides the content, the actions field contains an important piece of information that decides the next step in the event loop. The actions field is where state changes and control flow signals live. State is never updated in-place. Every state change flows through an Event\\u0026rsquo;s state_delta. When the SessionService processes append_event(session, event), it reads event.actions.state_delta and applies those changes to the persisted state. This is the only reliable path for state updates.\\nIn an earlier article on building a multi-agent workflow using Google ADK, we saw how event.actions.escalate was used to signal the workflow\\u0026rsquo;s termination.\\nReading and writing state You can read state from a Session object, from CallbackContext, or from ToolContext:\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 # From a session object (read-only recommended) session = await session_service.get_session(app_name=APP, user_id=UID, session_id=SID) language = session.state.get(\\u0026#34;user:preferred_payment_mode\\u0026#34;, \\u0026#34;card\\u0026#34;) step = session.state.get(\\u0026#34;booking_step\\u0026#34;, \\u0026#34;start\\u0026#34;) # From a callback context def my_callback(callback_context, llm_request): name = callback_context.state.get(\\u0026#34;user:name\\u0026#34;, \\u0026#34;Guest\\u0026#34;) return None # From a tool context def my_tool(query: str, tool_context: ToolContext) -\\u0026gt; dict: api_url = tool_context.state.get(\\u0026#34;app:api_endpoint\\u0026#34;) return {\\u0026#34;result\\u0026#34;: \\u0026#34;...\\u0026#34;} There are three ways to write to the session state.\\noutput_key is the simplest, for saving the agent\\u0026rsquo;s final text response. EventActions.state_delta is used for manual and complex updates. CallbackContext.state / ToolContext.state is recommended for callbacks and tools. We should never modify the session.state directly on a session object retrieved by the SessionService. This bypasses event tracking, breaks persistence, and is not thread-safe.\\noutput_key We have seen in earlier articles in this series that using output_key stores the agent\\u0026rsquo;s response in the session state. This is the simplest method and is useful when we need to capture the agent\\u0026rsquo;s complete response so that other agents and tools can refer to it.\\n1 2 3 4 5 6 7 8 from google.adk.agents import LlmAgent greeting_agent = LlmAgent( name=\\u0026#34;Greeter\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, instruction=\\u0026#34;Generate a short, friendly greeting.\\u0026#34;, output_key=\\u0026#34;last_greeting\\u0026#34; # Agent\\u0026#39;s response → state[\\u0026#39;last_greeting\\u0026#39;] ) After the agent runs the session.state['last_greeting'] will contain something like \\u0026quot;Hello there! How can I help you today?\\u0026quot;. This method only captures text, cannot store structured data, multiple keys, or scoped keys like user:.\\nEventActions.state_delta We can use the state_delta event action for fine-grained control over what gets stored and when. Using this method, we can manually construct the state changes, wrap them in an Event, and append it.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 from google.adk.events import Event, EventActions import time # Define multiple state changes across scopes state_changes = { \\u0026#34;task_status\\u0026#34;: \\u0026#34;active\\u0026#34;, # session scope \\u0026#34;user:login_count\\u0026#34;: 5, # user scope \\u0026#34;user:last_login\\u0026#34;: time.time(), # user scope \\u0026#34;app:maintenance_mode\\u0026#34;: False, # app scope \\u0026#34;temp:validation_result\\u0026#34;: {\\u0026#34;valid\\u0026#34;: True} # invocation scope (discarded after) } event = Event( invocation_id=\\u0026#34;inv_system_update\\u0026#34;, author=\\u0026#34;system\\u0026#34;, actions=EventActions(state_delta=state_changes), timestamp=time.time() ) await session_service.append_event(session, event) This method is useful for system-level updates, multi-key updates, updates to scoped state keys, and other scenarios not tied to the agent\\u0026rsquo;s direct text response.\\nCallbackContext and ToolContext For modifying state inside callbacks and tool functions, using CallbackContext and ToolContext is the recommended approach.\\nInside a callback function, you can use the CallbackContext.state to retrieve or update the state. We will learn about callbacks in a future article in this series.\\nIn a tool function, you can use ToolContext.state to retrieve or update the state.\\n1 2 3 4 5 6 7 8 9 from google.adk.tools import ToolContext def add_to_cart(item: str, tool_context: ToolContext) -\\u0026gt; dict: \\u0026#34;\\u0026#34;\\u0026#34;Adds an item to the shopping cart.\\u0026#34;\\u0026#34;\\u0026#34; cart = tool_context.state.get(\\u0026#34;cart_items\\u0026#34;, []) cart.append(item) tool_context.state[\\u0026#34;cart_items\\u0026#34;] = cart tool_context.state[\\u0026#34;cart_count\\u0026#34;] = len(cart) return {\\u0026#34;status\\u0026#34;: \\u0026#34;added\\u0026#34;, \\u0026#34;item\\u0026#34;: item, \\u0026#34;cart_size\\u0026#34;: len(cart)} In both CallbackContext and ToolContext, you write clean, natural code, context.state[\\u0026quot;key\\u0026quot;] = value, and the framework handles creating EventActions, populating state_delta, calling append_event, and ensuring persistence. There is no boilerplate code required.\\nInjecting state into agent instructions One of ADK\\u0026rsquo;s most powerful features: you can embed state values directly into agent instructions using {key} template syntax.\\n1 2 3 4 5 6 7 8 9 10 from google.adk.agents import LlmAgent agent = LlmAgent( name=\\u0026#34;PersonalizedAgent\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, instruction=\\u0026#34;\\u0026#34;\\u0026#34;You are a helpful assistant for {user:name}. They prefer responses in {user:language}. Their current task is: {current_task}. Their membership tier is: {user:tier}.\\u0026#34;\\u0026#34;\\u0026#34; ) If session.state contains:\\n1 2 3 4 5 6 { \\u0026#34;user:name\\u0026#34;: \\u0026#34;Ravi\\u0026#34;, \\u0026#34;user:language\\u0026#34;: \\u0026#34;English\\u0026#34;, \\u0026#34;current_task\\u0026#34;: \\u0026#34;booking a hotel\\u0026#34;, \\u0026#34;user:tier\\u0026#34;: \\u0026#34;Gold\\u0026#34; } The LLM receives:\\n1 2 3 4 You are a helpful assistant for Ravi. They prefer responses in English. Their current task is: booking a hotel. Their membership tier is: Gold. For this template syntax to work, the key must exist in the state, or the agent will throw an error. We can use {key?} for keys that may be absent. Keys suffixed with a question mark resolve to an empty string if they are missing. The values should be strings or easily convertible to strings. If you need literal curly braces in the agent instructions, you must use InstructionProvider function as shown below.\\n1 2 3 4 5 6 7 8 9 10 11 12 from google.adk.agents import LlmAgent from google.adk.agents.readonly_context import ReadonlyContext def my_instruction(context: ReadonlyContext) -\\u0026gt; str: # This will NOT have {key} replaced — passed as-is to the LLM return \\u0026#34;Format your response as: {{name: string, age: number}}\\u0026#34; agent = LlmAgent( model=\\u0026#34;gemini-2.0-flash\\u0026#34;, name=\\u0026#34;JsonHelper\\u0026#34;, instruction=my_instruction # Function instead of string ) This method is useful when we need full control over instruction generation, including bypassing the {key} templating. For example, when your instruction contains literal curly braces for JSON examples, or you need completely dynamic instruction generation based on state.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 def role_based_instruction(context: ReadonlyContext) -\\u0026gt; str: tier = context.state.get(\\u0026#34;user:tier\\u0026#34;, \\u0026#34;free\\u0026#34;) if tier == \\u0026#34;premium\\u0026#34;: return \\u0026#34;You are a premium concierge. Provide detailed, proactive assistance.\\u0026#34; elif tier == \\u0026#34;enterprise\\u0026#34;: return \\u0026#34;You are an enterprise support specialist. Be thorough and reference documentation.\\u0026#34; else: return \\u0026#34;You are a helpful assistant. Answer questions clearly and concisely.\\u0026#34; agent = LlmAgent( model=\\u0026#34;gemini-2.0-flash\\u0026#34;, name=\\u0026#34;AdaptiveAgent\\u0026#34;, instruction=role_based_instruction ) If you need to inject state via {key} templating but need to preserve the literal braces, you must use inject_session_state() method.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 from google.adk.utils import instructions_utils async def dynamic_instruction(context: ReadonlyContext) -\\u0026gt; str: template = \\u0026#34;\\u0026#34;\\u0026#34;You are helping {user:name}. Format your output as: {{result: string, confidence: number}}\\u0026#34;\\u0026#34;\\u0026#34; return await instructions_utils.inject_session_state(template, context) agent = LlmAgent( model=\\u0026#34;gemini-2.0-flash\\u0026#34;, name=\\u0026#34;HybridAgent\\u0026#34;, instruction=dynamic_instruction ) The instructions_utils.inject_session_state(template, context) injects the {user:name} state variable but preserves the literal braces.\\nMemory A session tracks the history and temporary data for a single, ongoing conversation. To enable history and state persistence across conversations and enable agents to recall the information from past interactions, we must use the memory service. There are two types of memory service.\\nThe InMemoryMemoryService is used for quick prototyping and local testing of agents, and it is good for basic keyword search. Using this requires no setup, stores session data in application memory, and does not provide persistence. The VertexAiMemoryBankService connects to the Vertex AI memory bank service and provides LLM-based extraction of meaningful information from sessions. This service persists data in Google Cloud and is production-ready. Each of these memory services offers two operations.\\nIngest: memory_service.add_session_to_memory(session) takes a completed session and adds its information to the long-term store Search: memory_service.search_memory(app_name, user_id, query) returns relevant snippets from past sessions These memory services also offer tools that agents can use in their work.\\nPreloadMemoryTool automatically retrieves relevant memories at the start of every turn (like a callback that always fires) LoadMemoryTool (or load_memory) lets the agent decide when to search memory (on-demand) Here is an example of working with InMemoryMemoryService.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 from google.adk.agents import LlmAgent from google.adk.sessions import InMemorySessionService from google.adk.memory import InMemoryMemoryService from google.adk.runners import Runner from google.adk.tools import load_memory from google.genai.types import Content, Part import asyncio # --- Setup services (shared across runners) --- session_service = InMemorySessionService() memory_service = InMemoryMemoryService() # --- Step 1: Agent captures information --- capture_agent = LlmAgent( model=\\u0026#34;gemini-2.0-flash\\u0026#34;, name=\\u0026#34;CaptureAgent\\u0026#34;, instruction=\\u0026#34;Acknowledge what the user tells you.\\u0026#34; ) runner1 = Runner( agent=capture_agent, app_name=\\u0026#34;memory_app\\u0026#34;, session_service=session_service, memory_service=memory_service ) async def main(): session1 = await session_service.create_session( app_name=\\u0026#34;memory_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34;, session_id=\\u0026#34;session_capture\\u0026#34; ) # Run the agent with user input user_msg = Content( parts=[ Part( text=\\u0026#34;My favorite color is blue and I love hiking.\\u0026#34; ) ], role=\\u0026#34;user\\u0026#34; ) async for event in runner1.run_async(user_id=\\u0026#34;user1\\u0026#34;, session_id=\\u0026#34;session_capture\\u0026#34;, new_message=user_msg): pass # Agent processes and responds # --- Step 2: Ingest session into memory --- completed_session = await session_service.get_session( app_name=\\u0026#34;memory_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34;, session_id=\\u0026#34;session_capture\\u0026#34; ) await memory_service.add_session_to_memory(completed_session) # --- Step 3: New session, recall from memory --- recall_agent = LlmAgent( model=\\u0026#34;gemini-2.0-flash\\u0026#34;, name=\\u0026#34;RecallAgent\\u0026#34;, instruction=\\u0026#34;Answer questions using past conversation context. \\u0026#34; \\u0026#34;Use the load_memory tool to search past conversations.\\u0026#34;, tools=[load_memory] ) runner2 = Runner( agent=recall_agent, app_name=\\u0026#34;memory_app\\u0026#34;, session_service=session_service, memory_service=memory_service ) session2 = await session_service.create_session( app_name=\\u0026#34;memory_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34;, session_id=\\u0026#34;session_recall\\u0026#34; ) recall_msg = Content(parts=[Part(text=\\u0026#34;What\\u0026#39;s my favorite color?\\u0026#34;)], role=\\u0026#34;user\\u0026#34;) async for event in runner2.run_async(user_id=\\u0026#34;user1\\u0026#34;, session_id=\\u0026#34;session_recall\\u0026#34;, new_message=recall_msg): if event.is_final_response() and event.content and event.content.parts: print(event.content.parts[0].text) # Expected: Something like \\u0026#34;Your favorite color is blue!\\u0026#34; if __name__ == \\u0026#34;__main__\\u0026#34;: asyncio.run(main()) When you run this, the first runner stores the user preference in memory. This is done using add_session_to_memory method. The second runner then uses the basic keyword match provided by the memory service to generate the response. The load_memory tool provided to the recall_agent automatically retrieves the memory for search.\\n1 2 3 PS\\u0026gt; python.exe .\\\\inmemory-memory.py .... Your favorite color is blue. The process of saving memory can be automated using agent callbacks. We will learn about this in a later article in the series.\\nHere is another example where we use InMemoryMemoryService and help agent track the conversation progress through state.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 import asyncio from google.adk.agents import LlmAgent from google.adk.sessions import InMemorySessionService from google.adk.runners import Runner from google.adk.tools import ToolContext from google.genai.types import Content, Part # --- Tool that modifies state --- def search_flights( origin: str, destination: str, tool_context: ToolContext ) -\\u0026gt; dict: \\u0026#34;\\u0026#34;\\u0026#34;Searches for flights between two cities.\\u0026#34;\\u0026#34;\\u0026#34; results = [ {\\u0026#34;flight\\u0026#34;: \\u0026#34;AA101\\u0026#34;, \\u0026#34;price\\u0026#34;: 450, \\u0026#34;time\\u0026#34;: \\u0026#34;8:00 AM\\u0026#34;}, {\\u0026#34;flight\\u0026#34;: \\u0026#34;UA202\\u0026#34;, \\u0026#34;price\\u0026#34;: 380, \\u0026#34;time\\u0026#34;: \\u0026#34;11:30 AM\\u0026#34;}, {\\u0026#34;flight\\u0026#34;: \\u0026#34;DL303\\u0026#34;, \\u0026#34;price\\u0026#34;: 520, \\u0026#34;time\\u0026#34;: \\u0026#34;3:00 PM\\u0026#34;}, ] # Save search context to state for next turn tool_context.state[\\u0026#34;search_results\\u0026#34;] = results tool_context.state[\\u0026#34;origin\\u0026#34;] = origin tool_context.state[\\u0026#34;destination\\u0026#34;] = destination tool_context.state[\\u0026#34;booking_step\\u0026#34;] = \\u0026#34;select_flight\\u0026#34; return {\\u0026#34;flights\\u0026#34;: results} def book_flight( flight_number: str, tool_context: ToolContext ) -\\u0026gt; dict: \\u0026#34;\\u0026#34;\\u0026#34;Books a specific flight.\\u0026#34;\\u0026#34;\\u0026#34; results = tool_context.state.get(\\u0026#34;search_results\\u0026#34;, []) selected = next((f for f in results if f[\\u0026#34;flight\\u0026#34;] == flight_number), None) if not selected: return {\\u0026#34;error\\u0026#34;: f\\u0026#34;Flight {flight_number} not found in search results\\u0026#34;} tool_context.state[\\u0026#34;booked_flight\\u0026#34;] = selected tool_context.state[\\u0026#34;booking_step\\u0026#34;] = \\u0026#34;confirmed\\u0026#34; tool_context.state[\\u0026#34;user:total_bookings\\u0026#34;] = ( tool_context.state.get(\\u0026#34;user:total_bookings\\u0026#34;, 0) + 1 ) return {\\u0026#34;status\\u0026#34;: \\u0026#34;confirmed\\u0026#34;, \\u0026#34;flight\\u0026#34;: selected} # --- Agent --- booking_agent = LlmAgent( name=\\u0026#34;BookingAgent\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, instruction=\\u0026#34;\\u0026#34;\\u0026#34;You are a flight booking assistant. Current booking step: {booking_step?} Help users search for and book flights. If they\\u0026#39;ve already searched, reference the results in state.\\u0026#34;\\u0026#34;\\u0026#34;, tools=[search_flights, book_flight], output_key=\\u0026#34;last_response\\u0026#34; ) # --- Runner and Session --- async def main(): session_service = InMemorySessionService() runner = Runner( agent=booking_agent, app_name=\\u0026#34;booking_app\\u0026#34;, session_service=session_service ) session = await session_service.create_session( app_name=\\u0026#34;booking_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34;, state={\\u0026#34;booking_step\\u0026#34;: \\u0026#34;start\\u0026#34;, \\u0026#34;user:name\\u0026#34;: \\u0026#34;Ravi\\u0026#34;} ) # Turn 1: Search msg1 = Content(parts=[Part(text=\\u0026#34;Find flights from NYC to Paris\\u0026#34;)], role=\\u0026#34;user\\u0026#34;) async for event in runner.run_async( user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id, new_message=msg1 ): if event.is_final_response() and event.content: print(f\\u0026#34;Agent: {event.content.parts[0].text}\\u0026#34;) # Check state after Turn 1 s = await session_service.get_session( app_name=\\u0026#34;booking_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id ) print(f\\u0026#34;State: booking_step={s.state.get(\\u0026#39;booking_step\\u0026#39;)}\\u0026#34;) print(f\\u0026#34;State: origin={s.state.get(\\u0026#39;origin\\u0026#39;)}\\u0026#34;) # Turn 2: Book msg2 = Content(parts=[Part(text=\\u0026#34;Book UA202 please\\u0026#34;)], role=\\u0026#34;user\\u0026#34;) async for event in runner.run_async( user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id, new_message=msg2 ): if event.is_final_response() and event.content: print(f\\u0026#34;Agent: {event.content.parts[0].text}\\u0026#34;) # Check final state s = await session_service.get_session( app_name=\\u0026#34;booking_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id ) print(f\\u0026#34;State: booking_step={s.state.get(\\u0026#39;booking_step\\u0026#39;)}\\u0026#34;) print(f\\u0026#34;State: user:total_bookings={s.state.get(\\u0026#39;user:total_bookings\\u0026#39;)}\\u0026#34;) asyncio.run(main()) When you run this, you can observe how the agent uses the state updates to track progress.\\n1 2 3 4 5 6 7 8 9 10 \\u0026gt; python.exe .\\\\inmemory-track-state.py Agent: OK. I found three flights for you: AA101 at 8:00 AM for $450, UA202 at 11:30 AM for $380, and DL303 at 3:00 PM for $520. State: booking_step=select_flight State: origin=NYC Agent: OK. I have booked flight UA202 for you. It departs at 11:30 AM and the price is $380. State: booking_step=confirmed State: user:total_bookings=1 Understanding how ADK uses Sessions, state, and memory to enable agents to persist conversational state and recall past interactions is important for developing efficient agent workflows. This article explored this in-depth and demonstrated session and memory capabilities using InMemorySessionService and InMemoryMemoryService. The fundamentals you learned about the overall workflow stay the same for other session and memory service types that provide persistence. I recommend that you experiment with those services.\\n\"",
  "url": "https:\/\/ravichaganti.com\/blog\/google-adk-sessions-state-and-memory\/",
  "datePublished": "2025-12-05T00:00:00Z",
  "dateModified": "2025-12-05T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Ravikanth Chaganti"
    ,"sameAs": ["https://twitter.com/ravikanth"]
  },
  "publisher": {
    "@type": "Person",
    "name": "Ravikanth Chaganti",
    "sameAs": ["https://twitter.com/ravikanth"]
  },
  
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/ravichaganti.com\/images\/adk.png",
    "width": 1200,
    "height": 630
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/ravichaganti.com\/blog\/google-adk-sessions-state-and-memory\/"
  },
  
  "articleSection": "\"Google\"",
  
  
  
  "timeRequired": "PT17M",
  
  "inLanguage": "en-US",
  "isAccessibleForFree": true
}
</script>




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https:\/\/ravichaganti.com\/"
    }
    ,
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https:\/\/ravichaganti.com\/blog/"
    }
    
    ,
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Google",
      "item": "https:\/\/ravichaganti.com\/categories/google/"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Google ADK - Sessions, state, and memory",
      "item": "https:\/\/ravichaganti.com\/blog\/google-adk-sessions-state-and-memory\/"
    }
    
    
  ]
}
</script>


</head>

<body class="flex flex-col min-h-screen bg-gray-50 dark:bg-dark-bg">
  <header class="sticky top-0 z-50 bg-white dark:bg-dark-bg-secondary shadow-md relative">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      
      <div class="flex items-center">
        <a href="https://ravichaganti.com/" class="flex items-center gap-3 text-gray-900 dark:text-dark-text hover:text-primary transition-colors no-underline group">
          
          <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
            <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2" class="group-hover:stroke-primary transition-colors"/>
            <text x="20" y="26" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="currentColor">RC</text>
          </svg>
          
          <div class="flex flex-col leading-tight">
            <span class="text-xs sm:text-sm font-semibold">Cloud Native</span>
            <span class="text-xs sm:text-sm font-semibold">Agentic AI</span>
            <span class="text-xs sm:text-sm font-semibold">Infrastructure</span>
          </div>
        </a>
      </div>

      
      <div class="hidden md:flex items-center space-x-8">
        
          <a href="/blog/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Blog
          </a>
        
          <a href="/books/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Books
          </a>
        
          <a href="https://learn.ravichaganti.com" target="_blank" rel="noopener noreferrer" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Courses
          </a>
        
          <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank" rel="noopener noreferrer" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Newsletter
          </a>
        
          <a href="/about/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            About
          </a>
        
      </div>

      
      <div class="hidden md:flex items-center space-x-4 relative" id="social-search-container">
        
        <div id="social-icons" class="flex items-center space-x-3">
          

<a href="https://twitter.com/ravikanth" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Twitter">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
  </svg>
</a>



<a href="https://github.com/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="GitHub">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
  </svg>
</a>



<a href="https://linkedin.com/in/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="LinkedIn">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
  </svg>
</a>




        </div>

        
        <button
          id="theme-toggle"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="search-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <div id="search-box" class="hidden absolute top-full right-0 mt-2 w-80 bg-white dark:bg-dark-bg-secondary shadow-lg p-4 z-50 rounded-lg">
          





<div class="relative search-container" data-mode="desktop">
  <input
    type="text"
    id="search-input-desktop"
    placeholder="Search articles..."
    class="search-input w-full px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results-desktop" class="search-results absolute top-full mt-2 w-full bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-80 overflow-y-auto z-50">
    
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>


<script>
(function() {
  let headerFuse;
  let headerSearchData = [];
  let searchInitialized = false;

  
  fetch('/index.json')
    .then(response => response.json())
    .then(data => {
      headerSearchData = data;

      
      const options = {
        keys: [
          { name: 'title', weight: 3 },
          { name: 'excerpt', weight: 2 },
          { name: 'content', weight: 1 },
          { name: 'categories', weight: 1.5 },
          { name: 'series', weight: 1.5 }
        ],
        threshold: 0.4,
        includeScore: true,
        ignoreLocation: true,
        minMatchCharLength: 2
      };

      headerFuse = new Fuse(headerSearchData, options);
      searchInitialized = true;
    })
    .catch(error => console.error('Error loading search index:', error));

  
  function renderResults(results, resultsContainer) {
    if (results.length === 0) {
      resultsContainer.innerHTML = '<div class="p-4 text-center text-gray-500 dark:text-dark-text-secondary text-sm">No results found</div>';
      resultsContainer.classList.remove('hidden');
      return;
    }

    resultsContainer.innerHTML = results.slice(0, 5).map(result => {
      const item = result.item;
      const date = new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

      return `
        <a href="${item.permalink}" class="block p-3 hover:bg-gray-50 dark:hover:bg-dark-bg-tertiary border-b border-gray-100 dark:border-dark-border last:border-b-0 no-underline">
          <div class="font-medium text-sm text-gray-900 dark:text-dark-text mb-1">${item.title}</div>
          <div class="flex items-center gap-2 mb-1 flex-wrap">
            <span class="text-xs text-gray-500 dark:text-dark-text-secondary">${date}</span>
            ${item.categories ? item.categories.slice(0, 2).map(cat => `
              <span class="inline-block px-1.5 py-0.5 text-xs rounded bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400">
                ${cat}
              </span>
            `).join('') : ''}
          </div>
          ${item.excerpt ? `<p class="text-xs text-gray-600 dark:text-dark-text-secondary line-clamp-2">${item.excerpt}</p>` : ''}
        </a>
      `;
    }).join('');

    resultsContainer.classList.remove('hidden');
  }

  
  function initSearchContainers() {
    const containers = document.querySelectorAll('.search-container');

    containers.forEach(container => {
      const searchInput = container.querySelector('.search-input');
      const searchResults = container.querySelector('.search-results');

      if (!searchInput || !searchResults) return;

      
      searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();

        if (query.length < 2 || !searchInitialized) {
          searchResults.classList.add('hidden');
          return;
        }

        const results = headerFuse.search(query);
        renderResults(results, searchResults);
      });

      
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          searchResults.classList.add('hidden');
          searchInput.blur();
        }
      });
    });

    
    function closeAllResults(e) {
      const containers = document.querySelectorAll('.search-container');
      containers.forEach(container => {
        const searchResults = container.querySelector('.search-results');
        if (searchResults && !container.contains(e.target)) {
          searchResults.classList.add('hidden');
        }
      });
    }

    document.addEventListener('click', closeAllResults);
    document.addEventListener('touchend', closeAllResults);
  }

  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSearchContainers);
  } else {
    initSearchContainers();
  }
})();
</script>


        </div>
      </div>

      
      <div class="md:hidden flex items-center gap-2">
        
        <button id="search-toggle-mobile" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <button
          id="theme-toggle-mobile"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="mobile-menu-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded" aria-label="Menu">
          <svg class="w-6 h-6 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    
    <div id="search-box-mobile" class="hidden md:hidden absolute top-full left-0 right-0 bg-white dark:bg-dark-bg-secondary shadow-lg p-4 z-50">
      





<div class="relative search-container" data-mode="mobile">
  <input
    type="text"
    id="search-input-mobile"
    placeholder="Search articles..."
    class="search-input w-full px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results-mobile" class="search-results absolute top-full mt-2 w-full bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-80 overflow-y-auto z-50">
    
  </div>
</div>




    </div>

    
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4">
      
        <a href="/blog/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Blog
        </a>
      
        <a href="/books/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Books
        </a>
      
        <a href="https://learn.ravichaganti.com" target="_blank" rel="noopener noreferrer" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Courses
        </a>
      
        <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank" rel="noopener noreferrer" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Newsletter
        </a>
      
        <a href="/about/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          About
        </a>
      
    </div>
  </nav>

  
  
    <div id="reading-progress" class="absolute bottom-0 left-0 w-full h-1 bg-primary transition-all duration-200 z-10" style="width: 0%; max-width: 100%;"></div>
  
</header>


<script>
  document.getElementById('mobile-menu-toggle')?.addEventListener('click', function() {
    const menu = document.getElementById('mobile-menu');
    menu?.classList.toggle('hidden');
  });

  
  document.getElementById('search-toggle')?.addEventListener('click', function() {
    const searchBox = document.getElementById('search-box');
    searchBox?.classList.toggle('hidden');
    if (!searchBox?.classList.contains('hidden')) {
      searchBox?.querySelector('.search-input')?.focus();
    }
  });

  
  document.getElementById('search-toggle-mobile')?.addEventListener('click', function() {
    const searchBoxMobile = document.getElementById('search-box-mobile');
    searchBoxMobile?.classList.toggle('hidden');
    if (!searchBoxMobile?.classList.contains('hidden')) {
      searchBoxMobile?.querySelector('.search-input')?.focus();
    }
  });

  
  document.addEventListener('click', function(e) {
    const searchBox = document.getElementById('search-box');
    const searchToggle = document.getElementById('search-toggle');
    if (searchBox && searchToggle && !searchBox.contains(e.target) && !searchToggle.contains(e.target)) {
      searchBox.classList.add('hidden');
    }
  });

  
  document.addEventListener('click', function(e) {
    const searchBoxMobile = document.getElementById('search-box-mobile');
    const searchToggleMobile = document.getElementById('search-toggle-mobile');
    if (searchBoxMobile && searchToggleMobile && !searchBoxMobile.contains(e.target) && !searchToggleMobile.contains(e.target)) {
      searchBoxMobile.classList.add('hidden');
    }
  });
</script>


  <main class="flex-grow">
    
<article class="container mx-auto px-4 sm:px-6 md:px-4 py-8 sm:py-10 md:py-12">
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-[75%_25%] gap-8">
      
      <div class="min-w-0">
        
        <header class="mb-8">
          
          <nav class="text-xs sm:text-sm mb-4">
            <ol class="flex items-center space-x-2 text-gray-600 dark:text-dark-text-secondary">
              <li><a href="https://ravichaganti.com/" class="hover:text-primary dark:hover:text-blue-400">Home</a></li>
              <li><span class="mx-2">/</span></li>
              <li><a href="/blog/" class="hover:text-primary dark:hover:text-blue-400">Blog</a></li>
              
              <li><span class="mx-2">/</span></li>
              <li><a href="/categories/google/" class="hover:text-primary dark:hover:text-blue-400">Google</a></li>
              
            </ol>
          </nav>

          
          <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-dark-text mb-6">
            Google ADK - Sessions, state, and memory
          </h1>

          
          <div
            class="flex flex-wrap items-center gap-2 sm:gap-3 md:gap-4 text-sm sm:text-base text-gray-600 dark:text-dark-text-secondary mb-6">
            
            <div class="flex items-center">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <time datetime=" 2025-12-05">December 5, 2025</time>
            </div>

            
            
            <span>•</span>
            <div class="flex items-center">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span>17 min read</span>
            </div>
            

            
            
          </div>

          
          <div class="flex flex-wrap gap-2 mb-6">
            
            
            <a href="/categories/google/"
              class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Google
            </a>
            
            <a href="/categories/agent-development-kit/"
              class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Agent Development Kit
            </a>
            
            <a href="/categories/agents/"
              class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Agents
            </a>
            
            
            
            
            <a href="/series/google-adk/"
              class="inline-block px-3 py-1 text-sm font-medium bg-secondary/10 dark:bg-secondary/20 text-secondary dark:text-purple-400 rounded-full hover:bg-secondary/20 dark:hover:bg-secondary/30 transition-colors no-underline">
              📚 Series: Google ADK
            </a>
            
            
          </div>

          
          
          <div
            class="text-base sm:text-lg md:text-xl text-gray-700 dark:text-dark-text-secondary italic border-l-4 border-primary dark:border-blue-400 pl-4 sm:pl-6 py-2 mb-6 sm:mb-8 bg-gray-50 dark:bg-dark-bg-tertiary rounded-r">
            LLMs are stateless. Every API call to an LLM is independent. The model does not inherently remember what was said before. Yet meaningful conversations are inherently multi-turn, contextual, and stateful.
          </div>
          
        </header>

        
        


  
  
  
    <aside class="bg-gradient-to-br from-secondary/5 to-primary/5 dark:from-secondary/10 dark:to-primary/10 rounded-lg shadow-md dark:shadow-2xl dark:shadow-black/20 p-4 mb-6 border border-secondary/20 dark:border-secondary/30">
      
      <button
        class="flex items-center justify-between w-full text-left font-semibold text-base text-gray-900 dark:text-dark-text hover:text-secondary dark:hover:text-purple-400 transition-colors"
        aria-expanded="false"
        aria-controls="series-content"
      >
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          Series: Google ADK
        </span>
        <svg
          id="series-chevron"
          class="w-4 h-4 transform transition-transform -rotate-90"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      
      <p class="text-xs text-gray-600 dark:text-dark-text-secondary mt-2 mb-2 collapsed" id="series-description">
        Part of a 9-part series
      </p>

      
      <nav id="series-content" class="series-content collapsed mt-1">
        <ol class="space-y-3">
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                1
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/introduction-to-google-agent-development-kit/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Introduction to Google Agent Development Kit
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 1, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                2
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-types-of-agents/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - types of agents
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 3, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                3
              </span>
              <div class="flex-grow">
                
                  <span class="font-bold text-secondary dark:text-purple-400">
                    Google ADK - Sessions, state, and memory
                    <span class="text-xs ml-2 px-2 py-0.5 bg-secondary dark:bg-purple-600 text-white rounded">You are here</span>
                  </span>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 5, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                4
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-callbacks/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - Callbacks
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 12, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                5
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-runner-and-execution-architecture/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - Runner and execution architecture
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 18, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                6
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - MCP tools
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 20, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                7
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 23, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                8
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-a-multi-agent-linkedin-newsletter-system-with-google-adk/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building a Multi-Agent LinkedIn Newsletter System with Google ADK
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Jan 26, 2026</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                9
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-multi-agent-systems-with-google-adk-and-the-a2a-protocol/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building multi-agent systems with Google ADK and the A2A protocol
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Jan 27, 2026</p>
              </div>
            </li>
          
        </ol>

        
        <div class="mt-6 pt-6 border-t border-secondary/20 dark:border-secondary/30 grid grid-cols-2 gap-4">
          
          
            
          
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          

          
          
            
            <a href="https://ravichaganti.com/blog/google-adk-types-of-agents/" class="flex items-center text-sm text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline group">
              <svg class="w-4 h-4 mr-1 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              <span class="truncate">Google ADK - types of agents</span>
            </a>
          

          
          
            
            <a href="https://ravichaganti.com/blog/google-adk-callbacks/" class="flex items-center justify-end text-sm text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline group">
              <span class="truncate">Google ADK - Callbacks</span>
              <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          
        </div>
      </nav>
    </aside>
  



        
        <div class="block lg:hidden mobile-toc-container">
          

  
    <div class="bg-white dark:bg-dark-bg-secondary rounded-lg shadow-md dark:shadow-2xl dark:shadow-black/20 p-4 mb-6 border border-gray-200 dark:border-dark-border">
      
      <button
        class="flex items-center justify-between w-full text-left font-semibold text-base text-gray-900 dark:text-dark-text hover:text-primary dark:hover:text-blue-400 transition-colors"
        aria-expanded="false"
        aria-controls="toc-content"
      >
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
          </svg>
          Table of Contents
        </span>
        <svg
          id="toc-chevron"
          class="w-4 h-4 transform transition-transform -rotate-90"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      
      <nav id="toc-content" class="toc-content collapsed text-sm mt-3">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#agent-memory">Agent memory</a></li>
    <li><a href="#sessions">Sessions</a>
      <ul>
        <li><a href="#state">State</a></li>
        <li><a href="#events">Events</a></li>
        <li><a href="#reading-and-writing-state">Reading and writing state</a></li>
        <li><a href="#injecting-state-into-agent-instructions">Injecting state into agent instructions</a></li>
      </ul>
    </li>
    <li><a href="#memory">Memory</a></li>
  </ul>
</nav>
      </nav>
    </div>

    <style>
      #toc-content ul {
        list-style: none;
        padding-left: 1rem;
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
      }
      #toc-content > nav > ul {
        padding-left: 0;
      }
      #toc-content li {
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
      }
      #toc-content a {
        color: #374151;
        text-decoration: none;
        transition: color 0.2s;
      }
      #toc-content a:hover {
        color: #1e40af;
        text-decoration: underline;
      }
       
      .dark #toc-content a {
        color: #cbd5e1;
      }
      .dark #toc-content a:hover {
        color: #60a5fa;
      }
    </style>
  


        </div>

        <style>
          @media (min-width: 1024px) {
            .mobile-toc-container {
              display: none !important;
            }

             
            html,
            body,
            main,
            article,
            .container,
            .max-w-7xl,
            .grid,
            aside {
              overflow: visible !important;
              height: auto !important;
            }

             
            .sidebar-sticky-reinforced {
              position: -webkit-sticky !important;
              position: sticky !important;
              top: 130px !important;
              z-index: 100;
              align-self: start;
              height: fit-content;
            }
          }
        </style>

        
        <div class="prose prose-sm sm:prose-base md:prose-lg max-w-none mb-8 sm:mb-10 md:mb-12">
          <p>Imagine you built a travel-booking agent. A user says, &ldquo;Find flights to Paris, and the agent returns options. Then the user says, &ldquo;Book the second one.&rdquo; Without any memory of the previous turn, the agent has no idea what &ldquo;the second one&rdquo; refers to. The conversation is dead. This is the fundamental problem with LLMs. LLMs are stateless. Every API call to an LLM is independent. The model does not inherently remember what was said before. Yet meaningful conversations are inherently multi-turn, contextual, and stateful. This is where agent memory comes into play. Agent memory is the system built around the LLM to allow it to retain information, learn from past interactions, and maintain continuity within and across conversations.</p>
<h2 id="agent-memory">Agent memory</h2>
<p>At a high-level, there are three types of memory.</p>
<ul>
<li><em>Short-term or working memory</em> is what&rsquo;s currently visible within the model&rsquo;s context window. This is needed for continuity in the current conversation. It includes the current prompt, the immediate conversation history, and a scratch pad where the agent reasons through a problem. This memory is volatile. The information in this memory will be lost once the conversation ends or the context limit is reached. There are methods to compact the context and continue the conversation.</li>
<li><em>Long-term memory</em> is usually stored externally, mostly in a vector database, and retrieved when needed using techniques such as RAG. This is used to store events &amp; experiences (episodic memory) and facts &amp; knowledge (semantic memory). This allows an agent to recall user preferences, past decisions, and specific interaction history.</li>
<li><em>Procedural memory</em> is the implicit knowledge of how to perform tasks. This is usually represented by the available tools and instructions for using them.</li>
</ul>
<p>When developing agents with Google ADK, sessions and memory enable the agent to retain information, learn from past interactions, and maintain continuity within and across conversations. Let us dive into these concepts.</p>
<p><figure class="figure " style="max-width: 50%; height: 50%; margin: 1.5rem auto;">
  <a href="/images/adk-mem.png" class="glightbox" data-gallery="post-images" data-glightbox="description: " style="display: block; height: 100%;">
    <img src="/images/adk-mem.png" alt="" loading="lazy" style="width: 100%; height: 100%; object-fit: cover; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  
  
  <script src="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/js/glightbox.min.js"></script>
  
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const lightbox = GLightbox({
        selector: '.glightbox',
        touchNavigation: true,
        loop: true,
        autoplayVideos: true,
        zoomable: true,
        draggable: true,
        closeButton: true,
        moreLength: 0
      });
    });
  </script></p>
<h2 id="sessions">Sessions</h2>
<p>A session in Google ADK is a single, ongoing interaction between the user and your agent. Think of it as one chat thread. It contains the chronological history of everything that happened (as Events) and a scratchpad of data relevant to this conversation (State). A <code>Session</code> object is the container for one conversation thread. Some of the key properties of the <code>Session</code> object are:</p>
<table>
  <thead>
      <tr>
          <th>Property</th>
          <th>Type</th>
          <th>Purpose</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>id</code></td>
          <td><code>str</code></td>
          <td>Unique identifier for this specific conversation</td>
      </tr>
      <tr>
          <td><code>app_name</code></td>
          <td><code>str</code></td>
          <td>Which agent application does this belong to</td>
      </tr>
      <tr>
          <td><code>user_id</code></td>
          <td><code>str</code></td>
          <td>Which user owns this conversation</td>
      </tr>
      <tr>
          <td><code>state</code></td>
          <td><code>dict</code></td>
          <td>Key-value scratchpad</td>
      </tr>
      <tr>
          <td><code>events</code></td>
          <td><code>list[Event]</code></td>
          <td>Chronological history of all interactions</td>
      </tr>
      <tr>
          <td><code>last_update_time</code></td>
          <td><code>float</code></td>
          <td>Timestamp of the most recent event</td>
      </tr>
  </tbody>
</table>
<p>To create and manage sessions, we use the <code>SessionService</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.sessions</span> <span class="kn">import</span> <span class="n">InMemorySessionService</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">session_service</span> <span class="o">=</span> <span class="n">InMemorySessionService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a new session</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;travel_agent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user_123&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">state</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;user:name&#34;</span><span class="p">:</span> <span class="s2">&#34;Ravi&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can list all sessions for a user using the <code>list_sessions</code> method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">sessions</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">list_sessions</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;my_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user_42&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sessions</span><span class="o">.</span><span class="n">sessions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Session </span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> — last updated: </span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">last_update_time</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>To get an existing session, we use the <code>get_session</code> method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;my_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user_42&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span><span class="o">=</span><span class="s2">&#34;custom_id_optional&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">events</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can use the <code>delete_session</code> method to delete a session.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">delete_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;my_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user_42&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span><span class="o">=</span><span class="s2">&#34;custom_id_optional&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>InMemorySessionService</code> stores all session data directly in the application&rsquo;s memory; therefore, all conversation history will be lost if the application restarts. The <code>DatabaseSessionService</code> and <code>VertextAiSessionService</code> provide session persistence. The <code>InMemorySessionService</code> service is a good fit for quick development and local testing.</p>
<p>As discussed, a <code>Session</code> object is a container for a conversation thread. This object contains <code>state</code> and <code>events</code>.</p>
<h3 id="state">State</h3>
<p>The <code>state</code> is the agent&rsquo;s working memory for the current conversation, and it is a dictionary holding key-value pairs. This is the agent&rsquo;s scratchpad, which is updated during a conversation. This scratchpad can be used to track and recall information such as user preferences and task execution progress, and to store any information that will be useful during an agent&rsquo;s execution. For the state, the keys must be strings. The values associated with these must be serializable.</p>
<p>You can organize session state into multiple scopes. This is determined using the prefix on the state keys. Scope determines who can see the state and how long it lives.</p>
<h4 id="session-scope">Session Scope</h4>
<p>When the state key has no prefix, it becomes a part of the current session scope. This is useful for tracking progress on the current task or for temporary flags.</p>
<p><code>session.state['current_step'] = 'payment'</code> sets the <code>current_step</code> key to <code>payment</code> in the current session.</p>
<h4 id="user-scope">User Scope</h4>
<p>When the state keys has <code>user:</code> prefix, it becomes a user state. It gets tied to <code>user_id</code> and is shared across all sessions for that user within the same application (<code>app_name</code>). This scoped state is best for storing user preferences and task-specific details for the user.</p>
<p><code>session.state['user:preferred_payment_mode'] = 'card'</code> sets and tracks user&rsquo;s payment mode preference.</p>
<h4 id="app-scope">App Scope</h4>
<p>You can use the app scope when you need state that is shared across all users and sessions for an application. This is useful for global settings that apply to all users and all sessions.</p>
<p><code>session.state['app:payment_api'] = 'http://payments.yourbank.com'</code> sets app-wide the payments API endpoint.</p>
<h4 id="temporary-scope">Temporary Scope</h4>
<p>Finally, if you want to track the state within the current invocation only, use the <code>temp</code> prefix. For example, state variables such as tool call results, which are relevant only to the current invocation, can be set as a <code>temp</code> scope.</p>
<p><code>session.state['temp:raw_api_response'] = {...}</code> sets <code>raw_api_response</code> as a state variable in the current invocation.</p>
<p>Except for the temporary scoped state, other scoped states can be persisted when using the database or Vertex AI services as a session service.</p>
<p>Your agent code sees a single, flat <code>session.state</code> dictionary. The <code>SessionService</code> handles the magic of merging state from different scopes behind the scenes. When you read <code>session.state['user:name']</code>, the service fetches it from the user-level store. When you read <code>session.state['cart_total']</code>, it comes from the session-level store. It&rsquo;s all transparent.</p>
<h3 id="events">Events</h3>
<p>Everything that happens in a session is recorded as an event. Events are the fundamental units of information flow in Google ADK agents. They carry user messages, agent responses, tool calls, tool results, state changes, and control signals. An event loop is at the heart of the ADK runtime and facilitates the communication between the <code>Runner</code> component and the agent execution. When a user prompt arrives, the <code>Runner</code> hands it over to the agent for processing. The agent runs until it has something to yield, at which point it emits an event. The <code>Runner</code> receives the event, processes any associated actions, calls the session service to append the event to the current state, and forwards the event. After the <code>Runner</code> completes event processing, the agent resumes from where it was paused and continues this loop until it has no more events to yield. The <code>Runner</code> component is the central orchestrator of this event loop. The agent or execution logic running within the event loop yields or emits events. An <code>event</code> has the following structure.</p>
<blockquote>
<p>We will dive into <code>Runner</code> and its architecture in a later part of this series.</p>
</blockquote>
<table>
  <thead>
      <tr>
          <th>Field</th>
          <th>Purpose</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>id</code></td>
          <td>Unique identifier for this specific event</td>
      </tr>
      <tr>
          <td><code>invocation_id</code></td>
          <td>Groups all events from one user-request-to-final-response cycle</td>
      </tr>
      <tr>
          <td><code>author</code></td>
          <td><code>'user'</code> or agent name (e.g., <code>'WeatherAgent'</code>)</td>
      </tr>
      <tr>
          <td><code>content</code></td>
          <td>The payload (text, function calls, or function responses)</td>
      </tr>
      <tr>
          <td><code>actions</code></td>
          <td>Side effects (state_delta, artifact_delta, transfer_to_agent, escalate)</td>
      </tr>
      <tr>
          <td><code>timestamp</code></td>
          <td>When this event was created</td>
      </tr>
      <tr>
          <td><code>partial</code></td>
          <td><code>True</code> if this is a streaming chunk, not yet complete</td>
      </tr>
  </tbody>
</table>
<p>Besides the <code>content</code>, the <code>actions</code> field contains an important piece of information that decides the next step in the event loop. The <code>actions</code> field is where state changes and control flow signals live. State is never updated in-place. Every state change flows through an Event&rsquo;s <code>state_delta</code>. When the <code>SessionService</code> processes <code>append_event(session, event)</code>, it reads <code>event.actions.state_delta</code> and applies those changes to the persisted state. This is the only reliable path for state updates.</p>
<p>In an earlier article on <a href="http://localhost:1313/blog/building-a-multi-agent-linkedin-newsletter-system-with-google-adk/">building a multi-agent workflow</a> using Google ADK, we saw how <code>event.actions.escalate</code> was used to signal the workflow&rsquo;s termination.</p>
<h3 id="reading-and-writing-state">Reading and writing state</h3>
<p>You can read state from a <code>Session</code> object, from <code>CallbackContext</code>, or from <code>ToolContext</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># From a session object (read-only recommended)</span>
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span><span class="n">app_name</span><span class="o">=</span><span class="n">APP</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">UID</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">SID</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">language</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;user:preferred_payment_mode&#34;</span><span class="p">,</span> <span class="s2">&#34;card&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">step</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;booking_step&#34;</span><span class="p">,</span> <span class="s2">&#34;start&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># From a callback context</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_callback</span><span class="p">(</span><span class="n">callback_context</span><span class="p">,</span> <span class="n">llm_request</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">callback_context</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;user:name&#34;</span><span class="p">,</span> <span class="s2">&#34;Guest&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># From a tool context</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_tool</span><span class="p">(</span><span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tool_context</span><span class="p">:</span> <span class="n">ToolContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">api_url</span> <span class="o">=</span> <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;app:api_endpoint&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;result&#34;</span><span class="p">:</span> <span class="s2">&#34;...&#34;</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>There are three ways to write to the session state.</p>
<ol>
<li><code>output_key</code> is the simplest, for saving the agent&rsquo;s final text response.</li>
<li><code>EventActions.state_delta</code> is used for manual and complex updates.</li>
<li><code>CallbackContext.state</code> / <code>ToolContext.state</code> is recommended for callbacks and tools.</li>
</ol>
<p>We should never modify the <code>session.state</code> directly on a session object retrieved by the <code>SessionService</code>. This bypasses event tracking, breaks persistence, and is not thread-safe.</p>
<h4 id="output_key">output_key</h4>
<p>We have seen in earlier articles in this series that using <code>output_key</code> stores the agent&rsquo;s response in the session state. This is the simplest method and is useful when we need to capture the agent&rsquo;s complete response so that other agents and tools can refer to it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">greeting_agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;Greeter&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;Generate a short, friendly greeting.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_key</span><span class="o">=</span><span class="s2">&#34;last_greeting&#34;</span>  <span class="c1"># Agent&#39;s response → state[&#39;last_greeting&#39;]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>After the agent runs the <code>session.state['last_greeting']</code> will contain something like <code>&quot;Hello there! How can I help you today?&quot;</code>. This method only captures text, cannot store structured data, multiple keys, or scoped keys like <code>user:</code>.</p>
<h4 id="eventactionsstate_delta">EventActions.state_delta</h4>
<p>We can use the <code>state_delta</code> event action for fine-grained control over what gets stored and when. Using this method, we can manually construct the state changes, wrap them in an Event, and append it.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.events</span> <span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">EventActions</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define multiple state changes across scopes</span>
</span></span><span class="line"><span class="cl"><span class="n">state_changes</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;task_status&#34;</span><span class="p">:</span> <span class="s2">&#34;active&#34;</span><span class="p">,</span>                         <span class="c1"># session scope</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;user:login_count&#34;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>                           <span class="c1"># user scope</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;user:last_login&#34;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>                  <span class="c1"># user scope</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;app:maintenance_mode&#34;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>                   <span class="c1"># app scope</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;temp:validation_result&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;valid&#34;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>        <span class="c1"># invocation scope (discarded after)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">invocation_id</span><span class="o">=</span><span class="s2">&#34;inv_system_update&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">author</span><span class="o">=</span><span class="s2">&#34;system&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">actions</span><span class="o">=</span><span class="n">EventActions</span><span class="p">(</span><span class="n">state_delta</span><span class="o">=</span><span class="n">state_changes</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">timestamp</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">append_event</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This method is useful for system-level updates, multi-key updates, updates to scoped state keys, and other scenarios not tied to the agent&rsquo;s direct text response.</p>
<h4 id="callbackcontext-and-toolcontext">CallbackContext and ToolContext</h4>
<p>For modifying state inside callbacks and tool functions, using <code>CallbackContext</code> and <code>ToolContext</code> is the recommended approach.</p>
<p>Inside a callback function, you can use the <code>CallbackContext.state</code> to retrieve or update the state. We will learn about callbacks in a future article in this series.</p>
<p>In a tool function, you can use <code>ToolContext.state</code> to retrieve or update the state.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools</span> <span class="kn">import</span> <span class="n">ToolContext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_to_cart</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">tool_context</span><span class="p">:</span> <span class="n">ToolContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Adds an item to the shopping cart.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cart</span> <span class="o">=</span> <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;cart_items&#34;</span><span class="p">,</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">    <span class="n">cart</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;cart_items&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cart</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;cart_count&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cart</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;added&#34;</span><span class="p">,</span> <span class="s2">&#34;item&#34;</span><span class="p">:</span> <span class="n">item</span><span class="p">,</span> <span class="s2">&#34;cart_size&#34;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">cart</span><span class="p">)}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In both <code>CallbackContext</code> and <code>ToolContext</code>, you write clean, natural code, <code>context.state[&quot;key&quot;] = value</code>, and the framework handles creating <code>EventActions</code>, populating <code>state_delta</code>, calling <code>append_event</code>, and ensuring persistence. There is no boilerplate code required.</p>
<h3 id="injecting-state-into-agent-instructions">Injecting state into agent instructions</h3>
<p>One of ADK&rsquo;s most powerful features: you can embed state values directly into agent instructions using <code>{key}</code> template syntax.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;PersonalizedAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;You are a helpful assistant for {user:name}.
</span></span></span><span class="line"><span class="cl"><span class="s2">They prefer responses in {user:language}.
</span></span></span><span class="line"><span class="cl"><span class="s2">Their current task is: </span><span class="si">{current_task}</span><span class="s2">.
</span></span></span><span class="line"><span class="cl"><span class="s2">Their membership tier is: {user:tier}.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If <code>session.state</code> contains:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;user:name&#34;</span><span class="p">:</span> <span class="s2">&#34;Ravi&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;user:language&#34;</span><span class="p">:</span> <span class="s2">&#34;English&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;current_task&#34;</span><span class="p">:</span> <span class="s2">&#34;booking a hotel&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;user:tier&#34;</span><span class="p">:</span> <span class="s2">&#34;Gold&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The LLM receives:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">You are a helpful assistant for Ravi.
</span></span><span class="line"><span class="cl">They prefer responses in English.
</span></span><span class="line"><span class="cl">Their current task is: booking a hotel.
</span></span><span class="line"><span class="cl">Their membership tier is: Gold.
</span></span></code></pre></td></tr></table>
</div>
</div><p>For this template syntax to work, the key must exist in the state, or the agent will throw an error. We can use <code>{key?}</code> for keys that may be absent. Keys suffixed with a question mark resolve to an empty string if they are missing. The values should be strings or easily convertible to strings. If you need literal curly braces in the agent instructions, you must use <code>InstructionProvider</code> function as shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents.readonly_context</span> <span class="kn">import</span> <span class="n">ReadonlyContext</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">my_instruction</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">ReadonlyContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># This will NOT have {key} replaced — passed as-is to the LLM</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;Format your response as: {{name: string, age: number}}&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;JsonHelper&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="n">my_instruction</span>  <span class="c1"># Function instead of string</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This method is useful when we need full control over instruction generation, including bypassing the <code>{key}</code> templating. For example, when your instruction contains literal curly braces for JSON examples, or you need completely dynamic instruction generation based on state.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">role_based_instruction</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">ReadonlyContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">tier</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;user:tier&#34;</span><span class="p">,</span> <span class="s2">&#34;free&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">tier</span> <span class="o">==</span> <span class="s2">&#34;premium&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;You are a premium concierge. Provide detailed, proactive assistance.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">tier</span> <span class="o">==</span> <span class="s2">&#34;enterprise&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;You are an enterprise support specialist. Be thorough and reference documentation.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;You are a helpful assistant. Answer questions clearly and concisely.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;AdaptiveAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="n">role_based_instruction</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you need to inject state via <code>{key}</code> templating but need to preserve the literal braces, you must use <code>inject_session_state()</code> method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.utils</span> <span class="kn">import</span> <span class="n">instructions_utils</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">dynamic_instruction</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">ReadonlyContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">template</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;You are helping {user:name}.
</span></span></span><span class="line"><span class="cl"><span class="s2">Format your output as: {{result: string, confidence: number}}&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">await</span> <span class="n">instructions_utils</span><span class="o">.</span><span class="n">inject_session_state</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;HybridAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="n">dynamic_instruction</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>instructions_utils.inject_session_state(template, context)</code> injects the <code>{user:name}</code> state variable but preserves the literal braces.</p>
<h2 id="memory">Memory</h2>
<p>A session tracks the history and temporary data for a single, ongoing conversation. To enable history and state persistence across conversations and enable agents to recall the information from past interactions, we must use the memory service. There are two types of memory service.</p>
<ul>
<li>The <code>InMemoryMemoryService</code> is used for quick prototyping and local testing of agents, and it is good for basic keyword search. Using this requires no setup, stores session data in application memory, and does not provide persistence.</li>
<li>The <code>VertexAiMemoryBankService</code> connects to the Vertex AI memory bank service and provides LLM-based extraction of meaningful information from sessions. This service persists data in Google Cloud and is production-ready.</li>
</ul>
<p>Each of these memory services offers two operations.</p>
<ul>
<li><strong>Ingest:</strong> <code>memory_service.add_session_to_memory(session)</code> takes a completed session and adds its information to the long-term store</li>
<li><strong>Search:</strong> <code>memory_service.search_memory(app_name, user_id, query)</code> returns relevant snippets from past sessions</li>
</ul>
<p>These memory services also offer tools that agents can use in their work.</p>
<ul>
<li><code>PreloadMemoryTool</code> automatically retrieves relevant memories at the start of every turn (like a callback that always fires)</li>
<li><code>LoadMemoryTool</code> (or <code>load_memory</code>) lets the agent decide when to search memory (on-demand)</li>
</ul>
<p>Here is an example of working with <code>InMemoryMemoryService</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.sessions</span> <span class="kn">import</span> <span class="n">InMemorySessionService</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.memory</span> <span class="kn">import</span> <span class="n">InMemoryMemoryService</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.runners</span> <span class="kn">import</span> <span class="n">Runner</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools</span> <span class="kn">import</span> <span class="n">load_memory</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.genai.types</span> <span class="kn">import</span> <span class="n">Content</span><span class="p">,</span> <span class="n">Part</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Setup services (shared across runners) ---</span>
</span></span><span class="line"><span class="cl"><span class="n">session_service</span> <span class="o">=</span> <span class="n">InMemorySessionService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">memory_service</span> <span class="o">=</span> <span class="n">InMemoryMemoryService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Step 1: Agent captures information ---</span>
</span></span><span class="line"><span class="cl"><span class="n">capture_agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;CaptureAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;Acknowledge what the user tells you.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">runner1</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">agent</span><span class="o">=</span><span class="n">capture_agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;memory_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">memory_service</span><span class="o">=</span><span class="n">memory_service</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">session1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;memory_app&#34;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="s2">&#34;session_capture&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Run the agent with user input</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_msg</span> <span class="o">=</span> <span class="n">Content</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">parts</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="n">Part</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">text</span><span class="o">=</span><span class="s2">&#34;My favorite color is blue and I love hiking.&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner1</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="s2">&#34;session_capture&#34;</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">user_msg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>  <span class="c1"># Agent processes and responds</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># --- Step 2: Ingest session into memory ---</span>
</span></span><span class="line"><span class="cl">    <span class="n">completed_session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;memory_app&#34;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="s2">&#34;session_capture&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">memory_service</span><span class="o">.</span><span class="n">add_session_to_memory</span><span class="p">(</span><span class="n">completed_session</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># --- Step 3: New session, recall from memory ---</span>
</span></span><span class="line"><span class="cl">    <span class="n">recall_agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">name</span><span class="o">=</span><span class="s2">&#34;RecallAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;Answer questions using past conversation context. &#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;Use the load_memory tool to search past conversations.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">load_memory</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">runner2</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">agent</span><span class="o">=</span><span class="n">recall_agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;memory_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">memory_service</span><span class="o">=</span><span class="n">memory_service</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">session2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;memory_app&#34;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="s2">&#34;session_recall&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">recall_msg</span> <span class="o">=</span> <span class="n">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;What&#39;s my favorite color?&#34;</span><span class="p">)],</span> <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner2</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="s2">&#34;session_recall&#34;</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">recall_msg</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Expected: Something like &#34;Your favorite color is blue!&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When you run this, the first runner stores the user preference in memory. This is done using <code>add_session_to_memory</code> method. The second runner then uses the basic keyword match provided by the memory service to generate the response. The <code>load_memory</code> tool provided to the <code>recall_agent</code> automatically retrieves the memory for search.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">PS&gt; python.exe .<span class="se">\i</span>nmemory-memory.py
</span></span><span class="line"><span class="cl">....
</span></span><span class="line"><span class="cl">Your favorite color is blue.
</span></span></code></pre></td></tr></table>
</div>
</div><p>The process of saving memory can be automated using agent callbacks. We will learn about this in a later article in the series.</p>
<p>Here is another example where we use <code>InMemoryMemoryService</code> and help agent track the conversation progress through state.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.sessions</span> <span class="kn">import</span> <span class="n">InMemorySessionService</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.runners</span> <span class="kn">import</span> <span class="n">Runner</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools</span> <span class="kn">import</span> <span class="n">ToolContext</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.genai.types</span> <span class="kn">import</span> <span class="n">Content</span><span class="p">,</span> <span class="n">Part</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Tool that modifies state ---</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">search_flights</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">destination</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="p">:</span> <span class="n">ToolContext</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Searches for flights between two cities.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;flight&#34;</span><span class="p">:</span> <span class="s2">&#34;AA101&#34;</span><span class="p">,</span> <span class="s2">&#34;price&#34;</span><span class="p">:</span> <span class="mi">450</span><span class="p">,</span> <span class="s2">&#34;time&#34;</span><span class="p">:</span> <span class="s2">&#34;8:00 AM&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;flight&#34;</span><span class="p">:</span> <span class="s2">&#34;UA202&#34;</span><span class="p">,</span> <span class="s2">&#34;price&#34;</span><span class="p">:</span> <span class="mi">380</span><span class="p">,</span> <span class="s2">&#34;time&#34;</span><span class="p">:</span> <span class="s2">&#34;11:30 AM&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="s2">&#34;flight&#34;</span><span class="p">:</span> <span class="s2">&#34;DL303&#34;</span><span class="p">,</span> <span class="s2">&#34;price&#34;</span><span class="p">:</span> <span class="mi">520</span><span class="p">,</span> <span class="s2">&#34;time&#34;</span><span class="p">:</span> <span class="s2">&#34;3:00 PM&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Save search context to state for next turn</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;search_results&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;origin&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;destination&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">destination</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;booking_step&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;select_flight&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;flights&#34;</span><span class="p">:</span> <span class="n">results</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">book_flight</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">flight_number</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="p">:</span> <span class="n">ToolContext</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Books a specific flight.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">results</span> <span class="o">=</span> <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;search_results&#34;</span><span class="p">,</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">    <span class="n">selected</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="s2">&#34;flight&#34;</span><span class="p">]</span> <span class="o">==</span> <span class="n">flight_number</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">selected</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;error&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;Flight </span><span class="si">{</span><span class="n">flight_number</span><span class="si">}</span><span class="s2"> not found in search results&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;booked_flight&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">selected</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;booking_step&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&#34;confirmed&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;user:total_bookings&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;user:total_bookings&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;confirmed&#34;</span><span class="p">,</span> <span class="s2">&#34;flight&#34;</span><span class="p">:</span> <span class="n">selected</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Agent ---</span>
</span></span><span class="line"><span class="cl"><span class="n">booking_agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;BookingAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;You are a flight booking assistant.
</span></span></span><span class="line"><span class="cl"><span class="s2">Current booking step: {booking_step?}
</span></span></span><span class="line"><span class="cl"><span class="s2">Help users search for and book flights.
</span></span></span><span class="line"><span class="cl"><span class="s2">If they&#39;ve already searched, reference the results in state.&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">search_flights</span><span class="p">,</span> <span class="n">book_flight</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_key</span><span class="o">=</span><span class="s2">&#34;last_response&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Runner and Session ---</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_service</span> <span class="o">=</span> <span class="n">InMemorySessionService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">runner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">agent</span><span class="o">=</span><span class="n">booking_agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;booking_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;booking_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">state</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;booking_step&#34;</span><span class="p">:</span> <span class="s2">&#34;start&#34;</span><span class="p">,</span> <span class="s2">&#34;user:name&#34;</span><span class="p">:</span> <span class="s2">&#34;Ravi&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Turn 1: Search</span>
</span></span><span class="line"><span class="cl">    <span class="n">msg1</span> <span class="o">=</span> <span class="n">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;Find flights from NYC to Paris&#34;</span><span class="p">)],</span> <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">msg1</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Check state after Turn 1</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;booking_app&#34;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;State: booking_step=</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;booking_step&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;State: origin=</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;origin&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Turn 2: Book</span>
</span></span><span class="line"><span class="cl">    <span class="n">msg2</span> <span class="o">=</span> <span class="n">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;Book UA202 please&#34;</span><span class="p">)],</span> <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">msg2</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Check final state</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;booking_app&#34;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;State: booking_step=</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;booking_step&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;State: user:total_bookings=</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user:total_bookings&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When you run this, you can observe how the agent uses the state updates to track progress.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; python.exe .<span class="se">\i</span>nmemory-track-state.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Agent: OK. I found three flights <span class="k">for</span> you: AA101 at 8:00 AM <span class="k">for</span> <span class="nv">$450</span>, UA202 at 11:30 AM <span class="k">for</span> <span class="nv">$380</span>, and DL303 at 3:00 PM <span class="k">for</span> <span class="nv">$520</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">State: <span class="nv">booking_step</span><span class="o">=</span>select_flight
</span></span><span class="line"><span class="cl">State: <span class="nv">origin</span><span class="o">=</span>NYC
</span></span><span class="line"><span class="cl">Agent: OK. I have booked flight UA202 <span class="k">for</span> you. It departs at 11:30 AM and the price is <span class="nv">$380</span>.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">State: <span class="nv">booking_step</span><span class="o">=</span>confirmed
</span></span><span class="line"><span class="cl">State: user:total_bookings<span class="o">=</span><span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Understanding how ADK uses Sessions, state, and memory to enable agents to persist conversational state and recall past interactions is important for developing efficient agent workflows. This article explored this in-depth and demonstrated session and memory capabilities using <code>InMemorySessionService</code> and <code>InMemoryMemoryService</code>. The fundamentals you learned about the overall workflow stay the same for other session and memory service types that provide persistence. I recommend that you experiment with those services.</p>

        </div>

        
        

        
        

<div class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-lg font-bold mb-4 text-center text-gray-900 dark:text-dark-text">Share this article</h3>
  <div class="flex flex-wrap justify-center items-center gap-3 sm:gap-4">
    
    <button onclick="shareNative()"
      class="sm:hidden w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-primary text-primary dark:border-blue-400 dark:text-blue-400 flex items-center justify-center transition-all shadow-sm hover:shadow-md hover:bg-primary hover:text-white dark:hover:bg-blue-600 dark:hover:text-white dark:hover:border-blue-600"
      aria-label="Share" title="Share" id="native-share-btn">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z">
        </path>
      </svg>
    </button>

    
    <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-sessions-state-and-memory%2F&text=Google&#43;ADK&#43;-&#43;Sessions%2C&#43;state%2C&#43;and&#43;memory"
      target="_blank" rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#1DA1F2] text-[#1DA1F2] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#1DA1F2] hover:text-white hover:scale-105"
      aria-label="Share on Twitter" title="Share on Twitter">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" />
      </svg>
    </a>

    
    <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-sessions-state-and-memory%2F" target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#0077B5] text-[#0077B5] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#0077B5] hover:text-white hover:scale-105"
      aria-label="Share on LinkedIn" title="Share on LinkedIn">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
      </svg>
    </a>

    
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-sessions-state-and-memory%2F" target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#1877F2] text-[#1877F2] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#1877F2] hover:text-white hover:scale-105"
      aria-label="Share on Facebook" title="Share on Facebook">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
      </svg>
    </a>

    
    <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-sessions-state-and-memory%2F&title=Google&#43;ADK&#43;-&#43;Sessions%2C&#43;state%2C&#43;and&#43;memory"
      target="_blank" rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#FF4500] text-[#FF4500] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#FF4500] hover:text-white hover:scale-105"
      aria-label="Share on Reddit" title="Share on Reddit">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z" />
      </svg>
    </a>

    
    <a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-sessions-state-and-memory%2F&t=Google&#43;ADK&#43;-&#43;Sessions%2C&#43;state%2C&#43;and&#43;memory"
      target="_blank" rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#FF6600] text-[#FF6600] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#FF6600] hover:text-white hover:scale-105"
      aria-label="Share on Hacker News" title="Share on Hacker News">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M0 0v24h24V0H0zm12.8 13.4v5.2H11v-5.2L6.6 5.4h2.1l3.3 6.2 3.3-6.2h2.1l-4.6 8z" />
      </svg>
    </a>

    
    <button onclick="copyToClipboard('https:\/\/ravichaganti.com\/blog\/google-adk-sessions-state-and-memory\/')"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-amber-500 text-amber-500 flex items-center justify-center transition-all shadow-sm hover:shadow-md hover:bg-amber-500 hover:text-white hover:scale-105"
      aria-label="Copy link" title="Copy link" id="copy-link-btn">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
        </path>
      </svg>
    </button>
  </div>
</div>

<script>
  
  function shareNative() {
    if (navigator.share) {
      navigator.share({
        title: 'Google ADK - Sessions, state, and memory',
        text: 'LLMs are stateless. Every API call to an LLM is independent. The model does not inherently remember what was said before. Yet meaningful conversations are inherently multi-turn, contextual, and stateful.',
        url: 'https:\/\/ravichaganti.com\/blog\/google-adk-sessions-state-and-memory\/'
      }).catch(function (error) {
        console.log('Error sharing:', error);
      });
    }
  }

  
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function () {
      const btn = document.getElementById('copy-link-btn');
      const originalHTML = btn.innerHTML;
      const originalTitle = btn.title;

      
      btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
      btn.title = 'Copied!';

      
      setTimeout(function () {
        btn.innerHTML = originalHTML;
        btn.title = originalTitle;
      }, 2000);
    }).catch(function (error) {
      console.error('Failed to copy:', error);
      alert('Failed to copy link. Please copy manually: ' + text);
    });
  }
</script>


        
        
<nav class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border" aria-label="Post navigation">
  
  
  
  

  
  
  
    
    
    

    
    
    

    
    
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
    
      
        
        
      
      
        
        
      
    
  

  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    
    <div class="flex">
      
        <a href="https://ravichaganti.com/blog/google-adk-types-of-agents/"
           class="flex-1 group card hover:shadow-xl transition-all hover:scale-[1.02] no-underline"
           aria-label="Previous in Google ADK: Google ADK - types of agents">
          <div class="flex items-start gap-3">
            
            <div class="flex-shrink-0 text-primary dark:text-blue-400 group-hover:text-secondary dark:group-hover:text-purple-400 transition-colors mt-1">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </div>

            
            <div class="flex-1 min-w-0">
              <p class="text-xs text-gray-500 dark:text-dark-text-muted mb-1 uppercase tracking-wide">Previous in Google ADK</p>
              <h3 class="text-base font-bold text-gray-900 dark:text-dark-text mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                Google ADK - types of agents
              </h3>
              
                <p class="text-sm text-gray-600 dark:text-dark-text-secondary line-clamp-2">Google Agent Development Kit (ADK) is a flexible and modular framework for developing and deploying AI agents. It offers different types agents.</p>
              
            </div>
          </div>
        </a>
      
    </div>

    
    <div class="flex">
      
        <a href="https://ravichaganti.com/blog/google-adk-callbacks/"
           class="flex-1 group card hover:shadow-xl transition-all hover:scale-[1.02] no-underline"
           aria-label="Next in Google ADK: Google ADK - Callbacks">
          <div class="flex items-start gap-3">
            
            <div class="flex-1 min-w-0 text-right md:text-left md:order-1">
              <p class="text-xs text-gray-500 dark:text-dark-text-muted mb-1 uppercase tracking-wide">Next in Google ADK</p>
              <h3 class="text-base font-bold text-gray-900 dark:text-dark-text mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                Google ADK - Callbacks
              </h3>
              
                <p class="text-sm text-gray-600 dark:text-dark-text-secondary line-clamp-2">Callbacks are user-defined functions that hook into an agent&#39;s execution pipeline at predefined checkpoints. They let you observe, customize, and control agent behavior without modifying the ADK framework code.</p>
              
            </div>

            
            <div class="flex-shrink-0 text-primary dark:text-blue-400 group-hover:text-secondary dark:group-hover:text-purple-400 transition-colors mt-1 md:order-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
          </div>
        </a>
      
    </div>
  </div>
</nav>


        
        

        
        

        
        

<div class="comments-section mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-xl sm:text-2xl font-bold mb-6 text-gray-900 dark:text-dark-text">Comments</h3>

  
  <div id="comments-placeholder" class="hidden">
    <div class="bg-gray-100 dark:bg-dark-bg border-2 border-dashed border-gray-300 dark:border-dark-border rounded-lg p-8 text-center">
      <svg class="w-12 h-12 mx-auto mb-4 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      <h4 class="text-lg font-semibold text-gray-900 dark:text-dark-text mb-2">
        Comments Require Consent
      </h4>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
        The comment system (Giscus) uses GitHub and may set authentication cookies.
        Enable comments to join the discussion.
      </p>
      <button onclick="window.cookieConsent.enableComments()"
              class="px-6 py-2 bg-primary hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
        Enable Comments
      </button>
    </div>
  </div>

  
  <div id="giscus-wrapper" class="giscus-wrapper"></div>

  
  <script>
    (function() {
      'use strict';

      let giscusLoaded = false;
      let themeObserver = null;

      
      function loadGiscus() {
        if (giscusLoaded) return;

        const wrapper = document.getElementById('giscus-wrapper');
        const placeholder = document.getElementById('comments-placeholder');

        if (!wrapper) return;

        
        if (placeholder) placeholder.classList.add('hidden');
        wrapper.classList.remove('hidden');

        
        const script = document.createElement('script');
        script.src = 'https://giscus.app/client.js';
        script.setAttribute('data-repo', 'rchaganti\/rchaganti.github.io');
        script.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkyNzcwNTE0Mjc=');
        script.setAttribute('data-category', 'Announcements');
        script.setAttribute('data-category-id', 'DIC_kwDOEIN4I84CS4rW');
        script.setAttribute('data-mapping', 'pathname');
        script.setAttribute('data-strict', '0');
        script.setAttribute('data-reactions-enabled', '1');
        script.setAttribute('data-emit-metadata', '0');
        script.setAttribute('data-input-position', 'bottom');
        script.setAttribute('data-theme', 'light');
        script.setAttribute('data-lang', 'en');
        script.setAttribute('data-loading', 'lazy');
        script.setAttribute('crossorigin', 'anonymous');
        script.async = true;

        wrapper.appendChild(script);
        giscusLoaded = true;

        
        setupThemeObserver();
      }

      
      function updateGiscusTheme() {
        const isDark = document.documentElement.classList.contains('dark');
        const theme = isDark ? 'dark' : 'light';

        const iframe = document.querySelector('iframe.giscus-frame');
        if (iframe) {
          iframe.contentWindow.postMessage(
            { giscus: { setConfig: { theme: theme } } },
            'https://giscus.app'
          );
        }
      }

      
      function setupThemeObserver() {
        if (themeObserver) return;

        
        themeObserver = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
              updateGiscusTheme();
            }
          });
        });

        themeObserver.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ['class']
        });

        
        window.addEventListener('message', function(event) {
          if (event.origin !== 'https://giscus.app') return;
          if (!(typeof event.data === 'object' && event.data.giscus)) return;

          
          if (event.data.giscus.discussion) {
            updateGiscusTheme();
          }
        });
      }

      
      function checkConsentAndLoad() {
        if (window.cookieConsent && window.cookieConsent.hasConsent('comments')) {
          loadGiscus();
        } else {
          
          const placeholder = document.getElementById('comments-placeholder');
          if (placeholder) placeholder.classList.remove('hidden');
        }
      }

      
      window.addEventListener('loadComments', loadGiscus);
      window.addEventListener('consentChanged', checkConsentAndLoad);

      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkConsentAndLoad);
      } else {
        checkConsentAndLoad();
      }
    })();
  </script>
</div>


      </div>
      

      
      <aside class="hidden lg:block relative">
        <div class="mb-6">
          
<div class="bg-white dark:bg-dark-bg-secondary rounded-xl shadow-md dark:shadow-lg dark:shadow-black/20 p-6 mb-6">
  <div class="flex items-center gap-3 mb-4">
    <div class="w-10 h-10 bg-[#0A66C2]/10 rounded-full flex items-center justify-center">
      <svg class="w-5 h-5 text-[#0A66C2]" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
      </svg>
    </div>
    <h3 class="font-semibold text-gray-900 dark:text-dark-text">Newsletter</h3>
  </div>
  <p class="text-sm text-gray-600 dark:text-dark-text-secondary mb-4">
    Get notified about new articles on cloud, AI, and infrastructure.
  </p>
  <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank"
    rel="noopener noreferrer"
    class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-[#0A66C2] hover:bg-[#004182] !text-white text-sm font-semibold rounded-lg transition-colors no-underline">
    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
      <path
        d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
    </svg>
    Subscribe on LinkedIn
  </a>
</div>
        </div>
        <div class="mb-6">
          


  <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700">
    <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-gray-100">
      You May Also Like
    </h3>
    <div>
      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-23">
      Dec 23, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - MCP tools
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-20">
      Dec 20, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-runner-and-execution-architecture/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - Runner and execution architecture
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-18">
      Dec 18, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-callbacks/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - Callbacks
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-12">
      Dec 12, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-types-of-agents/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - types of agents
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-03">
      Dec 3, 2025
    </time>
  </a>
</article>

      
    </div>
  </div>


        </div>
        <div class="sidebar-sticky-reinforced">
          


<div class="bg-white dark:bg-dark-bg-secondary rounded-xl shadow-md dark:shadow-lg dark:shadow-black/20 p-6 mb-6">
  <h3 class="font-semibold text-gray-900 dark:text-dark-text mb-4 flex items-center">
    <svg class="w-5 h-5 mr-2 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
    </svg>
    Table of Contents
  </h3>

  <nav id="sidebar-toc" class="toc-sidebar text-sm max-h-[calc(100vh-200px)] overflow-y-auto custom-scrollbar">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#agent-memory">Agent memory</a></li>
    <li><a href="#sessions">Sessions</a>
      <ul>
        <li><a href="#state">State</a></li>
        <li><a href="#events">Events</a></li>
        <li><a href="#reading-and-writing-state">Reading and writing state</a></li>
        <li><a href="#injecting-state-into-agent-instructions">Injecting state into agent instructions</a></li>
      </ul>
    </li>
    <li><a href="#memory">Memory</a></li>
  </ul>
</nav>
  </nav>
</div>

<style>
  #sidebar-toc ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }

  #sidebar-toc ul ul {
    padding-left: 1rem;
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
    border-left: 1px solid #e5e7eb;
     
  }

  .dark #sidebar-toc ul ul {
    border-color: #374151;
     
  }

  #sidebar-toc li {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }

  #sidebar-toc a {
    display: block;
    color: #4b5563;
     
    text-decoration: none;
    transition: all 0.2s;
    padding-left: 0.5rem;
    border-left: 2px solid transparent;
    margin-left: -1px;
     
  }

  #sidebar-toc a:hover {
    color: #1e40af;
     
    text-decoration: none;
  }

   
  #sidebar-toc a.active {
    color: #2563eb;
     
    font-weight: 600;
    border-left-color: #2563eb;
  }

   
  .dark #sidebar-toc a {
    color: #9ca3af;
     
  }

  .dark #sidebar-toc a:hover {
    color: #60a5fa;
     
  }

  .dark #sidebar-toc a.active {
    color: #60a5fa;
     
    border-left-color: #60a5fa;
  }

   
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #e5e7eb;
    border-radius: 20px;
  }

  .dark .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #374151;
  }
</style>


        </div>
      </aside>
    </div>
    
  </div>

  
  <script src="/js/collapse.js"></script>
  <script src="/js/code-copy.js"></script>
  <script src="/js/toc-scrollspy.js"></script>
  <script src="/js/heading-anchors.js"></script>
</article>

  </main>

  <footer class="bg-gray-900 dark:bg-dark-bg text-gray-300 dark:text-dark-text-secondary mt-16">
  <div class="container mx-auto px-4 py-8">
    <div class="text-center text-sm">
      <p>&copy; 2026 Ravikanth Chaganti. All rights reserved.</p>
    </div>
  </div>
</footer>


  
  <button id="back-to-top"
          class="fixed bottom-8 right-8 w-12 h-12 bg-primary text-white rounded-full shadow-lg hover:bg-blue-700 transition-all opacity-0 pointer-events-none z-40"
          aria-label="Back to top"
          title="Back to top">
    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
    </svg>
  </button>

  
  

  
  <script>
    
    
    
  </script>

  
  
    <script src="/js/reading-progress.js"></script>
  

  
  <script src="/js/back-to-top.js"></script>

  
  <script src="/js/theme-toggle.js"></script>

  
  <script src="/js/cookie-consent.js"></script>

  
  

  
  <script
    data-goatcounter="https://ravichaganti.goatcounter.com/count"
    async
    src="//gc.zgo.at/count.js">
  </script>



  
  
<div id="cookie-consent-banner"
     class="hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg z-50 transition-transform duration-300">
  <div class="container mx-auto px-4 py-2">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-4">

      
      <div class="flex-1">
        <p class="text-xs sm:text-sm text-gray-700 dark:text-gray-200">
          This site may load third-party content (comments, embeds) that could set cookies.
          <a href="#"
             id="cookie-learn-more"
             class="text-primary hover:underline font-medium ml-1"
             onclick="document.getElementById('cookie-customize').click(); return false;">
            Learn more
          </a>
        </p>
      </div>

      
      <div class="flex flex-row gap-2 w-full sm:w-auto flex-shrink-0">
        <button id="cookie-reject-all"
                class="px-3 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors">
          Reject
        </button>
        <button id="cookie-customize"
                class="px-3 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors">
          Settings
        </button>
        <button id="cookie-accept-all"
                class="px-3 py-1 text-xs font-medium text-white bg-primary hover:bg-blue-700 rounded transition-colors">
          Accept
        </button>
      </div>
    </div>
  </div>
</div>


<div id="cookie-settings-modal"
     class="hidden fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 z-50 flex items-center justify-center p-4 overflow-y-auto">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl my-8">

    
    <div class="bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3 rounded-t-lg">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold text-gray-900 dark:text-gray-100">
          Cookie Preferences
        </h2>
        <button id="cookie-modal-close"
                class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
                aria-label="Close">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    
    <div class="px-6 py-4 space-y-4 max-h-[calc(90vh-140px)] overflow-y-auto bg-white dark:bg-gray-800">

      
      <div class="text-sm text-gray-600 dark:text-gray-300">
        <p>
          Control what third-party content is loaded. We use privacy-friendly analytics with no cookies.
        </p>
      </div>

      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Essential
            </h3>
            <div class="flex items-center justify-center w-10 h-5 bg-primary rounded-full flex-shrink-0">
              <span class="text-xs font-medium text-white">ON</span>
            </div>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Required for the website to function. Cannot be disabled.
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>• Theme preference</li>
            <li>• Privacy-friendly analytics</li>
          </ul>
        </div>

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Comments
            </h3>
            <label class="relative inline-block w-10 h-5 flex-shrink-0">
              <input type="checkbox"
                     id="consent-comments"
                     class="peer sr-only">
              <span class="absolute inset-0 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer transition-colors peer-checked:bg-primary"></span>
              <span class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
            </label>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Giscus comment system (GitHub Discussions).
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>• Authentication cookies</li>
            <li>• GitHub privacy policy</li>
          </ul>
        </div>

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Embedded Content
            </h3>
            <label class="relative inline-block w-10 h-5 flex-shrink-0">
              <input type="checkbox"
                     id="consent-embeds"
                     class="peer sr-only">
              <span class="absolute inset-0 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer transition-colors peer-checked:bg-primary"></span>
              <span class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
            </label>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Videos, code snippets, presentations.
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>• YouTube, Gists, SlideShare</li>
            <li>• May set tracking cookies</li>
          </ul>
        </div>
      </div>

      
      <div class="bg-blue-50 dark:bg-blue-950 dark:bg-opacity-50 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
          <div class="text-sm">
            <p class="font-semibold mb-1 text-blue-800 dark:text-blue-200">Privacy First</p>
            <p class="text-xs text-gray-700 dark:text-gray-300">
              No tracking cookies. Third-party content only loads with your consent. Preferences stored locally in your browser.
            </p>
          </div>
        </div>
      </div>
    </div>

    
    <div class="bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 px-4 py-3 rounded-b-lg">
      <div class="flex justify-end">
        <button id="cookie-save-preferences"
                class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-blue-700 dark:hover:bg-blue-600 rounded transition-colors shadow-sm">
          Save Preferences
        </button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
