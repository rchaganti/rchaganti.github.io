<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <script src="https://ravichaganti.com/js/view.js"></script>
    <script id="dsq-count-scr" src="//ravikanth.disqus.com/count.js" async></script>
    <link rel="stylesheet" href="https://ravichaganti.com/css/syntax.css">
    <meta name="author" content="Ravikanth Chaganti">
    <meta name="description" content="When working ARM templates, you may have come across a situation where you want to provision multiple instances of a resource with similar configuration. For example, multiple storage accounts or virtual machines or multiple data disks attached to a virtual machine. In the JSON template language, the copy element is used for this purpose. Bicep language has a few different ways you can achieve this at different levels like resources, resource properties, and outputs.">
    <meta name="keywords" content="blog,microsoft,mvp,powershell,automation,author, innovator, speaker">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Bicep Language - Beyond Basics - Iterations"/>
<meta name="twitter:description" content="When working ARM templates, you may have come across a situation where you want to provision multiple instances of a resource with similar configuration. For example, multiple storage accounts or virtual machines or multiple data disks attached to a virtual machine. In the JSON template language, the copy element is used for this purpose. Bicep language has a few different ways you can achieve this at different levels like resources, resource properties, and outputs."/>

    <meta property="og:title" content="Bicep Language - Beyond Basics - Iterations" />
<meta property="og:description" content="When working ARM templates, you may have come across a situation where you want to provision multiple instances of a resource with similar configuration. For example, multiple storage accounts or virtual machines or multiple data disks attached to a virtual machine. In the JSON template language, the copy element is used for this purpose. Bicep language has a few different ways you can achieve this at different levels like resources, resource properties, and outputs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ravichaganti.com/blog/bicep-basics-beyond-basics-iterations/" />
<meta property="article:published_time" content="2021-04-14T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-04-14T00:00:00+00:00" />



    
      <base href="https://ravichaganti.com/blog/bicep-basics-beyond-basics-iterations/">
    
    <title>
  Bicep Language - Beyond Basics - Iterations · Ravikanth Chaganti
</title>

    
      <link rel="canonical" href="https://ravichaganti.com/blog/bicep-basics-beyond-basics-iterations/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://ravichaganti.com/css/coder.min.897f2f761ca1c7df1614de4c088e4ebbb7f5984b520994e5ee0a0fc4ba52f7de.css" integrity="sha256-iX8vdhyhx98WFN5MCI5Ou7f1mEtSCZTl7goPxLpS994=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://ravichaganti.com/css/coder-dark.min.e78e80fc3a585a4d1c8fc7f58623b6ff852411e38431a9cd1792877ecaa160f6.css" integrity="sha256-546A/DpYWk0cj8f1hiO2/4UkEeOEManNF5KHfsqhYPY=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="https://ravichaganti.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://ravichaganti.com/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.73.0" />
  </head>

  
  
    
  
  
    <body onload="getViews( &#34;https://ravichaganti.com/blog/bicep-basics-beyond-basics-iterations/&#34; )" class="colorscheme-auto">
  
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://ravichaganti.com/">
      Ravikanth Chaganti
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/about/">About</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/blog/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/books/">Books</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Bicep Language - Beyond Basics - Iterations</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2021-04-14T00:00:00Z'>
                April 14, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              9-minute read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://ravichaganti.com/categories/azure/">Azure</a>
      <span class="separator">•</span>
    <a href="https://ravichaganti.com/categories/bicep/">Bicep</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://ravichaganti.com/tags/azure/">Azure</a>
      <span class="separator">•</span>
    <a href="https://ravichaganti.com/tags/bicep/">Bicep</a></div>

        </div>
        <div class="post-meta">
          <span class="reading-time">
            <i class="fas fa-comments"></i>
            <a href="https://ravichaganti.com/blog/bicep-basics-beyond-basics-iterations/#disqus_thread"> Comments</a>
          </span>
        </div>
        <div class="post-meta">
          <span class="reading-time">
            <i class="fas fa-eye"></i>
            <strong id="views"></strong>
            Readers
          </span>
        </div>        
      </header>
      <hr>
      <div>
        
        
          <nav id="TableOfContents">
  <ul>
    <li><a href="#using-a-loop-index">Using a loop index</a>
      <ul>
        <li><a href="#resource-iteration">Resource iteration</a></li>
        <li><a href="#resource-property-iteration">Resource property iteration</a></li>
      </ul>
    </li>
    <li><a href="#iterating-over-a-collection">Iterating over a collection</a>
      <ul>
        <li><a href="#resource-iteration-1">Resource Iteration</a></li>
        <li><a href="#resource-property-iteration-1">Resource property iteration</a></li>
      </ul>
    </li>
    <li><a href="#iterating-over-elements-in-an-array">Iterating over elements in an array</a>
      <ul>
        <li><a href="#resource-iteration-2">Resource Iteration</a></li>
        <li><a href="#resource-property-iteration-2">Resource property Iteration</a></li>
      </ul>
    </li>
    <li><a href="#serial-deployment-of-resources">Serial deployment of resources</a></li>
  </ul>
</nav>
          <hr>
        
        
    <figure >
        
            <img src="https://ravichaganti.com/images/bicep.png" />
        
        
    </figure>
    
<p>When working ARM templates, you may have come across a situation where you want to provision multiple instances of a resource with similar configuration. For example, multiple storage accounts or virtual machines or multiple data disks attached to a virtual machine. In the JSON template language, the <code>copy</code> element is used for this purpose. Bicep language has a few different ways you can achieve this at different levels like resources, resource properties, and outputs. Variable iterations <a href="https://github.com/Azure/bicep/issues/1814">are not available yet</a> and mostly coming as a part of <a href="https://github.com/Azure/bicep/projects/7#card-56641753">0.4 release</a> which is due by <a href="https://github.com/Azure/bicep/milestone/7">May 25th 2021</a>.</p>
<p>In this part of the <a href="https://ravichaganti.com/series/azure-bicep">series</a> of articles on Bicep language, you will learn about using iterations in your Bicep files. There are three ways to implement iterations in Bicep.</p>
<h2 id="using-a-loop-index">Using a loop index</h2>
<p>Using an iteration or loop index is the simplest way to create multiple instances of a resource or iterating resource properties. A loop index syntax in Bicep is similar to what you may have seen in other languages.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[for &lt;index&gt; in range(&lt;start&gt;, &lt;stop&gt;): {
  &lt;resource-instance&gt; or &lt;resource-properties&gt;
}]
</code></pre></td></tr></table>
</div>
</div><p>As you will see next, all you need to do is just assign this either to a resource declaration or resource property.</p>
<h3 id="resource-iteration">Resource iteration</h3>
<p>Here is the general syntax of implementing a index based iteration in Bicep for resources.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">resource &lt;resource-symbolic-name&gt; &#39;&lt;resource-type&gt;@&lt;api-version&gt;&#39; = [for &lt;index&gt; in range(&lt;start&gt;, &lt;stop&gt;): {
  &lt;resource-instance&gt;
}]
</code></pre></td></tr></table>
</div>
</div><p>This should not be difficult to understand since you already know how to declare a resource instance. To add an iteration, all you need to do is add the iterator. In this case a loop index. The <code>range()</code> function here helps in creating a collection of integers from start integer to stop integer. Stop index is excluded. Here is a simple example around creating multiple storage accounts using loop index.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">param saCount int = 2

resource sa &#39;Microsoft.Storage/storageAccounts@2019-04-01&#39; = [for index in range(0, saCount): {
  name: &#39;${index}stg${uniqueString(resourceGroup().id)}&#39;
  location: resourceGroup().location
  sku: {
    name: &#39;Standard_LRS&#39;
  }
  kind: &#39;StorageV2&#39;
  properties: {
  	accessTier: &#39;Hot&#39;
  }
}]
</code></pre></td></tr></table>
</div>
</div><p>In the previous article on expressions in Bicep language, you learned how to use interpolation. The same technique can be used here to access the value stored in <code>index</code> &ndash; <code>${index}</code>.</p>
<p>This is how the resource declaration gets tranpiled into ARM JSON.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json">  <span class="s2">&#34;resources&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;copy&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;sa&#34;</span><span class="p">,</span>
        <span class="nt">&#34;count&#34;</span><span class="p">:</span> <span class="s2">&#34;[length(range(0, parameters(&#39;saCount&#39;)))]&#34;</span>
      <span class="p">},</span>
      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Storage/storageAccounts&#34;</span><span class="p">,</span>
      <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2019-04-01&#34;</span><span class="p">,</span>
      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[format(&#39;{0}stg{1}&#39;, range(0, parameters(&#39;saCount&#39;))[copyIndex()], uniqueString(resourceGroup().id))]&#34;</span><span class="p">,</span>
      <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceGroup().location]&#34;</span><span class="p">,</span>
      <span class="nt">&#34;sku&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Standard_LRS&#34;</span>
      <span class="p">},</span>
      <span class="nt">&#34;kind&#34;</span><span class="p">:</span> <span class="s2">&#34;StorageV2&#34;</span><span class="p">,</span>
      <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;accessTier&#34;</span><span class="p">:</span> <span class="s2">&#34;Hot&#34;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="resource-property-iteration">Resource property iteration</h3>
<p>The general syntax for using loop indexes for resource properties is similar to that of resources.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&lt;property-name&gt;: [for &lt;index&gt; in range(&lt;start&gt;, &lt;stop&gt;): {
  &lt;resource-properties&gt;
}]
</code></pre></td></tr></table>
</div>
</div><p>Here is a quick example of iterating on resource properties. This example demonstrates creating multiple subnets in a Azure Virtual Network.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">var numSubnets = 3
var subnetPrefix = [
  &#39;10.10.12.0/24&#39;
  &#39;10.10.13.0/24&#39;
]

resource vnet &#39;Microsoft.Network/virtualNetworks@2018-11-01&#39; = {
  name: &#39;vnet&#39;
  location: resourceGroup().location
  properties: {
    addressSpace: {
      addressPrefixes: [
        &#39;10.10.10.0/16&#39;
      ]
    }
    subnets: [for sIndex in range(0, numSubnets): {
      name: &#39;subnet${sIndex}&#39;
      properties: {
        addressPrefix: subnetPrefix[sIndex]
      }
    }]
  }
}
</code></pre></td></tr></table>
</div>
</div><p>The way this example is built is very similar to how you create multiple storage account instances. For the number of subnets, the <code>numSubnets</code> variable is used and the <code>subnetPrefix</code> array has the prefixes used for each subnet. Using array indexer, you can retrieve the prefix from the <code>subnetPrefix</code> array.</p>
<p>Those of you with a sharp eye must have noticed that the <code>numSubnets</code> is set to 3 but there are only two elements in the <code>subnetPrefix</code> array. For Bicep, this does not matter. You must make sure that these values are consistent.</p>
<h2 id="iterating-over-a-collection">Iterating over a collection</h2>
<p>The second method of creating resource or resource property iterations is to iterate over a collection. Here is the general syntax for this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[for &lt;item&gt; in &lt;collection&gt;: {
  &lt;resource-instance&gt; or &lt;resource-properties&gt;
}]
</code></pre></td></tr></table>
</div>
</div><p>Once again, this syntax can be used with either resource declaration or resource properties.</p>
<h3 id="resource-iteration-1">Resource Iteration</h3>
<p>The general syntax for iterating over a collection to create multiple resource instances is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">resource &lt;resource-symbolic-name&gt; &#39;&lt;resource-type&gt;@&lt;api-version&gt;&#39; = [for &lt;item&gt; in &lt;collection&gt;: {
  &lt;resource-instance&gt;
}]
</code></pre></td></tr></table>
</div>
</div><p>Here is a full example of creating multiple storage accounts using this method.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">var saNames = [
  &#39;sqllondon&#39;
  &#39;sqlchennai&#39;
  &#39;archiveseattle&#39;
]

resource sa &#39;Microsoft.Storage/storageAccounts@2019-04-01&#39; = [for sName in saNames: {
  name: concat(sName, uniqueString(resourceGroup().id))
  location: resourceGroup().location
  sku: {
    name: &#39;Standard_LRS&#39;
  }
  kind: &#39;StorageV2&#39;
  properties: {
    accessTier: &#39;Hot&#39;
  }
}]
</code></pre></td></tr></table>
</div>
</div><p>In this example, the variable <code>saNames</code> contains a list of storage account names. The iteration in this example loops over the elements in <code>saNames</code> array and uses these values as a part of the storage account name. Here is how the resource declaration gets compiled into ARM JSON representation.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="s2">&#34;resources&#34;</span><span class="err">:</span> <span class="p">[</span>
	<span class="p">{</span>
		<span class="nt">&#34;copy&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;sa&#34;</span><span class="p">,</span>
			<span class="nt">&#34;count&#34;</span><span class="p">:</span> <span class="s2">&#34;[length(variables(&#39;saNames&#39;))]&#34;</span>
         <span class="p">},</span>
		<span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Storage/storageAccounts&#34;</span><span class="p">,</span>
		<span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2019-04-01&#34;</span><span class="p">,</span>
		<span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[concat(variables(&#39;saNames&#39;)[copyIndex()], uniqueString(resourceGroup().id))]&#34;</span><span class="p">,</span>
		<span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceGroup().location]&#34;</span><span class="p">,</span>
		<span class="nt">&#34;sku&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Standard_LRS&#34;</span>
		<span class="p">},</span>
		<span class="nt">&#34;kind&#34;</span><span class="p">:</span> <span class="s2">&#34;StorageV2&#34;</span><span class="p">,</span>
		<span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
			<span class="nt">&#34;accessTier&#34;</span><span class="p">:</span> <span class="s2">&#34;Hot&#34;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="resource-property-iteration-1">Resource property iteration</h3>
<p>Here is the general syntax for using collection iteration with resource properties.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&lt;property-name&gt;: [for &lt;item&gt; in &lt;collection&gt;: {
  &lt;resource-properties&gt;
}]
</code></pre></td></tr></table>
</div>
</div><p>The previous example around the storage account creation can be modified to add iteration for the <code>accessTier</code> property.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">var sAccounts = [
  {
    name: &#39;sqllondon&#39;
    accessTier: &#39;Cool&#39;
  }
  {
    name: &#39;sqlchennai&#39;
    accessTier: &#39;Hot&#39;
  }
  {
    name: &#39;archiveseattle&#39;
    accessTier: &#39;Cool&#39;
  }
] 

resource sa &#39;Microsoft.Storage/storageAccounts@2019-04-01&#39; = [for sAcct in sAccounts: {
  name: concat(sAcct.name, uniqueString(resourceGroup().id))
  location: resourceGroup().location
  sku: {
    name: &#39;Standard_LRS&#39;
  }
  kind: &#39;StorageV2&#39;
  properties: {
    accessTier: sAcct.accessTier
  }
}]
</code></pre></td></tr></table>
</div>
</div><p>In this example, the <code>sAccounts</code> variable is a collection of objects. Each object in this collection has two properties &ndash; <code>name</code> and <code>accessTier</code>. We use the same collection for both storage account instance and the <code>accessTier</code> resource property. Within the iteration, you can access the properties using an accessor. <code>sAcct</code> represents the item from <code>sAccounts</code> collection in the current iteration and <code>sAcct.name</code> and <code>sAcct.accessTier</code> represent the <code>name</code> and <code>accessTier</code> values associated with the current item in the collection.</p>
<h2 id="iterating-over-elements-in-an-array">Iterating over elements in an array</h2>
<p>The final method to use loops in Bicep files is to iterate over elements in an array. In the first method, you looked using the index value from the iteration. In the second method where we used an array of storage account names, we used the element value within each iteration. In this third method, you can access both index and element value. The general syntax for this type of iteration is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">[for (&lt;item&gt;, &lt;index&gt;) in &lt;collection&gt;: {
  &lt;resource-instance&gt; or &lt;resource-properties&gt;
}]
</code></pre></td></tr></table>
</div>
</div><h3 id="resource-iteration-2">Resource Iteration</h3>
<p>The syntax for resource iteration using this third method is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">resource &lt;resource-symbolic-name&gt; &#39;&lt;resource-type&gt;@&lt;api-version&gt;&#39; = [for (&lt;item&gt;, &lt;index&gt;) in &lt;collection&gt;: {
  &lt;resource-instance&gt;
}]
</code></pre></td></tr></table>
</div>
</div><p>Using this method, you can simplify the above example where you created multiple storage accounts and configured a different access tier for each account.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">var sAccounts = [
  {
    name: &#39;sqllondon&#39;
    accessTier: &#39;Cool&#39;
  }
  {
    name: &#39;sqlchennai&#39;
    accessTier: &#39;Hot&#39;
  }
  {
    name: &#39;archiveseattle&#39;
    accessTier: &#39;Cool&#39;
  }
] 

resource sa &#39;Microsoft.Storage/storageAccounts@2019-04-01&#39; = [for (sItem, sIndex) in sAccounts: {
  name: &#39;stg${sItem.name}${sIndex}&#39;
  location: resourceGroup().location
  sku: {
    name: &#39;Standard_LRS&#39;
  }
  kind: &#39;StorageV2&#39;
  properties: {
    accessTier: sItem.accessTier
  }
}]
</code></pre></td></tr></table>
</div>
</div><p>In this method of iteration, <code>sItem</code> represents the element at the current index and <code>sIndex</code> is the integer representing the current iteration. You can build this and see how it gets transpiled to ARM JSON representation.</p>
<h3 id="resource-property-iteration-2">Resource property Iteration</h3>
<p>The syntax for resource property iteration in this method is:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&lt;property-name&gt;: [for (&lt;item&gt;, &lt;index&gt;) in &lt;collection&gt;: {
  &lt;resource-properties&gt;
}]
</code></pre></td></tr></table>
</div>
</div><p>Here is an example of using this method to create multiple subnets in a Azure virtual network.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">var subnetPrefix = [
  &#39;10.10.12.0/24&#39;
  &#39;10.10.13.0/24&#39;
]

resource vnet &#39;Microsoft.Network/virtualNetworks@2018-11-01&#39; = {
  name: &#39;vnet&#39;
  location: resourceGroup().location
  properties: {
    addressSpace: {
      addressPrefixes: [
        &#39;10.10.10.0/16&#39;
      ]
    }
    subnets: [for (sItem, sIndex) in subnetPrefix: {
      name: &#39;subnet${sIndex}&#39;
      properties: {
        addressPrefix: sItem
      }
    }]
  }
}
</code></pre></td></tr></table>
</div>
</div><p>When you choose one of these methods depends on what type of configuration you want to perform. As you start building more complex Bicep files, you will start identifying places to use one of the three methods that you just learned.</p>
<h2 id="serial-deployment-of-resources">Serial deployment of resources</h2>
<p>By default, creating multiple resource instances happens in parallel. However, you can configure to do this serially as well. This is where you use the the <code>@batchSize</code> decorator in a resource declaration. This decorator takes an integer as input which represent the number of parallel deployments to perform. Here is a quick example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">param saCount int = 20

@batchSize(3)
resource sa &#39;Microsoft.Storage/storageAccounts@2019-04-01&#39; = [for index in range(0, saCount): {
  name: &#39;${index}stg${uniqueString(resourceGroup().id)}&#39;
  location: resourceGroup().location
  sku: {
    name: &#39;Standard_LRS&#39;
  }
  kind: &#39;StorageV2&#39;
  properties: {
  	accessTier: &#39;Hot&#39;
  }
}]
</code></pre></td></tr></table>
</div>
</div><p>When you add a <code>batchSize</code> decorator, the resulting ARM representation sets the <code>mode</code> property of the <code>copy</code> element to serial.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="s2">&#34;resources&#34;</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&#34;copy&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;sa&#34;</span><span class="p">,</span>
        <span class="nt">&#34;count&#34;</span><span class="p">:</span> <span class="s2">&#34;[length(range(0, parameters(&#39;saCount&#39;)))]&#34;</span><span class="p">,</span>
        <span class="nt">&#34;mode&#34;</span><span class="p">:</span> <span class="s2">&#34;serial&#34;</span><span class="p">,</span>
        <span class="nt">&#34;batchSize&#34;</span><span class="p">:</span> <span class="mi">3</span>
      <span class="p">},</span>
      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Storage/storageAccounts&#34;</span><span class="p">,</span>
      <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2019-04-01&#34;</span><span class="p">,</span>
      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[format(&#39;{0}stg{1}&#39;, range(0, parameters(&#39;saCount&#39;))[copyIndex()], uniqueString(resourceGroup().id))]&#34;</span><span class="p">,</span>
      <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceGroup().location]&#34;</span><span class="p">,</span>
      <span class="nt">&#34;sku&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;Standard_LRS&#34;</span>
      <span class="p">},</span>
      <span class="nt">&#34;kind&#34;</span><span class="p">:</span> <span class="s2">&#34;StorageV2&#34;</span><span class="p">,</span>
      <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;accessTier&#34;</span><span class="p">:</span> <span class="s2">&#34;Hot&#34;</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">]</span>
</code></pre></td></tr></table>
</div>
</div><p>So far you have learned about using iteration for resource creation and resource properties. This is it for today. In the next part of this series, you will learn about outputs in Bicep files and how iterations can be used with outputs. Stay tuned.</p>

        

<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
position: relative;
text-align: left; 
height: 36px; 
width: 32px; 
float: left; 
text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span style="color: rgb(77, 77, 95);">Share on: </span><div id="share-buttons">
<div class="facebook" title="Share this on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https:\/\/ravichaganti.com\/blog\/bicep-basics-beyond-basics-iterations\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
<div class="twitter" title="Share this on Twitter" onclick="window.open('https://twitter.com/intent/tweet?text=https:\/\/ravichaganti.com\/blog\/bicep-basics-beyond-basics-iterations\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
<div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/sharing/share-offsite/?url=https:\/\/ravichaganti.com\/blog\/bicep-basics-beyond-basics-iterations\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
<div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https:\/\/ravichaganti.com\/blog\/bicep-basics-beyond-basics-iterations\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>
      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3>See also in Azure Bicep</h3>
      <nav>
        <ul>
        
        
          
            <li>
              <a href="https://ravichaganti.com/blog/2022-11-26-fully-automated-kubernetes-cluster-deployment-on-azure-in-under-8-minutes/">Fully automated Kubernetes cluster deployment on Azure in under 8 minutes</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/book-announcing-azure-bicep-zero-to-hero/">[Book] - Annoucing Azure Bicep - Zero to Hero</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/bicep-v0-4-and-linter/">Bicep v0.4 and the linter</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/bicep-container-image/">Bicep Container Image</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/bicep-visualizer/">Bicep Visualizer</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/bicep-basics-beyond-basics-scoped-deployment/">Bicep Language - Beyond Basics - Scoped Deployment</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ravikanth" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
        
          
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-3619442-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p>All Rights Reserved.</p>
      
      
        ©
        
          2019 -
        
        2023
         Ravikanth Chaganti 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a> and hosted using <a href="https://pages.github.com/">GitHub Pages</a>.
      
      
    </section>
  </footer>

    </main>

    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-3619442-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
    

  </body>

</html>
