<!DOCTYPE html>
<html lang="en-us">
<head>
  
  <script>
    (function() {
      const stored = localStorage.getItem('theme-preference');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = stored || (prefersDark ? 'dark' : 'light');

      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Google ADK - Runner and execution architecture | Ravikanth Chaganti</title>

  
  <meta name="description" content="You have defined your agents, wired up tools, set up callbacks, and configured sessions with scoped state. But when a user sends a message, what actually happens? Who calls the agent? Who persists in the state changes? Who decides when the conversation turn is over? The answer to all of these is the Runner. The Runner is the central orchestrator of the ADK runtime. It receives a user&rsquo;s query, starts the agent, processes every event the agent emits, commits state changes via the SessionService, and forwards events to the caller. Without the Runner, your agents, tools, and callbacks are just definitions sitting idle. The Runner is the engine that brings them to life.">
  <meta name="author" content="Ravikanth Chaganti">

  
  
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  

  
  <meta property="og:title" content="Google ADK - Runner and execution architecture">
  <meta property="og:description" content="You have defined your agents, wired up tools, set up callbacks, and configured sessions with scoped state. But when a user sends a message, what actually happens? Who calls the agent? Who persists in the state changes? Who decides when the conversation turn is over? The answer to all of these is the Runner. The Runner is the central orchestrator of the ADK runtime. It receives a user&rsquo;s query, starts the agent, processes every event the agent emits, commits state changes via the SessionService, and forwards events to the caller. Without the Runner, your agents, tools, and callbacks are just definitions sitting idle. The Runner is the engine that brings them to life.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://ravichaganti.com/blog/google-adk-runner-and-execution-architecture/">
  <meta property="og:site_name" content="Ravikanth Chaganti">
  <meta property="og:locale" content="en_US">
  
  <meta property="og:image" content="https://ravichaganti.com/images/adk.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Google ADK - Runner and execution architecture">

  
  
    <meta property="article:published_time" content="2025-12-18T00:00:00Z">
    <meta property="article:modified_time" content="2025-12-18T00:00:00Z">
    <meta property="article:author" content="Ravikanth Chaganti">
    <meta property="article:section" content="Google">
    
  

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Google ADK - Runner and execution architecture">
  <meta name="twitter:description" content="You have defined your agents, wired up tools, set up callbacks, and configured sessions with scoped state. But when a user sends a message, what actually happens? Who calls the agent? Who persists in the state changes? Who decides when the conversation turn is over? The answer to all of these is the Runner. The Runner is the central orchestrator of the ADK runtime. It receives a user&rsquo;s query, starts the agent, processes every event the agent emits, commits state changes via the SessionService, and forwards events to the caller. Without the Runner, your agents, tools, and callbacks are just definitions sitting idle. The Runner is the engine that brings them to life.">
  <meta name="twitter:image" content="https://ravichaganti.com/images/adk.png">
  <meta name="twitter:site" content="@ravikanth">

  
  <link rel="canonical" href="https://ravichaganti.com/blog/google-adk-runner-and-execution-architecture/">

  
  <link rel="alternate" type="application/rss+xml" href="https://ravichaganti.com/index.xml">

  
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate icon" type="image/x-icon" href="/favicon.ico">

  
  <link rel="stylesheet" href="/css/main.css">

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  
  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Google ADK - Runner and execution architecture",
  "description": "You have defined your agents, wired up tools, set up callbacks, and configured sessions with scoped state. But when a user sends a message, what actually happens? Who calls the agent? Who persists in â€¦",
  "articleBody": "\"You have defined your agents, wired up tools, set up callbacks, and configured sessions with scoped state. But when a user sends a message, what actually happens? Who calls the agent? Who persists in the state changes? Who decides when the conversation turn is over? The answer to all of these is the Runner. The Runner is the central orchestrator of the ADK runtime. It receives a user\\u0026rsquo;s query, starts the agent, processes every event the agent emits, commits state changes via the SessionService, and forwards events to the caller. Without the Runner, your agents, tools, and callbacks are just definitions sitting idle. The Runner is the engine that brings them to life.\\nThe event loop An event loop is at the heart of the ADK runtime and facilitates the communication between the Runner component and the agent execution. When a user prompt arrives, the Runner hands it over to the agent for processing. The agent runs until it has something to yield, at which point it emits an event. The Runner receives the event, processes any associated actions, calls the session service to append the event to the current state, and forwards the event. After the Runner completes event processing, the agent resumes from where it was paused and continues this loop until it has no more events to yield. The Runner component is the central orchestrator of this event loop.\\nSeveral components work together within the ADK runtime. Understanding their roles clarifies how the event loop functions.\\nThe Runner The Runner serves as the central coordinator for a single-user invocation. Its responsibilities in the loop are:\\nInitiation: Receives the user\\u0026rsquo;s query (new_message) and appends it to the session history via the SessionService. Kick-off: Starts event generation by calling the main agent\\u0026rsquo;s execution method (agent.run_async(...)). Receive and process: Waits for the agent logic to yield an Event. Upon receiving one, it uses configured services (SessionService, ArtifactService, MemoryService) to commit changes indicated in event.actions (such as state_delta and artifact_delta). Yield upstream: Forwards the processed event onwards to the calling application or UI for rendering. Iterate: Signals the agent logic that processing is complete, allowing it to resume and generate the next event. The execution logic Your code within agents, tools, and callbacks is responsible for the actual computation and decision-making. Its interaction with the loop follows a specific pattern:\\nExecute: Runs its logic based on the current InvocationContext, including the session state as it was when execution resumed. Yield: When the logic needs to communicate, it constructs an Event containing the relevant content and actions, then yields it back to the Runner. Pause: The agent\\u0026rsquo;s execution pauses immediately after the yield. It waits for the Runner to complete processing and committing. Resume: Only after the Runner has processed the yielded event does the agent logic resume from the statement immediately following the yield. See updated state: Upon resumption, the agent logic can now reliably access the session state reflecting the changes that were committed by the Runner. This cooperative yield/pause/resume cycle between the Runner and your execution logic, mediated by Event objects, forms the core of the ADK runtime. When the Runner starts processing a user query, it creates an InvocationContext. This is the runtime\\u0026rsquo;s \\u0026ldquo;traveling notebook\\u0026rdquo; that accompanies the interaction from start to finish, collecting information, tracking progress, and providing context to every component along the way. You do not typically create or manage this object directly. The ADK framework creates it when an invocation starts via runner.run_async and passes the relevant contextual information to your agent code, callbacks, and tools. When you implement custom agents, you receive them as the ctx parameter in _run_async_impl.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 from google.adk.agents import BaseAgent from google.adk.agents.invocation_context import InvocationContext from google.adk.events import Event from typing import AsyncGenerator class MyAgent(BaseAgent): async def _run_async_impl( self, ctx: InvocationContext ) -\\u0026gt; AsyncGenerator[Event, None]: # Direct access to runtime information agent_name = ctx.agent.name session_id = ctx.session.id current_state = ctx.session.state # Use ctx.end_invocation = True to terminate early ... It is important to understand the hierarchy of concepts within an invocation. An invocation starts with a user message and ends with a final response. It can contain one or multiple agent calls, for example, when using agent transfer or AgentTool. Each agent call is handled by agent.run_async(). An LLM agent call can contain one or multiple steps. Each step calls the LLM once and yields its response. If the LLM requests tool calls, those are executed within the same step.\\nState variables prefixed with temp: are strictly scoped to a single invocation and discarded afterwards. When a parent agent calls a sub-agent, it passes its InvocationContext to the sub-agent. This means the entire chain of agent calls shares the same invocation ID and the same temp: state.\\nCreating and using a Runner To create a Runner, you need an agent and a SessionService. Optionally, you can provide an ArtifactService and a MemoryService.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 from google.adk.agents import LlmAgent from google.adk.sessions import InMemorySessionService from google.adk.runners import Runner # Define the agent agent = LlmAgent( name=\\u0026#34;MyAgent\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, instruction=\\u0026#34;You are a helpful assistant.\\u0026#34; ) # Create the session service session_service = InMemorySessionService() # Create the runner runner = Runner( agent=agent, app_name=\\u0026#34;my_app\\u0026#34;, session_service=session_service ) Once you have a runner, you interact with it using one of its run methods.\\nrun_async This is the primary method for executing agent invocations. It returns an async generator of events. The ADK runtime is fundamentally built on asynchronous patterns using Python\\u0026rsquo;s asyncio to handle concurrent operations like waiting for LLM responses or tool executions efficiently without blocking.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 from google.genai.types import Content, Part session = await session_service.create_session( app_name=\\u0026#34;my_app\\u0026#34;, user_id=\\u0026#34;user_1\\u0026#34; ) user_msg = Content(parts=[Part(text=\\u0026#34;Hello!\\u0026#34;)], role=\\u0026#34;user\\u0026#34;) async for event in runner.run_async( user_id=\\u0026#34;user_1\\u0026#34;, session_id=session.id, new_message=user_msg ): if event.is_final_response() and event.content and event.content.parts: print(event.content.parts[0].text) run (synchronous) A synchronous Runner.run method exists for convenience in simple scripts or testing environments. Internally, it calls Runner.run_async and manages the async event loop execution for you.\\n1 2 3 4 5 6 7 8 9 user_msg = Content(parts=[Part(text=\\u0026#34;Hello!\\u0026#34;)], role=\\u0026#34;user\\u0026#34;) for event in runner.run( user_id=\\u0026#34;user_1\\u0026#34;, session_id=session.id, new_message=user_msg ): if event.is_final_response() and event.content and event.content.parts: print(event.content.parts[0].text) For production applications, especially web servers, we should design applications to be asynchronous using run_async for best performance.\\nrun_live For bidirectional streaming scenarios, such as voice conversations, the Runner provides run_live. This method uses a LiveRequestQueue for sending messages and returns an async generator of events. Unlike run_async, which handles a single request-response cycle, run_live maintains a persistent streaming connection to the LLM.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 from google.adk.agents.run_config import RunConfig from google.adk.runners import Runner from google.adk.sessions import InMemorySessionService runner = Runner( agent=agent, app_name=\\u0026#34;my_app\\u0026#34;, session_service=InMemorySessionService() ) session = await session_service.create_session( app_name=\\u0026#34;my_app\\u0026#34;, user_id=\\u0026#34;user_1\\u0026#34; ) live_request_queue = LiveRequestQueue() run_config = RunConfig(response_modalities=[\\u0026#34;TEXT\\u0026#34;]) async for event in runner.run_live( session=session, live_request_queue=live_request_queue, run_config=run_config ): if event.content and event.content.parts: print(event.content.parts[0].text) One InvocationContext corresponds to one run_live() loop. It is created when you call run_live() and persists for the entire streaming session.\\nRunConfig The RunConfig class defines runtime behavior and options for agents. It controls streaming settings, function calling, artifact saving, and LLM call limits. You pass a RunConfig to customize how the runner executes your agent.\\n1 2 3 4 5 6 7 8 from google.adk.agents.run_config import RunConfig, StreamingMode run_config = RunConfig( streaming_mode=StreamingMode.NONE, max_llm_calls=500, save_input_blobs_as_artifacts=False, support_cfc=False ) Some of the key properties of the RunConfig class are:\\nProperty Type Default Purpose streaming_mode StreamingMode StreamingMode.NONE Controls output delivery: NONE, SSE, or BIDI max_llm_calls int 500 Safety limit on total LLM calls per invocation save_input_blobs_as_artifacts bool False Whether to save input binary data as artifacts support_cfc bool False Enables Compositional Function Calling speech_config SpeechConfig None Voice configuration for live/audio agents response_modalities list[str] None Controls output format: [\\u0026quot;TEXT\\u0026quot;] or [\\u0026quot;AUDIO\\u0026quot;] StreamingMode The streaming_mode setting determines how the agent\\u0026rsquo;s responses are delivered.\\nStreamingMode.NONE is the default. The LLM generates its entire response before delivering it. The Runner receives a single non-partial event for the response. StreamingMode.SSE (Server-Sent Events) uses HTTP streaming. The LLM generates its response in chunks. The Runner yields multiple events with partial=True for progressive display, followed by a final non-partial event. StreamingMode.BIDI enables full bidirectional streaming via WebSocket, used with run_live() for real-time voice and multimodal interactions. max_llm_calls The max_llm_calls parameter acts as a safety limit to prevent runaway agent loops. If an agent enters an infinite tool-calling cycle, this limit ensures the invocation terminates after a set number of LLM calls. The default of 500 is generous for most use cases.\\nCompositional Function Calling Setting support_cfc=True enables Compositional Function Calling. This allows the model to orchestrate multiple tools in sophisticated patterns, calling tools in parallel, chaining outputs as inputs to other tools, or conditionally executing tools based on intermediate results.\\nUnderstanding a few key aspects of how the ADK runtime handles state and streaming is crucial for building predictable agents.\\nPutting it all together Here is a complete example that demonstrates the Runner orchestrating a multi-turn conversation with a tool-calling agent. This builds on the sessions and state concepts from the earlier article in this series.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 import asyncio from google.adk.agents import LlmAgent from google.adk.sessions import InMemorySessionService from google.adk.runners import Runner from google.adk.tools import ToolContext from google.genai.types import Content, Part # --- Tools that modify state --- def lookup_weather( city: str, tool_context: ToolContext ) -\\u0026gt; dict: \\u0026#34;\\u0026#34;\\u0026#34;Looks up the current weather for a city.\\u0026#34;\\u0026#34;\\u0026#34; weather_data = { \\u0026#34;Paris\\u0026#34;: {\\u0026#34;temp\\u0026#34;: 18, \\u0026#34;condition\\u0026#34;: \\u0026#34;Partly cloudy\\u0026#34;}, \\u0026#34;London\\u0026#34;: {\\u0026#34;temp\\u0026#34;: 14, \\u0026#34;condition\\u0026#34;: \\u0026#34;Rainy\\u0026#34;}, \\u0026#34;Tokyo\\u0026#34;: {\\u0026#34;temp\\u0026#34;: 22, \\u0026#34;condition\\u0026#34;: \\u0026#34;Sunny\\u0026#34;}, } result = weather_data.get(city, {\\u0026#34;temp\\u0026#34;: 0, \\u0026#34;condition\\u0026#34;: \\u0026#34;Unknown\\u0026#34;}) # Track the last city queried in session state tool_context.state[\\u0026#34;last_city\\u0026#34;] = city tool_context.state[\\u0026#34;user:query_count\\u0026#34;] = ( tool_context.state.get(\\u0026#34;user:query_count\\u0026#34;, 0) + 1 ) return result # --- Agent --- weather_agent = LlmAgent( name=\\u0026#34;WeatherAgent\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, instruction=\\u0026#34;\\u0026#34;\\u0026#34;You are a weather assistant for {user:name}. They have made {user:query_count?} queries so far. Last city checked: {last_city?} Provide weather information when asked.\\u0026#34;\\u0026#34;\\u0026#34;, tools=[lookup_weather], output_key=\\u0026#34;last_response\\u0026#34; ) # --- Runner and interaction --- async def main(): session_service = InMemorySessionService() runner = Runner( agent=weather_agent, app_name=\\u0026#34;weather_app\\u0026#34;, session_service=session_service ) session = await session_service.create_session( app_name=\\u0026#34;weather_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34;, state={\\u0026#34;user:name\\u0026#34;: \\u0026#34;Ravi\\u0026#34;, \\u0026#34;user:query_count\\u0026#34;: 0} ) # Turn 1 msg1 = Content(parts=[Part(text=\\u0026#34;What\\u0026#39;s the weather in Paris?\\u0026#34;)], role=\\u0026#34;user\\u0026#34;) async for event in runner.run_async( user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id, new_message=msg1 ): if event.is_final_response() and event.content: print(f\\u0026#34;Agent: {event.content.parts[0].text}\\u0026#34;) # Inspect state after Turn 1 s = await session_service.get_session( app_name=\\u0026#34;weather_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id ) print(f\\u0026#34;State: last_city={s.state.get(\\u0026#39;last_city\\u0026#39;)}\\u0026#34;) print(f\\u0026#34;State: user:query_count={s.state.get(\\u0026#39;user:query_count\\u0026#39;)}\\u0026#34;) print(f\\u0026#34;Events so far: {len(s.events)}\\u0026#34;) # Turn 2 msg2 = Content(parts=[Part(text=\\u0026#34;How about Tokyo?\\u0026#34;)], role=\\u0026#34;user\\u0026#34;) async for event in runner.run_async( user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id, new_message=msg2 ): if event.is_final_response() and event.content: print(f\\u0026#34;Agent: {event.content.parts[0].text}\\u0026#34;) # Inspect state after Turn 2 s = await session_service.get_session( app_name=\\u0026#34;weather_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id ) print(f\\u0026#34;State: last_city={s.state.get(\\u0026#39;last_city\\u0026#39;)}\\u0026#34;) print(f\\u0026#34;State: user:query_count={s.state.get(\\u0026#39;user:query_count\\u0026#39;)}\\u0026#34;) asyncio.run(main()) When you run this, you can observe the Runner orchestrating the full event loop across multiple turns, with the session service persisting state between them.\\n1 2 3 4 5 6 7 8 9 10 11 \\u0026gt; python.exe .\\\\runner-weather.py Agent: The weather in Paris is partly cloudy with a temperature of 18 degrees. State: last_city=Paris State: user:query_count=1 Events so far: 4 Agent: The weather in Tokyo is sunny with a temperature of 22 degrees. State: last_city=Tokyo State: user:query_count=2 Notice how the Runner drives the entire lifecycle. It receives each user message, passes it to the agent, processes every event the agent generates, including tool call events where state is modified via ToolContext, commits the state_delta through the SessionService, and yields the final response events back to our code. The user:query_count counter increases across turns because the user-scoped state is persisted by the session service between invocations. The agent\\u0026rsquo;s instruction template {user:query_count?} is resolved by the framework on each turn using the latest committed state.\\nUnderstanding the Runner and its execution architecture is essential for building reliable agent applications with Google ADK. The Runner is the piece that connects everything we have covered so far in this series, from sessions and state to callbacks and tools. Every state change flows through events, every event flows through the Runner, and the Runner ensures consistency through the yield/pause/process/resume cycle. I recommend experimenting with different RunConfig settings and tracing the events your agents emit to build a deeper understanding of this architecture.\\n\"",
  "url": "https:\/\/ravichaganti.com\/blog\/google-adk-runner-and-execution-architecture\/",
  "datePublished": "2025-12-18T00:00:00Z",
  "dateModified": "2025-12-18T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Ravikanth Chaganti"
    ,"sameAs": ["https://twitter.com/ravikanth"]
  },
  "publisher": {
    "@type": "Person",
    "name": "Ravikanth Chaganti",
    "sameAs": ["https://twitter.com/ravikanth"]
  },
  
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/ravichaganti.com\/images\/adk.png",
    "width": 1200,
    "height": 630
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/ravichaganti.com\/blog\/google-adk-runner-and-execution-architecture\/"
  },
  
  "articleSection": "\"Google\"",
  
  
  
  "timeRequired": "PT11M",
  
  "inLanguage": "en-US",
  "isAccessibleForFree": true
}
</script>




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https:\/\/ravichaganti.com\/"
    }
    ,
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https:\/\/ravichaganti.com\/blog/"
    }
    
    ,
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Google",
      "item": "https:\/\/ravichaganti.com\/categories/google/"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Google ADK - Runner and execution architecture",
      "item": "https:\/\/ravichaganti.com\/blog\/google-adk-runner-and-execution-architecture\/"
    }
    
    
  ]
}
</script>


</head>

<body class="flex flex-col min-h-screen bg-gray-50 dark:bg-dark-bg">
  <header class="sticky top-0 z-50 bg-white dark:bg-dark-bg-secondary shadow-md relative">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      
      <div class="flex items-center">
        <a href="https://ravichaganti.com/" class="flex items-center gap-3 text-gray-900 dark:text-dark-text hover:text-primary transition-colors no-underline group">
          
          <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
            <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2" class="group-hover:stroke-primary transition-colors"/>
            <text x="20" y="26" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="currentColor">RC</text>
          </svg>
          
          <div class="flex flex-col leading-tight">
            <span class="text-xs sm:text-sm font-semibold">Cloud Native</span>
            <span class="text-xs sm:text-sm font-semibold">Agentic AI</span>
            <span class="text-xs sm:text-sm font-semibold">Infrastructure</span>
          </div>
        </a>
      </div>

      
      <div class="hidden md:flex items-center space-x-8">
        
          <a href="/blog/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Blog
          </a>
        
          <a href="/books/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Books
          </a>
        
          <a href="https://learn.ravichaganti.com" target="_blank" rel="noopener noreferrer" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Courses
          </a>
        
          <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank" rel="noopener noreferrer" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Newsletter
          </a>
        
          <a href="/about/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            About
          </a>
        
      </div>

      
      <div class="hidden md:flex items-center space-x-4 relative" id="social-search-container">
        
        <div id="social-icons" class="flex items-center space-x-3">
          

<a href="https://twitter.com/ravikanth" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Twitter">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
  </svg>
</a>



<a href="https://github.com/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="GitHub">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
  </svg>
</a>



<a href="https://linkedin.com/in/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="LinkedIn">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
  </svg>
</a>




        </div>

        
        <button
          id="theme-toggle"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="search-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <div id="search-box" class="hidden absolute top-full right-0 mt-2 w-80 bg-white dark:bg-dark-bg-secondary shadow-lg p-4 z-50 rounded-lg">
          





<div class="relative search-container" data-mode="desktop">
  <input
    type="text"
    id="search-input-desktop"
    placeholder="Search articles..."
    class="search-input w-full px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results-desktop" class="search-results absolute top-full mt-2 w-full bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-80 overflow-y-auto z-50">
    
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>


<script>
(function() {
  let headerFuse;
  let headerSearchData = [];
  let searchInitialized = false;

  
  fetch('/index.json')
    .then(response => response.json())
    .then(data => {
      headerSearchData = data;

      
      const options = {
        keys: [
          { name: 'title', weight: 3 },
          { name: 'excerpt', weight: 2 },
          { name: 'content', weight: 1 },
          { name: 'categories', weight: 1.5 },
          { name: 'series', weight: 1.5 }
        ],
        threshold: 0.4,
        includeScore: true,
        ignoreLocation: true,
        minMatchCharLength: 2
      };

      headerFuse = new Fuse(headerSearchData, options);
      searchInitialized = true;
    })
    .catch(error => console.error('Error loading search index:', error));

  
  function renderResults(results, resultsContainer) {
    if (results.length === 0) {
      resultsContainer.innerHTML = '<div class="p-4 text-center text-gray-500 dark:text-dark-text-secondary text-sm">No results found</div>';
      resultsContainer.classList.remove('hidden');
      return;
    }

    resultsContainer.innerHTML = results.slice(0, 5).map(result => {
      const item = result.item;
      const date = new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

      return `
        <a href="${item.permalink}" class="block p-3 hover:bg-gray-50 dark:hover:bg-dark-bg-tertiary border-b border-gray-100 dark:border-dark-border last:border-b-0 no-underline">
          <div class="font-medium text-sm text-gray-900 dark:text-dark-text mb-1">${item.title}</div>
          <div class="flex items-center gap-2 mb-1 flex-wrap">
            <span class="text-xs text-gray-500 dark:text-dark-text-secondary">${date}</span>
            ${item.categories ? item.categories.slice(0, 2).map(cat => `
              <span class="inline-block px-1.5 py-0.5 text-xs rounded bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400">
                ${cat}
              </span>
            `).join('') : ''}
          </div>
          ${item.excerpt ? `<p class="text-xs text-gray-600 dark:text-dark-text-secondary line-clamp-2">${item.excerpt}</p>` : ''}
        </a>
      `;
    }).join('');

    resultsContainer.classList.remove('hidden');
  }

  
  function initSearchContainers() {
    const containers = document.querySelectorAll('.search-container');

    containers.forEach(container => {
      const searchInput = container.querySelector('.search-input');
      const searchResults = container.querySelector('.search-results');

      if (!searchInput || !searchResults) return;

      
      searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();

        if (query.length < 2 || !searchInitialized) {
          searchResults.classList.add('hidden');
          return;
        }

        const results = headerFuse.search(query);
        renderResults(results, searchResults);
      });

      
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          searchResults.classList.add('hidden');
          searchInput.blur();
        }
      });
    });

    
    function closeAllResults(e) {
      const containers = document.querySelectorAll('.search-container');
      containers.forEach(container => {
        const searchResults = container.querySelector('.search-results');
        if (searchResults && !container.contains(e.target)) {
          searchResults.classList.add('hidden');
        }
      });
    }

    document.addEventListener('click', closeAllResults);
    document.addEventListener('touchend', closeAllResults);
  }

  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSearchContainers);
  } else {
    initSearchContainers();
  }
})();
</script>


        </div>
      </div>

      
      <div class="md:hidden flex items-center gap-2">
        
        <button id="search-toggle-mobile" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <button
          id="theme-toggle-mobile"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="mobile-menu-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded" aria-label="Menu">
          <svg class="w-6 h-6 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    
    <div id="search-box-mobile" class="hidden md:hidden absolute top-full left-0 right-0 bg-white dark:bg-dark-bg-secondary shadow-lg p-4 z-50">
      





<div class="relative search-container" data-mode="mobile">
  <input
    type="text"
    id="search-input-mobile"
    placeholder="Search articles..."
    class="search-input w-full px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results-mobile" class="search-results absolute top-full mt-2 w-full bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-80 overflow-y-auto z-50">
    
  </div>
</div>




    </div>

    
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4">
      
        <a href="/blog/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Blog
        </a>
      
        <a href="/books/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Books
        </a>
      
        <a href="https://learn.ravichaganti.com" target="_blank" rel="noopener noreferrer" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Courses
        </a>
      
        <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank" rel="noopener noreferrer" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Newsletter
        </a>
      
        <a href="/about/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          About
        </a>
      
    </div>
  </nav>

  
  
    <div id="reading-progress" class="absolute bottom-0 left-0 w-full h-1 bg-primary transition-all duration-200 z-10" style="width: 0%; max-width: 100%;"></div>
  
</header>


<script>
  document.getElementById('mobile-menu-toggle')?.addEventListener('click', function() {
    const menu = document.getElementById('mobile-menu');
    menu?.classList.toggle('hidden');
  });

  
  document.getElementById('search-toggle')?.addEventListener('click', function() {
    const searchBox = document.getElementById('search-box');
    searchBox?.classList.toggle('hidden');
    if (!searchBox?.classList.contains('hidden')) {
      searchBox?.querySelector('.search-input')?.focus();
    }
  });

  
  document.getElementById('search-toggle-mobile')?.addEventListener('click', function() {
    const searchBoxMobile = document.getElementById('search-box-mobile');
    searchBoxMobile?.classList.toggle('hidden');
    if (!searchBoxMobile?.classList.contains('hidden')) {
      searchBoxMobile?.querySelector('.search-input')?.focus();
    }
  });

  
  document.addEventListener('click', function(e) {
    const searchBox = document.getElementById('search-box');
    const searchToggle = document.getElementById('search-toggle');
    if (searchBox && searchToggle && !searchBox.contains(e.target) && !searchToggle.contains(e.target)) {
      searchBox.classList.add('hidden');
    }
  });

  
  document.addEventListener('click', function(e) {
    const searchBoxMobile = document.getElementById('search-box-mobile');
    const searchToggleMobile = document.getElementById('search-toggle-mobile');
    if (searchBoxMobile && searchToggleMobile && !searchBoxMobile.contains(e.target) && !searchToggleMobile.contains(e.target)) {
      searchBoxMobile.classList.add('hidden');
    }
  });
</script>


  <main class="flex-grow">
    
<article class="container mx-auto px-4 sm:px-6 md:px-4 py-8 sm:py-10 md:py-12">
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-[75%_25%] gap-8">
      
      <div class="min-w-0">
        
        <header class="mb-8">
          
          <nav class="text-xs sm:text-sm mb-4">
            <ol class="flex items-center space-x-2 text-gray-600 dark:text-dark-text-secondary">
              <li><a href="https://ravichaganti.com/" class="hover:text-primary dark:hover:text-blue-400">Home</a></li>
              <li><span class="mx-2">/</span></li>
              <li><a href="/blog/" class="hover:text-primary dark:hover:text-blue-400">Blog</a></li>
              
              <li><span class="mx-2">/</span></li>
              <li><a href="/categories/google/" class="hover:text-primary dark:hover:text-blue-400">Google</a></li>
              
            </ol>
          </nav>

          
          <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-dark-text mb-6">
            Google ADK - Runner and execution architecture
          </h1>

          
          <div
            class="flex flex-wrap items-center gap-2 sm:gap-3 md:gap-4 text-sm sm:text-base text-gray-600 dark:text-dark-text-secondary mb-6">
            
            <div class="flex items-center">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <time datetime=" 2025-12-18">December 18, 2025</time>
            </div>

            
            
            <span>â€¢</span>
            <div class="flex items-center">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span>11 min read</span>
            </div>
            

            
            
          </div>

          
          <div class="flex flex-wrap gap-2 mb-6">
            
            
            <a href="/categories/google/"
              class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Google
            </a>
            
            <a href="/categories/agent-development-kit/"
              class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Agent Development Kit
            </a>
            
            <a href="/categories/agents/"
              class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Agents
            </a>
            
            
            
            
            <a href="/series/google-adk/"
              class="inline-block px-3 py-1 text-sm font-medium bg-secondary/10 dark:bg-secondary/20 text-secondary dark:text-purple-400 rounded-full hover:bg-secondary/20 dark:hover:bg-secondary/30 transition-colors no-underline">
              ðŸ“š Series: Google ADK
            </a>
            
            
          </div>

          
          
          <div
            class="text-base sm:text-lg md:text-xl text-gray-700 dark:text-dark-text-secondary italic border-l-4 border-primary dark:border-blue-400 pl-4 sm:pl-6 py-2 mb-6 sm:mb-8 bg-gray-50 dark:bg-dark-bg-tertiary rounded-r">
            You have agents, tools, callbacks, and sessions. But what actually runs them? The Runner is the central orchestrator that powers every agent interaction in Google ADK, driving the event loop that connects all these pieces together.
          </div>
          
        </header>

        
        


  
  
  
    <aside class="bg-gradient-to-br from-secondary/5 to-primary/5 dark:from-secondary/10 dark:to-primary/10 rounded-lg shadow-md dark:shadow-2xl dark:shadow-black/20 p-4 mb-6 border border-secondary/20 dark:border-secondary/30">
      
      <button
        class="flex items-center justify-between w-full text-left font-semibold text-base text-gray-900 dark:text-dark-text hover:text-secondary dark:hover:text-purple-400 transition-colors"
        aria-expanded="false"
        aria-controls="series-content"
      >
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          Series: Google ADK
        </span>
        <svg
          id="series-chevron"
          class="w-4 h-4 transform transition-transform -rotate-90"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      
      <p class="text-xs text-gray-600 dark:text-dark-text-secondary mt-2 mb-2 collapsed" id="series-description">
        Part of a 8-part series
      </p>

      
      <nav id="series-content" class="series-content collapsed mt-1">
        <ol class="space-y-3">
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                1
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/introduction-to-google-agent-development-kit/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Introduction to Google Agent Development Kit
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 1, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                2
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-types-of-agents/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - types of agents
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 3, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                3
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-sessions-state-and-memory/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - Sessions, state, and memory
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 5, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                4
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-callbacks/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - Callbacks
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 12, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                5
              </span>
              <div class="flex-grow">
                
                  <span class="font-bold text-secondary dark:text-purple-400">
                    Google ADK - Runner and execution architecture
                    <span class="text-xs ml-2 px-2 py-0.5 bg-secondary dark:bg-purple-600 text-white rounded">You are here</span>
                  </span>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 18, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                6
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - MCP tools
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 20, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                7
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-a-multi-agent-linkedin-newsletter-system-with-google-adk/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building a Multi-Agent LinkedIn Newsletter System with Google ADK
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Jan 26, 2026</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                8
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-multi-agent-systems-with-google-adk-and-the-a2a-protocol/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building multi-agent systems with Google ADK and the A2A protocol
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Jan 27, 2026</p>
              </div>
            </li>
          
        </ol>

        
        <div class="mt-6 pt-6 border-t border-secondary/20 dark:border-secondary/30 grid grid-cols-2 gap-4">
          
          
            
          
            
          
            
          
            
          
            
              
            
          
            
          
            
          
            
          

          
          
            
            <a href="https://ravichaganti.com/blog/google-adk-callbacks/" class="flex items-center text-sm text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline group">
              <svg class="w-4 h-4 mr-1 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              <span class="truncate">Google ADK - Callbacks</span>
            </a>
          

          
          
            
            <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/" class="flex items-center justify-end text-sm text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline group">
              <span class="truncate">Google ADK - MCP tools</span>
              <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          
        </div>
      </nav>
    </aside>
  



        
        <div class="block lg:hidden mobile-toc-container">
          

  
    <div class="bg-white dark:bg-dark-bg-secondary rounded-lg shadow-md dark:shadow-2xl dark:shadow-black/20 p-4 mb-6 border border-gray-200 dark:border-dark-border">
      
      <button
        class="flex items-center justify-between w-full text-left font-semibold text-base text-gray-900 dark:text-dark-text hover:text-primary dark:hover:text-blue-400 transition-colors"
        aria-expanded="false"
        aria-controls="toc-content"
      >
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
          </svg>
          Table of Contents
        </span>
        <svg
          id="toc-chevron"
          class="w-4 h-4 transform transition-transform -rotate-90"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      
      <nav id="toc-content" class="toc-content collapsed text-sm mt-3">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#the-event-loop">The event loop</a>
      <ul>
        <li><a href="#the-runner">The Runner</a></li>
        <li><a href="#the-execution-logic">The execution logic</a></li>
      </ul>
    </li>
    <li><a href="#creating-and-using-a-runner">Creating and using a Runner</a>
      <ul>
        <li><a href="#run_async">run_async</a></li>
        <li><a href="#run-synchronous">run (synchronous)</a></li>
        <li><a href="#run_live">run_live</a></li>
        <li><a href="#runconfig">RunConfig</a></li>
      </ul>
    </li>
    <li><a href="#putting-it-all-together">Putting it all together</a></li>
  </ul>
</nav>
      </nav>
    </div>

    <style>
      #toc-content ul {
        list-style: none;
        padding-left: 1rem;
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
      }
      #toc-content > nav > ul {
        padding-left: 0;
      }
      #toc-content li {
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
      }
      #toc-content a {
        color: #374151;
        text-decoration: none;
        transition: color 0.2s;
      }
      #toc-content a:hover {
        color: #1e40af;
        text-decoration: underline;
      }
       
      .dark #toc-content a {
        color: #cbd5e1;
      }
      .dark #toc-content a:hover {
        color: #60a5fa;
      }
    </style>
  


        </div>

        <style>
          @media (min-width: 1024px) {
            .mobile-toc-container {
              display: none !important;
            }

             
            html,
            body,
            main,
            article,
            .container,
            .max-w-7xl,
            .grid,
            aside {
              overflow: visible !important;
              height: auto !important;
            }

             
            .sidebar-sticky-reinforced {
              position: -webkit-sticky !important;
              position: sticky !important;
              top: 130px !important;
              z-index: 100;
              align-self: start;
              height: fit-content;
            }
          }
        </style>

        
        <div class="prose prose-sm sm:prose-base md:prose-lg max-w-none mb-8 sm:mb-10 md:mb-12">
          <p>You have defined your agents, wired up tools, set up callbacks, and configured sessions with scoped state. But when a user sends a message, what actually happens? Who calls the agent? Who persists in the state changes? Who decides when the conversation turn is over? The answer to all of these is the <code>Runner</code>. The Runner is the central orchestrator of the ADK runtime. It receives a user&rsquo;s query, starts the agent, processes every event the agent emits, commits state changes via the <code>SessionService</code>, and forwards events to the caller. Without the Runner, your agents, tools, and callbacks are just definitions sitting idle. The <code>Runner</code> is the engine that brings them to life.</p>
<h2 id="the-event-loop">The event loop</h2>
<p>An event loop is at the heart of the ADK runtime and facilitates the communication between the <code>Runner</code> component and the agent execution. When a user prompt arrives, the <code>Runner</code> hands it over to the agent for processing. The agent runs until it has something to yield, at which point it emits an event. The <code>Runner</code> receives the event, processes any associated actions, calls the session service to append the event to the current state, and forwards the event. After the <code>Runner</code> completes event processing, the agent resumes from where it was paused and continues this loop until it has no more events to yield. The <code>Runner</code> component is the central orchestrator of this event loop.</p>
<p>Several components work together within the ADK runtime. Understanding their roles clarifies how the event loop functions.</p>
<h3 id="the-runner">The Runner</h3>
<p>The <code>Runner</code> serves as the central coordinator for a single-user invocation. Its responsibilities in the loop are:</p>
<ol>
<li><strong>Initiation:</strong> Receives the user&rsquo;s query (<code>new_message</code>) and appends it to the session history via the <code>SessionService</code>.</li>
<li><strong>Kick-off:</strong> Starts event generation by calling the main agent&rsquo;s execution method (<code>agent.run_async(...)</code>).</li>
<li><strong>Receive and process:</strong> Waits for the agent logic to yield an <code>Event</code>. Upon receiving one, it uses configured services (<code>SessionService</code>, <code>ArtifactService</code>, <code>MemoryService</code>) to commit changes indicated in <code>event.actions</code> (such as <code>state_delta</code> and <code>artifact_delta</code>).</li>
<li><strong>Yield upstream:</strong> Forwards the processed event onwards to the calling application or UI for rendering.</li>
<li><strong>Iterate:</strong> Signals the agent logic that processing is complete, allowing it to resume and generate the next event.</li>
</ol>
<h3 id="the-execution-logic">The execution logic</h3>
<p>Your code within agents, tools, and callbacks is responsible for the actual computation and decision-making. Its interaction with the loop follows a specific pattern:</p>
<ol>
<li><strong>Execute:</strong> Runs its logic based on the current <code>InvocationContext</code>, including the session state as it was when execution resumed.</li>
<li><strong>Yield:</strong> When the logic needs to communicate, it constructs an <code>Event</code> containing the relevant content and actions, then yields it back to the <code>Runner</code>.</li>
<li><strong>Pause:</strong> The agent&rsquo;s execution pauses immediately after the yield. It waits for the <code>Runner</code> to complete processing and committing.</li>
<li><strong>Resume:</strong> Only after the <code>Runner</code> has processed the yielded event does the agent logic resume from the statement immediately following the yield.</li>
<li><strong>See updated state:</strong> Upon resumption, the agent logic can now reliably access the session state reflecting the changes that were committed by the <code>Runner</code>.</li>
</ol>
<p>This cooperative yield/pause/resume cycle between the <code>Runner</code> and your execution logic, mediated by <code>Event</code> objects, forms the core of the ADK runtime. When the <code>Runner</code> starts processing a user query, it creates an <code>InvocationContext</code>. This is the runtime&rsquo;s &ldquo;traveling notebook&rdquo; that accompanies the interaction from start to finish, collecting information, tracking progress, and providing context to every component along the way. You do not typically create or manage this object directly. The ADK framework creates it when an invocation starts via <code>runner.run_async</code> and passes the relevant contextual information to your agent code, callbacks, and tools. When you implement custom agents, you receive them as the <code>ctx</code> parameter in <code>_run_async_impl</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">BaseAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents.invocation_context</span> <span class="kn">import</span> <span class="n">InvocationContext</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.events</span> <span class="kn">import</span> <span class="n">Event</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">AsyncGenerator</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyAgent</span><span class="p">(</span><span class="n">BaseAgent</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">def</span> <span class="nf">_run_async_impl</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span> <span class="n">ctx</span><span class="p">:</span> <span class="n">InvocationContext</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">Event</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Direct access to runtime information</span>
</span></span><span class="line"><span class="cl">        <span class="n">agent_name</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">agent</span><span class="o">.</span><span class="n">name</span>
</span></span><span class="line"><span class="cl">        <span class="n">session_id</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_state</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">state</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Use ctx.end_invocation = True to terminate early</span>
</span></span><span class="line"><span class="cl">        <span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>It is important to understand the hierarchy of concepts within an invocation. An <em>invocation</em> starts with a user message and ends with a final response. It can contain one or multiple <em>agent calls</em>, for example, when using agent transfer or <code>AgentTool</code>. Each agent call is handled by <code>agent.run_async()</code>. An LLM agent call can contain one or multiple <em>steps</em>. Each step calls the LLM once and yields its response. If the LLM requests tool calls, those are executed within the same step.</p>
<p>State variables prefixed with <code>temp:</code> are strictly scoped to a single invocation and discarded afterwards. When a parent agent calls a sub-agent, it passes its <code>InvocationContext</code> to the sub-agent. This means the entire chain of agent calls shares the same invocation ID and the same <code>temp:</code> state.</p>
<h2 id="creating-and-using-a-runner">Creating and using a Runner</h2>
<p>To create a <code>Runner</code>, you need an agent and a <code>SessionService</code>. Optionally, you can provide an <code>ArtifactService</code> and a <code>MemoryService</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.sessions</span> <span class="kn">import</span> <span class="n">InMemorySessionService</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.runners</span> <span class="kn">import</span> <span class="n">Runner</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the agent</span>
</span></span><span class="line"><span class="cl"><span class="n">agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;MyAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;You are a helpful assistant.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create the session service</span>
</span></span><span class="line"><span class="cl"><span class="n">session_service</span> <span class="o">=</span> <span class="n">InMemorySessionService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create the runner</span>
</span></span><span class="line"><span class="cl"><span class="n">runner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;my_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Once you have a runner, you interact with it using one of its run methods.</p>
<h3 id="run_async">run_async</h3>
<p>This is the primary method for executing agent invocations. It returns an async generator of events. The ADK runtime is fundamentally built on asynchronous patterns using Python&rsquo;s <code>asyncio</code> to handle concurrent operations like waiting for LLM responses or tool executions efficiently without blocking.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.genai.types</span> <span class="kn">import</span> <span class="n">Content</span><span class="p">,</span> <span class="n">Part</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;my_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user_1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">user_msg</span> <span class="o">=</span> <span class="n">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;Hello!&#34;</span><span class="p">)],</span> <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user_1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_message</span><span class="o">=</span><span class="n">user_msg</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="run-synchronous">run (synchronous)</h3>
<p>A synchronous <code>Runner.run</code> method exists for convenience in simple scripts or testing environments. Internally, it calls <code>Runner.run_async</code> and manages the async event loop execution for you.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">user_msg</span> <span class="o">=</span> <span class="n">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;Hello!&#34;</span><span class="p">)],</span> <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user_1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_message</span><span class="o">=</span><span class="n">user_msg</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>For production applications, especially web servers, we should design applications to be asynchronous using <code>run_async</code> for best performance.</p>
<h3 id="run_live">run_live</h3>
<p>For bidirectional streaming scenarios, such as voice conversations, the <code>Runner</code> provides <code>run_live</code>. This method uses a <code>LiveRequestQueue</code> for sending messages and returns an async generator of events. Unlike <code>run_async</code>, which handles a single request-response cycle, <code>run_live</code> maintains a persistent streaming connection to the LLM.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents.run_config</span> <span class="kn">import</span> <span class="n">RunConfig</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.runners</span> <span class="kn">import</span> <span class="n">Runner</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.sessions</span> <span class="kn">import</span> <span class="n">InMemorySessionService</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">runner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">agent</span><span class="o">=</span><span class="n">agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;my_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_service</span><span class="o">=</span><span class="n">InMemorySessionService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;my_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user_1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">live_request_queue</span> <span class="o">=</span> <span class="n">LiveRequestQueue</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">run_config</span> <span class="o">=</span> <span class="n">RunConfig</span><span class="p">(</span><span class="n">response_modalities</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;TEXT&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_live</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">session</span><span class="o">=</span><span class="n">session</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">live_request_queue</span><span class="o">=</span><span class="n">live_request_queue</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">run_config</span><span class="o">=</span><span class="n">run_config</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>One <code>InvocationContext</code> corresponds to one <code>run_live()</code> loop. It is created when you call <code>run_live()</code> and persists for the entire streaming session.</p>
<h3 id="runconfig">RunConfig</h3>
<p>The <code>RunConfig</code> class defines runtime behavior and options for agents. It controls streaming settings, function calling, artifact saving, and LLM call limits. You pass a <code>RunConfig</code> to customize how the runner executes your agent.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents.run_config</span> <span class="kn">import</span> <span class="n">RunConfig</span><span class="p">,</span> <span class="n">StreamingMode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">run_config</span> <span class="o">=</span> <span class="n">RunConfig</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">streaming_mode</span><span class="o">=</span><span class="n">StreamingMode</span><span class="o">.</span><span class="n">NONE</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">max_llm_calls</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">save_input_blobs_as_artifacts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">support_cfc</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Some of the key properties of the <code>RunConfig</code> class are:</p>
<table>
  <thead>
      <tr>
          <th>Property</th>
          <th>Type</th>
          <th>Default</th>
          <th>Purpose</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>streaming_mode</code></td>
          <td><code>StreamingMode</code></td>
          <td><code>StreamingMode.NONE</code></td>
          <td>Controls output delivery: <code>NONE</code>, <code>SSE</code>, or <code>BIDI</code></td>
      </tr>
      <tr>
          <td><code>max_llm_calls</code></td>
          <td><code>int</code></td>
          <td><code>500</code></td>
          <td>Safety limit on total LLM calls per invocation</td>
      </tr>
      <tr>
          <td><code>save_input_blobs_as_artifacts</code></td>
          <td><code>bool</code></td>
          <td><code>False</code></td>
          <td>Whether to save input binary data as artifacts</td>
      </tr>
      <tr>
          <td><code>support_cfc</code></td>
          <td><code>bool</code></td>
          <td><code>False</code></td>
          <td>Enables Compositional Function Calling</td>
      </tr>
      <tr>
          <td><code>speech_config</code></td>
          <td><code>SpeechConfig</code></td>
          <td><code>None</code></td>
          <td>Voice configuration for live/audio agents</td>
      </tr>
      <tr>
          <td><code>response_modalities</code></td>
          <td><code>list[str]</code></td>
          <td><code>None</code></td>
          <td>Controls output format: <code>[&quot;TEXT&quot;]</code> or <code>[&quot;AUDIO&quot;]</code></td>
      </tr>
  </tbody>
</table>
<h4 id="streamingmode">StreamingMode</h4>
<p>The <code>streaming_mode</code> setting determines how the agent&rsquo;s responses are delivered.</p>
<ul>
<li><code>StreamingMode.NONE</code> is the default. The LLM generates its entire response before delivering it. The Runner receives a single non-partial event for the response.</li>
<li><code>StreamingMode.SSE</code> (Server-Sent Events) uses HTTP streaming. The LLM generates its response in chunks. The Runner yields multiple events with <code>partial=True</code> for progressive display, followed by a final non-partial event.</li>
<li><code>StreamingMode.BIDI</code> enables full bidirectional streaming via WebSocket, used with <code>run_live()</code> for real-time voice and multimodal interactions.</li>
</ul>
<h4 id="max_llm_calls">max_llm_calls</h4>
<p>The <code>max_llm_calls</code> parameter acts as a safety limit to prevent runaway agent loops. If an agent enters an infinite tool-calling cycle, this limit ensures the invocation terminates after a set number of LLM calls. The default of 500 is generous for most use cases.</p>
<h4 id="compositional-function-calling">Compositional Function Calling</h4>
<p>Setting <code>support_cfc=True</code> enables <a href="https://ai.google.dev/gemini-api/docs/function-calling?example=meeting#compositional_function_calling">Compositional Function Calling</a>. This allows the model to orchestrate multiple tools in sophisticated patterns, calling tools in parallel, chaining outputs as inputs to other tools, or conditionally executing tools based on intermediate results.</p>
<p>Understanding a few key aspects of <a href="https://google.github.io/adk-docs/runtime/event-loop/#important-runtime-behaviors">how the ADK runtime handles state and streaming</a> is crucial for building predictable agents.</p>
<h2 id="putting-it-all-together">Putting it all together</h2>
<p>Here is a complete example that demonstrates the Runner orchestrating a multi-turn conversation with a tool-calling agent. This builds on the sessions and state concepts from the earlier article in this series.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.sessions</span> <span class="kn">import</span> <span class="n">InMemorySessionService</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.runners</span> <span class="kn">import</span> <span class="n">Runner</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools</span> <span class="kn">import</span> <span class="n">ToolContext</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.genai.types</span> <span class="kn">import</span> <span class="n">Content</span><span class="p">,</span> <span class="n">Part</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Tools that modify state ---</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">lookup_weather</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">city</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="p">:</span> <span class="n">ToolContext</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Looks up the current weather for a city.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">weather_data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Paris&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;temp&#34;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&#34;condition&#34;</span><span class="p">:</span> <span class="s2">&#34;Partly cloudy&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;London&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;temp&#34;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&#34;condition&#34;</span><span class="p">:</span> <span class="s2">&#34;Rainy&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Tokyo&#34;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&#34;temp&#34;</span><span class="p">:</span> <span class="mi">22</span><span class="p">,</span> <span class="s2">&#34;condition&#34;</span><span class="p">:</span> <span class="s2">&#34;Sunny&#34;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">weather_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">city</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;temp&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;condition&#34;</span><span class="p">:</span> <span class="s2">&#34;Unknown&#34;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Track the last city queried in session state</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;last_city&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">city</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;user:query_count&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;user:query_count&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Agent ---</span>
</span></span><span class="line"><span class="cl"><span class="n">weather_agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;WeatherAgent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;You are a weather assistant for {user:name}.
</span></span></span><span class="line"><span class="cl"><span class="s2">They have made {user:query_count?} queries so far.
</span></span></span><span class="line"><span class="cl"><span class="s2">Last city checked: {last_city?}
</span></span></span><span class="line"><span class="cl"><span class="s2">Provide weather information when asked.&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">lookup_weather</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="n">output_key</span><span class="o">=</span><span class="s2">&#34;last_response&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># --- Runner and interaction ---</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_service</span> <span class="o">=</span> <span class="n">InMemorySessionService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">runner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">agent</span><span class="o">=</span><span class="n">weather_agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;weather_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;weather_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">state</span><span class="o">=</span><span class="p">{</span><span class="s2">&#34;user:name&#34;</span><span class="p">:</span> <span class="s2">&#34;Ravi&#34;</span><span class="p">,</span> <span class="s2">&#34;user:query_count&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Turn 1</span>
</span></span><span class="line"><span class="cl">    <span class="n">msg1</span> <span class="o">=</span> <span class="n">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;What&#39;s the weather in Paris?&#34;</span><span class="p">)],</span> <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">msg1</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Inspect state after Turn 1</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;weather_app&#34;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;State: last_city=</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_city&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;State: user:query_count=</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user:query_count&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Events so far: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">events</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Turn 2</span>
</span></span><span class="line"><span class="cl">    <span class="n">msg2</span> <span class="o">=</span> <span class="n">Content</span><span class="p">(</span><span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;How about Tokyo?&#34;</span><span class="p">)],</span> <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">msg2</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Inspect state after Turn 2</span>
</span></span><span class="line"><span class="cl">    <span class="n">s</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">get_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;weather_app&#34;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;State: last_city=</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;last_city&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;State: user:query_count=</span><span class="si">{</span><span class="n">s</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user:query_count&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When you run this, you can observe the <code>Runner</code> orchestrating the full event loop across multiple turns, with the session service persisting state between them.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; python.exe .<span class="se">\r</span>unner-weather.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Agent: The weather in Paris is partly cloudy with a temperature of <span class="m">18</span> degrees.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">State: <span class="nv">last_city</span><span class="o">=</span>Paris
</span></span><span class="line"><span class="cl">State: user:query_count<span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">Events so far: <span class="m">4</span>
</span></span><span class="line"><span class="cl">Agent: The weather in Tokyo is sunny with a temperature of <span class="m">22</span> degrees.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">State: <span class="nv">last_city</span><span class="o">=</span>Tokyo
</span></span><span class="line"><span class="cl">State: user:query_count<span class="o">=</span><span class="m">2</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Notice how the <code>Runner</code> drives the entire lifecycle. It receives each user message, passes it to the agent, processes every event the agent generates, including tool call events where state is modified via <code>ToolContext</code>, commits the <code>state_delta</code> through the <code>SessionService</code>, and yields the final response events back to our code. The <code>user:query_count</code> counter increases across turns because the user-scoped state is persisted by the session service between invocations. The agent&rsquo;s instruction template <code>{user:query_count?}</code> is resolved by the framework on each turn using the latest committed state.</p>
<p>Understanding the <code>Runner</code> and its execution architecture is essential for building reliable agent applications with Google ADK. The <code>Runner</code> is the piece that connects everything we have covered so far in this series, from sessions and state to callbacks and tools. Every state change flows through events, every event flows through the <code>Runner</code>, and the <code>Runner</code> ensures consistency through the yield/pause/process/resume cycle. I recommend experimenting with different <code>RunConfig</code> settings and tracing the events your agents emit to build a deeper understanding of this architecture.</p>

        </div>

        
        

        
        

<div class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-lg font-bold mb-4 text-center text-gray-900 dark:text-dark-text">Share this article</h3>
  <div class="flex flex-wrap justify-center items-center gap-3 sm:gap-4">
    
    <button onclick="shareNative()"
      class="sm:hidden w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-primary text-primary dark:border-blue-400 dark:text-blue-400 flex items-center justify-center transition-all shadow-sm hover:shadow-md hover:bg-primary hover:text-white dark:hover:bg-blue-600 dark:hover:text-white dark:hover:border-blue-600"
      aria-label="Share" title="Share" id="native-share-btn">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z">
        </path>
      </svg>
    </button>

    
    <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-runner-and-execution-architecture%2F&text=Google&#43;ADK&#43;-&#43;Runner&#43;and&#43;execution&#43;architecture"
      target="_blank" rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#1DA1F2] text-[#1DA1F2] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#1DA1F2] hover:text-white hover:scale-105"
      aria-label="Share on Twitter" title="Share on Twitter">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" />
      </svg>
    </a>

    
    <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-runner-and-execution-architecture%2F" target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#0077B5] text-[#0077B5] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#0077B5] hover:text-white hover:scale-105"
      aria-label="Share on LinkedIn" title="Share on LinkedIn">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
      </svg>
    </a>

    
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-runner-and-execution-architecture%2F" target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#1877F2] text-[#1877F2] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#1877F2] hover:text-white hover:scale-105"
      aria-label="Share on Facebook" title="Share on Facebook">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
      </svg>
    </a>

    
    <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-runner-and-execution-architecture%2F&title=Google&#43;ADK&#43;-&#43;Runner&#43;and&#43;execution&#43;architecture"
      target="_blank" rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#FF4500] text-[#FF4500] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#FF4500] hover:text-white hover:scale-105"
      aria-label="Share on Reddit" title="Share on Reddit">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z" />
      </svg>
    </a>

    
    <a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-runner-and-execution-architecture%2F&t=Google&#43;ADK&#43;-&#43;Runner&#43;and&#43;execution&#43;architecture"
      target="_blank" rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#FF6600] text-[#FF6600] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#FF6600] hover:text-white hover:scale-105"
      aria-label="Share on Hacker News" title="Share on Hacker News">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M0 0v24h24V0H0zm12.8 13.4v5.2H11v-5.2L6.6 5.4h2.1l3.3 6.2 3.3-6.2h2.1l-4.6 8z" />
      </svg>
    </a>

    
    <button onclick="copyToClipboard('https:\/\/ravichaganti.com\/blog\/google-adk-runner-and-execution-architecture\/')"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-amber-500 text-amber-500 flex items-center justify-center transition-all shadow-sm hover:shadow-md hover:bg-amber-500 hover:text-white hover:scale-105"
      aria-label="Copy link" title="Copy link" id="copy-link-btn">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
        </path>
      </svg>
    </button>
  </div>
</div>

<script>
  
  function shareNative() {
    if (navigator.share) {
      navigator.share({
        title: 'Google ADK - Runner and execution architecture',
        text: 'You have agents, tools, callbacks, and sessions. But what actually runs them? The Runner is the central orchestrator that powers every agent interaction in Google ADK, driving the event loop that connects all these pieces together.',
        url: 'https:\/\/ravichaganti.com\/blog\/google-adk-runner-and-execution-architecture\/'
      }).catch(function (error) {
        console.log('Error sharing:', error);
      });
    }
  }

  
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function () {
      const btn = document.getElementById('copy-link-btn');
      const originalHTML = btn.innerHTML;
      const originalTitle = btn.title;

      
      btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
      btn.title = 'Copied!';

      
      setTimeout(function () {
        btn.innerHTML = originalHTML;
        btn.title = originalTitle;
      }, 2000);
    }).catch(function (error) {
      console.error('Failed to copy:', error);
      alert('Failed to copy link. Please copy manually: ' + text);
    });
  }
</script>


        
        
<nav class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border" aria-label="Post navigation">
  
  
  
  

  
  
  
    
    
    

    
    
    

    
    
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    

    
    
      
        
        
      
      
        
        
      
    
  

  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    
    <div class="flex">
      
        <a href="https://ravichaganti.com/blog/google-adk-callbacks/"
           class="flex-1 group card hover:shadow-xl transition-all hover:scale-[1.02] no-underline"
           aria-label="Previous in Google ADK: Google ADK - Callbacks">
          <div class="flex items-start gap-3">
            
            <div class="flex-shrink-0 text-primary dark:text-blue-400 group-hover:text-secondary dark:group-hover:text-purple-400 transition-colors mt-1">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </div>

            
            <div class="flex-1 min-w-0">
              <p class="text-xs text-gray-500 dark:text-dark-text-muted mb-1 uppercase tracking-wide">Previous in Google ADK</p>
              <h3 class="text-base font-bold text-gray-900 dark:text-dark-text mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                Google ADK - Callbacks
              </h3>
              
                <p class="text-sm text-gray-600 dark:text-dark-text-secondary line-clamp-2">Callbacks are user-defined functions that hook into an agent&#39;s execution pipeline at predefined checkpoints. They let you observe, customize, and control agent behavior without modifying the ADK framework code.</p>
              
            </div>
          </div>
        </a>
      
    </div>

    
    <div class="flex">
      
        <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/"
           class="flex-1 group card hover:shadow-xl transition-all hover:scale-[1.02] no-underline"
           aria-label="Next in Google ADK: Google ADK - MCP tools">
          <div class="flex items-start gap-3">
            
            <div class="flex-1 min-w-0 text-right md:text-left md:order-1">
              <p class="text-xs text-gray-500 dark:text-dark-text-muted mb-1 uppercase tracking-wide">Next in Google ADK</p>
              <h3 class="text-base font-bold text-gray-900 dark:text-dark-text mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                Google ADK - MCP tools
              </h3>
              
                <p class="text-sm text-gray-600 dark:text-dark-text-secondary line-clamp-2">An agent that can only use the tools you hard-code into it has a ceiling. The Model Context Protocol (MCP) shatters that ceiling by giving your ADK agents a standardized way to discover and use tools hosted anywhere â€” local processes, remote servers, or cloud services.</p>
              
            </div>

            
            <div class="flex-shrink-0 text-primary dark:text-blue-400 group-hover:text-secondary dark:group-hover:text-purple-400 transition-colors mt-1 md:order-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
          </div>
        </a>
      
    </div>
  </div>
</nav>


        
        

        
        

        
        

<div class="comments-section mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-xl sm:text-2xl font-bold mb-6 text-gray-900 dark:text-dark-text">Comments</h3>

  
  <div id="comments-placeholder" class="hidden">
    <div class="bg-gray-100 dark:bg-dark-bg border-2 border-dashed border-gray-300 dark:border-dark-border rounded-lg p-8 text-center">
      <svg class="w-12 h-12 mx-auto mb-4 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      <h4 class="text-lg font-semibold text-gray-900 dark:text-dark-text mb-2">
        Comments Require Consent
      </h4>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
        The comment system (Giscus) uses GitHub and may set authentication cookies.
        Enable comments to join the discussion.
      </p>
      <button onclick="window.cookieConsent.enableComments()"
              class="px-6 py-2 bg-primary hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
        Enable Comments
      </button>
    </div>
  </div>

  
  <div id="giscus-wrapper" class="giscus-wrapper"></div>

  
  <script>
    (function() {
      'use strict';

      let giscusLoaded = false;
      let themeObserver = null;

      
      function loadGiscus() {
        if (giscusLoaded) return;

        const wrapper = document.getElementById('giscus-wrapper');
        const placeholder = document.getElementById('comments-placeholder');

        if (!wrapper) return;

        
        if (placeholder) placeholder.classList.add('hidden');
        wrapper.classList.remove('hidden');

        
        const script = document.createElement('script');
        script.src = 'https://giscus.app/client.js';
        script.setAttribute('data-repo', 'rchaganti\/rchaganti.github.io');
        script.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkyNzcwNTE0Mjc=');
        script.setAttribute('data-category', 'Announcements');
        script.setAttribute('data-category-id', 'DIC_kwDOEIN4I84CS4rW');
        script.setAttribute('data-mapping', 'pathname');
        script.setAttribute('data-strict', '0');
        script.setAttribute('data-reactions-enabled', '1');
        script.setAttribute('data-emit-metadata', '0');
        script.setAttribute('data-input-position', 'bottom');
        script.setAttribute('data-theme', 'light');
        script.setAttribute('data-lang', 'en');
        script.setAttribute('data-loading', 'lazy');
        script.setAttribute('crossorigin', 'anonymous');
        script.async = true;

        wrapper.appendChild(script);
        giscusLoaded = true;

        
        setupThemeObserver();
      }

      
      function updateGiscusTheme() {
        const isDark = document.documentElement.classList.contains('dark');
        const theme = isDark ? 'dark' : 'light';

        const iframe = document.querySelector('iframe.giscus-frame');
        if (iframe) {
          iframe.contentWindow.postMessage(
            { giscus: { setConfig: { theme: theme } } },
            'https://giscus.app'
          );
        }
      }

      
      function setupThemeObserver() {
        if (themeObserver) return;

        
        themeObserver = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
              updateGiscusTheme();
            }
          });
        });

        themeObserver.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ['class']
        });

        
        window.addEventListener('message', function(event) {
          if (event.origin !== 'https://giscus.app') return;
          if (!(typeof event.data === 'object' && event.data.giscus)) return;

          
          if (event.data.giscus.discussion) {
            updateGiscusTheme();
          }
        });
      }

      
      function checkConsentAndLoad() {
        if (window.cookieConsent && window.cookieConsent.hasConsent('comments')) {
          loadGiscus();
        } else {
          
          const placeholder = document.getElementById('comments-placeholder');
          if (placeholder) placeholder.classList.remove('hidden');
        }
      }

      
      window.addEventListener('loadComments', loadGiscus);
      window.addEventListener('consentChanged', checkConsentAndLoad);

      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkConsentAndLoad);
      } else {
        checkConsentAndLoad();
      }
    })();
  </script>
</div>


      </div>
      

      
      <aside class="hidden lg:block relative">
        <div class="mb-6">
          
<div class="bg-white dark:bg-dark-bg-secondary rounded-xl shadow-md dark:shadow-lg dark:shadow-black/20 p-6 mb-6">
  <div class="flex items-center gap-3 mb-4">
    <div class="w-10 h-10 bg-[#0A66C2]/10 rounded-full flex items-center justify-center">
      <svg class="w-5 h-5 text-[#0A66C2]" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
      </svg>
    </div>
    <h3 class="font-semibold text-gray-900 dark:text-dark-text">Newsletter</h3>
  </div>
  <p class="text-sm text-gray-600 dark:text-dark-text-secondary mb-4">
    Get notified about new articles on cloud, AI, and infrastructure.
  </p>
  <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank"
    rel="noopener noreferrer"
    class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-[#0A66C2] hover:bg-[#004182] !text-white text-sm font-semibold rounded-lg transition-colors no-underline">
    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
      <path
        d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
    </svg>
    Subscribe on LinkedIn
  </a>
</div>
        </div>
        <div class="mb-6">
          


  <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700">
    <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-gray-100">
      You May Also Like
    </h3>
    <div>
      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - MCP tools
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-20">
      Dec 20, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-callbacks/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - Callbacks
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-12">
      Dec 12, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-sessions-state-and-memory/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - Sessions, state, and memory
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-05">
      Dec 5, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-types-of-agents/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - types of agents
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-03">
      Dec 3, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/introduction-to-google-agent-development-kit/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Introduction to Google Agent Development Kit
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-01">
      Dec 1, 2025
    </time>
  </a>
</article>

      
    </div>
  </div>


        </div>
        <div class="sidebar-sticky-reinforced">
          


<div class="bg-white dark:bg-dark-bg-secondary rounded-xl shadow-md dark:shadow-lg dark:shadow-black/20 p-6 mb-6">
  <h3 class="font-semibold text-gray-900 dark:text-dark-text mb-4 flex items-center">
    <svg class="w-5 h-5 mr-2 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
    </svg>
    Table of Contents
  </h3>

  <nav id="sidebar-toc" class="toc-sidebar text-sm max-h-[calc(100vh-200px)] overflow-y-auto custom-scrollbar">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#the-event-loop">The event loop</a>
      <ul>
        <li><a href="#the-runner">The Runner</a></li>
        <li><a href="#the-execution-logic">The execution logic</a></li>
      </ul>
    </li>
    <li><a href="#creating-and-using-a-runner">Creating and using a Runner</a>
      <ul>
        <li><a href="#run_async">run_async</a></li>
        <li><a href="#run-synchronous">run (synchronous)</a></li>
        <li><a href="#run_live">run_live</a></li>
        <li><a href="#runconfig">RunConfig</a></li>
      </ul>
    </li>
    <li><a href="#putting-it-all-together">Putting it all together</a></li>
  </ul>
</nav>
  </nav>
</div>

<style>
  #sidebar-toc ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }

  #sidebar-toc ul ul {
    padding-left: 1rem;
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
    border-left: 1px solid #e5e7eb;
     
  }

  .dark #sidebar-toc ul ul {
    border-color: #374151;
     
  }

  #sidebar-toc li {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }

  #sidebar-toc a {
    display: block;
    color: #4b5563;
     
    text-decoration: none;
    transition: all 0.2s;
    padding-left: 0.5rem;
    border-left: 2px solid transparent;
    margin-left: -1px;
     
  }

  #sidebar-toc a:hover {
    color: #1e40af;
     
    text-decoration: none;
  }

   
  #sidebar-toc a.active {
    color: #2563eb;
     
    font-weight: 600;
    border-left-color: #2563eb;
  }

   
  .dark #sidebar-toc a {
    color: #9ca3af;
     
  }

  .dark #sidebar-toc a:hover {
    color: #60a5fa;
     
  }

  .dark #sidebar-toc a.active {
    color: #60a5fa;
     
    border-left-color: #60a5fa;
  }

   
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #e5e7eb;
    border-radius: 20px;
  }

  .dark .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #374151;
  }
</style>


        </div>
      </aside>
    </div>
    
  </div>

  
  <script src="/js/collapse.js"></script>
  <script src="/js/code-copy.js"></script>
  <script src="/js/toc-scrollspy.js"></script>
  <script src="/js/heading-anchors.js"></script>
</article>

  </main>

  <footer class="bg-gray-900 dark:bg-dark-bg text-gray-300 dark:text-dark-text-secondary mt-16">
  <div class="container mx-auto px-4 py-8">
    <div class="text-center text-sm">
      <p>&copy; 2026 Ravikanth Chaganti. All rights reserved.</p>
    </div>
  </div>
</footer>


  
  <button id="back-to-top"
          class="fixed bottom-8 right-8 w-12 h-12 bg-primary text-white rounded-full shadow-lg hover:bg-blue-700 transition-all opacity-0 pointer-events-none z-40"
          aria-label="Back to top"
          title="Back to top">
    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
    </svg>
  </button>

  
  

  
  <script>
    
    
    
  </script>

  
  
    <script src="/js/reading-progress.js"></script>
  

  
  <script src="/js/back-to-top.js"></script>

  
  <script src="/js/theme-toggle.js"></script>

  
  <script src="/js/cookie-consent.js"></script>

  
  

  
  <script
    data-goatcounter="https://ravichaganti.goatcounter.com/count"
    async
    src="//gc.zgo.at/count.js">
  </script>



  
  
<div id="cookie-consent-banner"
     class="hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg z-50 transition-transform duration-300">
  <div class="container mx-auto px-4 py-2">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-4">

      
      <div class="flex-1">
        <p class="text-xs sm:text-sm text-gray-700 dark:text-gray-200">
          This site may load third-party content (comments, embeds) that could set cookies.
          <a href="#"
             id="cookie-learn-more"
             class="text-primary hover:underline font-medium ml-1"
             onclick="document.getElementById('cookie-customize').click(); return false;">
            Learn more
          </a>
        </p>
      </div>

      
      <div class="flex flex-row gap-2 w-full sm:w-auto flex-shrink-0">
        <button id="cookie-reject-all"
                class="px-3 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors">
          Reject
        </button>
        <button id="cookie-customize"
                class="px-3 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors">
          Settings
        </button>
        <button id="cookie-accept-all"
                class="px-3 py-1 text-xs font-medium text-white bg-primary hover:bg-blue-700 rounded transition-colors">
          Accept
        </button>
      </div>
    </div>
  </div>
</div>


<div id="cookie-settings-modal"
     class="hidden fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 z-50 flex items-center justify-center p-4 overflow-y-auto">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl my-8">

    
    <div class="bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3 rounded-t-lg">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold text-gray-900 dark:text-gray-100">
          Cookie Preferences
        </h2>
        <button id="cookie-modal-close"
                class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
                aria-label="Close">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    
    <div class="px-6 py-4 space-y-4 max-h-[calc(90vh-140px)] overflow-y-auto bg-white dark:bg-gray-800">

      
      <div class="text-sm text-gray-600 dark:text-gray-300">
        <p>
          Control what third-party content is loaded. We use privacy-friendly analytics with no cookies.
        </p>
      </div>

      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Essential
            </h3>
            <div class="flex items-center justify-center w-10 h-5 bg-primary rounded-full flex-shrink-0">
              <span class="text-xs font-medium text-white">ON</span>
            </div>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Required for the website to function. Cannot be disabled.
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>â€¢ Theme preference</li>
            <li>â€¢ Privacy-friendly analytics</li>
          </ul>
        </div>

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Comments
            </h3>
            <label class="relative inline-block w-10 h-5 flex-shrink-0">
              <input type="checkbox"
                     id="consent-comments"
                     class="peer sr-only">
              <span class="absolute inset-0 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer transition-colors peer-checked:bg-primary"></span>
              <span class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
            </label>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Giscus comment system (GitHub Discussions).
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>â€¢ Authentication cookies</li>
            <li>â€¢ GitHub privacy policy</li>
          </ul>
        </div>

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Embedded Content
            </h3>
            <label class="relative inline-block w-10 h-5 flex-shrink-0">
              <input type="checkbox"
                     id="consent-embeds"
                     class="peer sr-only">
              <span class="absolute inset-0 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer transition-colors peer-checked:bg-primary"></span>
              <span class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
            </label>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Videos, code snippets, presentations.
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>â€¢ YouTube, Gists, SlideShare</li>
            <li>â€¢ May set tracking cookies</li>
          </ul>
        </div>
      </div>

      
      <div class="bg-blue-50 dark:bg-blue-950 dark:bg-opacity-50 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
          <div class="text-sm">
            <p class="font-semibold mb-1 text-blue-800 dark:text-blue-200">Privacy First</p>
            <p class="text-xs text-gray-700 dark:text-gray-300">
              No tracking cookies. Third-party content only loads with your consent. Preferences stored locally in your browser.
            </p>
          </div>
        </div>
      </div>
    </div>

    
    <div class="bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 px-4 py-3 rounded-b-lg">
      <div class="flex justify-end">
        <button id="cookie-save-preferences"
                class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-blue-700 dark:hover:bg-blue-600 rounded transition-colors shadow-sm">
          Save Preferences
        </button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
