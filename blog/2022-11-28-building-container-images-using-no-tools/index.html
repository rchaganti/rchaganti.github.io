<!DOCTYPE html>
<html lang="en-us">
<head>
  
  <script>
    (function() {
      const stored = localStorage.getItem('theme-preference');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = stored || (prefersDark ? 'dark' : 'light');

      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Building container images - using no tools | Ravikanth Chaganti</title>

  
  <meta name="description" content="In a couple of earlier articles, we looked at Linux constructs used in building container images and the OCI image specification which standardizes the container image format. It is now time to understand how we can create container images. Knowing this is important to optimize the image size and building secure container images. And, of course, this knowledge also helps us appreciate what tools like Docker CLI or Buildah among many others help us achieve. There are many tools to build container images. We shall look at each of these methods in-depth in later parts of this series of articles on container images. For today, we will look into building container images using no tools! Actually, just using built-in OS tools.">
  <meta name="author" content="Ravikanth Chaganti">

  
  
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  

  
  <meta property="og:title" content="Building container images - using no tools">
  <meta property="og:description" content="In a couple of earlier articles, we looked at Linux constructs used in building container images and the OCI image specification which standardizes the container image format. It is now time to understand how we can create container images. Knowing this is important to optimize the image size and building secure container images. And, of course, this knowledge also helps us appreciate what tools like Docker CLI or Buildah among many others help us achieve. There are many tools to build container images. We shall look at each of these methods in-depth in later parts of this series of articles on container images. For today, we will look into building container images using no tools! Actually, just using built-in OS tools.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://ravichaganti.com/blog/2022-11-28-building-container-images-using-no-tools/">
  <meta property="og:site_name" content="Ravikanth Chaganti">
  <meta property="og:locale" content="en_US">
  
  <meta property="og:image" content="https://ravichaganti.com/images/default-post.svg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Building container images - using no tools">

  
  
    <meta property="article:published_time" content="2022-11-28T00:00:00Z">
    <meta property="article:modified_time" content="2022-11-28T00:00:00Z">
    <meta property="article:author" content="Ravikanth Chaganti">
    <meta property="article:section" content="oci">
    <meta property="article:tag" content="oci"><meta property="article:tag" content="containers">
  

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Building container images - using no tools">
  <meta name="twitter:description" content="In a couple of earlier articles, we looked at Linux constructs used in building container images and the OCI image specification which standardizes the container image format. It is now time to understand how we can create container images. Knowing this is important to optimize the image size and building secure container images. And, of course, this knowledge also helps us appreciate what tools like Docker CLI or Buildah among many others help us achieve. There are many tools to build container images. We shall look at each of these methods in-depth in later parts of this series of articles on container images. For today, we will look into building container images using no tools! Actually, just using built-in OS tools.">
  <meta name="twitter:image" content="https://ravichaganti.com/images/default-post.svg">
  <meta name="twitter:site" content="@ravikanth">

  
  <link rel="canonical" href="https://ravichaganti.com/blog/2022-11-28-building-container-images-using-no-tools/">

  
  <link rel="alternate" type="application/rss+xml" href="https://ravichaganti.com/index.xml">

  
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate icon" type="image/x-icon" href="/favicon.ico">

  
  <link rel="stylesheet" href="/css/main.css">

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  
  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Building container images - using no tools",
  "description": "In a couple of earlier articles, we looked at Linux constructs used in building container images and the OCI image specification which standardizes the container image format. It is now time to ‚Ä¶",
  "articleBody": "\"In a couple of earlier articles, we looked at Linux constructs used in building container images and the OCI image specification which standardizes the container image format. It is now time to understand how we can create container images. Knowing this is important to optimize the image size and building secure container images. And, of course, this knowledge also helps us appreciate what tools like Docker CLI or Buildah among many others help us achieve. There are many tools to build container images. We shall look at each of these methods in-depth in later parts of this series of articles on container images. For today, we will look into building container images using no tools! Actually, just using built-in OS tools.\\nAs we learned already, a container image is a made up of layers packaged as tarballs. Each of these tarballs represent a portion of the file system that is needed for the application in the container to function. For example, here is how the Golang image looks like [on the file system] when you extract it using Skopeo.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 vscode ‚ûú ~$ cat index.json | jq \\u0026#39;.manifests[].digest\\u0026#39; \\u0026#34;sha256:5e2f436ecda6b9f2ccdd912cfa462323100ba98e4399bdddb212f675d87fb85b\\u0026#34; vscode ‚ûú ~$ cat blobs/sha256/5e2f436ecda6b9f2ccdd912cfa462323100ba98e4399bdddb212f675d87fb85b | jq \\u0026#39;.config.digest\\u0026#39; \\u0026#34;sha256:b47d5cbdc30315fb21d7299ceacc1146985c84230421fd5e4a07e8b009575a11\\u0026#34; vscode ‚ûú ~$ cat blobs/sha256/5e2f436ecda6b9f2ccdd912cfa462323100ba98e4399bdddb212f675d87fb85b | jq \\u0026#39;.layers[].digest\\u0026#39; \\u0026#34;sha256:a8ca11554fce00d9177da2d76307bdc06df7faeb84529755c648ac4886192ed1\\u0026#34; \\u0026#34;sha256:e4e46864aba2e62ba7c75965e4aa33ec856ee1b1074dda6b478101c577b63abd\\u0026#34; \\u0026#34;sha256:c85a0be79bfba309d1f05dc40b447aa82b604593531fed1e7e12e4bef63483a5\\u0026#34; \\u0026#34;sha256:195ea6a58ca87a18477965a6e6a8623112bde82c5b568a29c56ce4581b6e6695\\u0026#34; \\u0026#34;sha256:52908dc1c386fab0271a2b84b6ef4d96205a98a8c8801169554767172e45d8c7\\u0026#34; \\u0026#34;sha256:a2b47720d601b6c6c6e7763b4851e25475118d80a76be466ef3aa388abf2defd\\u0026#34; \\u0026#34;sha256:14a70245b07c7f5056bdd90a3d93e37417ec26542def5a37ac8f19e437562533\\u0026#34; index.json at the root of the OCI layout contains a pointer to the manifest that describes the configuration and layers within the image. As seen here, both manifest and image config have file\\u0026rsquo;s SHA256 hash as the file name and both files are JSON documents.\\nImage config, as we learned earlier, is what the container runtime uses to setup the container. It contains an ordered collection of file system layers and the execution parameters to create the container. What is important for our discussion is at the beginning of the configuration JSON. Here is an example from the golang image.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 vscode ‚ûú ~$ cat golang/blobs/sha256/b47d5cbdc30315fb21d7299ceacc1146985c84230421fd5e4a07e8b009575a11 | jq . { \\u0026#34;created\\u0026#34;: \\u0026#34;2022-11-16T04:16:44.241793636Z\\u0026#34;, \\u0026#34;architecture\\u0026#34;: \\u0026#34;amd64\\u0026#34;, \\u0026#34;os\\u0026#34;: \\u0026#34;linux\\u0026#34;, \\u0026#34;config\\u0026#34;: { \\u0026#34;Env\\u0026#34;: [ \\u0026#34;PATH=/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\\u0026#34;, \\u0026#34;GOLANG_VERSION=1.19.3\\u0026#34;, \\u0026#34;GOPATH=/go\\u0026#34; ], \\u0026#34;Cmd\\u0026#34;: [ \\u0026#34;bash\\u0026#34; ], \\u0026#34;WorkingDir\\u0026#34;: \\u0026#34;/go\\u0026#34; }, \\u0026#34;rootfs\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;layers\\u0026#34;, \\u0026#34;diff_ids\\u0026#34;: [ \\u0026#34;sha256:ccba29d6937047c719a6c048a7038d3907590fbb8556418d119469b2ad4f95bc\\u0026#34;, \\u0026#34;sha256:f1c1f22985847a54884b1448b7e41f2852c7f4fab4b71014ba38cc2990cdc9f1\\u0026#34;, \\u0026#34;sha256:80231db1194c4e9941e3c4e00c704f527889863ea2222b691ff7f8583b912aa0\\u0026#34;, \\u0026#34;sha256:89c3244a87b279c98478c9248c9cbfba18ca16866e38c54f0134b31bbfd3ab27\\u0026#34;, \\u0026#34;sha256:6a7921805df03a2c5bbc8a24979077ce43b466d1b4ace36afd045e51fdbbe24f\\u0026#34;, \\u0026#34;sha256:de3f6c83fe06d179f2cdc189bd123dd159c78b2b80cd6739fde25988b1142925\\u0026#34;, \\u0026#34;sha256:6201ebf6567d8a29c3458610efb2b681fec4b8c127668d8d223f504520ed351e\\u0026#34; ] }, .... Each layer in the image is a gzipped tarball, once again, containing the SHA256 hash as the file name. So, if we need to build a container image by hand, we need to really follow the same process of packaging each of our image layers. Let us look at that.\\nBuilding a hello-cloud image To understand the process of building a container image, we shall use a simple hello-cloud Go program. Our image will contain only one layer \\u0026ndash; the hello-cloud program. Here is our simple Go program.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 package main import ( \\u0026#34;fmt\\u0026#34; \\u0026#34;os\\u0026#34; ) func main() { var name string if len(os.Args) == 2 { name = os.Args[1] } if name == \\u0026#34;\\u0026#34; { fmt.Println(\\u0026#34;Hello, üåç!\\u0026#34;) } else { fmt.Println(\\u0026#34;Hello,\\u0026#34;, name, \\u0026#34;üëã\\u0026#34;) } } Nothing fancy here. This program takes an optional input. This optional input can be your name or whatever you like. If there is no input, it prints Hello, üåç!. You can build the binary using go build hello-cloud.go command.\\n1 2 3 4 vscode ‚ûú ~/hello-cloud$ ./hello-cloud Hello, üåç! vscode ‚ûú ~/hello-cloud$ ./hello-cloud \\u0026#34;Cloud Native Central\\u0026#34; Hello, Cloud Native Central üëã Go programs are statically linked and therefore have no OS dependencies. Let us now look at creating a folder structure needed for this.\\n1 2 3 4 5 6 vscode ‚ûú ~/hello-cloud$ tree imageLayer/ imageLayer/ ‚îú‚îÄ‚îÄ bin ‚îî‚îÄ‚îÄ tmp 2 directories, 0 files We shall now move the hello-world binary into the bin folder.\\n1 2 3 4 5 6 7 vscode ‚ûú ~/hello-cloud$ mv hello-cloud imageLayer/bin/ vscode ‚ûú ~/hello-cloud$ tree imageLayer/ imageLayer/ ‚îú‚îÄ‚îÄ bin ‚îÇ¬†‚îî‚îÄ‚îÄ hello-cloud ‚îî‚îÄ‚îÄ tmp We have the contents of our image layer ready. We can now package this into a gzipped tarball.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 vscode ‚ûú ~/hello-cloud$ cd imageLayer/ vscode ‚ûú ~/hello-cloud/imageLayer$ tar -czvf ../hello-cloud.tar.gz * bin/ bin/hello-cloud tmp/ vscode ‚ûú ~/hello-world/imageLayer$ tree ../ ../ ‚îú‚îÄ‚îÄ hello-cloud.tar.gz ‚îî‚îÄ‚îÄ imageLayer ‚îú‚îÄ‚îÄ bin ‚îÇ¬†‚îî‚îÄ‚îÄ hello-cloud ‚îî‚îÄ‚îÄ tmp 3 directories, 2 files This is good. However, to be able to run a container from this image layer, we need to feed tell the container runtime how to use the layers and the execution parameters to setup the container. So, let us step back a bit and see what the earlier example of golang image\\u0026rsquo;s configuration JSON contained. Every container image is specific to an operating system and architecture. The golang image that we pulled is a linux/amd64 image. Our hello-cloud binary is built on a Linux amd64 system as well.\\nTo be able to invoke our hello-cloud binary, we need to set the right environment variables. Also, we want this binary to get invoked when the container starts. These environment and execution parameters needs to be within the config section of the configuration JSON.\\nSo, here is how our configuration JSON will start.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 { \\u0026#34;architecture\\u0026#34;: \\u0026#34;amd64\\u0026#34;, \\u0026#34;os\\u0026#34;: \\u0026#34;linux\\u0026#34;, \\u0026#34;config\\u0026#34;: { \\u0026#34;Env\\u0026#34;: [\\u0026#34;PATH=/bin\\u0026#34;], \\u0026#34;Entrypoint\\u0026#34;: [ \\u0026#34;hello-cloud\\u0026#34; ], \\u0026#34;Cmd\\u0026#34;: [ \\u0026#34;Cloud Native Central!\\u0026#34; ] } } We set the Entrypoint to the hello-world binary and the Cmd array to a single argument that will be passed to the binary.\\nThe next important thing that needs to be added is the DiffID of the image layer. The diff ID is the digest over the layer\\u0026rsquo;s uncompressed tarball. We can obtainthis using the sha256sum command.\\n1 2 vscode ‚ûú ~$ gunzip \\u0026lt; hello-world/hello-cloud.tar.gz | sha256sum 690fa2812df903a4cee676e28389e154fe022f2a26fb29c4c97e9c6583fa5bc6 - We need to add the serialized version of this digest to the configuration JSON. So, here is how our final configuration JSON looks like.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 { \\u0026#34;architecture\\u0026#34;: \\u0026#34;amd64\\u0026#34;, \\u0026#34;os\\u0026#34;: \\u0026#34;linux\\u0026#34;, \\u0026#34;config\\u0026#34;: { \\u0026#34;Env\\u0026#34;: [ \\u0026#34;PATH=/bin\\u0026#34; ], \\u0026#34;Entrypoint\\u0026#34;: [ \\u0026#34;hello-cloud\\u0026#34; ], \\u0026#34;Cmd\\u0026#34;: [ \\u0026#34;Cloud Native Central!\\u0026#34; ] }, \\u0026#34;rootfs\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;layers\\u0026#34;, \\u0026#34;diff_ids\\u0026#34;: [ \\u0026#34;sha256:690fa2812df903a4cee676e28389e154fe022f2a26fb29c4c97e9c6583fa5bc6\\u0026#34; ] }, \\u0026#34;history\\u0026#34;: [ { \\u0026#34;created_by\\u0026#34;: \\u0026#34;Ravikanth C\\u0026#34; } ] } As we saw in the golang image example earlier, we need a manifest that combines configuration JSON and the layers. These artifacts are referenced using their digest values as well. So, let us generate the digests for both configuration JSON and the layer tar.gz. We will also need the size in bytes which can be derived from the ls output. The layer digest is different from the DiffID we captured earlier. The layer digest identifies the compressed content and DiffID, as mentioned earlier, identifies the uncompressed content. Container runtimes deal with uncompressed layer content and therefore the configuration JSON must include the digest of the uncompressed layer.\\n1 2 3 4 5 6 7 8 9 10 11 vscode ‚ûú ~/hello-cloud$ sha256sum \\u0026lt; hello-world.tar.gz e251e682f7e64cff127020015be3254313b3a7900f54d82ecf34653192be4c21 - vscode ‚ûú ~/hello-cloud$ sha256sum \\u0026lt; configuration.json da17376c4c02667544fb07a8788cfa4c294f89464534d3a76a45ee004cebacf5 - vscode ‚ûú ~/hello-cloud$ ls -l total 1064 -rw-r--r-- 1 rchaganti rchaganti 364 Nov 27 13:19 configuration.json -rw-r--r-- 1 rchaganti rchaganti 1074934 Nov 27 13:42 hello-world.tar.gz drwxr-xr-x 4 rchaganti rchaganti 4096 Nov 27 11:11 imageLayer We need to add the appropriate mediaType for both configuration JSON and each layer. Here is how our manifest.json looks like.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 { \\u0026#34;schemaVersion\\u0026#34;: 2, \\u0026#34;mediaType\\u0026#34;: \\u0026#34;application/vnd.oci.image.manifest.v1+json\\u0026#34;, \\u0026#34;config\\u0026#34;: { \\u0026#34;mediaType\\u0026#34;: \\u0026#34;application/vnd.oci.image.config.v1+json\\u0026#34;, \\u0026#34;size\\u0026#34;: 277, \\u0026#34;digest\\u0026#34;: \\u0026#34;sha256:da17376c4c02667544fb07a8788cfa4c294f89464534d3a76a45ee004cebacf5\\u0026#34; }, \\u0026#34;layers\\u0026#34;: [ { \\u0026#34;mediaType\\u0026#34;: \\u0026#34;application/vnd.oci.image.layer.v1.tar+gzip\\u0026#34;, \\u0026#34;size\\u0026#34;: 1074934, \\u0026#34;digest\\u0026#34;: \\u0026#34;sha256:e251e682f7e64cff127020015be3254313b3a7900f54d82ecf34653192be4c21\\u0026#34; } ] } Alright. Do we have the image ready? Not quite yet. We need to push it to an image registry. While, on surface, it looks like a container image is a singular entity but in reality it is not. As we have already seen, a container image includes a bunch of layers, a configuration, and a manifest. When Docker CLI or any other tool pushes images to a registry, these tools do so in a specific sequence. Since we are building this without any tools such as Docker CLI, we need to push these artifacts manually using the Docker registry HTTP API.\\nHere is the workflow.\\nLet us start. We need to first authenticate with Docker Hub. There are many ways to do this but we will use token authentication.\\n1 2 3 vscode ‚ûú ~/hello-cloud$ USERNAME=ravikanth vscode ‚ûú ~/hello-cloud$ REPO=\\u0026#34;${USERNAME}/hello-cloud\\u0026#34; vscode ‚ûú ~/hello-cloud$ TOKEN=$(curl -v -u \\u0026#34;$USERNAME\\u0026#34; \\u0026#34;https://auth.docker.io/token?service=registry.docker.io\\u0026amp;scope=repository:$REPO:pull,push\\u0026#34; | jq \\u0026#39;.token\\u0026#39; | cut -d\\\\\\u0026#34; -f2) The above command will prompt for a password to authenticate with Docker Hub and retrieve the token from the response.\\nUpload blobs Once we have the auth token, we need to upload each blob (layers and configuration JSON) to the repository. Let us start with hello-world.tar.gz.\\n1 2 3 4 5 vscode ‚ûú ~/hello-cloud$ LOCATION=$(curl -i https://registry.hub.docker.com/v2/$REPO/blobs/uploads/ -H \\u0026#34;Authorization: Bearer $TOKEN\\u0026#34; -d \\u0026#39;\\u0026#39; | grep location | cut -d\\u0026#34; \\u0026#34; -f2 | tr -d \\u0026#39;\\\\r\\u0026#39;) vscode ‚ûú ~/hello-cloud$ LOCATION=$(curl -i $LOCATION -X PATCH -H \\u0026#34;Content-Length: $LAYERSIZE\\u0026#34; -H \\u0026#34;Authorization: Bearer $TOKEN\\u0026#34; -H \\u0026#34;Content-Type: application/octet-stream\\u0026#34; --data-binary @e251e682f7e64cff127020015be3254313b3a7900f54d82ecf34653192be4c21 | grep location | cut -d\\u0026#34; \\u0026#34; -f2 | tr -d \\u0026#39;\\\\r\\u0026#39;) vscode ‚ûú ~/hello-cloud$ curl \\u0026#34;$LOCATION\\u0026amp;digest=sha256:$LAYERDIGEST\\u0026#34; -X PUT -H \\u0026#34;Authorization: Bearer $TOKEN\\u0026#34; -v The first command starts an upload and retrieves the location for the upload. The second command uses the location from first command and uploads the blob. Finally, the third command commits the upload at the location returned by second command and specifies the digest of the blob.\\nwe just need to repeat these steps for each layer and configuration JSON. Since we have only one layer, let us just push the configuration JSON as well.\\n1 2 3 4 5 vscode ‚ûú ~/hello-cloud$ LOCATION=$(curl -i https://registry.hub.docker.com/v2/$REPO/blobs/uploads/ -H \\u0026#34;Authorization: Bearer $TOKEN\\u0026#34; -d \\u0026#39;\\u0026#39; | grep location | cut -d\\u0026#34; \\u0026#34; -f2 | tr -d \\u0026#39;\\\\r\\u0026#39;) vscode ‚ûú ~/hello-cloud$ LOCATION=$(curl -i $LOCATION -X PATCH -H \\u0026#34;Authorization: Bearer $TOKEN\\u0026#34; -H \\u0026#34;Content-Type: application/octet-stream\\u0026#34; --data-binary @4500bf72b8876e180985cb9d30dcbfb4b37c6212af4a1e66f6a59e9c44e4430e | grep location | cut -d\\u0026#34; \\u0026#34; -f2 | tr -d \\u0026#39;\\\\r\\u0026#39;) vscode ‚ûú ~/hello-cloud$ curl \\u0026#34;$LOCATION\\u0026amp;digest=sha256:$CONFIGDIGEST\\u0026#34; -X PUT -H \\u0026#34;Authorization: Bearer $TOKEN\\u0026#34; -v Upload the manifest Finally, we need to upload the manifest.\\n1 vscode ‚ûú ~/hello-cloud$ curl \\u0026#34;https://registry.hub.docker.com/v2/$REPO/manifests/latest\\u0026#34; -X PUT -H \\u0026#34;Content-Type: application/vnd.oci.image.manifest.v1+json\\u0026#34; -H \\u0026#34;Authorization: Bearer $TOKEN\\u0026#34; --data-binary @manifest.json -v Once the manifest upload is complete, you can find the image on Docker Hub.\\nCan we not run the image we created without pushing it to Docker Hub or another registry? We can! Let us save that for a different day. For now, we will pull the image we just pushed and try to run a container.\\n1 2 3 4 5 6 7 8 9 10 11 vscode ‚ûú ~$ docker pull ravikanth/hello-cloud:latest latest: Pulling from ravikanth/hello-cloud Digest: sha256:a23f26c0df0206f3135ca7c7c02d896b9d9fa43373fb6f5c8be8c7615b4e4402 Status: Image is up to date for ravikanth/hello-cloud:latest docker.io/ravikanth/hello-cloud:latest vscode ‚ûú ~$ docker run ravikanth/hello-cloud:latest Hello, Cloud Native Central! üëã vscode ‚ûú ~$ docker run ravikanth/hello-cloud:latest Readers! Hello, Readers! üëã This is it! What\\u0026rsquo;s next? We shall look at some tools to build these container images. Stay tuned.\\n\"",
  "url": "https:\/\/ravichaganti.com\/blog\/2022-11-28-building-container-images-using-no-tools\/",
  "datePublished": "2022-11-28T00:00:00Z",
  "dateModified": "2022-11-28T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Ravikanth Chaganti"
    ,"sameAs": ["https://twitter.com/ravikanth"]
  },
  "publisher": {
    "@type": "Person",
    "name": "Ravikanth Chaganti",
    "sameAs": ["https://twitter.com/ravikanth"]
  },
  
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/ravichaganti.com\/images\/default-post.svg",
    "width": 1200,
    "height": 630
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/ravichaganti.com\/blog\/2022-11-28-building-container-images-using-no-tools\/"
  },
  
  "articleSection": "\"oci\"",
  
  
  "keywords": "[\"oci\",\"containers\"]",
  
  
  "timeRequired": "PT9M",
  
  "inLanguage": "en-US",
  "isAccessibleForFree": true
}
</script>




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https:\/\/ravichaganti.com\/"
    }
    ,
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https:\/\/ravichaganti.com\/blog/"
    }
    
    ,
    {
      "@type": "ListItem",
      "position": 3,
      "name": "oci",
      "item": "https:\/\/ravichaganti.com\/categories/oci/"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Building container images - using no tools",
      "item": "https:\/\/ravichaganti.com\/blog\/2022-11-28-building-container-images-using-no-tools\/"
    }
    
    
  ]
}
</script>


</head>

<body class="flex flex-col min-h-screen bg-gray-50 dark:bg-dark-bg">
  <header class="sticky top-0 z-50 bg-white dark:bg-dark-bg-secondary shadow-md relative">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      
      <div class="flex items-center">
        <a href="https://ravichaganti.com/" class="flex items-center gap-3 text-gray-900 dark:text-dark-text hover:text-primary transition-colors no-underline group">
          
          <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
            <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2" class="group-hover:stroke-primary transition-colors"/>
            <text x="20" y="26" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="currentColor">RC</text>
          </svg>
          
          <div class="flex flex-col leading-tight">
            <span class="text-xs sm:text-sm font-semibold">Cloud Native</span>
            <span class="text-xs sm:text-sm font-semibold">Agentic AI</span>
            <span class="text-xs sm:text-sm font-semibold">Infrastructure</span>
          </div>
        </a>
      </div>

      
      <div class="hidden md:flex items-center space-x-8">
        
          <a href="/blog/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Blog
          </a>
        
          <a href="/books/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Books
          </a>
        
          <a href="/slides/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Slides
          </a>
        
          <a href="/videos/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Videos
          </a>
        
          <a href="/about/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            About
          </a>
        
      </div>

      
      <div class="hidden md:flex items-center space-x-4" id="social-search-container">
        
        <div id="social-icons" class="flex items-center space-x-3">
          

<a href="https://twitter.com/ravikanth" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Twitter">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
  </svg>
</a>



<a href="https://github.com/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="GitHub">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
  </svg>
</a>



<a href="https://linkedin.com/in/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="LinkedIn">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
  </svg>
</a>




        </div>

        
        <button
          id="theme-toggle"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="search-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <div id="search-box" class="hidden">
          
<div class="relative">
  <input
    type="text"
    id="search-input"
    placeholder="Search articles..."
    class="w-64 px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results" class="absolute top-full mt-2 w-96 bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-96 overflow-y-auto z-50">
    
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>


<script>
(function() {
  let headerFuse;
  let headerSearchData = [];

  
  fetch('/index.json')
    .then(response => response.json())
    .then(data => {
      headerSearchData = data;

      
      const options = {
        keys: [
          { name: 'title', weight: 3 },
          { name: 'excerpt', weight: 2 },
          { name: 'content', weight: 1 },
          { name: 'categories', weight: 1.5 },
          { name: 'series', weight: 1.5 }
        ],
        threshold: 0.4,
        includeScore: true,
        ignoreLocation: true,
        minMatchCharLength: 2
      };

      headerFuse = new Fuse(headerSearchData, options);
    })
    .catch(error => console.error('Error loading search index:', error));

  
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  if (searchInput && searchResults) {
    searchInput.addEventListener('input', function(e) {
      const query = e.target.value.trim();

      if (query.length < 2) {
        searchResults.classList.add('hidden');
        return;
      }

      
      const results = headerFuse.search(query);

      
      if (results.length === 0) {
        searchResults.innerHTML = '<div class="p-4 text-center text-gray-500 text-sm">No results found</div>';
        searchResults.classList.remove('hidden');
        return;
      }

      searchResults.innerHTML = results.slice(0, 5).map(result => {
        const item = result.item;
        const date = new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

        return `
          <a href="${item.permalink}" class="block p-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 no-underline">
            <div class="font-medium text-sm text-gray-900 mb-1">${item.title}</div>
            <div class="flex items-center gap-2 mb-1">
              <span class="text-xs text-gray-500">${date}</span>
              ${item.categories ? item.categories.slice(0, 2).map(cat => `
                <span class="inline-block px-1.5 py-0.5 text-xs rounded" style="background-color: rgba(30, 64, 175, 0.1); color: #1e40af;">
                  ${cat}
                </span>
              `).join('') : ''}
            </div>
            ${item.excerpt ? `<p class="text-xs text-gray-600 line-clamp-2">${item.excerpt}</p>` : ''}
          </a>
        `;
      }).join('');

      searchResults.classList.remove('hidden');
    });

    
    document.addEventListener('click', function(e) {
      if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
        searchResults.classList.add('hidden');
      }
    });

    
    searchInput.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        searchResults.classList.add('hidden');
        searchInput.blur();
      }
    });
  }
})();
</script>

        </div>
      </div>

      
      <button id="mobile-menu-toggle" class="md:hidden p-2 hover:bg-gray-100 rounded" aria-label="Menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4">
      
        <a href="/blog/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Blog
        </a>
      
        <a href="/books/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Books
        </a>
      
        <a href="/slides/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Slides
        </a>
      
        <a href="/videos/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Videos
        </a>
      
        <a href="/about/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          About
        </a>
      
    </div>
  </nav>

  
  
    <div id="reading-progress" class="absolute bottom-0 left-0 w-full h-1 bg-primary transition-all duration-200 z-10" style="width: 0%; max-width: 100%;"></div>
  
</header>


<script>
  document.getElementById('mobile-menu-toggle')?.addEventListener('click', function() {
    const menu = document.getElementById('mobile-menu');
    menu?.classList.toggle('hidden');
  });

  document.getElementById('search-toggle')?.addEventListener('click', function() {
    const socialIcons = document.getElementById('social-icons');
    const searchBox = document.getElementById('search-box');
    socialIcons?.classList.toggle('hidden');
    searchBox?.classList.toggle('hidden');
  });
</script>


  <main class="flex-grow">
    
<article class="container mx-auto px-4 sm:px-6 md:px-4 py-8 sm:py-10 md:py-12">
  <div class="max-w-4xl mx-auto">
    
    <header class="mb-8">
      
      <nav class="text-xs sm:text-sm mb-4">
        <ol class="flex items-center space-x-2 text-gray-600 dark:text-dark-text-secondary">
          <li><a href="https://ravichaganti.com/" class="hover:text-primary dark:hover:text-blue-400">Home</a></li>
          <li><span class="mx-2">/</span></li>
          <li><a href="/blog/" class="hover:text-primary dark:hover:text-blue-400">Blog</a></li>
          
            <li><span class="mx-2">/</span></li>
            <li><a href="/categories/oci/" class="hover:text-primary dark:hover:text-blue-400">oci</a></li>
          
        </ol>
      </nav>

      
      <div class="flex flex-wrap items-center gap-2 sm:gap-3 md:gap-4 text-sm sm:text-base text-gray-600 dark:text-dark-text-secondary mb-6">
        
        <div class="flex items-center">
          <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <time datetime="2022-11-28">November 28, 2022</time>
        </div>

        
        
          <span>‚Ä¢</span>
          <div class="flex items-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>9 min read</span>
          </div>
        

        
        
      </div>

      
      <div class="flex flex-wrap gap-2 mb-6">
        
          
            <a href="/categories/oci/" class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              oci
            </a>
          
            <a href="/categories/containers/" class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              containers
            </a>
          
        
        
          
            <a href="/series/container-images/" class="inline-block px-3 py-1 text-sm font-medium bg-secondary/10 dark:bg-secondary/20 text-secondary dark:text-purple-400 rounded-full hover:bg-secondary/20 dark:hover:bg-secondary/30 transition-colors no-underline">
              üìö Series: Container Images
            </a>
          
        
      </div>

      
      <div class="mb-6 sm:mb-8 rounded-lg overflow-hidden shadow-lg">
        
        <img src="/images/default-post.svg" alt="Building container images - using no tools" class="w-full h-auto max-h-64 sm:max-h-96 md:max-h-none object-cover">
      </div>

      
      
    </header>

    
    


  
  
  



    
    



    
    <div class="prose prose-sm sm:prose-base md:prose-lg max-w-none mb-8 sm:mb-10 md:mb-12">
      <p>In a couple of earlier articles, we looked at <a href="https://ravichaganti.com/blog/2022-10-18-understanding-container-images-the-fundamentals/">Linux constructs used in building container images</a> and the <a href="https://ravichaganti.com/blog/2022-10-28-understanding-container-images-oci-image-specification/">OCI image specification</a> which standardizes the container image format. It is now time to understand how we can create container images. Knowing this is important to optimize the image size and building secure container images. And, of course, this knowledge also helps us appreciate what tools like Docker CLI or Buildah among many others help us achieve. There are many tools to build container images. We shall look at each of these methods in-depth in later parts of <a href="/series/container-images/">this series of articles</a> on container images. For today, we will look into building container images using no tools! Actually, just using built-in OS tools.</p>
<p>As we learned already, a container image is a made up of layers packaged as tarballs. Each of these tarballs represent a portion of the file system that is needed for the application in the container to function. For example, here is how the <a href="https://hub.docker.com/_/golang">Golang image</a> looks like [on the file system] when you extract it using <a href="https://github.com/containers/skopeo">Skopeo</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~$ cat index.json <span class="p">|</span> jq <span class="s1">&#39;.manifests[].digest&#39;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;sha256:5e2f436ecda6b9f2ccdd912cfa462323100ba98e4399bdddb212f675d87fb85b&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~$ cat blobs/sha256/5e2f436ecda6b9f2ccdd912cfa462323100ba98e4399bdddb212f675d87fb85b <span class="p">|</span> jq <span class="s1">&#39;.config.digest&#39;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;sha256:b47d5cbdc30315fb21d7299ceacc1146985c84230421fd5e4a07e8b009575a11&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~$ cat blobs/sha256/5e2f436ecda6b9f2ccdd912cfa462323100ba98e4399bdddb212f675d87fb85b <span class="p">|</span> jq <span class="s1">&#39;.layers[].digest&#39;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;sha256:a8ca11554fce00d9177da2d76307bdc06df7faeb84529755c648ac4886192ed1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;sha256:e4e46864aba2e62ba7c75965e4aa33ec856ee1b1074dda6b478101c577b63abd&#34;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;sha256:c85a0be79bfba309d1f05dc40b447aa82b604593531fed1e7e12e4bef63483a5&#34;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;sha256:195ea6a58ca87a18477965a6e6a8623112bde82c5b568a29c56ce4581b6e6695&#34;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;sha256:52908dc1c386fab0271a2b84b6ef4d96205a98a8c8801169554767172e45d8c7&#34;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;sha256:a2b47720d601b6c6c6e7763b4851e25475118d80a76be466ef3aa388abf2defd&#34;</span>
</span></span><span class="line"><span class="cl"><span class="s2">&#34;sha256:14a70245b07c7f5056bdd90a3d93e37417ec26542def5a37ac8f19e437562533&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>index.json</code> at the root of the OCI layout contains a pointer to the manifest that describes the configuration and layers within the image. As seen here, both manifest and image config have file&rsquo;s SHA256 hash as the file name and both files are JSON documents.</p>
<p>Image config, as we learned earlier, is what the container runtime uses to setup the container. It contains an ordered collection of file system layers and the execution parameters to create the container. What is important for our discussion is at the beginning of the configuration JSON. Here is an example from the golang image.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">vscode</span> <span class="err">‚ûú</span> <span class="err">~$</span> <span class="err">cat</span> <span class="err">golang/blobs/sha</span><span class="mi">256</span><span class="err">/b</span><span class="mi">47</span><span class="err">d</span><span class="mi">5</span><span class="err">cbdc</span><span class="mi">30315</span><span class="err">fb</span><span class="mi">21</span><span class="err">d</span><span class="mi">7299</span><span class="err">ceacc</span><span class="mi">1146985</span><span class="err">c</span><span class="mi">84230421</span><span class="err">fd</span><span class="mf">5e4</span><span class="err">a</span><span class="mi">0</span><span class="mf">7e8</span><span class="err">b</span><span class="mi">009575</span><span class="err">a</span><span class="mi">11</span> <span class="err">|</span> <span class="err">jq</span> <span class="err">.</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;created&#34;</span><span class="p">:</span> <span class="s2">&#34;2022-11-16T04:16:44.241793636Z&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;architecture&#34;</span><span class="p">:</span> <span class="s2">&#34;amd64&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="s2">&#34;linux&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Env&#34;</span><span class="p">:</span> <span class="p">[</span>  <span class="s2">&#34;PATH=/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;GOLANG_VERSION=1.19.3&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;GOPATH=/go&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Cmd&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;bash&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;WorkingDir&#34;</span><span class="p">:</span> <span class="s2">&#34;/go&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;rootfs&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;layers&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;diff_ids&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;sha256:ccba29d6937047c719a6c048a7038d3907590fbb8556418d119469b2ad4f95bc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;sha256:f1c1f22985847a54884b1448b7e41f2852c7f4fab4b71014ba38cc2990cdc9f1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;sha256:80231db1194c4e9941e3c4e00c704f527889863ea2222b691ff7f8583b912aa0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;sha256:89c3244a87b279c98478c9248c9cbfba18ca16866e38c54f0134b31bbfd3ab27&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;sha256:6a7921805df03a2c5bbc8a24979077ce43b466d1b4ace36afd045e51fdbbe24f&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;sha256:de3f6c83fe06d179f2cdc189bd123dd159c78b2b80cd6739fde25988b1142925&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;sha256:6201ebf6567d8a29c3458610efb2b681fec4b8c127668d8d223f504520ed351e&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="err">....</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Each layer in the image is a gzipped tarball, once again, containing the SHA256 hash as the file name. So, if we need to build a container image by hand, we need to really follow the same process of packaging each of our image layers. Let us look at that.</p>
<h3 id="building-a-hello-cloud-image">Building a hello-cloud image</h3>
<p>To understand the process of building a container image, we shall use a simple hello-cloud Go program. Our image will contain only one layer &ndash; the <code>hello-cloud</code> program. Here is our simple Go program.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="s">&#34;fmt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="s">&#34;os&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="kd">var</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">name</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nx">Args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="k">if</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#34;&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Hello, üåç!&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">		</span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Hello,&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;üëã&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="p">}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>Nothing fancy here. This program takes an optional input. This optional input can be your name or whatever you like. If there is no input, it prints Hello, üåç!. You can build the binary using <code>go build hello-cloud.go</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ ./hello-cloud
</span></span><span class="line"><span class="cl">Hello, üåç!
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ ./hello-cloud <span class="s2">&#34;Cloud Native Central&#34;</span>
</span></span><span class="line"><span class="cl">Hello, Cloud Native Central üëã
</span></span></code></pre></td></tr></table>
</div>
</div><p>Go programs are statically linked and therefore have no OS dependencies. Let us now look at creating a folder structure needed for this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ tree imageLayer/
</span></span><span class="line"><span class="cl">imageLayer/
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ bin
</span></span><span class="line"><span class="cl">‚îî‚îÄ‚îÄ tmp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">2</span> directories, <span class="m">0</span> files
</span></span></code></pre></td></tr></table>
</div>
</div><p>We shall now move the hello-world binary into the bin folder.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ mv hello-cloud imageLayer/bin/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ tree imageLayer/
</span></span><span class="line"><span class="cl">imageLayer/
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ bin
</span></span><span class="line"><span class="cl">‚îÇ¬†¬† ‚îî‚îÄ‚îÄ hello-cloud
</span></span><span class="line"><span class="cl">‚îî‚îÄ‚îÄ tmp
</span></span></code></pre></td></tr></table>
</div>
</div><p>We have the contents of our image layer ready. We can now package this into a gzipped tarball.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ <span class="nb">cd</span> imageLayer/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud/imageLayer$ tar -czvf ../hello-cloud.tar.gz *
</span></span><span class="line"><span class="cl">bin/
</span></span><span class="line"><span class="cl">bin/hello-cloud
</span></span><span class="line"><span class="cl">tmp/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-world/imageLayer$ tree ../
</span></span><span class="line"><span class="cl">../
</span></span><span class="line"><span class="cl">‚îú‚îÄ‚îÄ hello-cloud.tar.gz
</span></span><span class="line"><span class="cl">‚îî‚îÄ‚îÄ imageLayer
</span></span><span class="line"><span class="cl">    ‚îú‚îÄ‚îÄ bin
</span></span><span class="line"><span class="cl">    ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ hello-cloud
</span></span><span class="line"><span class="cl">    ‚îî‚îÄ‚îÄ tmp
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="m">3</span> directories, <span class="m">2</span> files
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is good. However, to be able to run a container from this image layer, we need to feed tell the container runtime how to use the layers and the execution parameters to setup the container. So, let us step back a bit and see what the earlier example of golang image&rsquo;s configuration JSON contained. Every container image is specific to an operating system and architecture. The golang image that we pulled is a linux/amd64 image. Our <code>hello-cloud</code> binary is built on a Linux amd64 system as well.</p>
<p>To be able to invoke our <code>hello-cloud</code> binary, we need to set the right environment variables. Also, we want this binary to get invoked when the container starts. These environment and execution parameters needs to be within the config section of the configuration JSON.</p>
<p>So, here is how our configuration JSON will start.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;architecture&#34;</span><span class="p">:</span> <span class="s2">&#34;amd64&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="s2">&#34;linux&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;Env&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;PATH=/bin&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;Entrypoint&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;hello-cloud&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;Cmd&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Cloud Native Central!&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We set the <code>Entrypoint</code> to the hello-world binary and the <code>Cmd</code> array to a single argument that will be passed to the binary.</p>
<p>The next important thing that needs to be added is the <a href="https://github.com/opencontainers/image-spec/blob/main/config.md#layer-diffid">DiffID</a> of the image layer. The diff ID is the digest over the layer&rsquo;s uncompressed tarball. We can obtainthis using the <code>sha256sum</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~$ gunzip &lt; hello-world/hello-cloud.tar.gz <span class="p">|</span> sha256sum
</span></span><span class="line"><span class="cl">690fa2812df903a4cee676e28389e154fe022f2a26fb29c4c97e9c6583fa5bc6  -
</span></span></code></pre></td></tr></table>
</div>
</div><p>We need to add the serialized version of this digest to the configuration JSON. So, here is how our final configuration JSON looks like.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;architecture&#34;</span><span class="p">:</span> <span class="s2">&#34;amd64&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;os&#34;</span><span class="p">:</span> <span class="s2">&#34;linux&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Env&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;PATH=/bin&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Entrypoint&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;hello-cloud&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Cmd&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;Cloud Native Central!&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;rootfs&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;layers&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;diff_ids&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;sha256:690fa2812df903a4cee676e28389e154fe022f2a26fb29c4c97e9c6583fa5bc6&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;history&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;created_by&#34;</span><span class="p">:</span> <span class="s2">&#34;Ravikanth C&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As we saw in the golang image example earlier, we need a manifest that combines configuration JSON and the layers. These artifacts are referenced using their digest values as well. So, let us generate the digests for both configuration JSON and the layer tar.gz. We will also need the size in bytes which can be derived from the <code>ls</code> output. The layer digest is different from the DiffID we captured earlier. The <a href="https://github.com/opencontainers/image-spec/blob/main/manifest.md#image-manifest-property-descriptions">layer digest</a> identifies the compressed content and DiffID, as mentioned earlier, identifies the uncompressed content. Container runtimes deal with uncompressed layer content and therefore the configuration JSON must include the digest of the uncompressed layer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ sha256sum &lt; hello-world.tar.gz
</span></span><span class="line"><span class="cl">e251e682f7e64cff127020015be3254313b3a7900f54d82ecf34653192be4c21  -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ sha256sum &lt; configuration.json
</span></span><span class="line"><span class="cl">da17376c4c02667544fb07a8788cfa4c294f89464534d3a76a45ee004cebacf5  -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ ls -l
</span></span><span class="line"><span class="cl">total <span class="m">1064</span>
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> rchaganti rchaganti     <span class="m">364</span> Nov <span class="m">27</span> 13:19 configuration.json
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> rchaganti rchaganti <span class="m">1074934</span> Nov <span class="m">27</span> 13:42 hello-world.tar.gz
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">4</span> rchaganti rchaganti    <span class="m">4096</span> Nov <span class="m">27</span> 11:11 imageLayer
</span></span></code></pre></td></tr></table>
</div>
</div><p>We need to add the appropriate <a href="https://github.com/opencontainers/image-spec/blob/main/media-types.md">mediaType</a> for both configuration JSON and each layer. Here is how our manifest.json looks like.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;schemaVersion&#34;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;mediaType&#34;</span><span class="p">:</span> <span class="s2">&#34;application/vnd.oci.image.manifest.v1+json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;mediaType&#34;</span><span class="p">:</span> <span class="s2">&#34;application/vnd.oci.image.config.v1+json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">277</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;digest&#34;</span><span class="p">:</span> <span class="s2">&#34;sha256:da17376c4c02667544fb07a8788cfa4c294f89464534d3a76a45ee004cebacf5&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;layers&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;mediaType&#34;</span><span class="p">:</span> <span class="s2">&#34;application/vnd.oci.image.layer.v1.tar+gzip&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="mi">1074934</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;digest&#34;</span><span class="p">:</span> <span class="s2">&#34;sha256:e251e682f7e64cff127020015be3254313b3a7900f54d82ecf34653192be4c21&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Alright. Do we have the image ready? Not quite yet. We need to push it to an image registry. While, on surface, it looks like a container image is a singular entity but in reality it is not. As we have already seen, a container image includes a bunch of layers, a configuration, and a manifest. When Docker CLI or any other tool pushes images to a registry, these tools do so in a specific sequence. Since we are building this without any tools such as Docker CLI, we need to push these artifacts manually using the <a href="https://docs.docker.com/registry/spec/api/#introduction">Docker registry HTTP API</a>.</p>
<p>Here is the workflow.</p>
<p><figure class="figure " style="max-width: 450px; margin: 1.5rem auto;">
  <a href="/images/container-push.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/container-push.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>
 
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
 
 
 <script src="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/js/glightbox.min.js"></script>
 
 
 <script>
   document.addEventListener('DOMContentLoaded', function() {
     const lightbox = GLightbox({
       selector: '.glightbox',
       touchNavigation: true,
       loop: true,
       autoplayVideos: true,
       zoomable: true,
       draggable: true,
       closeButton: true,
       moreLength: 0
     });
   });
 </script></p>
<p>Let us start. We need to first <a href="https://docs.docker.com/registry/spec/auth/token/#how-to-authenticate">authenticate with Docker Hub</a>. There are many ways to do this but we will use token authentication.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ <span class="nv">USERNAME</span><span class="o">=</span>ravikanth
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ <span class="nv">REPO</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">USERNAME</span><span class="si">}</span><span class="s2">/hello-cloud&#34;</span>
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ <span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>curl -v -u <span class="s2">&#34;</span><span class="nv">$USERNAME</span><span class="s2">&#34;</span> <span class="s2">&#34;https://auth.docker.io/token?service=registry.docker.io&amp;scope=repository:</span><span class="nv">$REPO</span><span class="s2">:pull,push&#34;</span> <span class="p">|</span> jq <span class="s1">&#39;.token&#39;</span> <span class="p">|</span> cut -d<span class="se">\&#34;</span> -f2<span class="k">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The above command will prompt for a password to authenticate with Docker Hub and retrieve the token from the response.</p>
<h3 id="upload-blobs">Upload blobs</h3>
<p>Once we have the auth token, we need to upload each blob (layers and configuration JSON) to the repository. Let us start with hello-world.tar.gz.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ <span class="nv">LOCATION</span><span class="o">=</span><span class="k">$(</span>curl -i https://registry.hub.docker.com/v2/<span class="nv">$REPO</span>/blobs/uploads/ -H <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&#34;</span> -d <span class="s1">&#39;&#39;</span> <span class="p">|</span> grep location <span class="p">|</span> cut -d<span class="s2">&#34; &#34;</span> -f2 <span class="p">|</span> tr -d <span class="s1">&#39;\r&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ <span class="nv">LOCATION</span><span class="o">=</span><span class="k">$(</span>curl -i <span class="nv">$LOCATION</span> -X PATCH -H <span class="s2">&#34;Content-Length: </span><span class="nv">$LAYERSIZE</span><span class="s2">&#34;</span> -H <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&#34;</span> -H <span class="s2">&#34;Content-Type: application/octet-stream&#34;</span> --data-binary @e251e682f7e64cff127020015be3254313b3a7900f54d82ecf34653192be4c21 <span class="p">|</span> grep location <span class="p">|</span> cut -d<span class="s2">&#34; &#34;</span> -f2 <span class="p">|</span> tr -d <span class="s1">&#39;\r&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ curl <span class="s2">&#34;</span><span class="nv">$LOCATION</span><span class="s2">&amp;digest=sha256:</span><span class="nv">$LAYERDIGEST</span><span class="s2">&#34;</span> -X PUT -H <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&#34;</span> -v
</span></span></code></pre></td></tr></table>
</div>
</div><p>The first command starts an upload and retrieves the location for the upload. The second command uses the location from first command and uploads the blob. Finally, the third command commits the upload at the location returned by second command and specifies the digest of the blob.</p>
<p>we just need to repeat these steps for each layer and configuration JSON. Since we have only one layer, let us just push the configuration JSON as well.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ <span class="nv">LOCATION</span><span class="o">=</span><span class="k">$(</span>curl -i https://registry.hub.docker.com/v2/<span class="nv">$REPO</span>/blobs/uploads/ -H <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&#34;</span> -d <span class="s1">&#39;&#39;</span> <span class="p">|</span> grep location <span class="p">|</span> cut -d<span class="s2">&#34; &#34;</span> -f2 <span class="p">|</span> tr -d <span class="s1">&#39;\r&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ <span class="nv">LOCATION</span><span class="o">=</span><span class="k">$(</span>curl -i <span class="nv">$LOCATION</span> -X PATCH -H <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&#34;</span> -H <span class="s2">&#34;Content-Type: application/octet-stream&#34;</span> --data-binary @4500bf72b8876e180985cb9d30dcbfb4b37c6212af4a1e66f6a59e9c44e4430e <span class="p">|</span> grep location <span class="p">|</span> cut -d<span class="s2">&#34; &#34;</span> -f2 <span class="p">|</span> tr -d <span class="s1">&#39;\r&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ curl <span class="s2">&#34;</span><span class="nv">$LOCATION</span><span class="s2">&amp;digest=sha256:</span><span class="nv">$CONFIGDIGEST</span><span class="s2">&#34;</span> -X PUT -H <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&#34;</span> -v
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="upload-the-manifest">Upload the manifest</h3>
<p>Finally, we need to upload the manifest.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~/hello-cloud$ curl <span class="s2">&#34;https://registry.hub.docker.com/v2/</span><span class="nv">$REPO</span><span class="s2">/manifests/latest&#34;</span> -X PUT -H <span class="s2">&#34;Content-Type: application/vnd.oci.image.manifest.v1+json&#34;</span> -H <span class="s2">&#34;Authorization: Bearer </span><span class="nv">$TOKEN</span><span class="s2">&#34;</span> --data-binary @manifest.json -v
</span></span></code></pre></td></tr></table>
</div>
</div><p>Once the manifest upload is complete, you can find the image on Docker Hub.</p>
<figure class="figure " style="max-width: 450px; margin: 1.5rem auto;">
  <a href="/images/container-dockerhub.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/container-dockerhub.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<p>Can we not run the image we created without pushing it to Docker Hub or another registry? We can! Let us save that for a different day. For now, we will pull the image we just pushed and try to run a container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vscode ‚ûú ~$ docker pull ravikanth/hello-cloud:latest
</span></span><span class="line"><span class="cl">latest: Pulling from ravikanth/hello-cloud
</span></span><span class="line"><span class="cl">Digest: sha256:a23f26c0df0206f3135ca7c7c02d896b9d9fa43373fb6f5c8be8c7615b4e4402
</span></span><span class="line"><span class="cl">Status: Image is up to date <span class="k">for</span> ravikanth/hello-cloud:latest
</span></span><span class="line"><span class="cl">docker.io/ravikanth/hello-cloud:latest
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~$ docker run ravikanth/hello-cloud:latest
</span></span><span class="line"><span class="cl">Hello, Cloud Native Central! üëã
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vscode ‚ûú ~$ docker run ravikanth/hello-cloud:latest Readers!
</span></span><span class="line"><span class="cl">Hello, Readers! üëã
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is it! What&rsquo;s next? We shall look at some tools to build these container images. Stay tuned.</p>

    </div>

    
    
      <div class="mb-8">
        <h3 class="text-sm font-semibold text-gray-600 dark:text-dark-text-secondary mb-3">Tags:</h3>
        <div class="flex flex-wrap gap-2">
          
            <a href="/tags/oci/" class="inline-block px-3 py-1 text-sm bg-gray-100 dark:bg-dark-bg-tertiary text-gray-700 dark:text-dark-text rounded hover:bg-gray-200 dark:hover:bg-dark-border transition-colors no-underline">
              #oci
            </a>
          
            <a href="/tags/containers/" class="inline-block px-3 py-1 text-sm bg-gray-100 dark:bg-dark-bg-tertiary text-gray-700 dark:text-dark-text rounded hover:bg-gray-200 dark:hover:bg-dark-border transition-colors no-underline">
              #containers
            </a>
          
        </div>
      </div>
    

    
    

<div class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-lg font-bold mb-4 text-center text-gray-900 dark:text-dark-text">Share this article</h3>
  <div class="flex flex-wrap justify-center items-center gap-3 sm:gap-4">
    
    <button
      onclick="shareNative()"
      class="sm:hidden w-12 h-12 rounded-full bg-primary hover:bg-primary/90 dark:bg-blue-600 dark:hover:bg-blue-700 text-white flex items-center justify-center transition-colors shadow-md hover:shadow-lg"
      aria-label="Share"
      title="Share"
      id="native-share-btn"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
      </svg>
    </button>

    
    <a
      href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fravichaganti.com%2Fblog%2F2022-11-28-building-container-images-using-no-tools%2F&text=Building&#43;container&#43;images&#43;-&#43;using&#43;no&#43;tools"
      target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-[#1DA1F2] hover:bg-[#1a8cd8] text-white flex items-center justify-center transition-all no-underline shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Share on Twitter"
      title="Share on Twitter"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
      </svg>
    </a>

    
    <a
      href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fravichaganti.com%2Fblog%2F2022-11-28-building-container-images-using-no-tools%2F"
      target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-[#0077B5] hover:bg-[#006399] text-white flex items-center justify-center transition-all no-underline shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Share on LinkedIn"
      title="Share on LinkedIn"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
      </svg>
    </a>

    
    <a
      href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fravichaganti.com%2Fblog%2F2022-11-28-building-container-images-using-no-tools%2F"
      target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-[#1877F2] hover:bg-[#1564d3] text-white flex items-center justify-center transition-all no-underline shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Share on Facebook"
      title="Share on Facebook"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </svg>
    </a>

    
    <button
      onclick="copyToClipboard('https:\/\/ravichaganti.com\/blog\/2022-11-28-building-container-images-using-no-tools\/')"
      class="w-12 h-12 rounded-full bg-accent hover:bg-amber-600 dark:bg-amber-500 dark:hover:bg-amber-600 text-white flex items-center justify-center transition-all shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Copy link"
      title="Copy link"
      id="copy-link-btn"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
      </svg>
    </button>
  </div>
</div>

<script>

function shareNative() {
  if (navigator.share) {
    navigator.share({
      title: 'Building container images - using no tools',
      text: 'In a couple of earlier articles, we looked at Linux constructs used in building container images and the OCI image specification which standardizes the container image format. It is now time to ‚Ä¶',
      url: 'https:\/\/ravichaganti.com\/blog\/2022-11-28-building-container-images-using-no-tools\/'
    }).catch(function(error) {
      console.log('Error sharing:', error);
    });
  }
}


function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(function() {
    const btn = document.getElementById('copy-link-btn');
    const originalHTML = btn.innerHTML;
    const originalTitle = btn.title;

    
    btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
    btn.title = 'Copied!';

    
    setTimeout(function() {
      btn.innerHTML = originalHTML;
      btn.title = originalTitle;
    }, 2000);
  }).catch(function(error) {
    console.error('Failed to copy:', error);
    alert('Failed to copy link. Please copy manually: ' + text);
  });
}
</script>



    
    
<nav class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border" aria-label="Post navigation">
  
  
  
  

  
  
  
    
    
    

    
    
    

    
    
    
      
        
      
    

    
    
      
      
    
  

  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    
    <div class="flex">
      
        
        <div class="flex-1 card bg-gray-50 dark:bg-dark-bg-tertiary opacity-50 cursor-not-allowed">
          <div class="flex items-start gap-3">
            <div class="flex-shrink-0 text-gray-400 dark:text-dark-text-muted mt-1">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </div>
            <div class="flex-1">
              <p class="text-xs text-gray-400 dark:text-dark-text-muted mb-1 uppercase tracking-wide">No Previous Article</p>
              <p class="text-sm text-gray-400 dark:text-dark-text-muted">This is the first post</p>
            </div>
          </div>
        </div>
      
    </div>

    
    <div class="flex">
      
        
        <div class="flex-1 card bg-gray-50 dark:bg-dark-bg-tertiary opacity-50 cursor-not-allowed">
          <div class="flex items-start gap-3">
            <div class="flex-1 text-right md:text-left">
              <p class="text-xs text-gray-400 dark:text-dark-text-muted mb-1 uppercase tracking-wide">No Next Article</p>
              <p class="text-sm text-gray-400 dark:text-dark-text-muted">This is the latest post</p>
            </div>
            <div class="flex-shrink-0 text-gray-400 dark:text-dark-text-muted mt-1">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
          </div>
        </div>
      
    </div>
  </div>
</nav>


    
    

    
    

    
    
  </div>

  
  <script src="/js/collapse.js"></script>
  <script src="/js/code-copy.js"></script>
</article>

  </main>

  <footer class="bg-gray-900 dark:bg-dark-bg text-gray-300 dark:text-dark-text-secondary mt-16">
  <div class="container mx-auto px-4 py-8">
    <div class="text-center text-sm">
      <p>&copy; 2026 Ravikanth Chaganti. All rights reserved.</p>
    </div>
  </div>
</footer>


  
  <button id="back-to-top"
          class="fixed bottom-8 right-8 w-12 h-12 bg-primary text-white rounded-full shadow-lg hover:bg-blue-700 transition-all opacity-0 pointer-events-none z-40"
          aria-label="Back to top"
          title="Back to top">
    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
    </svg>
  </button>

  
  

  
  <script>
    
    
    
  </script>

  
  
    <script src="/js/reading-progress.js"></script>
  

  
  <script src="/js/back-to-top.js"></script>

  
  <script src="/js/theme-toggle.js"></script>
</body>
</html>
