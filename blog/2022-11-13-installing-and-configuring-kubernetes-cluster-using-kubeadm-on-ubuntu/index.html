<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <script src="https://ravichaganti.com/js/view.js"></script>
    <script id="dsq-count-scr" src="//ravikanth.disqus.com/count.js" async></script>
    <link rel="stylesheet" href="https://ravichaganti.com/css/syntax.css">
    <meta name="author" content="Ravikanth Chaganti">
    <meta name="description" content="This article is more like a note to myself, but this may help if you are looking at configuring a Kubernetes cluster on Ubuntu.
There are many ways to install and configure Kubernetes cluster for learning and development purpose. You can use Docker Desktop or Rancher Desktop or Podman Desktop or minikube or microk8s for quickly bringing up a single node cluster for your development work. I am a big fan of Docker Desktop and use that for any quick experiments.">
    <meta name="keywords" content="blog,microsoft,mvp,powershell,automation,author, innovator, speaker">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Installing and Configuring Kubernetes cluster using kubeadm on Ubuntu"/>
<meta name="twitter:description" content="This article is more like a note to myself, but this may help if you are looking at configuring a Kubernetes cluster on Ubuntu.
There are many ways to install and configure Kubernetes cluster for learning and development purpose. You can use Docker Desktop or Rancher Desktop or Podman Desktop or minikube or microk8s for quickly bringing up a single node cluster for your development work. I am a big fan of Docker Desktop and use that for any quick experiments."/>

    <meta property="og:title" content="Installing and Configuring Kubernetes cluster using kubeadm on Ubuntu" />
<meta property="og:description" content="This article is more like a note to myself, but this may help if you are looking at configuring a Kubernetes cluster on Ubuntu.
There are many ways to install and configure Kubernetes cluster for learning and development purpose. You can use Docker Desktop or Rancher Desktop or Podman Desktop or minikube or microk8s for quickly bringing up a single node cluster for your development work. I am a big fan of Docker Desktop and use that for any quick experiments." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ravichaganti.com/blog/2022-11-13-installing-and-configuring-kubernetes-cluster-using-kubeadm-on-ubuntu/" />
<meta property="article:published_time" content="2022-11-13T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-11-13T00:00:00+00:00" />


    
      <base href="https://ravichaganti.com/blog/2022-11-13-installing-and-configuring-kubernetes-cluster-using-kubeadm-on-ubuntu/">
    
    <title>
  Installing and Configuring Kubernetes cluster using kubeadm on Ubuntu · Ravikanth Chaganti
</title>

    
      <link rel="canonical" href="https://ravichaganti.com/blog/2022-11-13-installing-and-configuring-kubernetes-cluster-using-kubeadm-on-ubuntu/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://ravichaganti.com/css/coder.min.897f2f761ca1c7df1614de4c088e4ebbb7f5984b520994e5ee0a0fc4ba52f7de.css" integrity="sha256-iX8vdhyhx98WFN5MCI5Ou7f1mEtSCZTl7goPxLpS994=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://ravichaganti.com/css/coder-dark.min.e78e80fc3a585a4d1c8fc7f58623b6ff852411e38431a9cd1792877ecaa160f6.css" integrity="sha256-546A/DpYWk0cj8f1hiO2/4UkEeOEManNF5KHfsqhYPY=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="https://ravichaganti.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://ravichaganti.com/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.73.0" />
  </head>

  
  
    
  
  
    <body onload="getViews( &#34;https://ravichaganti.com/blog/2022-11-13-installing-and-configuring-kubernetes-cluster-using-kubeadm-on-ubuntu/&#34; )" class="colorscheme-auto">
  
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://ravichaganti.com/">
      Ravikanth Chaganti
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/about/">About</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/blog/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/books/">Books</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Installing and Configuring Kubernetes cluster using kubeadm on Ubuntu</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2022-11-13T00:00:00Z'>
                November 13, 2022
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              9-minute read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://ravichaganti.com/categories/kubernetes/">kubernetes</a>
      <span class="separator">•</span>
    <a href="https://ravichaganti.com/categories/cloudnative/">cloudnative</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://ravichaganti.com/tags/kubernetes/">kubernetes</a>
      <span class="separator">•</span>
    <a href="https://ravichaganti.com/tags/cloudnative/">cloudnative</a></div>

        </div>
        <div class="post-meta">
          <span class="reading-time">
            <i class="fas fa-comments"></i>
            <a href="https://ravichaganti.com/blog/2022-11-13-installing-and-configuring-kubernetes-cluster-using-kubeadm-on-ubuntu/#disqus_thread"> Comments</a>
          </span>
        </div>
        <div class="post-meta">
          <span class="reading-time">
            <i class="fas fa-eye"></i>
            <strong id="views"></strong>
            Readers
          </span>
        </div>        
      </header>
      <hr>
      <div>
        
        
        <p>This article is more like a note to myself, but this may help if you are looking at configuring a Kubernetes cluster on Ubuntu.</p>
<p>There are many ways to install and configure Kubernetes cluster for learning and development purpose. You can use <a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a> or <a href="https://rancherdesktop.io/">Rancher Desktop</a> or <a href="https://podman-desktop.io/">Podman Desktop</a> or <a href="https://minikube.sigs.k8s.io/docs/start/">minikube</a> or <a href="https://microk8s.io/">microk8s</a> for quickly bringing up a single node cluster for your development work. I am a big fan of Docker Desktop and use that for any quick experiments. However, for anything more than simple deployment, I need a multi-node cluster with additional services. For this, I use a bunch of Ubuntu virtual machines and configure a Kubernetes cluster using <a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">kubeadm</a>.</p>
<p>In this article, I walk through the steps I followed to setup a virtual Kubernetes cluster.</p>
<h3 id="virtual-machine-configuration">Virtual machine configuration</h3>
<p>To ensure I have enough resources in the cluster, I created four Ubuntu 22.04 LTS virtual machines on my Windows 11 system. Each of these VMs is configured with two virtual CPUs and 2GB of virtual memory. It is recommended to configure each virtual machine with a static IP address. I chose to create an external virtual switch to enable Internet connectivity within the Ubuntu guest OS. Out of the four virtual machines, I chose to use one as the control plane node and rest three as worker nodes.</p>
<h3 id="container-runtime">Container runtime</h3>
<p>Kubernetes uses a Container Runtime Interface (CRI) compliant container runtime to orchestrate containers in Pods.</p>
<p>
<link rel="stylesheet" href="https://ravichaganti.com/css/hugo-easy-gallery.css" />
<div class="box" style="max-width:450px">
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://ravichaganti.com/images/kubernetes-container-runtime.png" />
    </div>
    <a href="https://ravichaganti.com/images/kubernetes-container-runtime.png" itemprop="contentUrl"></a>
  </figure>
</div>
  



  


<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://ravichaganti.com/js/load-photoswipe.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>
</p>
<p>There are <a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/">many runtimes</a> that are supported within Kubernetes. The most popular ones include Docker (via <a href="https://github.com/Mirantis/cri-dockerd">cri-dockerd</a>), <a href="https://containerd.io/">containerd</a>, and <a href="https://cri-o.io/">CRI-O</a>. The choice of a runtime depends on several factors such as performance, isolation needs, and security. For this virtual cluster. I chose <a href="https://containerd.io/">containerd</a> as the runtime for my virtual cluster.</p>
<h3 id="container-network-interface-cni">Container Network Interface (CNI)</h3>
<p>Kubernetes requires a CNI compatible Pod network addon for Pods within the cluster to communicate with each other. You can choose from many <a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/#networking-and-network-policy">open-source and commercial CNI plugins</a> to implement the Pod network. Once again, you need to consider factors such as ease of deployment, performance, security, and resource consumption to choose the Pod network addon that is correct for your Kubernetes cluster and the workload you plan to run.</p>
<p>I chose <a href="https://www.tigera.io/project-calico/">Calico</a> as the pod network addon for the ease of deployment and considering the fact that I have some prior experience with Calico.</p>
<h3 id="preparing-control-plane-and-worker-nodes">Preparing control plane and worker nodes</h3>
<p>Each node in the Kubernetes cluster the following components.</p>
<ul>
<li>A container runtime</li>
<li>Kubectl - The command line interface to Kubernetes API</li>
<li>Kubelet - Agent on each node that receives work from the scheduler</li>
<li>Kubeadm - Tool to automate deployment and configuration of a Kubernetes cluster</li>
</ul>
<p>Before going into this, you must ensure that nodes that will be a part of the Kubernetes cluster can communicate with each other and the firewall ports required for node to node communication are open.</p>
<p>The following network ports must be open for inbound TCP traffic on the control plane node.</p>
<ul>
<li>6443</li>
<li>2379:2380</li>
<li>10250</li>
<li>10257</li>
<li>10259</li>
<li>179 (required for Calico)</li>
</ul>
<p>On the worker nodes, you should configure to allow incoming TCP traffic on the following ports.</p>
<ul>
<li>10250</li>
<li>30000:32767</li>
</ul>
<p>On Ubuntu, you can use <code>ufw</code> command to perform this configuration.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo ufw allow proto tcp from any to any port 6443,2379,2380,10250,10257,10259,179
</code></pre></td></tr></table>
</div>
</div><p>On each node, you must disable swap and configure IPv4 forwarding and IP tables to see the bridged traffic. Before all this, ensure that each node has the latest and greatest packages. You will need <code>curl</code> as well on the node to download certain packages.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo apt-get update
$ sudo apt-get install -y apt-transport-https ca-certificates curl
</code></pre></td></tr></table>
</div>
</div><p>On each node that will be a part of the Kubernetes cluster, you must disable swap.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo swapoff -a
$ sed -i <span class="s1">&#39;/ swap / s/^\(.*\)$/#\1/g&#39;</span> /etc/fstab
</code></pre></td></tr></table>
</div>
</div><p>Along with this, you must also check if swap is listed in the <code>/etc/fstab</code> and either comment it or remove it.</p>
<p>Next, you need to configure IPv4 forwarding and IP tables on each node.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">#Enable IP tables bridge traffic on all nodes</span>
<span class="c1"># https://kubernetes.io/docs/setup/production-environment/container-runtimes/#forwarding-ipv4-and-letting-iptables-see-bridged-traffic</span>
$ cat <span class="s">&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span><span class="s">overlay
</span><span class="s">br_netfilter
</span><span class="s">EOF</span>

$ sudo modprobe overlay
$ sudo modprobe br_netfilter

<span class="c1"># sysctl params required by setup, params persist across reboots</span>
$ cat <span class="s">&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span><span class="s">net.bridge.bridge-nf-call-iptables  = 1
</span><span class="s">net.bridge.bridge-nf-call-ip6tables = 1
</span><span class="s">net.ipv4.ip_forward                 = 1
</span><span class="s">EOF</span>

<span class="c1"># Apply sysctl params without reboot</span>
$ sudo sysctl --system
</code></pre></td></tr></table>
</div>
</div><h4 id="installing-containerd">Installing containerd</h4>
<p>The next set of commands download the latest release of containerd from GitHub and configure it. You need to run this on each node.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1"># Install Containerd</span>
$ curl -Lo /tmp/containerd-1.6.9-linux-amd64.tar.gz https://github.com/containerd/containerd/releases/download/v1.6.9/containerd-1.6.9-linux-amd64.tar.gz
$ sudo tar Cxzvf /usr/local /tmp/containerd-1.6.9-linux-amd64.tar.gz

$ curl -Lo /tmp/runc.amd64 https://github.com/opencontainers/runc/releases/download/v1.1.4/runc.amd64
$ sudo install -m <span class="m">755</span> /tmp/runc.amd64 /usr/local/sbin/runc

$ curl -Lo /tmp/cni-plugins-linux-amd64-v1.1.1.tgz https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz
$ sudo mkdir -p /opt/cni/bin
$ sudo tar Cxzvf /opt/cni/bin /tmp/cni-plugins-linux-amd64-v1.1.1.tgz

<span class="c1"># Remove the temporary files</span>
$ rm /tmp/containerd-1.6.9-linux-amd64.tar.gz /tmp/runc.amd64 /tmp/cni-plugins-linux-amd64-v1.1.1.tgz

$ sudo mkdir /etc/containerd
containerd config default <span class="p">|</span> sudo tee /etc/containerd/config.toml
$ sudo sed -i <span class="s1">&#39;s/SystemdCgroup \= false/SystemdCgroup \= true/g&#39;</span> /etc/containerd/config.toml

$ sudo curl -Lo /etc/systemd/system/containerd.service https://raw.githubusercontent.com/containerd/containerd/main/containerd.service
$ sudo systemctl daemon-reload
$ sudo systemctl <span class="nb">enable</span> --now containerd
$ sudo systemctl status containerd
</code></pre></td></tr></table>
</div>
</div><h4 id="installing-kubeadm-kubelet-and-kubectl">Installing kubeadm, kubelet, and kubectl</h4>
<p>These three tools are needed on each node.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://packages.cloud.google.com/apt/doc/apt-key.gpg

$ <span class="nb">echo</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/kubernetes.list

<span class="c1"># Kubeadm, Kubelet, and Kubectl</span>
$ sudo apt-get update
$ sudo apt-get install -y kubelet kubeadm kubectl
$ sudo apt-mark hold kubelet kubeadm kubectl
</code></pre></td></tr></table>
</div>
</div><p>The above commands download and install the three tools that we need on each node. Once installed, we mark the packages as held so that they don&rsquo;t get automatically upgraded or removed.</p>
<h4 id="initialize-kubernetes-cluster">Initialize Kubernetes cluster</h4>
<p>Once the prerequisite configuration is complete, you can initialize the Kubernetes cluster using <code>kubeadm init</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ <span class="nv">IPADDR</span><span class="o">=</span><span class="k">$(</span>hostname -I<span class="k">)</span>
$ <span class="nv">APISERVER</span><span class="o">=</span><span class="k">$(</span>hostname -s<span class="k">)</span>
$ <span class="nv">NODENAME</span><span class="o">=</span><span class="k">$(</span>hostname -s<span class="k">)</span>
$ <span class="nv">POD_NET</span><span class="o">=</span><span class="s2">&#34;10.244.0.0/16&#34;</span>

$ sudo kubeadm init --apiserver-advertise-address<span class="o">=</span><span class="nv">$IPADDR</span> <span class="se">\
</span><span class="se"></span>                  --apiserver-cert-extra-sans<span class="o">=</span><span class="nv">$APISERVER</span> <span class="se">\
</span><span class="se"></span>                  --pod-network-cidr<span class="o">=</span><span class="nv">$POD_NET</span> <span class="se">\
</span><span class="se"></span>                  --node-name <span class="nv">$NODENAME</span>
</code></pre></td></tr></table>
</div>
</div><p>This command starts a few preflight checks and starts the necessary Pods needed for starting the Kubernets control plane. At the end of successful execution, you will see output similar to what is shown here.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">Your Kubernetes control-plane has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

  mkdir -p <span class="nv">$HOME</span>/.kube
  sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
  sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config

You should now deploy a Pod network to the cluster.
Run <span class="s2">&#34;kubectl apply -f [podnetwork].yaml&#34;</span> with one of the options listed at:
  /docs/concepts/cluster-administration/addons/

You can now join any number of machines by running the following on each node
as root:

  kubeadm join &lt;control-plane-host&gt;:&lt;control-plane-port&gt; --token &lt;token&gt; --discovery-token-ca-cert-hash sha256:&lt;hash&gt;
</code></pre></td></tr></table>
</div>
</div><p>Before proceeding or clearing the screen output, copy the <code>kubeadm join</code> command. You need this to join the worker nodes to the Kubernetes cluster.</p>
<h4 id="prepare-kube-config">Prepare kube config</h4>
<p>Before installing the Pod network addon, you need to make sure you prepare the <code>kubectl</code> config file. <code>kubeadm init</code> command provides the necessary commands to do this.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ mkdir -p <span class="nv">$HOME</span>/.kube
$ sudo cp -i /etc/kubernetes/admin.conf <span class="nv">$HOME</span>/.kube/config
$ sudo chown <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="nv">$HOME</span>/.kube/config
</code></pre></td></tr></table>
</div>
</div><p>Once this is done, verify if the Kubernetes control plane objects can be queried or not.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ kubectl get nodes
</code></pre></td></tr></table>
</div>
</div><p>This command will show only the control plane node and it will be shown as <code>NotReady</code>. This is because the Pod network is not ready. You can now install the Pod network addon.</p>
<h4 id="installing-calico">Installing Calico</h4>
<p>Installing Calico is just two steps. First, we install the opertor.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ curl -Lo /tmp/tigera-operator.yaml https://raw.githubusercontent.com/projectcalico/calico/v3.24.5/manifests/tigera-operator.yaml
$ kubectl create -f /tmp/tigera-operator.yaml
</code></pre></td></tr></table>
</div>
</div><p>Next, we need to install the custom resources.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ curl -Lo /tmp/custom-resources.yaml https://raw.githubusercontent.com/projectcalico/calico/v3.24.5/manifests/custom-resources.yaml
</code></pre></td></tr></table>
</div>
</div><p>In this YAML, you need to modify the the <code>spec.calicoNetwork.ipPools.cidr</code> to match what you specified as the argument to <code>--pod-network-cidr</code>. Once this modification is complete, you can implement the custom resources.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ <span class="nv">CIDR</span><span class="o">=</span><span class="s1">&#39;10.244.0.0/16&#39;</span>
$ sed -i <span class="s2">&#34;s|192.168.0.0/16|</span><span class="nv">$CIDR</span><span class="s2">|&#34;</span> /tmp/custom-resources.yaml
$ kubectl create -f /tmp/custom-resources.yaml
</code></pre></td></tr></table>
</div>
</div><p>You need to wait for the Calico Pods to transition to Ready state before you can proceed towards joining the worker nodes to the cluster.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ watch kubectl get pods -n calico-system
</code></pre></td></tr></table>
</div>
</div><p>Once all Calico pods in the calico-system namespace are online and ready, you can check if the control plane node is in ready state or not using <code>kubectl get nodes</code> command.</p>
<p>Finally, you can move on to joining all worker nodes the cluster. You need to run the command you copied from the <code>kubeadm init</code> command on each worker node.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ kubeadm join IP:6443 --token token <span class="se">\
</span><span class="se"></span>        --discovery-token-ca-cert-hash <span class="nb">hash</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>Note</strong>: IP, token, and hash in the command you copied will be different.</p>
</blockquote>
<p>The node joining process takes a few minutes. On the control plane node, you can run <code>watch kubectl get nodes</code> command wait until all nodes come online and transition to ready state.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ kubectl get nodes
NAME       STATUS   ROLES           AGE     VERSION
cplane01   Ready    control-plane   4h42m   v1.25.4
node01     Ready    &lt;none&gt;          4h28m   v1.25.4
node02     Ready    &lt;none&gt;          4h28m   v1.25.4
node03     Ready    &lt;none&gt;          4h28m   v1.25.4
</code></pre></td></tr></table>
</div>
</div><p>You should also verify if all control plane pods are online and ready or not.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ kubectl get pods --all-namespaces
NAMESPACE          NAME                                       READY   STATUS    RESTARTS        AGE
calico-apiserver   calico-apiserver-f975659ff-fscmd           1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h31m
calico-apiserver   calico-apiserver-f975659ff-jq9hn           1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h31m
calico-system      calico-kube-controllers-6b57db7fd6-grkdh   1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h33m
calico-system      calico-node-2kfq2                          1/1     Running   <span class="m">2</span> <span class="o">(</span>3h55m ago<span class="o">)</span>   4h29m
calico-system      calico-node-6h65z                          1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h33m
calico-system      calico-node-f4vml                          0/1     Running   <span class="m">2</span> <span class="o">(</span>3h55m ago<span class="o">)</span>   4h29m
calico-system      calico-node-rfpdz                          0/1     Running   <span class="m">2</span> <span class="o">(</span>3h55m ago<span class="o">)</span>   4h29m
calico-system      calico-typha-75884b99f4-dhrmp              1/1     Running   <span class="m">3</span> <span class="o">(</span>3h55m ago<span class="o">)</span>   4h29m
calico-system      calico-typha-75884b99f4-sss9d              1/1     Running   <span class="m">3</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h33m
kube-system        coredns-565d847f94-knrf8                   1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h42m
kube-system        coredns-565d847f94-mtxrs                   1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h42m
kube-system        etcd-cplane01                              1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h42m
kube-system        kube-apiserver-cplane01                    1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h42m
kube-system        kube-controller-manager-cplane01           1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h42m
kube-system        kube-proxy-9s7c7                           1/1     Running   <span class="m">2</span> <span class="o">(</span>3h55m ago<span class="o">)</span>   4h29m
kube-system        kube-proxy-dq5rc                           1/1     Running   <span class="m">2</span> <span class="o">(</span>3h55m ago<span class="o">)</span>   4h29m
kube-system        kube-proxy-kfs78                           1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h42m
kube-system        kube-proxy-zl7sb                           1/1     Running   <span class="m">2</span> <span class="o">(</span>3h55m ago<span class="o">)</span>   4h29m
kube-system        kube-scheduler-cplane01                    1/1     Running   <span class="m">2</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h42m
tigera-operator    tigera-operator-6bb5985474-cmnxp           1/1     Running   <span class="m">3</span> <span class="o">(</span>3h56m ago<span class="o">)</span>   4h35m
</code></pre></td></tr></table>
</div>
</div><p>This is it. You now have a four node Kubernetes cluster that you can use for your learning, development, and even production (if you are brave enough!).</p>

        

<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
position: relative;
text-align: left; 
height: 36px; 
width: 32px; 
float: left; 
text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span style="color: rgb(77, 77, 95);">Share on: </span><div id="share-buttons">
<div class="facebook" title="Share this on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https:\/\/ravichaganti.com\/blog\/2022-11-13-installing-and-configuring-kubernetes-cluster-using-kubeadm-on-ubuntu\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
<div class="twitter" title="Share this on Twitter" onclick="window.open('https://twitter.com/intent/tweet?text=https:\/\/ravichaganti.com\/blog\/2022-11-13-installing-and-configuring-kubernetes-cluster-using-kubeadm-on-ubuntu\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
<div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/sharing/share-offsite/?url=https:\/\/ravichaganti.com\/blog\/2022-11-13-installing-and-configuring-kubernetes-cluster-using-kubeadm-on-ubuntu\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
<div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https:\/\/ravichaganti.com\/blog\/2022-11-13-installing-and-configuring-kubernetes-cluster-using-kubeadm-on-ubuntu\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>
      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ravikanth" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
        
          
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-3619442-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p>All Rights Reserved.</p>
      
      
        ©
        
          2019 -
        
        2022
         Ravikanth Chaganti 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a> and hosted using <a href="https://pages.github.com/">GitHub Pages</a>.
      
      
    </section>
  </footer>

    </main>

    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-3619442-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
    

  </body>

</html>
