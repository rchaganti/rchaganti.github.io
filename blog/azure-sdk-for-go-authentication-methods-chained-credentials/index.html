<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <script src="https://ravichaganti.com/js/view.js"></script>
    <link rel="stylesheet" href="https://ravichaganti.com/css/syntax.css">
    <meta name="author" content="Ravikanth Chaganti">
    <meta name="description" content="So far in this series, you learned how to use different types of credentials that the Azure SDK for Go offers. You used specific credential types to authenticate with Azure in all the examples. You use a set of credential types for the development environment and a different set for production use cases. However, what if you want to use the code unmodified between development and production? What if you must test the code that uses managed identity credentials locally where the type of credentials you must use are different?">
    <meta name="keywords" content="blog,microsoft,mvp,powershell,automation,author, innovator, speaker">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Azure SDK for Go - Authentication methods - Chained Credentials"/>
<meta name="twitter:description" content="So far in this series, you learned how to use different types of credentials that the Azure SDK for Go offers. You used specific credential types to authenticate with Azure in all the examples. You use a set of credential types for the development environment and a different set for production use cases. However, what if you want to use the code unmodified between development and production? What if you must test the code that uses managed identity credentials locally where the type of credentials you must use are different?"/>

    <meta property="og:title" content="Azure SDK for Go - Authentication methods - Chained Credentials" />
<meta property="og:description" content="So far in this series, you learned how to use different types of credentials that the Azure SDK for Go offers. You used specific credential types to authenticate with Azure in all the examples. You use a set of credential types for the development environment and a different set for production use cases. However, what if you want to use the code unmodified between development and production? What if you must test the code that uses managed identity credentials locally where the type of credentials you must use are different?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-chained-credentials/" />
<meta property="article:published_time" content="2023-08-16T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-08-16T00:00:00+00:00" /><meta property="og:see_also" content="https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-managed-identity-credential/" /><meta property="og:see_also" content="https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-environmental-credential/" /><meta property="og:see_also" content="https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-for-local-dev-environment/" /><meta property="og:see_also" content="https://ravichaganti.com/blog/2023-07-13-getting-started-with-azure-sdk-for-go/" />



    
      <base href="https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-chained-credentials/">
    
    <title>
  Azure SDK for Go - Authentication methods - Chained Credentials · Ravikanth Chaganti
</title>

    
      <link rel="canonical" href="https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-chained-credentials/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://ravichaganti.com/css/coder.min.897f2f761ca1c7df1614de4c088e4ebbb7f5984b520994e5ee0a0fc4ba52f7de.css" integrity="sha256-iX8vdhyhx98WFN5MCI5Ou7f1mEtSCZTl7goPxLpS994=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://ravichaganti.com/css/coder-dark.min.e78e80fc3a585a4d1c8fc7f58623b6ff852411e38431a9cd1792877ecaa160f6.css" integrity="sha256-546A/DpYWk0cj8f1hiO2/4UkEeOEManNF5KHfsqhYPY=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="https://ravichaganti.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://ravichaganti.com/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.73.0" />
  </head>

  
  
    
  
  
    <body onload="getViews( &#34;https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-chained-credentials/&#34; )" class="colorscheme-auto">
  
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://ravichaganti.com/">
      Ravikanth Chaganti
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/about/">About</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/blog/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/books/">Books</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Azure SDK for Go - Authentication methods - Chained Credentials</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2023-08-16T00:00:00Z'>
                August 16, 2023
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              6-minute read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://ravichaganti.com/categories/azure/">azure</a>
      <span class="separator">•</span>
    <a href="https://ravichaganti.com/categories/go/">go</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://ravichaganti.com/tags/azure/">azure</a>
      <span class="separator">•</span>
    <a href="https://ravichaganti.com/tags/go/">go</a></div>

        </div>
      </header>
      <hr>
      <div>
        
        
        <p>So far <a href="https://ravichaganti.com/series/azure-go/">in this series</a>, you learned how to use different types of credentials that the Azure SDK for Go offers. You used specific credential types to authenticate with Azure in all the examples. You use a set of credential types for the development environment and a different set for production use cases. However, what if you want to use the code unmodified between development and production? What if you must test the code that uses managed identity credentials locally where the type of credentials you must use are different? This is where credential chaining comes to the rescue.</p>
<p>The <a href="https://pkg.go.dev/github.com/Azure/azure-sdk-for-go/sdk/azidentity#section-readme">azidentity</a> package offers two ways to implement credential chaining.</p>
<h2 id="defaultazurecredential">DefaultAzureCredential</h2>
<p>The DefaultAzureCredential type is most commonly used for applications deployed to Azure. This type combines the production credentials with the development credentials. This credential type attempts to authenticate using different credentials in a specific order.</p>
<p>Environment -&gt; Workload Identity -&gt; Managed Identity -&gt; Azure CLI</p>
<p>The chain stops when one of the methods succeeds. Here is an example. This example implements logging of all authentication events to demonstrate that this method attempts different types of credentials through chaining.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>
	<span class="s">&#34;encoding/json&#34;</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>

	<span class="nx">azlog</span> <span class="s">&#34;github.com/Azure/azure-sdk-for-go/sdk/azcore/log&#34;</span>
	<span class="s">&#34;github.com/Azure/azure-sdk-for-go/sdk/azidentity&#34;</span>
	<span class="s">&#34;github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/resources/armresources&#34;</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">subscriptionID</span> <span class="p">=</span> <span class="s">&#34;21e034f70820&#34;</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">azlog</span><span class="p">.</span><span class="nf">SetListener</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">event</span> <span class="nx">azlog</span><span class="p">.</span><span class="nx">Event</span><span class="p">,</span> <span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
	<span class="p">})</span>

	<span class="nx">azlog</span><span class="p">.</span><span class="nf">SetEvents</span><span class="p">(</span><span class="nx">azidentity</span><span class="p">.</span><span class="nx">EventAuthentication</span><span class="p">)</span>

	<span class="nx">cred</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">azidentity</span><span class="p">.</span><span class="nf">NewDefaultAzureCredential</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">rcFactory</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">armresources</span><span class="p">.</span><span class="nf">NewClientFactory</span><span class="p">(</span><span class="nx">subscriptionID</span><span class="p">,</span> <span class="nx">cred</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">rgClient</span> <span class="o">:=</span> <span class="nx">rcFactory</span><span class="p">.</span><span class="nf">NewResourceGroupsClient</span><span class="p">()</span>

	<span class="nx">ctx</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">()</span>
	<span class="nx">resultPager</span> <span class="o">:=</span> <span class="nx">rgClient</span><span class="p">.</span><span class="nf">NewListPager</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>

	<span class="nx">resourceGroups</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">armresources</span><span class="p">.</span><span class="nx">ResourceGroup</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">resultPager</span><span class="p">.</span><span class="nf">More</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">pageResp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">resultPager</span><span class="p">.</span><span class="nf">NextPage</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">resourceGroups</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">resourceGroups</span><span class="p">,</span> <span class="nx">pageResp</span><span class="p">.</span><span class="nx">ResourceGroupListResult</span><span class="p">.</span><span class="nx">Value</span><span class="o">...</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">jsonData</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">resourceGroups</span><span class="p">,</span> <span class="s">&#34;\t&#34;</span><span class="p">,</span> <span class="s">&#34;\t&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">jsonData</span><span class="p">))</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You can try and execute this in the development environment first, where you already have Azure CLI credentials locally.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ go run defaultAzureCred.go 
Managed Identity Credential will use IMDS managed identity
NewDefaultAzureCredential failed to initialize some credentials:
        EnvironmentCredential: missing environment variable AZURE_TENANT_ID
        WorkloadIdentityCredential: no client ID specified. Check pod configuration or <span class="nb">set</span> ClientID in the options
2023/08/16 15:06:15 DefaultAzureCredential authentication failed
GET http://169.254.169.254/metadata/identity/oauth2/token
--------------------------------------------------------------------------------
RESPONSE <span class="m">403</span> connecting to 169.254.169.254:80: connecting to 169.254.169.254:80: dial tcp 169.254.169.254:80: connectex: A socket operation was attempted to an unreachable network.
--------------------------------------------------------------------------------
connecting to 169.254.169.254:80: connecting to 169.254.169.254:80: dial tcp 169.254.169.254:80: connectex: A socket operation was attempted to an unreachable network.
--------------------------------------------------------------------------------
<span class="nb">exit</span> status <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><p>As you can see in the output here, the <code>DefaultAzureCredential</code> type attempted <code>EnvironmentCredential</code> and <code>WorkloadIdentityCredential</code> in that order. It then attempted the ManagedIdentityCredential type but failed with an error the &ldquo;socket operation was attempted to an unreachable network&rdquo;. So, what happened to the final type &ndash; <code>AzureCliCredential</code>? Interestingly, it is working as designed. According to the <a href="https://github.com/Azure/azure-sdk-for-go/issues/21029#issuecomment-1601175070">response on one of the issues</a>, the reason this method errors out is because of the way the <code>ManagedIdentityCredential</code> constructor exits once it fails to connect to the metadata endpoint causing the <code>NewDefaultAzureCredential</code> to skip attempting Azure CLI credential.</p>
<p>However, if you execute the same code inside an Azure service (like an Azure VM), you will see that it attempts the Azure CLI credential.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="err">$</span> <span class="k">go</span> <span class="nx">run</span> <span class="nx">defaultAzureCred</span><span class="p">.</span><span class="k">go</span> 
<span class="nx">Managed</span> <span class="nx">Identity</span> <span class="nx">Credential</span> <span class="nx">will</span> <span class="nx">use</span> <span class="nx">IMDS</span> <span class="nx">managed</span> <span class="nx">identity</span>
<span class="nx">NewDefaultAzureCredential</span> <span class="nx">failed</span> <span class="nx">to</span> <span class="nx">initialize</span> <span class="nx">some</span> <span class="nx">credentials</span><span class="p">:</span>
        <span class="nx">EnvironmentCredential</span><span class="p">:</span> <span class="nx">missing</span> <span class="nx">environment</span> <span class="nx">variable</span> <span class="nx">AZURE_TENANT_ID</span>
        <span class="nx">WorkloadIdentityCredential</span><span class="p">:</span> <span class="nx">no</span> <span class="nx">client</span> <span class="nx">ID</span> <span class="nx">specified</span><span class="p">.</span> <span class="nx">Check</span> <span class="nx">pod</span> <span class="nx">configuration</span> <span class="nx">or</span> <span class="nx">set</span> <span class="nx">ClientID</span> <span class="nx">in</span> <span class="nx">the</span> <span class="nx">options</span>
<span class="mi">2023</span><span class="o">/</span><span class="mi">08</span><span class="o">/</span><span class="mi">16</span> <span class="mi">16</span><span class="p">:</span><span class="mi">18</span><span class="p">:</span><span class="mi">52</span> <span class="nx">DefaultAzureCredential</span><span class="p">:</span> <span class="nx">failed</span> <span class="nx">to</span> <span class="nx">acquire</span> <span class="nx">a</span> <span class="nx">token</span><span class="p">.</span>
<span class="nx">Attempted</span> <span class="nx">credentials</span><span class="p">:</span>
        <span class="nx">EnvironmentCredential</span><span class="p">:</span> <span class="nx">missing</span> <span class="nx">environment</span> <span class="nx">variable</span> <span class="nx">AZURE_TENANT_ID</span>
        <span class="nx">WorkloadIdentityCredential</span><span class="p">:</span> <span class="nx">no</span> <span class="nx">client</span> <span class="nx">ID</span> <span class="nx">specified</span><span class="p">.</span> <span class="nx">Check</span> <span class="nx">pod</span> <span class="nx">configuration</span> <span class="nx">or</span> <span class="nx">set</span> <span class="nx">ClientID</span> <span class="nx">in</span> <span class="nx">the</span> <span class="nx">options</span>
        <span class="nx">ManagedIdentityCredential</span><span class="p">:</span> <span class="nx">no</span> <span class="k">default</span> <span class="nx">identity</span> <span class="nx">is</span> <span class="nx">assigned</span> <span class="nx">to</span> <span class="nx">this</span> <span class="nx">resource</span>
        <span class="nx">AzureCLICredential</span><span class="p">:</span> <span class="nx">Azure</span> <span class="nx">CLI</span> <span class="nx">not</span> <span class="nx">found</span> <span class="nx">on</span> <span class="nx">path</span>
<span class="nx">exit</span> <span class="nx">status</span> <span class="mi">1</span>
</code></pre></td></tr></table>
</div>
</div><p>The managed identity endpoint can still be reached inside an Azure VM, even when there is no managed identity (system or user-assigned). This endpoint does not result in a valid token credential; therefore, the <code>NewDefaultAzureCredential()</code> method attempts the Azure CLI credential check.</p>
<p>As you see above, the <code>NewDefaultAzureCredential()</code> method implements a fixed authentication flow in a specific order. What if you want to customize the authentication flow? You can achieve that using <code>ChainedTokenCredential</code>.</p>
<h2 id="chainedtokencredential">ChainedTokenCredential</h2>
<p>The <code>ChainedTokenCredential</code> method can link multiple credentials to be tried sequentially. Here is an example.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>
	<span class="s">&#34;encoding/json&#34;</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;log&#34;</span>

	<span class="s">&#34;github.com/Azure/azure-sdk-for-go/sdk/azcore&#34;</span>
	<span class="nx">azlog</span> <span class="s">&#34;github.com/Azure/azure-sdk-for-go/sdk/azcore/log&#34;</span>
	<span class="s">&#34;github.com/Azure/azure-sdk-for-go/sdk/azidentity&#34;</span>
	<span class="s">&#34;github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/resources/armresources&#34;</span>
<span class="p">)</span>

<span class="kd">const</span> <span class="nx">subscriptionID</span> <span class="p">=</span> <span class="s">&#34;5073fd4c-3a1b-4559-8371-21e034f70820&#34;</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">azlog</span><span class="p">.</span><span class="nf">SetListener</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">event</span> <span class="nx">azlog</span><span class="p">.</span><span class="nx">Event</span><span class="p">,</span> <span class="nx">s</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
	<span class="p">})</span>

	<span class="nx">azlog</span><span class="p">.</span><span class="nf">SetEvents</span><span class="p">(</span><span class="nx">azidentity</span><span class="p">.</span><span class="nx">EventAuthentication</span><span class="p">)</span>

	<span class="nx">cli</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">azidentity</span><span class="p">.</span><span class="nf">NewAzureCLICredential</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">env</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">azidentity</span><span class="p">.</span><span class="nf">NewEnvironmentCredential</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">mic</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">azidentity</span><span class="p">.</span><span class="nf">NewManagedIdentityCredential</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">cred</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">azidentity</span><span class="p">.</span><span class="nf">NewChainedTokenCredential</span><span class="p">([]</span><span class="nx">azcore</span><span class="p">.</span><span class="nx">TokenCredential</span><span class="p">{</span><span class="nx">cli</span><span class="p">,</span> <span class="nx">mic</span><span class="p">,</span> <span class="nx">env</span><span class="p">},</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">rcFactory</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">armresources</span><span class="p">.</span><span class="nf">NewClientFactory</span><span class="p">(</span><span class="nx">subscriptionID</span><span class="p">,</span> <span class="nx">cred</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">rgClient</span> <span class="o">:=</span> <span class="nx">rcFactory</span><span class="p">.</span><span class="nf">NewResourceGroupsClient</span><span class="p">()</span>

	<span class="nx">ctx</span> <span class="o">:=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">()</span>
	<span class="nx">resultPager</span> <span class="o">:=</span> <span class="nx">rgClient</span><span class="p">.</span><span class="nf">NewListPager</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>

	<span class="nx">resourceGroups</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="o">*</span><span class="nx">armresources</span><span class="p">.</span><span class="nx">ResourceGroup</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="nx">resultPager</span><span class="p">.</span><span class="nf">More</span><span class="p">()</span> <span class="p">{</span>
		<span class="nx">pageResp</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">resultPager</span><span class="p">.</span><span class="nf">NextPage</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>
		<span class="nx">resourceGroups</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">resourceGroups</span><span class="p">,</span> <span class="nx">pageResp</span><span class="p">.</span><span class="nx">ResourceGroupListResult</span><span class="p">.</span><span class="nx">Value</span><span class="o">...</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">jsonData</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">json</span><span class="p">.</span><span class="nf">MarshalIndent</span><span class="p">(</span><span class="nx">resourceGroups</span><span class="p">,</span> <span class="s">&#34;\t&#34;</span><span class="p">,</span> <span class="s">&#34;\t&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nb">string</span><span class="p">(</span><span class="nx">jsonData</span><span class="p">))</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As shown in the code, you must first create the credentials you want to chain together and use the <code>NewChainedTokenCredential()</code> method to specify the authentication flow. When you run this example, you will see that the authentication flow attempts each credential type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">$ go run chainedCredential.go 
EnvironmentCredential will authenticate with ClientSecretCredential
Managed Identity Credential will use IMDS managed identity
2023/08/17 04:54:12 ChainedTokenCredential: failed to acquire a token.
Attempted credentials:
        AzureCLICredential: Azure CLI not found on path
        ManagedIdentityCredential: no default identity is assigned to this resource
        ClientSecretCredential: unable to resolve an endpoint: http call<span class="o">(</span>https://login.microsoftonline.com/test/v2.0/.well-known/openid-configuration<span class="o">)(</span>GET<span class="o">)</span> error: reply status code was 400:
<span class="o">{</span><span class="s2">&#34;error&#34;</span>:<span class="s2">&#34;invalid_tenant&#34;</span>,<span class="s2">&#34;error_description&#34;</span>:<span class="s2">&#34;AADSTS90002: Tenant &#39;test&#39; not found. Check to make sure you have the correct tenant ID and are signing into the correct cloud. Check with your subscription administrator, this may happen if there are no active subscriptions for the tenant.\r\nTrace ID: a21cd225-ecbb-419b-b73e-b78595fd6c00\r\nCorrelation ID: 38d1a094-e650-495e-8797-134839aad177\r\nTimestamp: 2023-08-17 04:54:12Z&#34;</span>,<span class="s2">&#34;error_codes&#34;</span>:<span class="o">[</span>90002<span class="o">]</span>,<span class="s2">&#34;timestamp&#34;</span>:<span class="s2">&#34;2023-08-17 04:54:12Z&#34;</span>,<span class="s2">&#34;trace_id&#34;</span>:<span class="s2">&#34;a21cd225-ecbb-419b-b73e-b78595fd6c00&#34;</span>,<span class="s2">&#34;correlation_id&#34;</span>:<span class="s2">&#34;38d1a094-e650-495e-8797-134839aad177&#34;</span>,<span class="s2">&#34;error_uri&#34;</span>:<span class="s2">&#34;https://login.microsoftonline.com/error?code=90002&#34;</span><span class="o">}</span>
<span class="nb">exit</span> status <span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><p>With <code>ChainedTokenCredential</code>, you can customize the authentication flow and use it across both development and production environments.</p>

        

<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
position: relative;
text-align: left; 
height: 36px; 
width: 32px; 
float: left; 
text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span style="color: rgb(77, 77, 95);">Share on: </span><div id="share-buttons">
<div class="facebook" title="Share this on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https:\/\/ravichaganti.com\/blog\/azure-sdk-for-go-authentication-methods-chained-credentials\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
<div class="twitter" title="Share this on Twitter" onclick="window.open('https://twitter.com/intent/tweet?text=https:\/\/ravichaganti.com\/blog\/azure-sdk-for-go-authentication-methods-chained-credentials\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
<div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/sharing/share-offsite/?url=https:\/\/ravichaganti.com\/blog\/azure-sdk-for-go-authentication-methods-chained-credentials\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
<div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https:\/\/ravichaganti.com\/blog\/azure-sdk-for-go-authentication-methods-chained-credentials\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>
        <script src="https://giscus.app/client.js"
        data-repo="rchaganti/rchaganti.github.io"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyNzcwNTE0Mjc="
        data-category="Announcements"
        data-category-id="DIC_kwDOEIN4I84CS4rW"
        data-mapping="pathname"
        data-strict="1"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="top"
        data-theme="light"
        data-lang="en"
        data-loading="lazy"
        crossorigin="anonymous"
        async>
</script>
      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3>See also in azure-go</h3>
      <nav>
        <ul>
        
        
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-managed-identity-credential/">Azure SDK for Go - Authentication methods - Managed Identity Credential</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-environmental-credential/">Azure SDK for Go - Authentication methods - Environmental credential</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/azure-sdk-for-go-authentication-methods-for-local-dev-environment/">Azure SDK for Go - Authentication methods for local development environment</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/2023-07-13-getting-started-with-azure-sdk-for-go/">Getting Started with Azure SDK for Go</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        
        <script data-goatcounter="https://ravichaganti.goatcounter.com/count" async src="https://gc.zgo.at/count.js"></script>
      </footer>
    </article>

    
  </section>

      </div>
      <script data-goatcounter="https://ravichaganti.goatcounter.com/count" async src="https://gc.zgo.at/count.js"></script>
      
  <footer class="footer">
    <section class="container">
      
        <p>All Rights Reserved.</p>
      
      
        ©
        
          2019 -
        
        2025
         Ravikanth Chaganti 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a> and hosted using <a href="https://pages.github.com/">GitHub Pages</a>.
      
      
    </section>
  </footer>

    </main>

        
    
    

  </body>

</html>
