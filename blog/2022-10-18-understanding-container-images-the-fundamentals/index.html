<!DOCTYPE html>
<html lang="en-us">
<head>
  
  <script>
    (function() {
      const stored = localStorage.getItem('theme-preference');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = stored || (prefersDark ? 'dark' : 'light');

      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Understanding container images - The fundamentals | Ravikanth Chaganti</title>

  
  <meta name="description" content="Containers have been around for a while. There is no need for an introduction to containers anymore but If you are still looking for some background, you can read a series of articles I have written on this blog. Docker simplified working with containers by introducing a way to package your applications and application dependencies as container images. It also provided the tooling that made running container instances from these images easy. This meant the user space tools abstracted all complex details and removed the need to know the inner workings of containers. Like every other technology, knowing the internals of how something is built becomes important when troubleshooting issues or optimizing what the technology does. And, of course, knowing / learning internals is fun too!">
  <meta name="author" content="Ravikanth Chaganti">

  
  
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  

  
  <meta property="og:title" content="Understanding container images - The fundamentals">
  <meta property="og:description" content="Containers have been around for a while. There is no need for an introduction to containers anymore but If you are still looking for some background, you can read a series of articles I have written on this blog. Docker simplified working with containers by introducing a way to package your applications and application dependencies as container images. It also provided the tooling that made running container instances from these images easy. This meant the user space tools abstracted all complex details and removed the need to know the inner workings of containers. Like every other technology, knowing the internals of how something is built becomes important when troubleshooting issues or optimizing what the technology does. And, of course, knowing / learning internals is fun too!">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://ravichaganti.com/blog/2022-10-18-understanding-container-images-the-fundamentals/">
  <meta property="og:site_name" content="Ravikanth Chaganti">
  <meta property="og:locale" content="en_US">
  
  <meta property="og:image" content="https://ravichaganti.com/images/default-post.svg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Understanding container images - The fundamentals">

  
  
    <meta property="article:published_time" content="2022-10-18T00:00:00Z">
    <meta property="article:modified_time" content="2022-10-18T00:00:00Z">
    <meta property="article:author" content="Ravikanth Chaganti">
    <meta property="article:section" content="oci">
    <meta property="article:tag" content="oci"><meta property="article:tag" content="containers">
  

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Understanding container images - The fundamentals">
  <meta name="twitter:description" content="Containers have been around for a while. There is no need for an introduction to containers anymore but If you are still looking for some background, you can read a series of articles I have written on this blog. Docker simplified working with containers by introducing a way to package your applications and application dependencies as container images. It also provided the tooling that made running container instances from these images easy. This meant the user space tools abstracted all complex details and removed the need to know the inner workings of containers. Like every other technology, knowing the internals of how something is built becomes important when troubleshooting issues or optimizing what the technology does. And, of course, knowing / learning internals is fun too!">
  <meta name="twitter:image" content="https://ravichaganti.com/images/default-post.svg">
  <meta name="twitter:site" content="@ravikanth">

  
  <link rel="canonical" href="https://ravichaganti.com/blog/2022-10-18-understanding-container-images-the-fundamentals/">

  
  <link rel="alternate" type="application/rss+xml" href="https://ravichaganti.com/index.xml">

  
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate icon" type="image/x-icon" href="/favicon.ico">

  
  <link rel="stylesheet" href="/css/main.css">

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  
  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Understanding container images - The fundamentals",
  "description": "Containers have been around for a while. There is no need for an introduction to containers anymore but If you are still looking for some background, you can read a series of articles I have written â€¦",
  "articleBody": "\"Containers have been around for a while. There is no need for an introduction to containers anymore but If you are still looking for some background, you can read a series of articles I have written on this blog. Docker simplified working with containers by introducing a way to package your applications and application dependencies as container images. It also provided the tooling that made running container instances from these images easy. This meant the user space tools abstracted all complex details and removed the need to know the inner workings of containers. Like every other technology, knowing the internals of how something is built becomes important when troubleshooting issues or optimizing what the technology does. And, of course, knowing / learning internals is fun too!\\nToday\\u0026rsquo;s article is a collection of my notes [I made] as I started digging into how container images are built. First, the basics.\\nNote: This article uses the Docker engine as an example. The fundamental concepts around managing container images do not change between container engines.\\nThe basics Let us step back a bit and understand why there is a need for container images. Before containerization was made famous by Docker Inc., IT shops used virtualization as a way to deploy multiple applications on a single physical server. Virtualization vendors provide tools to do this efficiently and sometimes in an automated manner. However, each virtual machine requires a full operating system and application dependencies. Assuming that a single VM took ~10GB [very optimistic assumption] of space for OS alone, running 100 of them on a physical system will consume ~1TB. If all your VMs are running the same OS, this is a huge waste of disk space to store duplicate files. You had to install application dependencies in each VM separately, even when most applications have common dependencies. These limitations brought a bunch of operational challenges, such as patching/updates, portability, and distribution, as well.\\nSome virtualization vendors provided using differencing disks [for application code and dependencies] that shared a single parent disk containing an operating system. This, to some extent, helped, but it came with performance penalties and the same set of operational challenges.\\nWhen dotCloud, the company where Docker was born, started playing with Linux constructs to run applications as isolated processes [containers], they developed a method to package application code and dependencies that did not result in the same challenges as virtual machines. This packaging made the distribution of application code easy but solved the portability issues. What worked on a developer workstation worked in the production without a change. This packaging is what we call a container image. A container image is an immutable package of operating system files, application code, and dependencies. Container images consist of reusable layers that are stacked on top of each other. Before you dive into consuming or creating images, it is important to understand the Linux construct used in dealing with container images. It is called the Union File System.\\nUnion File System The Union File System (UnionFS) in Linux allows merging the contents of one or more file systems [directories] while keeping the content [physically] separate. Different implementations, such as AUFS and OverlayFS, are meant for union mounts. Each of these different implementations has its pros and cons. To understand the concept of a union file system, let us take OverlayFS as an example.\\nOverlayFS deals with layers of content \\u0026ndash; one or more lower layers and one upper layer. The lower layers are treated as read-only and the upper layer as read-write. OverlayFS provides a unified view of these layers through a union mount.\\nAs you can see in this depiction, the merged or union view takes content from both lower and upper layers. If a file exists in both layers, such as file F3, the file in the upper layer overrides the one in the lower layer(s). Each file or directory operation has a specific result.\\nAdding new files When adding a new file, OverlayFS adds it to the upper layer.\\nDeleting an existing file When you delete a file or folder from the upper layer, it gets deleted. However, when you delete a file that is in the lower layer(s), a special character device gets created with the same name in the upper layer. The lower layers are read-only; therefore, no files or folders get deleted. The character device in the upper layer indicates that the file or folder should be hidden from the unified view.\\nModify an existing file There won\\u0026rsquo;t be any special change if you modify a file in the upper layer. However, if you modify a file in the lower layer(s), the file first gets copied to the upper layer, and then the changes are made to this copy.\\nTalk is cheap. Let us see this in action.\\nOverlayFS in action Before creating a union mount, you must first prepare a few directories.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ mkdir lower upper merged work demo $ cd demo $ echo \\u0026#34;This is a file 1 in lower layer\\u0026#34; \\u0026gt; lower/f1 $ echo \\u0026#34;This is a file 2 in lower layer\\u0026#34; \\u0026gt; lower/f2 $ echo \\u0026#34;This is a file 3 in lower layer\\u0026#34; \\u0026gt; lower/f3 $ echo \\u0026#34;This is a file 3 in upper layer\\u0026#34; \\u0026gt; upper/f3 $ echo \\u0026#34;This is a file 4 in upper layer\\u0026#34; \\u0026gt; upper/f4 $ cd .. $ tree demo/ demo/ â”œâ”€â”€ lower â”‚Â â”œâ”€â”€ f1 â”‚Â â”œâ”€â”€ f2 â”‚Â â””â”€â”€ f3 â”œâ”€â”€ merged â”œâ”€â”€ upper â”‚Â â”œâ”€â”€ f3 â”‚Â â””â”€â”€ f4 â””â”€â”€ work Do not create any files in the merged or work directories. Merged will be the union mount, where the unified view of lower and upper directories will be available. Now, you can use the mount command to perform a union mount.\\n1 $ sudo mount overlay -t overlay -o lowerdir=demo/lower/,upperdir=demo/upper/,workdir=demo/work/ demo/merged/ The mount command above mounts the directories, lowerdir and upperdir, as a union mount under the merged folder. The workdir can be considered a temporary scratch space copying files from lower to upper.\\n1 2 3 4 5 6 7 8 9 $ ls -l demo/merged/ total 16 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:29 f1 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:29 f2 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f3 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f4 $ cat demo/merged/f3 This is a file 3 in upper layer Once the mount command succeeds, the contents of the lower and upper directories will be merged to provide a unified view. You can now try different operations, as depicted in the earlier images.\\nNote: When working with the union file system, you must make all changes in the unified mount. In the example, it is the merged directory.\\nAdding file 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ echo \\u0026#34;A new file called f5 in merged view\\u0026#34; \\u0026gt; demo/merged/f5 $ ls -l demo/merged/ total 20 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:29 f1 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:29 f2 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f3 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f4 -rw-rw-r-- 1 rchaganti rchaganti 36 Oct 18 13:34 f5 $ ls -l demo/upper/ total 12 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f3 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f4 -rw-rw-r-- 1 rchaganti rchaganti 36 Oct 18 13:34 f5 Adding a file to the merged view adds it to the upper layer as that is the read/write layer.\\nDeleting a file 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 $ rm demo/merged/f2 $ ls -l demo/merged/ total 16 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:29 f1 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f3 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f4 -rw-rw-r-- 1 rchaganti rchaganti 36 Oct 18 13:34 f5 $ ls -l demo/upper/ total 12 c--------- 2 root root 0, 0 Oct 18 13:36 f2 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f3 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:31 f4 -rw-rw-r-- 1 rchaganti rchaganti 36 Oct 18 13:34 f5 $ ls -l demo/lower/ total 12 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:29 f1 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:29 f2 -rw-rw-r-- 1 rchaganti rchaganti 32 Oct 18 12:29 f3 Deleting file f2 results in a special character file in the upper layer. The lower layer, however, remains untouched.\\nModify file When you modify a file, depending on where it is \\u0026ndash; upper or lower \\u0026ndash; a copy-up action takes place. For example, if you modify file f1 in the lower layer, f1 is copied to the upper layer and modified in the upper layer.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ cat demo/merged/f1 This is a file 1 in lower layer $ echo \\u0026#34;adding some random content\\u0026#34; \\u0026gt;\\u0026gt; demo/merged/f1 $ cat demo/merged/f1 This is a file 1 in lower layer adding some random content $ cat demo/upper/f1 This is a file 1 in lower layer adding some random content $ cat demo/lower/f1 This is a file 1 in lower layer As the above example shows, file f1 in the lower layer is left untouched. A copy of f1 is present in the upper layer and gets modified to add the new line.\\nNow that you understand how OverlayFS works, it is time to see how container engines use the union file system to manage container images.\\nContainer images Container engines like Docker support different types of storage drivers responsible for combining stacked layers into a single unified view. Similar to what you saw in the earlier example, each layer contains only the differences from the below layer. The immutable nature of these layers makes the container image reusable and allows you to run multiple containers from a single image. Each container gets its thin writable layer to facilitate writing to the container file system or modifying or deleting existing files. The storage driver used by the container engine is responsible for managing the copy-on-write (CoW) layer. The Docker engine defaults to overlay2 as the storage driver.\\nLet us dig into how this works. First, let us pull an image from the Docker hub for this exercise.\\n1 2 3 4 5 6 7 8 $ docker pull ravikanth/hello-world:v1 v1: Pulling from ravikanth/hello-world 213ec9aee27d: Pull complete 0d351817f207: Pull complete 8b09275c3de5: Pull complete Digest: sha256:9964e0545f1cbd09fc902dda80664ba4b23b5f4bd32b1a0e7ab135f819c5ed6c Status: Downloaded newer image for ravikanth/hello-world:v1 docker.io/ravikanth/hello-world:v1 The image that we just pulled has three layers. The overlay2 driver on the Docker host stores the image layers at /var/lib/docker/overlay2.\\n1 2 3 4 5 6 $ sudo ls -l /var/lib/docker/overlay2 total 16 drwx--x--- 4 root root 4096 Oct 18 15:32 cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696 drwx--x--- 4 root root 4096 Oct 18 15:32 d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39 drwx--x--- 3 root root 4096 Oct 18 15:32 ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22 drwx------ 2 root root 4096 Oct 18 15:32 l The directories at this location are uncompressed image layers; therefore, the ID does not match the layer ID in the image. The directory named l contains the symbolic links to the diff directory within each uncompressed layer.\\nIf you have multiple other images on the docker host already, you can use the docker image inspect command to find the right uncompressed layer IDs for a specific image.\\n1 2 3 4 5 6 7 8 9 $ docker image inspect ravikanth/hello-world:v1 | jq -r \\u0026#39;.[0] | {Data: .GraphDriver.Data}\\u0026#39; { \\u0026#34;Data\\u0026#34;: { \\u0026#34;LowerDir\\u0026#34;: \\u0026#34;/var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff:/var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff\\u0026#34;, \\u0026#34;MergedDir\\u0026#34;: \\u0026#34;/var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/merged\\u0026#34;, \\u0026#34;UpperDir\\u0026#34;: \\u0026#34;/var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff\\u0026#34;, \\u0026#34;WorkDir\\u0026#34;: \\u0026#34;/var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/work\\u0026#34; } } The property names \\u0026ndash; LowerDir, UpperdDir, MergeDir, and WorkDir \\u0026ndash; in the above output should be familiar by now. The layer IDs listed in the output will correlate to the ls output earlier. If you observe this output, the LowerDir property has more than one layer associated with it as the value.\\n1 2 /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff /var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff These layers are represented in the order of their position in the container image. Therefore, ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22 is the lowest layer and d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39 is the layer above the lowest layer. From the image pull output, you see that there are three layers in this image. The layer represented by UpperDir is the topmost layer in this image.\\nNow that we know the order of the layers, let us move on to see what is there in each of these uncompressed layer directories.\\nThe lowest layer contains three entries.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 $ sudo ls -l /var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22 total 8 -rw------- 1 root root 0 Oct 18 15:32 committed drwxr-xr-x 19 root root 4096 Oct 18 15:32 diff -rw-r--r-- 1 root root 26 Oct 18 15:32 link $ sudo ls -l /var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff total 68 drwxr-xr-x 2 root root 4096 Aug 9 14:17 bin drwxr-xr-x 2 root root 4096 Aug 9 14:17 dev drwxr-xr-x 16 root root 4096 Aug 9 14:17 etc drwxr-xr-x 2 root root 4096 Aug 9 14:17 home drwxr-xr-x 7 root root 4096 Aug 9 14:17 lib drwxr-xr-x 5 root root 4096 Aug 9 14:17 media drwxr-xr-x 2 root root 4096 Aug 9 14:17 mnt drwxr-xr-x 2 root root 4096 Aug 9 14:17 opt dr-xr-xr-x 2 root root 4096 Aug 9 14:17 proc drwx------ 2 root root 4096 Aug 9 14:17 root drwxr-xr-x 2 root root 4096 Aug 9 14:17 run drwxr-xr-x 2 root root 4096 Aug 9 14:17 sbin drwxr-xr-x 2 root root 4096 Aug 9 14:17 srv drwxr-xr-x 2 root root 4096 Aug 9 14:17 sys drwxrwxrwt 2 root root 4096 Aug 9 14:17 tmp drwxr-xr-x 7 root root 4096 Aug 9 14:17 usr drwxr-xr-x 12 root root 4096 Aug 9 14:17 var $ sudo cat /var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/link BOOTVTCSKJUJXUJWX765MW7TMJ $ sudo ls -l /var/lib/docker/overlay2/l/BOOTVTCSKJUJXUJWX765MW7TMJ lrwxrwxrwx 1 root root 72 Oct 18 15:32 /var/lib/docker/overlay2/l/BOOTVTCSKJUJXUJWX765MW7TMJ -\\u0026gt; ../ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff This image is based on alpine:latest and therefore diff directory in the lowest layer contains the OS files. Let us move to the next layer. If you look at the last command in the output, file namedlink in the uncompressed layer is referencing the diff directory in the same layer.\\nLet us move to the next layer in the stack.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ sudo ls -l /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39 total 16 -rw------- 1 root root 0 Oct 18 15:32 committed drwxr-xr-x 2 root root 4096 Oct 18 15:32 diff -rw-r--r-- 1 root root 26 Oct 18 15:32 link -rw-r--r-- 1 root root 28 Oct 18 15:32 lower drwx------ 3 root root 4096 Oct 18 15:32 work $ sudo ls -l /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff total 0 -rw-r--r-- 1 root root 0 Oct 16 10:54 hello.txt $ sudo cat /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff/hello.txt $ sudo cat /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/link FYTORA5MEBUHE4B4ZY4IPI3P5D $ sudo cat /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/lower l/BOOTVTCSKJUJXUJWX765MW7TMJ All uncompressed layers above the lowest layer contain five entries. The diff directory contains the contents of the layer \\u0026ndash; a zero-byte hello.txt file in this case. The file named lower points to the lower layer in the stack. And, in this example, it naturally points to the lower layer diff directory. You can ignore the rest of the entries in this uncompressed layer. In each layer, the link file contains the symbolic link to the layer\\u0026rsquo;s diff directory.\\nFinally, we have one more layer to look at.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $ sudo ls -l /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696 total 16 drwxr-xr-x 2 root root 4096 Oct 18 15:32 diff -rw-r--r-- 1 root root 26 Oct 18 15:32 link -rw-r--r-- 1 root root 57 Oct 18 15:32 lower drwx------ 3 root root 4096 Oct 18 15:32 work $ sudo ls -l /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff total 4 -rw-r--r-- 1 root root 35 Oct 16 10:54 hello.txt $ sudo cat /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff/hello.txt this is an update to the hello.txt $ sudo cat /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/link S2YWWPZHW75GE3EIQ7ULNMR5RZ $ sudo cat /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/lower l/FYTORA5MEBUHE4B4ZY4IPI3P5D:l/BOOTVTCSKJUJXUJWX765MW7TMJ This layer has two layers below it and therefore you see two entries (separated by :) in the file named lower. Similar to the previous layer, the diff directory in the layer contains a file named hello.txt. As this is the upper layer or the topmost layer, when a container is created using this image, you should see the contents of this hello.txt file within the container.\\nTo better understand this, you need to visualize this layer structure.\\nAs described earlier, container images are immutable. You cannot write anything directly to these layers. The only way to consume these layers is to create a container instance. You can do that using the docker run command.\\n1 2 $ docker run -d --name helloworld ravikanth/hello-world:v1 sleep 1000000 cff3f0322cb6765f06575bba9405d8ffeb0fecac237c5f615b906a9546d2a413 Note: Starting this container in the background will help in exploring the copy-on-write operations.\\nIn an earlier illustration, you saw how more than one container can be created from a single image and how each gets its own copy-on-write (CoW) read/write layer. So, in theory, this CoW layer must be somehow getting associated with the uncompressed image layers that you explored. This association can be found by running the docker container inspect command.\\n1 2 3 4 5 6 7 8 9 $ docker container inspect helloworld | jq -r \\u0026#39;.[0] | {Data: .GraphDriver.Data}\\u0026#39; { \\u0026#34;Data\\u0026#34;: { \\u0026#34;LowerDir\\u0026#34;: \\u0026#34;/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751-init/diff:/var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff:/var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff:/var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff\\u0026#34;, \\u0026#34;MergedDir\\u0026#34;: \\u0026#34;/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/merged\\u0026#34;, \\u0026#34;UpperDir\\u0026#34;: \\u0026#34;/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/diff\\u0026#34;, \\u0026#34;WorkDir\\u0026#34;: \\u0026#34;/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/work\\u0026#34; } } This looks similar to what you have seen in the image information. The LowerDir has four different layers in the below order.\\n1 2 3 4 /var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751-init/diff /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff /var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff This is essentially the three image layers you saw earlier and an additional container layer. You may have observed MergeDir and WorkDir in the image information output. However, as images are immutable, these values do not matter much for an image. In the case of a container, these values do matter. Therefore, the /var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/merged directory contains the unified view of all image layers.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 $ sudo ls -l /var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/merged total 72 drwxr-xr-x 2 root root 4096 Aug 9 14:17 bin drwxr-xr-x 1 root root 4096 Oct 18 18:10 dev drwxr-xr-x 1 root root 4096 Oct 18 18:10 etc -rw-r--r-- 1 root root 35 Oct 16 10:54 hello.txt drwxr-xr-x 2 root root 4096 Aug 9 14:17 home drwxr-xr-x 7 root root 4096 Aug 9 14:17 lib drwxr-xr-x 5 root root 4096 Aug 9 14:17 media drwxr-xr-x 2 root root 4096 Aug 9 14:17 mnt drwxr-xr-x 2 root root 4096 Aug 9 14:17 opt dr-xr-xr-x 2 root root 4096 Aug 9 14:17 proc drwx------ 2 root root 4096 Aug 9 14:17 root drwxr-xr-x 2 root root 4096 Aug 9 14:17 run drwxr-xr-x 2 root root 4096 Aug 9 14:17 sbin drwxr-xr-x 2 root root 4096 Aug 9 14:17 srv drwxr-xr-x 2 root root 4096 Aug 9 14:17 sys drwxrwxrwt 2 root root 4096 Aug 9 14:17 tmp drwxr-xr-x 7 root root 4096 Aug 9 14:17 usr drwxr-xr-x 12 root root 4096 Aug 9 14:17 var $ sudo cat /var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/merged/hello.txt this is an update to the hello.txt Now, try writing a new file in the running container.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 $ docker exec helloworld touch /hello-world.txt rchaganti@ubuntu02:~$ docker exec helloworld ls -l total 60 drwxr-xr-x 2 root root 4096 Aug 9 08:47 bin drwxr-xr-x 5 root root 340 Oct 18 12:40 dev drwxr-xr-x 1 root root 4096 Oct 18 12:40 etc -rw-r--r-- 1 root root 0 Oct 18 13:11 hello-world.txt -rw-r--r-- 1 root root 35 Oct 16 05:24 hello.txt drwxr-xr-x 2 root root 4096 Aug 9 08:47 home drwxr-xr-x 7 root root 4096 Aug 9 08:47 lib drwxr-xr-x 5 root root 4096 Aug 9 08:47 media drwxr-xr-x 2 root root 4096 Aug 9 08:47 mnt drwxr-xr-x 2 root root 4096 Aug 9 08:47 opt dr-xr-xr-x 252 root root 0 Oct 18 12:40 proc drwx------ 2 root root 4096 Aug 9 08:47 root drwxr-xr-x 2 root root 4096 Aug 9 08:47 run drwxr-xr-x 2 root root 4096 Aug 9 08:47 sbin drwxr-xr-x 2 root root 4096 Aug 9 08:47 srv dr-xr-xr-x 12 root root 0 Oct 18 12:40 sys drwxrwxrwt 2 root root 4096 Aug 9 08:47 tmp drwxr-xr-x 7 root root 4096 Aug 9 08:47 usr drwxr-xr-x 12 root root 4096 Aug 9 08:47 var You can see that a new file got added inside the container. The view represents the contents of MergedDir. You can check the directory represented by UpperDir to see if it appears there as well.\\n1 2 3 $ sudo ls -l /var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/diff total 0 -rw-r--r-- 1 root root 0 Oct 18 18:41 hello-world.txt If you follow the same steps you followed to determine the links between multiple image layers, you will see the association between the CoW layer and the lower immutable image layers.\\nThis is one messy diagram but it demonstrates the point. The topmost layer is the CoW read/write layer and all layers below are read-only layers. I mentioned earlier that this is a temporary lived read/write layer. What happens if we stop and start the container? What happens if we remove the container?\\nTry it yourself. Hint: The file you created within the container survives a container restart.\\nOh, BTW, you can use a tool called dive to look into the container images. While that is a great time saver, it is not as much fun as exploring the images manually \\u0026ndash; the hard way.\\nThis is one long article but I had fun refining the notes I made to write this. This article showed how images are managed by the storage driver. You may have read elsewhere that container images can be used with any container engine. How is that made possible? Let us review that in the next article around Open Container Initiative (OCI) and the OCI image specification.\\n\"",
  "url": "https:\/\/ravichaganti.com\/blog\/2022-10-18-understanding-container-images-the-fundamentals\/",
  "datePublished": "2022-10-18T00:00:00Z",
  "dateModified": "2022-10-18T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Ravikanth Chaganti"
    ,"sameAs": ["https://twitter.com/ravikanth"]
  },
  "publisher": {
    "@type": "Person",
    "name": "Ravikanth Chaganti",
    "sameAs": ["https://twitter.com/ravikanth"]
  },
  
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/ravichaganti.com\/images\/default-post.svg",
    "width": 1200,
    "height": 630
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/ravichaganti.com\/blog\/2022-10-18-understanding-container-images-the-fundamentals\/"
  },
  
  "articleSection": "\"oci\"",
  
  
  "keywords": "[\"oci\",\"containers\"]",
  
  
  "timeRequired": "PT18M",
  
  "inLanguage": "en-US",
  "isAccessibleForFree": true
}
</script>




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https:\/\/ravichaganti.com\/"
    }
    ,
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https:\/\/ravichaganti.com\/blog/"
    }
    
    ,
    {
      "@type": "ListItem",
      "position": 3,
      "name": "oci",
      "item": "https:\/\/ravichaganti.com\/categories/oci/"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Understanding container images - The fundamentals",
      "item": "https:\/\/ravichaganti.com\/blog\/2022-10-18-understanding-container-images-the-fundamentals\/"
    }
    
    
  ]
}
</script>


</head>

<body class="flex flex-col min-h-screen bg-gray-50 dark:bg-dark-bg">
  <header class="sticky top-0 z-50 bg-white dark:bg-dark-bg-secondary shadow-md relative">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      
      <div class="flex items-center">
        <a href="https://ravichaganti.com/" class="flex items-center gap-3 text-gray-900 dark:text-dark-text hover:text-primary transition-colors no-underline group">
          
          <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
            <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2" class="group-hover:stroke-primary transition-colors"/>
            <text x="20" y="26" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="currentColor">RC</text>
          </svg>
          
          <div class="flex flex-col leading-tight">
            <span class="text-xs sm:text-sm font-semibold">Cloud Native</span>
            <span class="text-xs sm:text-sm font-semibold">Agentic AI</span>
            <span class="text-xs sm:text-sm font-semibold">Infrastructure</span>
          </div>
        </a>
      </div>

      
      <div class="hidden md:flex items-center space-x-8">
        
          <a href="/blog/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Blog
          </a>
        
          <a href="/books/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Books
          </a>
        
          <a href="/slides/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Slides
          </a>
        
          <a href="/videos/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Videos
          </a>
        
          <a href="/about/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            About
          </a>
        
      </div>

      
      <div class="hidden md:flex items-center space-x-4" id="social-search-container">
        
        <div id="social-icons" class="flex items-center space-x-3">
          

<a href="https://twitter.com/ravikanth" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Twitter">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
  </svg>
</a>



<a href="https://github.com/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="GitHub">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
  </svg>
</a>



<a href="https://linkedin.com/in/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="LinkedIn">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
  </svg>
</a>




        </div>

        
        <button
          id="theme-toggle"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="search-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <div id="search-box" class="hidden">
          
<div class="relative">
  <input
    type="text"
    id="search-input"
    placeholder="Search articles..."
    class="w-64 px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results" class="absolute top-full mt-2 w-96 bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-96 overflow-y-auto z-50">
    
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>


<script>
(function() {
  let headerFuse;
  let headerSearchData = [];

  
  fetch('/index.json')
    .then(response => response.json())
    .then(data => {
      headerSearchData = data;

      
      const options = {
        keys: [
          { name: 'title', weight: 3 },
          { name: 'excerpt', weight: 2 },
          { name: 'content', weight: 1 },
          { name: 'categories', weight: 1.5 },
          { name: 'series', weight: 1.5 }
        ],
        threshold: 0.4,
        includeScore: true,
        ignoreLocation: true,
        minMatchCharLength: 2
      };

      headerFuse = new Fuse(headerSearchData, options);
    })
    .catch(error => console.error('Error loading search index:', error));

  
  const searchInput = document.getElementById('search-input');
  const searchResults = document.getElementById('search-results');

  if (searchInput && searchResults) {
    searchInput.addEventListener('input', function(e) {
      const query = e.target.value.trim();

      if (query.length < 2) {
        searchResults.classList.add('hidden');
        return;
      }

      
      const results = headerFuse.search(query);

      
      if (results.length === 0) {
        searchResults.innerHTML = '<div class="p-4 text-center text-gray-500 text-sm">No results found</div>';
        searchResults.classList.remove('hidden');
        return;
      }

      searchResults.innerHTML = results.slice(0, 5).map(result => {
        const item = result.item;
        const date = new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

        return `
          <a href="${item.permalink}" class="block p-3 hover:bg-gray-50 border-b border-gray-100 last:border-b-0 no-underline">
            <div class="font-medium text-sm text-gray-900 mb-1">${item.title}</div>
            <div class="flex items-center gap-2 mb-1">
              <span class="text-xs text-gray-500">${date}</span>
              ${item.categories ? item.categories.slice(0, 2).map(cat => `
                <span class="inline-block px-1.5 py-0.5 text-xs rounded" style="background-color: rgba(30, 64, 175, 0.1); color: #1e40af;">
                  ${cat}
                </span>
              `).join('') : ''}
            </div>
            ${item.excerpt ? `<p class="text-xs text-gray-600 line-clamp-2">${item.excerpt}</p>` : ''}
          </a>
        `;
      }).join('');

      searchResults.classList.remove('hidden');
    });

    
    document.addEventListener('click', function(e) {
      if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
        searchResults.classList.add('hidden');
      }
    });

    
    searchInput.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        searchResults.classList.add('hidden');
        searchInput.blur();
      }
    });
  }
})();
</script>

        </div>
      </div>

      
      <button id="mobile-menu-toggle" class="md:hidden p-2 hover:bg-gray-100 rounded" aria-label="Menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>

    
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4">
      
        <a href="/blog/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Blog
        </a>
      
        <a href="/books/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Books
        </a>
      
        <a href="/slides/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Slides
        </a>
      
        <a href="/videos/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Videos
        </a>
      
        <a href="/about/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          About
        </a>
      
    </div>
  </nav>

  
  
    <div id="reading-progress" class="absolute bottom-0 left-0 w-full h-1 bg-primary transition-all duration-200 z-10" style="width: 0%; max-width: 100%;"></div>
  
</header>


<script>
  document.getElementById('mobile-menu-toggle')?.addEventListener('click', function() {
    const menu = document.getElementById('mobile-menu');
    menu?.classList.toggle('hidden');
  });

  document.getElementById('search-toggle')?.addEventListener('click', function() {
    const socialIcons = document.getElementById('social-icons');
    const searchBox = document.getElementById('search-box');
    socialIcons?.classList.toggle('hidden');
    searchBox?.classList.toggle('hidden');
  });
</script>


  <main class="flex-grow">
    
<article class="container mx-auto px-4 sm:px-6 md:px-4 py-8 sm:py-10 md:py-12">
  <div class="max-w-4xl mx-auto">
    
    <header class="mb-8">
      
      <nav class="text-xs sm:text-sm mb-4">
        <ol class="flex items-center space-x-2 text-gray-600 dark:text-dark-text-secondary">
          <li><a href="https://ravichaganti.com/" class="hover:text-primary dark:hover:text-blue-400">Home</a></li>
          <li><span class="mx-2">/</span></li>
          <li><a href="/blog/" class="hover:text-primary dark:hover:text-blue-400">Blog</a></li>
          
            <li><span class="mx-2">/</span></li>
            <li><a href="/categories/oci/" class="hover:text-primary dark:hover:text-blue-400">oci</a></li>
          
        </ol>
      </nav>

      
      <div class="flex flex-wrap items-center gap-2 sm:gap-3 md:gap-4 text-sm sm:text-base text-gray-600 dark:text-dark-text-secondary mb-6">
        
        <div class="flex items-center">
          <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <time datetime="2022-10-18">October 18, 2022</time>
        </div>

        
        
          <span>â€¢</span>
          <div class="flex items-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>18 min read</span>
          </div>
        

        
        
      </div>

      
      <div class="flex flex-wrap gap-2 mb-6">
        
          
            <a href="/categories/oci/" class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              oci
            </a>
          
            <a href="/categories/containers/" class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              containers
            </a>
          
        
        
          
            <a href="/series/container-images/" class="inline-block px-3 py-1 text-sm font-medium bg-secondary/10 dark:bg-secondary/20 text-secondary dark:text-purple-400 rounded-full hover:bg-secondary/20 dark:hover:bg-secondary/30 transition-colors no-underline">
              ðŸ“š Series: Container images
            </a>
          
        
      </div>

      
      <div class="mb-6 sm:mb-8 rounded-lg overflow-hidden shadow-lg">
        
        <img src="/images/default-post.svg" alt="Understanding container images - The fundamentals" class="w-full h-auto max-h-64 sm:max-h-96 md:max-h-none object-cover">
      </div>

      
      
    </header>

    
    


  
  
  
    <aside class="bg-gradient-to-br from-secondary/5 to-primary/5 dark:from-secondary/10 dark:to-primary/10 rounded-lg shadow-md dark:shadow-2xl dark:shadow-black/20 p-4 mb-6 border border-secondary/20 dark:border-secondary/30">
      
      <button
        class="flex items-center justify-between w-full text-left font-semibold text-base text-gray-900 dark:text-dark-text hover:text-secondary dark:hover:text-purple-400 transition-colors"
        aria-expanded="false"
        aria-controls="series-content"
      >
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          Series: Container images
        </span>
        <svg
          id="series-chevron"
          class="w-4 h-4 transform transition-transform -rotate-90"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      
      <p class="text-xs text-gray-600 dark:text-dark-text-secondary mt-2 mb-2 collapsed" id="series-description">
        Part of a 3-part series
      </p>

      
      <nav id="series-content" class="series-content collapsed mt-1">
        <ol class="space-y-3">
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                1
              </span>
              <div class="flex-grow">
                
                  <span class="font-bold text-secondary dark:text-purple-400">
                    Understanding container images - The fundamentals
                    <span class="text-xs ml-2 px-2 py-0.5 bg-secondary dark:bg-purple-600 text-white rounded">You are here</span>
                  </span>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Oct 18, 2022</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                2
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/2022-10-28-understanding-container-images-oci-image-specification/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Understanding container images - OCI image specification
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Oct 28, 2022</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                3
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/2022-10-29-publish-container-images-to-azure-container-registry/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Publish container images to Azure Container Registry
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Oct 29, 2022</p>
              </div>
            </li>
          
        </ol>

        
        <div class="mt-6 pt-6 border-t border-secondary/20 dark:border-secondary/30 grid grid-cols-2 gap-4">
          
          
            
              
            
          
            
          
            
          

          
          
            <div></div>
          

          
          
            
            <a href="https://ravichaganti.com/blog/2022-10-28-understanding-container-images-oci-image-specification/" class="flex items-center justify-end text-sm text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline group">
              <span class="truncate">Understanding container images - OCI image specification</span>
              <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          
        </div>
      </nav>
    </aside>
  



    
    



    
    <div class="prose prose-sm sm:prose-base md:prose-lg max-w-none mb-8 sm:mb-10 md:mb-12">
      <p>Containers have been around for a while. There is no need for an introduction to containers anymore but If you are still looking for some background, you can read a <a href="/tags/containers/">series of articles</a> I have written on this blog. Docker simplified working with containers by introducing a way to package your applications and application dependencies as container images. It also provided the tooling that made running container instances from these images easy. This meant the user space tools abstracted all complex details and removed the need to know the inner workings of containers. Like every other technology, knowing the internals of how something is built becomes important when troubleshooting issues or optimizing what the technology does. And, of course, knowing / learning internals is fun too!</p>
<p>Today&rsquo;s article is a collection of my notes [I made] as I started digging into how container images are built. First, the basics.</p>
<blockquote>
<p><strong>Note</strong>: This article uses the Docker engine as an example. The fundamental concepts around managing container images do not change between container engines.</p>
</blockquote>
<h3 id="the-basics">The basics</h3>
<p>Let us step back a bit and understand why there is a need for container images. Before containerization was made famous by Docker Inc., IT shops used virtualization as a way to deploy multiple applications on a single physical server. Virtualization vendors provide tools to do this efficiently and sometimes in an automated manner. However, each virtual machine requires a full operating system and application dependencies. Assuming that a single VM took ~10GB [very optimistic assumption] of space for OS alone, running 100 of them on a physical system will consume ~1TB. If all your VMs are running the same OS, this is a huge waste of disk space to store duplicate files. You had to install application dependencies in each VM separately, even when most applications have common dependencies. These limitations brought a bunch of operational challenges, such as patching/updates, portability, and distribution, as well.</p>
<p>Some virtualization vendors provided using differencing disks [for application code and dependencies] that shared a single parent disk containing an operating system. This, to some extent, helped, but it came with performance penalties and the same set of operational challenges.</p>
<p>When <a href="https://www.docker.com/press-release/dotcloud-inc-now-docker-inc/">dotCloud</a>, the company where Docker was born, started playing with Linux constructs to run applications as isolated processes [containers], they developed a method to package application code and dependencies that did not result in the same challenges as virtual machines. This packaging made the distribution of application code easy but solved the portability issues. What worked on a developer workstation worked in the production without a change. This packaging is what we call a container image. A container image is an immutable package of operating system files, application code, and dependencies. Container images consist of reusable layers that are stacked on top of each other. Before you dive into consuming or creating images, it is important to understand the Linux construct used in dealing with container images. It is called the Union File System.</p>
<h4 id="union-file-system">Union File System</h4>
<p>The Union File System (<a href="https://unionfs.filesystems.org/">UnionFS</a>) in Linux allows merging the contents of one or more file systems [directories] while keeping the content [physically] separate. Different implementations, such as AUFS and  OverlayFS, are meant for union mounts. Each of these different implementations has its pros and cons. To understand the concept of a union file system, let us take OverlayFS as an example.</p>
<p>OverlayFS deals with layers of content &ndash; one or more lower layers and one upper layer. The lower layers are treated as read-only and the upper layer as read-write. OverlayFS provides a unified view of these layers through a union mount.</p>
<p><figure class="figure " style="max-width: 450px; margin: 1.5rem auto;">
  <a href="/images/overlay-1.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/overlay-1.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css">
  
  
  <script src="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/js/glightbox.min.js"></script>
  
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const lightbox = GLightbox({
        selector: '.glightbox',
        touchNavigation: true,
        loop: true,
        autoplayVideos: true,
        zoomable: true,
        draggable: true,
        closeButton: true,
        moreLength: 0
      });
    });
  </script></p>
<p>As you can see in this depiction, the merged or union view takes content from both lower and upper layers. If a file exists in both layers, such as file F3, the file in the upper layer overrides the one in the lower layer(s). Each file or directory operation has a specific result.</p>
<h4 id="adding-new-files">Adding new files</h4>
<p>When adding a new file, OverlayFS adds it to the upper layer.</p>
<figure class="figure " style="max-width: 450px; margin: 1.5rem auto;">
  <a href="/images/overlay-2.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/overlay-2.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<h4 id="deleting-an-existing-file">Deleting an existing file</h4>
<p>When you delete a file or folder from the upper layer, it gets deleted. However, when you delete a file that is in the lower layer(s), a special character device gets created with the same name in the upper layer. The lower layers are read-only; therefore, no files or folders get deleted. The character device in the upper layer indicates that the file or folder should be hidden from the unified view.</p>
<figure class="figure " style="max-width: 450px; margin: 1.5rem auto;">
  <a href="/images/overlay-3.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/overlay-3.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<h4 id="modify-an-existing-file">Modify an existing file</h4>
<p>There won&rsquo;t be any special change if you modify a file in the upper layer. However, if you modify a file in the lower layer(s), the file first gets copied to the upper layer, and then the changes are made to this copy.</p>
<figure class="figure " style="max-width: 450px; margin: 1.5rem auto;">
  <a href="/images/overlay-4.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/overlay-4.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<p>Talk is cheap. Let us see this in action.</p>
<h4 id="overlayfs-in-action">OverlayFS in action</h4>
<p>Before creating a union mount, you must first prepare a few directories.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ mkdir lower upper merged work demo
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> demo
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;This is a file 1 in lower layer&#34;</span> &gt; lower/f1
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;This is a file 2 in lower layer&#34;</span> &gt; lower/f2
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;This is a file 3 in lower layer&#34;</span> &gt; lower/f3
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;This is a file 3 in upper layer&#34;</span> &gt; upper/f3
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;This is a file 4 in upper layer&#34;</span> &gt; upper/f4
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> ..
</span></span><span class="line"><span class="cl">$ tree demo/
</span></span><span class="line"><span class="cl">demo/
</span></span><span class="line"><span class="cl">â”œâ”€â”€ lower
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ f1
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ f2
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ f3
</span></span><span class="line"><span class="cl">â”œâ”€â”€ merged
</span></span><span class="line"><span class="cl">â”œâ”€â”€ upper
</span></span><span class="line"><span class="cl">â”‚Â Â  â”œâ”€â”€ f3
</span></span><span class="line"><span class="cl">â”‚Â Â  â””â”€â”€ f4
</span></span><span class="line"><span class="cl">â””â”€â”€ work
</span></span></code></pre></td></tr></table>
</div>
</div><p>Do not create any files in the merged or work directories. Merged will be the union mount, where the unified view of lower and upper directories will be available. Now, you can use the <code>mount</code> command to perform a union mount.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo mount overlay -t overlay -o <span class="nv">lowerdir</span><span class="o">=</span>demo/lower/,upperdir<span class="o">=</span>demo/upper/,workdir<span class="o">=</span>demo/work/ demo/merged/
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>mount</code> command above mounts the directories, <code>lowerdir</code> and <code>upperdir</code>, as a union mount under the merged folder. The <code>workdir</code> can be considered a temporary scratch space copying files from lower to upper.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ls -l demo/merged/
</span></span><span class="line"><span class="cl">total <span class="m">16</span>
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:29 f1
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:29 f2
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:31 f3
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:31 f4
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ cat demo/merged/f3
</span></span><span class="line"><span class="cl">This is a file <span class="m">3</span> in upper layer
</span></span></code></pre></td></tr></table>
</div>
</div><p>Once the mount command succeeds, the contents of the lower and upper directories will be merged to provide a unified view. You can now try different operations, as depicted in the earlier images.</p>
<blockquote>
<p><strong>Note:</strong> When working with the union file system, you must make all changes in the unified mount. In the example, it is the merged directory.</p>
</blockquote>
<h5 id="adding-file">Adding file</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;A new file called f5 in merged view&#34;</span> &gt;  demo/merged/f5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls -l demo/merged/
</span></span><span class="line"><span class="cl">total <span class="m">20</span>
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:29 f1
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:29 f2
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:31 f3
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:31 f4
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">36</span> Oct <span class="m">18</span> 13:34 f5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls -l demo/upper/
</span></span><span class="line"><span class="cl">total <span class="m">12</span>
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:31 f3
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:31 f4
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">36</span> Oct <span class="m">18</span> 13:34 f5
</span></span></code></pre></td></tr></table>
</div>
</div><p>Adding a file to the merged view adds it to the upper layer as that is the read/write layer.</p>
<h5 id="deleting-a-file">Deleting a file</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ rm demo/merged/f2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls -l demo/merged/
</span></span><span class="line"><span class="cl">total <span class="m">16</span>
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:29 f1
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:31 f3
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:31 f4
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">36</span> Oct <span class="m">18</span> 13:34 f5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls -l demo/upper/
</span></span><span class="line"><span class="cl">total <span class="m">12</span>
</span></span><span class="line"><span class="cl">c--------- <span class="m">2</span> root      root      0, <span class="m">0</span> Oct <span class="m">18</span> 13:36 f2
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti   <span class="m">32</span> Oct <span class="m">18</span> 12:31 f3
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti   <span class="m">32</span> Oct <span class="m">18</span> 12:31 f4
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti   <span class="m">36</span> Oct <span class="m">18</span> 13:34 f5
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ls -l demo/lower/
</span></span><span class="line"><span class="cl">total <span class="m">12</span>
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:29 f1
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:29 f2
</span></span><span class="line"><span class="cl">-rw-rw-r-- <span class="m">1</span> rchaganti rchaganti <span class="m">32</span> Oct <span class="m">18</span> 12:29 f3
</span></span></code></pre></td></tr></table>
</div>
</div><p>Deleting file f2 results in a special character file in the upper layer. The lower layer, however, remains untouched.</p>
<h5 id="modify-file">Modify file</h5>
<p>When you modify a file, depending on where it is &ndash; upper or lower &ndash; a copy-up action takes place. For example, if you modify file f1 in the lower layer, f1 is copied to the upper layer and modified in the upper layer.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cat demo/merged/f1
</span></span><span class="line"><span class="cl">This is a file <span class="m">1</span> in lower layer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ <span class="nb">echo</span> <span class="s2">&#34;adding some random content&#34;</span> &gt;&gt; demo/merged/f1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ cat demo/merged/f1
</span></span><span class="line"><span class="cl">This is a file <span class="m">1</span> in lower layer
</span></span><span class="line"><span class="cl">adding some random content
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ cat demo/upper/f1
</span></span><span class="line"><span class="cl">This is a file <span class="m">1</span> in lower layer
</span></span><span class="line"><span class="cl">adding some random content
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ cat demo/lower/f1
</span></span><span class="line"><span class="cl">This is a file <span class="m">1</span> in lower layer
</span></span></code></pre></td></tr></table>
</div>
</div><p>As the above example shows, file f1 in the lower layer is left untouched. A copy of f1 is present in the upper layer and gets modified to add the new line.</p>
<p>Now that you understand how OverlayFS works, it is time to see how container engines use the union file system to manage container images.</p>
<h3 id="container-images">Container images</h3>
<p>Container engines like Docker support different types of storage drivers responsible for combining stacked layers into a single unified view. Similar to what you saw in the earlier example, each layer contains only the differences from the below layer. The immutable nature of these layers makes the container image reusable and allows you to run multiple containers from a single image. Each container gets its thin writable layer to facilitate writing to the container file system or modifying or deleting existing files. The storage driver used by the container engine is responsible for managing the copy-on-write (CoW) layer. The Docker engine defaults to overlay2 as the storage driver.</p>
<figure class="figure " style="max-width: 450px; margin: 1.5rem auto;">
  <a href="/images/image-layers-containers.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/image-layers-containers.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<p>Let us dig into how this works. First, let us pull an image from the Docker hub for this exercise.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker pull ravikanth/hello-world:v1
</span></span><span class="line"><span class="cl">v1: Pulling from ravikanth/hello-world
</span></span><span class="line"><span class="cl">213ec9aee27d: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">0d351817f207: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">8b09275c3de5: Pull <span class="nb">complete</span>
</span></span><span class="line"><span class="cl">Digest: sha256:9964e0545f1cbd09fc902dda80664ba4b23b5f4bd32b1a0e7ab135f819c5ed6c
</span></span><span class="line"><span class="cl">Status: Downloaded newer image <span class="k">for</span> ravikanth/hello-world:v1
</span></span><span class="line"><span class="cl">docker.io/ravikanth/hello-world:v1
</span></span></code></pre></td></tr></table>
</div>
</div><p>The image that we just pulled has three layers. The <code>overlay2</code> driver on the Docker host stores the image layers at <code>/var/lib/docker/overlay2</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2
</span></span><span class="line"><span class="cl">total <span class="m">16</span>
</span></span><span class="line"><span class="cl">drwx--x--- <span class="m">4</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 15:32 cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696
</span></span><span class="line"><span class="cl">drwx--x--- <span class="m">4</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 15:32 d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39
</span></span><span class="line"><span class="cl">drwx--x--- <span class="m">3</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 15:32 ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22
</span></span><span class="line"><span class="cl">drwx------ <span class="m">2</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 15:32 l
</span></span></code></pre></td></tr></table>
</div>
</div><p>The directories at this location are uncompressed image layers; therefore, the ID does not match the layer ID in the image. The directory named <code>l</code> contains the symbolic links to the <code>diff</code> directory within each uncompressed layer.</p>
<p>If you have multiple other images on the docker host already, you can use the <code>docker image inspect</code> command to find the right uncompressed layer IDs for a specific image.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker image inspect ravikanth/hello-world:v1 <span class="p">|</span> jq -r <span class="s1">&#39;.[0] | {Data: .GraphDriver.Data}&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;Data&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;LowerDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff:/var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;MergedDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/merged&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UpperDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;WorkDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/work&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The property names &ndash; <code>LowerDir</code>, <code>UpperdDir</code>, <code>MergeDir</code>, and <code>WorkDir</code> &ndash; in the above output should be familiar by now. The layer IDs listed in the output will correlate to the <code>ls</code> output earlier. If you observe this output, the <code>LowerDir</code> property has more than one layer associated with it as the value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">overlay2</span><span class="o">/</span><span class="n">d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39</span><span class="o">/</span><span class="n">diff</span>
</span></span><span class="line"><span class="cl"><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">overlay2</span><span class="o">/</span><span class="n">ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22</span><span class="o">/</span><span class="n">diff</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>These layers are represented in the order of their position in the container image. Therefore, <code>ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22</code> is the lowest layer and <code>d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39</code> is the layer above the lowest layer. From the image pull output, you see that there are three layers in this image. The layer represented by <code>UpperDir</code> is the topmost layer in this image.</p>
<p>Now that we know the order of the layers, let us move on to see what is there in each of these uncompressed layer directories.</p>
<p>The lowest layer contains three entries.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22
</span></span><span class="line"><span class="cl">total <span class="m">8</span>
</span></span><span class="line"><span class="cl">-rw-------  <span class="m">1</span> root root    <span class="m">0</span> Oct <span class="m">18</span> 15:32 committed
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">19</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 15:32 diff
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> root root   <span class="m">26</span> Oct <span class="m">18</span> 15:32 link
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff
</span></span><span class="line"><span class="cl">total <span class="m">68</span>
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 bin
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 dev
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">16</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 etc
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 home
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">7</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 lib
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">5</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 media
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 mnt
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 opt
</span></span><span class="line"><span class="cl">dr-xr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 proc
</span></span><span class="line"><span class="cl">drwx------  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 root
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 run
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 sbin
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 srv
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 sys
</span></span><span class="line"><span class="cl">drwxrwxrwt  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 tmp
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">7</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 usr
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">12</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 var
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo cat /var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/link
</span></span><span class="line"><span class="cl">BOOTVTCSKJUJXUJWX765MW7TMJ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2/l/BOOTVTCSKJUJXUJWX765MW7TMJ
</span></span><span class="line"><span class="cl">lrwxrwxrwx <span class="m">1</span> root root <span class="m">72</span> Oct <span class="m">18</span> 15:32 /var/lib/docker/overlay2/l/BOOTVTCSKJUJXUJWX765MW7TMJ -&gt; ../ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff
</span></span></code></pre></td></tr></table>
</div>
</div><p>This image is based on <code>alpine:latest</code> and therefore <code>diff</code> directory in the lowest layer contains the OS files. Let us move to the next layer. If you look at the last command in the output, file named<code>link</code> in the uncompressed layer is referencing the <code>diff</code> directory in the same layer.</p>
<p>Let us move to the next layer in the stack.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39
</span></span><span class="line"><span class="cl">total <span class="m">16</span>
</span></span><span class="line"><span class="cl">-rw------- <span class="m">1</span> root root    <span class="m">0</span> Oct <span class="m">18</span> 15:32 committed
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">2</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 15:32 diff
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root   <span class="m">26</span> Oct <span class="m">18</span> 15:32 link
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root   <span class="m">28</span> Oct <span class="m">18</span> 15:32 lower
</span></span><span class="line"><span class="cl">drwx------ <span class="m">3</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 15:32 work
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff
</span></span><span class="line"><span class="cl">total <span class="m">0</span>
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">0</span> Oct <span class="m">16</span> 10:54 hello.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo cat /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff/hello.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo cat /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/link
</span></span><span class="line"><span class="cl">FYTORA5MEBUHE4B4ZY4IPI3P5D
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo cat /var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/lower
</span></span><span class="line"><span class="cl">l/BOOTVTCSKJUJXUJWX765MW7TMJ
</span></span></code></pre></td></tr></table>
</div>
</div><p>All uncompressed layers above the lowest layer contain five entries. The <code>diff</code> directory contains the contents of the layer &ndash; a zero-byte hello.txt file in this case. The file named lower points to the lower layer in the stack. And, in this example, it naturally points to the lower layer <code>diff</code> directory. You can ignore the rest of the entries in this uncompressed layer. In each layer, the <code>link</code> file contains the symbolic link to the layer&rsquo;s <code>diff</code> directory.</p>
<p>Finally, we have one more layer to look at.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696
</span></span><span class="line"><span class="cl">total <span class="m">16</span>
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">2</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 15:32 diff
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root   <span class="m">26</span> Oct <span class="m">18</span> 15:32 link
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root   <span class="m">57</span> Oct <span class="m">18</span> 15:32 lower
</span></span><span class="line"><span class="cl">drwx------ <span class="m">3</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 15:32 work
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff
</span></span><span class="line"><span class="cl">total <span class="m">4</span>
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">35</span> Oct <span class="m">16</span> 10:54 hello.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo cat /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff/hello.txt
</span></span><span class="line"><span class="cl">this is an update to the hello.txt
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo cat /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/link
</span></span><span class="line"><span class="cl">S2YWWPZHW75GE3EIQ7ULNMR5RZ
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo cat /var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/lower
</span></span><span class="line"><span class="cl">l/FYTORA5MEBUHE4B4ZY4IPI3P5D:l/BOOTVTCSKJUJXUJWX765MW7TMJ
</span></span></code></pre></td></tr></table>
</div>
</div><p>This layer has two layers below it and therefore you see two entries (separated by :) in the file named <code>lower</code>. Similar to the previous layer, the <code>diff</code> directory in the layer contains a file named hello.txt. As this is the upper layer or the topmost layer, when a container is created using this image, you should see the contents of this hello.txt file within the container.</p>
<p>To better understand this, you need to visualize this layer structure.</p>
<figure class="figure " style="max-width: 450px; margin: 1.5rem auto;">
  <a href="/images/overlay-layers-1.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/overlay-layers-1.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<p>As described earlier, container images are immutable. You cannot write anything directly to these layers. The only way to consume these layers is to create a container instance. You can do that using the <code>docker run</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker run -d --name helloworld ravikanth/hello-world:v1 sleep <span class="m">1000000</span>
</span></span><span class="line"><span class="cl">cff3f0322cb6765f06575bba9405d8ffeb0fecac237c5f615b906a9546d2a413
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p><strong>Note</strong>: Starting this container in the background will help in exploring the copy-on-write operations.</p>
</blockquote>
<p>In an earlier illustration, you saw how more than one container can be created from a single image and how each gets its own copy-on-write (CoW) read/write layer. So, in theory, this CoW layer must be somehow getting associated with the uncompressed image layers that you explored. This association can be found by running the docker container inspect command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker container inspect helloworld <span class="p">|</span> jq -r <span class="s1">&#39;.[0] | {Data: .GraphDriver.Data}&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;Data&#34;</span>: <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;LowerDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751-init/diff:/var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff:/var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff:/var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;MergedDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/merged&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;UpperDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/diff&#34;</span>,
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;WorkDir&#34;</span>: <span class="s2">&#34;/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/work&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This looks similar to what you have seen in the image information. The <code>LowerDir</code> has four different layers in the below order.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751-init/diff
</span></span><span class="line"><span class="cl">/var/lib/docker/overlay2/cf0b92185c9ba3bdf11d19e53252063def37acf80fe3491597fd5a8914e1a696/diff
</span></span><span class="line"><span class="cl">/var/lib/docker/overlay2/d63b70e8f22063b1eb4296b70c2e231392e28b104475104e14f7346530e0dd39/diff
</span></span><span class="line"><span class="cl">/var/lib/docker/overlay2/ec861e1affe1b78197b7cc7f6f4381c6de0e490e04a60dc1ff684a9f7ddeab22/diff
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is essentially the three image layers you saw earlier and an additional container layer. You may have observed <code>MergeDir</code> and <code>WorkDir</code> in the image information output. However, as images are immutable, these values do not matter much for an image. In the case of a container, these values do matter. Therefore, the <code>/var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/merged</code> directory contains the unified view of all image layers.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/merged
</span></span><span class="line"><span class="cl">total <span class="m">72</span>
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 bin
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">1</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 18:10 dev
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">1</span> root root <span class="m">4096</span> Oct <span class="m">18</span> 18:10 etc
</span></span><span class="line"><span class="cl">-rw-r--r--  <span class="m">1</span> root root   <span class="m">35</span> Oct <span class="m">16</span> 10:54 hello.txt
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 home
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">7</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 lib
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">5</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 media
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 mnt
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 opt
</span></span><span class="line"><span class="cl">dr-xr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 proc
</span></span><span class="line"><span class="cl">drwx------  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 root
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 run
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 sbin
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 srv
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 sys
</span></span><span class="line"><span class="cl">drwxrwxrwt  <span class="m">2</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 tmp
</span></span><span class="line"><span class="cl">drwxr-xr-x  <span class="m">7</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 usr
</span></span><span class="line"><span class="cl">drwxr-xr-x <span class="m">12</span> root root <span class="m">4096</span> Aug  <span class="m">9</span> 14:17 var
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ sudo cat /var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/merged/hello.txt
</span></span><span class="line"><span class="cl">this is an update to the hello.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now, try writing a new file in the running container.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ docker <span class="nb">exec</span> helloworld touch /hello-world.txt
</span></span><span class="line"><span class="cl">rchaganti@ubuntu02:~$ docker <span class="nb">exec</span> helloworld ls -l
</span></span><span class="line"><span class="cl">total <span class="m">60</span>
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">2</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 bin
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">5</span> root     root           <span class="m">340</span> Oct <span class="m">18</span> 12:40 dev
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">1</span> root     root          <span class="m">4096</span> Oct <span class="m">18</span> 12:40 etc
</span></span><span class="line"><span class="cl">-rw-r--r--    <span class="m">1</span> root     root             <span class="m">0</span> Oct <span class="m">18</span> 13:11 hello-world.txt
</span></span><span class="line"><span class="cl">-rw-r--r--    <span class="m">1</span> root     root            <span class="m">35</span> Oct <span class="m">16</span> 05:24 hello.txt
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">2</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 home
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">7</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 lib
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">5</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 media
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">2</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 mnt
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">2</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 opt
</span></span><span class="line"><span class="cl">dr-xr-xr-x  <span class="m">252</span> root     root             <span class="m">0</span> Oct <span class="m">18</span> 12:40 proc
</span></span><span class="line"><span class="cl">drwx------    <span class="m">2</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 root
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">2</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 run
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">2</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 sbin
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">2</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 srv
</span></span><span class="line"><span class="cl">dr-xr-xr-x   <span class="m">12</span> root     root             <span class="m">0</span> Oct <span class="m">18</span> 12:40 sys
</span></span><span class="line"><span class="cl">drwxrwxrwt    <span class="m">2</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 tmp
</span></span><span class="line"><span class="cl">drwxr-xr-x    <span class="m">7</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 usr
</span></span><span class="line"><span class="cl">drwxr-xr-x   <span class="m">12</span> root     root          <span class="m">4096</span> Aug  <span class="m">9</span> 08:47 var
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can see that a new file got added inside the container. The view represents the contents of <code>MergedDir</code>. You can check the directory represented by <code>UpperDir</code> to see if it appears there as well.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ sudo ls -l /var/lib/docker/overlay2/38705da4838102c3b9d2ae8aeb49844dac84dae95881df61fcffd1685caf9751/diff
</span></span><span class="line"><span class="cl">total <span class="m">0</span>
</span></span><span class="line"><span class="cl">-rw-r--r-- <span class="m">1</span> root root <span class="m">0</span> Oct <span class="m">18</span> 18:41 hello-world.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>If you follow the same steps you followed to determine the links between multiple image layers, you will see the association between the CoW layer and the lower immutable image layers.</p>
<figure class="figure " style="max-width: 450px; margin: 1.5rem auto;">
  <a href="/images/overlay-layers-2.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/overlay-layers-2.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<p>This is one messy diagram but it demonstrates the point. The topmost layer is the CoW read/write layer and all layers below are read-only layers. I mentioned earlier that this is a temporary lived read/write layer. What happens if we stop and start the container? What happens if we remove the container?</p>
<p>Try it yourself. Hint: The file you created within the container survives a container restart.</p>
<p>Oh, BTW, you can use a tool called <a href="https://github.com/wagoodman/dive">dive</a> to look into the container images. While that is a great time saver, it is not as much fun as exploring the images manually &ndash; the hard way.</p>
<p>This is one long article but I had fun refining the notes I made to write this. This article showed how images are managed by the storage driver. You may have read elsewhere that container images can be used with any container engine. How is that made possible? Let us review that in the next article around Open Container Initiative (OCI) and the OCI image specification.</p>

    </div>

    
    
      <div class="mb-8">
        <h3 class="text-sm font-semibold text-gray-600 dark:text-dark-text-secondary mb-3">Tags:</h3>
        <div class="flex flex-wrap gap-2">
          
            <a href="/tags/oci/" class="inline-block px-3 py-1 text-sm bg-gray-100 dark:bg-dark-bg-tertiary text-gray-700 dark:text-dark-text rounded hover:bg-gray-200 dark:hover:bg-dark-border transition-colors no-underline">
              #oci
            </a>
          
            <a href="/tags/containers/" class="inline-block px-3 py-1 text-sm bg-gray-100 dark:bg-dark-bg-tertiary text-gray-700 dark:text-dark-text rounded hover:bg-gray-200 dark:hover:bg-dark-border transition-colors no-underline">
              #containers
            </a>
          
        </div>
      </div>
    

    
    

<div class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-lg font-bold mb-4 text-center text-gray-900 dark:text-dark-text">Share this article</h3>
  <div class="flex flex-wrap justify-center items-center gap-3 sm:gap-4">
    
    <button
      onclick="shareNative()"
      class="sm:hidden w-12 h-12 rounded-full bg-primary hover:bg-primary/90 dark:bg-blue-600 dark:hover:bg-blue-700 text-white flex items-center justify-center transition-colors shadow-md hover:shadow-lg"
      aria-label="Share"
      title="Share"
      id="native-share-btn"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
      </svg>
    </button>

    
    <a
      href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fravichaganti.com%2Fblog%2F2022-10-18-understanding-container-images-the-fundamentals%2F&text=Understanding&#43;container&#43;images&#43;-&#43;The&#43;fundamentals"
      target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-[#1DA1F2] hover:bg-[#1a8cd8] text-white flex items-center justify-center transition-all no-underline shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Share on Twitter"
      title="Share on Twitter"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
      </svg>
    </a>

    
    <a
      href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fravichaganti.com%2Fblog%2F2022-10-18-understanding-container-images-the-fundamentals%2F"
      target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-[#0077B5] hover:bg-[#006399] text-white flex items-center justify-center transition-all no-underline shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Share on LinkedIn"
      title="Share on LinkedIn"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
      </svg>
    </a>

    
    <a
      href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fravichaganti.com%2Fblog%2F2022-10-18-understanding-container-images-the-fundamentals%2F"
      target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-[#1877F2] hover:bg-[#1564d3] text-white flex items-center justify-center transition-all no-underline shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Share on Facebook"
      title="Share on Facebook"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </svg>
    </a>

    
    <button
      onclick="copyToClipboard('https:\/\/ravichaganti.com\/blog\/2022-10-18-understanding-container-images-the-fundamentals\/')"
      class="w-12 h-12 rounded-full bg-accent hover:bg-amber-600 dark:bg-amber-500 dark:hover:bg-amber-600 text-white flex items-center justify-center transition-all shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Copy link"
      title="Copy link"
      id="copy-link-btn"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
      </svg>
    </button>
  </div>
</div>

<script>

function shareNative() {
  if (navigator.share) {
    navigator.share({
      title: 'Understanding container images - The fundamentals',
      text: 'Containers have been around for a while. There is no need for an introduction to containers anymore but If you are still looking for some background, you can read a series of articles I have written â€¦',
      url: 'https:\/\/ravichaganti.com\/blog\/2022-10-18-understanding-container-images-the-fundamentals\/'
    }).catch(function(error) {
      console.log('Error sharing:', error);
    });
  }
}


function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(function() {
    const btn = document.getElementById('copy-link-btn');
    const originalHTML = btn.innerHTML;
    const originalTitle = btn.title;

    
    btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
    btn.title = 'Copied!';

    
    setTimeout(function() {
      btn.innerHTML = originalHTML;
      btn.title = originalTitle;
    }, 2000);
  }).catch(function(error) {
    console.error('Failed to copy:', error);
    alert('Failed to copy link. Please copy manually: ' + text);
  });
}
</script>



    
    
<nav class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border" aria-label="Post navigation">
  
  
  
  

  
  
  
    
    
    

    
    
    

    
    
    
      
        
      
    
      
    
      
    

    
    
      
      
        
        
      
    
  

  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    
    <div class="flex">
      
        
        <div class="flex-1 card bg-gray-50 dark:bg-dark-bg-tertiary opacity-50 cursor-not-allowed">
          <div class="flex items-start gap-3">
            <div class="flex-shrink-0 text-gray-400 dark:text-dark-text-muted mt-1">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </div>
            <div class="flex-1">
              <p class="text-xs text-gray-400 dark:text-dark-text-muted mb-1 uppercase tracking-wide">No Previous Article</p>
              <p class="text-sm text-gray-400 dark:text-dark-text-muted">This is the first post</p>
            </div>
          </div>
        </div>
      
    </div>

    
    <div class="flex">
      
        <a href="https://ravichaganti.com/blog/2022-10-28-understanding-container-images-oci-image-specification/"
           class="flex-1 group card hover:shadow-xl transition-all hover:scale-[1.02] no-underline"
           aria-label="Next in Container images: Understanding container images - OCI image specification">
          <div class="flex items-start gap-3">
            
            <div class="flex-1 min-w-0 text-right md:text-left md:order-1">
              <p class="text-xs text-gray-500 dark:text-dark-text-muted mb-1 uppercase tracking-wide">Next in Container images</p>
              <h3 class="text-base font-bold text-gray-900 dark:text-dark-text mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                Understanding container images - OCI image specification
              </h3>
              
            </div>

            
            <div class="flex-shrink-0 text-primary dark:text-blue-400 group-hover:text-secondary dark:group-hover:text-purple-400 transition-colors mt-1 md:order-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
          </div>
        </a>
      
    </div>
  </div>
</nav>


    
    

    
    

    
    
  </div>

  
  <script src="/js/collapse.js"></script>
  <script src="/js/code-copy.js"></script>
</article>

  </main>

  <footer class="bg-gray-900 dark:bg-dark-bg text-gray-300 dark:text-dark-text-secondary mt-16">
  <div class="container mx-auto px-4 py-8">
    <div class="text-center text-sm">
      <p>&copy; 2026 Ravikanth Chaganti. All rights reserved.</p>
    </div>
  </div>
</footer>


  
  <button id="back-to-top"
          class="fixed bottom-8 right-8 w-12 h-12 bg-primary text-white rounded-full shadow-lg hover:bg-blue-700 transition-all opacity-0 pointer-events-none z-40"
          aria-label="Back to top"
          title="Back to top">
    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
    </svg>
  </button>

  
  

  
  <script>
    
    
    
  </script>

  
  
    <script src="/js/reading-progress.js"></script>
  

  
  <script src="/js/back-to-top.js"></script>

  
  <script src="/js/theme-toggle.js"></script>
</body>
</html>
