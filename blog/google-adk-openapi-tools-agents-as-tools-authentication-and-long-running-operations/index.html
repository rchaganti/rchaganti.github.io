<!DOCTYPE html>
<html lang="en-us">
<head>
  
  <script>
    (function() {
      const stored = localStorage.getItem('theme-preference');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = stored || (prefersDark ? 'dark' : 'light');

      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations | Ravikanth Chaganti</title>

  
  <meta name="description" content="Imagine this scenario. Your company has dozens of internal REST APIs, each with an OpenAPI specification already published. You need an agent that can query the inventory service, place orders through the fulfillment API, and check shipment tracking, all without writing individual tool functions for every single endpoint. Now layer on some more complexity. Some of those APIs require OAuth2 tokens. One task, say generating a compliance report, takes ten minutes to complete. And you want a coordinator agent that can delegate research tasks to a specialized sub-agent without losing control of the conversation.">
  <meta name="author" content="Ravikanth Chaganti">

  
  
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  

  
  <meta property="og:title" content="Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations">
  <meta property="og:description" content="Imagine this scenario. Your company has dozens of internal REST APIs, each with an OpenAPI specification already published. You need an agent that can query the inventory service, place orders through the fulfillment API, and check shipment tracking, all without writing individual tool functions for every single endpoint. Now layer on some more complexity. Some of those APIs require OAuth2 tokens. One task, say generating a compliance report, takes ten minutes to complete. And you want a coordinator agent that can delegate research tasks to a specialized sub-agent without losing control of the conversation.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://ravichaganti.com/blog/google-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations/">
  <meta property="og:site_name" content="Ravikanth Chaganti">
  <meta property="og:locale" content="en_US">
  
  <meta property="og:image" content="https://ravichaganti.com/images/adk.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations">

  
  
    <meta property="article:published_time" content="2025-12-23T00:00:00Z">
    <meta property="article:modified_time" content="2025-12-23T00:00:00Z">
    <meta property="article:author" content="Ravikanth Chaganti">
    <meta property="article:section" content="Google">
    
  

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations">
  <meta name="twitter:description" content="Imagine this scenario. Your company has dozens of internal REST APIs, each with an OpenAPI specification already published. You need an agent that can query the inventory service, place orders through the fulfillment API, and check shipment tracking, all without writing individual tool functions for every single endpoint. Now layer on some more complexity. Some of those APIs require OAuth2 tokens. One task, say generating a compliance report, takes ten minutes to complete. And you want a coordinator agent that can delegate research tasks to a specialized sub-agent without losing control of the conversation.">
  <meta name="twitter:image" content="https://ravichaganti.com/images/adk.png">
  <meta name="twitter:site" content="@ravikanth">

  
  <link rel="canonical" href="https://ravichaganti.com/blog/google-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations/">

  
  <link rel="alternate" type="application/rss+xml" href="https://ravichaganti.com/index.xml">

  
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate icon" type="image/x-icon" href="/favicon.ico">

  
  <link rel="stylesheet" href="/css/main.css">

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  
  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations",
  "description": "Imagine this scenario. Your company has dozens of internal REST APIs, each with an OpenAPI specification already published. You need an agent that can query the inventory service, place orders through …",
  "articleBody": "\"Imagine this scenario. Your company has dozens of internal REST APIs, each with an OpenAPI specification already published. You need an agent that can query the inventory service, place orders through the fulfillment API, and check shipment tracking, all without writing individual tool functions for every single endpoint. Now layer on some more complexity. Some of those APIs require OAuth2 tokens. One task, say generating a compliance report, takes ten minutes to complete. And you want a coordinator agent that can delegate research tasks to a specialized sub-agent without losing control of the conversation.\\nThese four problems, connecting to REST APIs at scale, composing agents hierarchically, authenticating with protected services, and handling slow operations gracefully, are exactly what this article covers. Each is a distinct Google ADK capability, but together they form the toolkit you need to build production-grade agents that interact with the real world.\\nLet us start with OpenAPI tools.\\nOpenAPI tools When your organization already has REST APIs documented with OpenAPI specifications, writing individual FunctionTool wrappers for each endpoint is tedious and error-prone. The OpenAPIToolset class solves this by reading an OpenAPI v3.x specification and automatically generating callable tools for every operation it discovers. You hand ADK a spec file, and it returns a set of tools your agent can use immediately.\\nThe two key classes The OpenAPI integration revolves around two classes working together.\\nOpenAPIToolset is the entry point. You initialize it with your OpenAPI specification, provided as a JSON string, a YAML string, or a Python dictionary, and it handles parsing, reference resolution, and tool generation. Think of it as the factory that reads the blueprint and produces the individual tools.\\nRestApiTool is what the factory produces. Each API operation defined in your spec (every GET, POST, PUT, DELETE path) becomes one RestApiTool instance. This tool can construct the correct HTTP request, fill in path parameters, attach query strings and headers, serialize the request body, and return the response, all based on the information in the spec.\\nHow the toolset generates tools When you create an OpenAPIToolset, several things happen internally:\\nThe spec is parsed, and all internal $ref references are resolved to produce a complete API description. Every valid operation within the paths section is identified. For each operation, a RestApiTool is created with a name derived from the operationId field (converted to snake_case, capped at 60 characters). If no operationId exists, the name is generated from the HTTP method and path. The tool\\u0026rsquo;s description is pulled from the summary or description field in the spec, which helps the LLM understand when to use it. Each RestApiTool dynamically creates a FunctionDeclaration that maps the operation\\u0026rsquo;s parameters and request body into arguments the LLM can provide. Basic usage Here is how you would connect an agent to a task management API using its OpenAPI spec.\\nThis example uses a mock OpenAPI server created in Python using FastAPI. The code for this server is at A mock OpenAPI server\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 from google.adk.tools.openapi_tool.openapi_spec_parser.openapi_toolset import OpenAPIToolset from google.adk.agents import LlmAgent import asyncio import requests from google.adk.runners import Runner from google.adk.sessions import InMemorySessionService from google.genai import types # Fetch the spec from the running server response = requests.get(\\u0026#34;http://localhost:3000/openapi.json\\u0026#34;) response.raise_for_status() spec_content = response.text # Create the toolset task_toolset = OpenAPIToolset( spec_str=spec_content, spec_str_type=\\u0026#34;json\\u0026#34; ) # Build the agent with the generated tools task_agent = LlmAgent( name=\\u0026#34;TaskManager\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, instruction=\\u0026#34;\\u0026#34;\\u0026#34;You manage tasks through the Task API. You can list tasks, create new ones, update their status, and delete completed ones. Always confirm with the user before deleting a task.\\u0026#34;\\u0026#34;\\u0026#34;, tools=[task_toolset] ) The task_toolset automatically generates tools like list_tasks, create_task, update_task, and delete_task based on the operations defined in the spec. The agent can call any of them as needed.\\nYou can also provide the spec as a YAML string or a Python dictionary. When using YAML, set spec_str_type=\\u0026quot;yaml\\u0026quot;. When passing a dictionary, use the spec_dict parameter instead of spec_str.\\n1 2 3 4 5 6 7 8 9 10 # From YAML toolset_from_yaml = OpenAPIToolset( spec_str=yaml_string, spec_str_type=\\u0026#34;yaml\\u0026#34; ) # From a dictionary toolset_from_dict = OpenAPIToolset( spec_dict=spec_dictionary ) Let us add the execution logic to interact with this agent.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 async def main(): session_service = InMemorySessionService() runner = Runner( agent=root_agent, app_name=\\u0026#34;task_app\\u0026#34;, session_service=session_service ) session = await session_service.create_session( app_name=\\u0026#34;task_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34; ) msg = types.Content( parts=[types.Part(text=\\u0026#34;list all tasks in progress.\\u0026#34;)], role=\\u0026#34;user\\u0026#34; ) async for event in runner.run_async( user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id, new_message=msg ): if event.get_function_calls(): call = event.get_function_calls()[0] print(f\\u0026#34;Tool called: {call.name} with args: {call.args}\\u0026#34;) if event.is_final_response() and event.content and event.content.parts: print(f\\u0026#34;Agent: {event.content.parts[0].text}\\u0026#34;) if __name__ == \\u0026#34;__main__\\u0026#34;: asyncio.run(main()) When you run this, you will see the agent calling the list_tasks_api_tasks_get tool with the argument {'status': 'in-progress'}.\\n1 2 3 4 5 \\u0026gt; python.exe .\\\\openapi\\\\agent.py Tool called: list_tasks_api_tasks_get with args: {\\u0026#39;status\\u0026#39;: \\u0026#39;in-progress\\u0026#39;} Agent: Here are all the tasks in progress: Review pull request, Deploy to staging, and upload new podcast. Working with individual RestApiTool instances Sometimes you need finer control over specific tools. You can retrieve individual tools by name using get_tool() or get all of them with get_tools().\\n1 2 3 4 5 6 7 8 9 10 11 # Get a specific tool get_task_tool = task_toolset.get_tool(\\u0026#34;list_tasks_api_tasks_get\\u0026#34;) # Get all tools as a list all_tools = task_toolset.get_tools() # Add custom headers to a specific tool get_task_tool.set_default_headers({ \\u0026#34;X-Request-Source\\u0026#34;: \\u0026#34;adk-agent\\u0026#34;, \\u0026#34;X-Trace-Id\\u0026#34;: \\u0026#34;abc123\\u0026#34; }) This is particularly useful when you want to apply tool-specific configurations, such as custom headers or different authentication credentials, to individual endpoints.\\nAgents-as-tools (AgentTool) In the MCP tools article, we saw how to extend an agent\\u0026rsquo;s capabilities by connecting it to external tool servers. But what if the capability you need is not a simple function but an entire reasoning process that, in turn, requires an LLM? What if you need a \\u0026ldquo;research agent\\u0026rdquo; that can search, synthesize, and summarize information, and you want a parent agent to be able to call this research agent the same way it would call any other tool?\\nThis is where AgentTool comes in. It wraps an entire agent, with its own instruction, model, and tools, and exposes it as a callable tool for a parent agent. The parent agent sends a request to the wrapped agent, which processes it using its own LLM and tools, and the result flows back to the parent as a standard tool response.\\nHow AgentTool differs from sub-agent transfer ADK provides two ways for agents to work together, and understanding the difference is critical for designing the right architecture.\\nWith sub-agent transfer (using sub_agents), the parent agent hands off control of the conversation entirely. The sub-agent takes over, directly responds to the user, and handles all follow-up questions. The parent steps out of the loop. This is like a customer service representative transferring your call to a specialist. You are now speaking with the specialist, not the original representative.\\nWith AgentTool, the parent agent remains in control. It formulates a specific question, sends it to the tool agent, receives the result, and then decides what to do next, including how to present the answer to the user. The tool agent never talks to the user directly. This is like a manager asking a team member to research something and report back. The manager still owns the conversation with the client.\\nHere is a summary of the key differences:\\nAspect Sub-Agent Transfer AgentTool Who talks to the user The sub-agent The parent agent Who handles follow-ups The sub-agent The parent agent Does control return? No Yes What is sent to the child Full conversation history A summarized question from the parent Typical LLM calls 2 (parent decides + sub answers) 3+ (parent + child + parent again) Session context Shared Separate (encapsulated) Using AgentTool To use an agent as a tool, wrap it with the AgentTool class and add it to the parent agent\\u0026rsquo;s tools list.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 from google.adk.agents import LlmAgent from google.adk.tools.agent_tool import AgentTool # Define a specialist agent code_reviewer = LlmAgent( name=\\u0026#34;CodeReviewer\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, description=\\u0026#34;Reviews code snippets for bugs, style issues, and security vulnerabilities.\\u0026#34;, instruction=\\u0026#34;\\u0026#34;\\u0026#34;You are an expert code reviewer. When given code, analyze it for: 1. Logical bugs and edge cases 2. Style and readability issues 3. Security vulnerabilities Provide a structured review with severity ratings.\\u0026#34;\\u0026#34;\\u0026#34; ) # Define the parent agent that uses the specialist as a tool dev_assistant = LlmAgent( name=\\u0026#34;DevAssistant\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, instruction=\\u0026#34;\\u0026#34;\\u0026#34;You are a software development assistant. When a user shares code and wants a review, use the CodeReviewer tool to analyze it. Then present the findings to the user in a friendly, actionable format. For general coding questions, answer directly without using the tool.\\u0026#34;\\u0026#34;\\u0026#34;, tools=[AgentTool(agent=code_reviewer)] ) When the user asks the DevAssistant to review code, the LLM invokes the CodeReviewer tool. ADK runs the CodeReviewer agent in its own execution context, collects its response, and returns it to the DevAssistant as a tool result. The DevAssistant then summarizes and presents the findings to the user.\\nThe skip_summarization option By default, when the tool agent returns its result, the parent agent\\u0026rsquo;s LLM makes an additional call to summarize or interpret that result before presenting it to the user. This is useful when the tool agent\\u0026rsquo;s output is verbose or technical and needs to be adapted for the user.\\nHowever, if the tool agent already produces clean, user-ready output, this extra LLM call is wasteful. Setting skip_summarization=True tells ADK to bypass the summarization step and pass the tool agent\\u0026rsquo;s output directly to the parent.\\n1 2 3 4 5 # Skip summarization when the tool agent\\u0026#39;s output is already well-formatted formatted_reporter = AgentTool( agent=code_reviewer, skip_summarization=True ) Building a hierarchical agent system AgentTool really shines when you build multi-level hierarchies. Consider a research coordinator who delegates to specialized agents.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 from google.adk.agents import LlmAgent from google.adk.tools.agent_tool import AgentTool # Level 1: Specialist agents with their own tools web_researcher = LlmAgent( name=\\u0026#34;WebResearcher\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, description=\\u0026#34;Searches the web for current information on a topic.\\u0026#34;, instruction=\\u0026#34;Search for the requested information and return factual findings with sources.\\u0026#34; ) data_analyst = LlmAgent( name=\\u0026#34;DataAnalyst\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, description=\\u0026#34;Analyzes numerical data and produces statistical summaries.\\u0026#34;, instruction=\\u0026#34;Analyze the provided data. Return key metrics, trends, and anomalies.\\u0026#34; ) # Level 2: Coordinator that uses specialists as tools research_coordinator = LlmAgent( name=\\u0026#34;ResearchCoordinator\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, description=\\u0026#34;Coordinates research tasks by delegating to specialists.\\u0026#34;, instruction=\\u0026#34;\\u0026#34;\\u0026#34;You coordinate research efforts. For questions requiring current information, use the WebResearcher tool. For questions requiring data analysis, use the DataAnalyst tool. Synthesize results from multiple tools when needed.\\u0026#34;\\u0026#34;\\u0026#34;, tools=[ AgentTool(agent=web_researcher), AgentTool(agent=data_analyst) ] ) # Level 3: Top-level agent that delegates entire research projects project_manager = LlmAgent( name=\\u0026#34;ProjectManager\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, instruction=\\u0026#34;\\u0026#34;\\u0026#34;You manage projects and write reports. When you need research done on any topic, use the ResearchCoordinator tool. Focus on synthesizing the research into clear, actionable recommendations.\\u0026#34;\\u0026#34;\\u0026#34;, tools=[AgentTool(agent=research_coordinator)] ) The user interacts with the ProjectManager. When it needs research, it calls the ResearchCoordinator as a tool, which in turn calls WebResearcher or DataAnalyst as tools. Results flow back up the hierarchy, with each level adding its own interpretation and context.\\nAuthenticated tools Many real-world APIs require authentication. Your agent might need to read a user\\u0026rsquo;s calendar events (requiring OAuth2 consent), query an internal service protected by API keys, or access enterprise resources behind OpenID Connect. ADK provides a comprehensive authentication system that integrates with OpenAPIToolset, RestApiTool, and custom FunctionTool implementations.\\nAuthentication building blocks ADK\\u0026rsquo;s auth system is built on two core concepts.\\nAuthScheme defines how an API expects credentials. Is it an API key in a header? An OAuth2 bearer token? A service account? ADK supports the same authentication schemes as OpenAPI 3.0: APIKey, HTTPBearer, OAuth2, and OpenIdConnectWithConfig.\\nAuthCredential stores the initial information needed to start the authentication process. This includes your application\\u0026rsquo;s OAuth client ID and secret, an API key, or a service account JSON key. It also includes an auth_type field that specifies the credential type.\\nThe supported credential types are:\\nType When to use API_KEY Simple key-based auth, no exchange needed HTTP Pre-obtained bearer tokens OAUTH2 Standard OAuth2 flows requiring user consent OPEN_ID_CONNECT Enterprise OIDC providers like Okta or Auth0 SERVICE_ACCOUNT Google Cloud service accounts for server-to-server auth API key authentication The simplest form of authentication is an API key. You can use the token_to_scheme_credential helper to create the required objects.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 from google.adk.tools.openapi_tool.auth.auth_helpers import token_to_scheme_credential from google.adk.tools.openapi_tool.openapi_spec_parser.openapi_toolset import OpenAPIToolset # Create auth objects for an API key passed as a query parameter auth_scheme, auth_credential = token_to_scheme_credential( \\u0026#34;apikey\\u0026#34;, # scheme type \\u0026#34;query\\u0026#34;, # where to send it (query, header, cookie) \\u0026#34;api_key\\u0026#34;, # parameter name \\u0026#34;sk-abc123\\u0026#34; # the actual key value ) analytics_toolset = OpenAPIToolset( spec_str=analytics_api_spec, spec_str_type=\\u0026#34;json\\u0026#34;, auth_scheme=auth_scheme, auth_credential=auth_credential ) The auth_scheme and auth_credential are applied to every RestApiTool generated by the toolset. Each HTTP request made by these tools will automatically include the API key.\\nOAuth2 authentication OAuth2 is more complex because it requires user interaction. The user must log in and grant your application permission to access their data. ADK handles this through an interactive flow involving your agent and the client application.\\nHere is how you configure an OpenAPIToolset for OAuth2.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 from google.adk.tools.openapi_tool.openapi_spec_parser.openapi_toolset import OpenAPIToolset from google.adk.auth import AuthCredential, AuthCredentialTypes, OAuth2Auth from fastapi.openapi.models import OAuth2, OAuthFlows, OAuthFlowAuthorizationCode auth_scheme = OAuth2( flows=OAuthFlows( authorizationCode=OAuthFlowAuthorizationCode( authorizationUrl=\\u0026#34;https://accounts.google.com/o/oauth2/auth\\u0026#34;, tokenUrl=\\u0026#34;https://oauth2.googleapis.com/token\\u0026#34;, scopes={ \\u0026#34;https://www.googleapis.com/auth/calendar.readonly\\u0026#34;: \\u0026#34;Read calendar events\\u0026#34; }, ) ) ) auth_credential = AuthCredential( auth_type=AuthCredentialTypes.OAUTH2, oauth2=OAuth2Auth( client_id=\\u0026#34;YOUR_CLIENT_ID\\u0026#34;, client_secret=\\u0026#34;YOUR_CLIENT_SECRET\\u0026#34; ) ) calendar_toolset = OpenAPIToolset( spec_str=calendar_api_spec, spec_str_type=\\u0026#34;yaml\\u0026#34;, auth_scheme=auth_scheme, auth_credential=auth_credential ) The interactive OAuth2 flow When an agent attempts to use an OAuth2-protected tool and no valid token is available, ADK triggers an interactive authentication flow. Here is what happens step by step.\\nStep 1: The agent yields an auth request. Instead of a normal tool response, the runner emits a special event containing a function call named adk_request_credential. Your client application must detect this event.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 events = runner.run_async( session_id=session.id, user_id=\\u0026#34;user1\\u0026#34;, new_message=user_query ) auth_function_call_id = None auth_config = None async for event in events: if event.content and event.content.parts: for part in event.content.parts: if (part.function_call and part.function_call.name == \\u0026#34;adk_request_credential\\u0026#34; and event.long_running_tool_ids and part.function_call.id in event.long_running_tool_ids): auth_function_call_id = part.function_call.id auth_config = AuthConfig.model_validate( part.function_call.args.get(\\u0026#34;auth_config\\u0026#34;) ) break Step 2: Redirect the user to the authorization URL. Extract the auth_uri from the auth_config and append your application\\u0026rsquo;s redirect_uri.\\n1 2 3 4 5 6 7 base_auth_uri = auth_config.exchanged_auth_credential.oauth2.auth_uri redirect_uri = \\u0026#34;http://localhost:8000/callback\\u0026#34; full_auth_url = f\\u0026#34;{base_auth_uri}\\u0026amp;redirect_uri={redirect_uri}\\u0026#34; # In a web app: redirect the user to full_auth_url # In a CLI: print the URL and ask the user to visit it print(f\\u0026#34;Please visit: {full_auth_url}\\u0026#34;) Step 3: Capture the callback. After the user logs in and grants permission, the OAuth provider redirects them to your redirect_uri with an authorization code in the URL. Your application captures this full callback URL.\\nStep 4: Send the auth response back to ADK. Update the auth_config with the callback URL and send it back to the runner as a FunctionResponse.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 # Update auth_config with the callback details auth_config.exchanged_auth_credential.oauth2.auth_response_uri = callback_url auth_config.exchanged_auth_credential.oauth2.redirect_uri = redirect_uri # Build the response message auth_response = types.Content( role=\\u0026#34;user\\u0026#34;, parts=[ types.Part( function_response=types.FunctionResponse( id=auth_function_call_id, name=\\u0026#34;adk_request_credential\\u0026#34;, response=auth_config.model_dump() ) ) ] ) # Resume the agent with the auth response async for event in runner.run_async( session_id=session.id, user_id=\\u0026#34;user1\\u0026#34;, new_message=auth_response ): if event.is_final_response() and event.content: print(event.content.parts[0].text) Step 5: ADK completes the flow. ADK exchanges the authorization code for tokens, stores them, and retries the original tool call, this time with a valid access token. The agent gets the real API response and generates its final answer.\\nBuilding custom authenticated tools When building your own FunctionTool that requires OAuth2, implement the authentication logic within the tool function using ToolContext. The pattern follows three phases: check for cached credentials, check for an auth response from a previous redirect, or initiate a new auth request.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 from google.adk.tools import FunctionTool, ToolContext from google.adk.auth import AuthConfig, AuthCredential, AuthCredentialTypes, OAuth2Auth from google.adk.auth.auth_schemes import OpenIdConnectWithConfig # Define the auth configuration auth_scheme = OpenIdConnectWithConfig( authorization_endpoint=\\u0026#34;https://your-idp.com/authorize\\u0026#34;, token_endpoint=\\u0026#34;https://your-idp.com/token\\u0026#34;, scopes=[\\u0026#34;openid\\u0026#34;, \\u0026#34;profile\\u0026#34;, \\u0026#34;email\\u0026#34;], ) auth_credential = AuthCredential( auth_type=AuthCredentialTypes.OPEN_ID_CONNECT, oauth2=OAuth2Auth( client_id=\\u0026#34;YOUR_CLIENT_ID\\u0026#34;, client_secret=\\u0026#34;YOUR_CLIENT_SECRET\\u0026#34;, ), ) def fetch_user_profile(tool_context: ToolContext) -\\u0026gt; dict: \\u0026#34;\\u0026#34;\\u0026#34;Fetches the authenticated user\\u0026#39;s profile from the identity provider.\\u0026#34;\\u0026#34;\\u0026#34; # Phase 1: Check for cached credentials cached_token = tool_context.state.get(\\u0026#34;user_profile_token\\u0026#34;) if cached_token: # Use cached token to make API call return call_profile_api(cached_token) # Phase 2: Check if the client just completed the OAuth flow exchanged = tool_context.get_auth_response( AuthConfig( auth_scheme=auth_scheme, raw_auth_credential=auth_credential, ) ) if exchanged: # ADK already exchanged the code for tokens access_token = exchanged.oauth2.access_token # Cache the token for future calls tool_context.state[\\u0026#34;user_profile_token\\u0026#34;] = access_token return call_profile_api(access_token) # Phase 3: No credentials at all — initiate the auth flow tool_context.request_credential( AuthConfig( auth_scheme=auth_scheme, raw_auth_credential=auth_credential, ) ) return {\\u0026#34;status\\u0026#34;: \\u0026#34;pending\\u0026#34;, \\u0026#34;message\\u0026#34;: \\u0026#34;Waiting for user to authenticate.\\u0026#34;} my_auth_tool = FunctionTool(func=fetch_user_profile) The three-phase pattern ensures your tool works correctly regardless of where it is in the authentication lifecycle. On the first call, the flow begins. After the user authenticates, it receives the tokens. On subsequent calls within the same session, it reuses the cached token.\\nSecurity considerations for token storage Storing tokens in session state works well for InMemorySessionService during development, since the data is transient. For persistent session backends in production, consider encrypting token data before storing it. For the most sensitive environments, use a dedicated secret manager, such as Google Cloud Secret Manager, to store refresh tokens, and store only short-lived access tokens in session state.\\nLong-running function tools Standard tool functions are synchronous: the agent calls the function, the function executes, and the result comes back in the same event loop iteration. But what about operations that take minutes or hours? Generating a compliance report, processing a large dataset, or waiting for a human to approve a request. None of these can block the agent\\u0026rsquo;s event loop.\\nLongRunningFunctionTool addresses this by splitting a tool invocation into two phases: initiation and completion. The tool function starts the operation and returns an initial status. ADK pauses the agent run. The client application monitors the external process and, when it receives an update, sends the result back to the agent. The agent then resumes with the new information.\\nHow it differs from regular tools With a regular FunctionTool, the sequence is: agent calls → function executes → result returns → agent continues. The entire cycle happens within a single agent run.\\nWith a LongRunningFunctionTool, the sequence is:\\nFirst agent run: Agent calls the tool → function starts the operation and returns an initial status (like a ticket ID or \\u0026ldquo;pending\\u0026rdquo;) → ADK pauses the run. Client waits: The client application monitors the external operation outside the agent runtime. Second agent run: Client sends the final (or intermediate) result back → agent resumes and generates a response. This is fundamentally about decoupling starting a task from completing it.\\nCreating a long-running tool You define a regular Python function and wrap it with LongRunningFunctionTool instead of FunctionTool.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 from google.adk.agents import LlmAgent from google.adk.tools import LongRunningFunctionTool, FunctionTool def request_expense_approval( description: str, amount: float, category: str ) -\\u0026gt; dict: \\u0026#34;\\u0026#34;\\u0026#34;Submits an expense report for manager approval.\\u0026#34;\\u0026#34;\\u0026#34; ticket_id = create_approval_ticket(description, amount, category) return { \\u0026#34;status\\u0026#34;: \\u0026#34;pending_approval\\u0026#34;, \\u0026#34;ticket_id\\u0026#34;: ticket_id, \\u0026#34;message\\u0026#34;: f\\u0026#34;Expense report for ${amount:.2f} submitted. Awaiting manager review.\\u0026#34; } def check_policy_compliance( category: str, amount: float ) -\\u0026gt; dict: \\u0026#34;\\u0026#34;\\u0026#34;Checks if an expense is within company policy limits.\\u0026#34;\\u0026#34;\\u0026#34; limits = {\\u0026#34;travel\\u0026#34;: 5000, \\u0026#34;equipment\\u0026#34;: 2000, \\u0026#34;training\\u0026#34;: 1500} limit = limits.get(category, 500) return { \\u0026#34;compliant\\u0026#34;: amount \\u0026lt;= limit, \\u0026#34;limit\\u0026#34;: limit, \\u0026#34;category\\u0026#34;: category } expense_agent = LlmAgent( name=\\u0026#34;ExpenseAssistant\\u0026#34;, model=\\u0026#34;gemini-2.0-flash\\u0026#34;, instruction=\\u0026#34;\\u0026#34;\\u0026#34;You help employees submit expense reports. 1. First check if the expense is within policy using check_policy_compliance. 2. If compliant, submit it for approval using request_expense_approval. 3. Once the manager responds, inform the employee of the decision.\\u0026#34;\\u0026#34;\\u0026#34;, tools=[ FunctionTool(func=check_policy_compliance), LongRunningFunctionTool(func=request_expense_approval), ] ) The check_policy_compliance tool runs synchronously. It checks the policy and returns immediately. The request_expense_approval tool, wrapped in LongRunningFunctionTool, creates a ticket and returns a pending status. The agent pauses at this point.\\nHandling the client-side flow After the agent run pauses, the client application is responsible for monitoring the external process and sending results back. Here is the full client-side flow.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 import asyncio from google.adk.runners import Runner from google.adk.sessions import InMemorySessionService from google.genai import types async def run_expense_workflow(): session_service = InMemorySessionService() runner = Runner( agent=expense_agent, app_name=\\u0026#34;expense_app\\u0026#34;, session_service=session_service ) session = await session_service.create_session( app_name=\\u0026#34;expense_app\\u0026#34;, user_id=\\u0026#34;user1\\u0026#34; ) # Step 1: User submits an expense msg = types.Content( parts=[types.Part(text=\\u0026#34;I need to submit a $450 training expense for the Python conference.\\u0026#34;)], role=\\u0026#34;user\\u0026#34; ) pending_response = None async for event in runner.run_async( user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id, new_message=msg ): # Detect the long-running tool\\u0026#39;s pending response if event.long_running_tool_ids and event.content and event.content.parts: for part in event.content.parts: if (part.function_response and part.function_response.id in event.long_running_tool_ids): pending_response = part.function_response print(f\\u0026#34;Tool paused: {pending_response.response}\\u0026#34;) if event.is_final_response() and event.content and event.content.parts: print(f\\u0026#34;Agent: {event.content.parts[0].text}\\u0026#34;) if not pending_response: return # Step 2: Simulate waiting for manager approval print(\\u0026#34;Waiting for manager decision...\\u0026#34;) await asyncio.sleep(2) # In production, poll an external system # Step 3: Send the approval result back approval_result = pending_response.model_copy(deep=True) approval_result.response = { \\u0026#34;status\\u0026#34;: \\u0026#34;approved\\u0026#34;, \\u0026#34;approved_by\\u0026#34;: \\u0026#34;Manager Sarah\\u0026#34;, \\u0026#34;notes\\u0026#34;: \\u0026#34;Approved. Great initiative on continuing education.\\u0026#34; } async for event in runner.run_async( user_id=\\u0026#34;user1\\u0026#34;, session_id=session.id, new_message=types.Content( role=\\u0026#34;user\\u0026#34;, parts=[types.Part(function_response=approval_result)] ) ): if event.is_final_response() and event.content and event.content.parts: print(f\\u0026#34;Agent: {event.content.parts[0].text}\\u0026#34;) asyncio.run(run_expense_workflow()) When you run this, the flow looks like:\\n1 2 3 4 5 \\u0026gt; python.exe .\\\\expense-approval.py Tool paused: {\\u0026#39;status\\u0026#39;: \\u0026#39;pending_approval\\u0026#39;, \\u0026#39;ticket_id\\u0026#39;: \\u0026#39;EXP-001\\u0026#39;, \\u0026#39;message\\u0026#39;: \\u0026#39;Expense report for $450.00 submitted. Awaiting manager review.\\u0026#39;} Agent: Your expense report for $450 for the Python conference has been submitted for approval. I will let you know once your manager responds. Waiting for manager decision... Agent: Great news! Your expense report has been approved by Manager Sarah. She noted: \\u0026#34;Great initiative on continuing education.\\u0026#34; Sending intermediate progress updates You are not limited to a single final result. The client can send multiple intermediate updates to keep the user informed about progress.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 # Send a progress update (not the final result) progress = pending_response.model_copy(deep=True) progress.response = { \\u0026#34;status\\u0026#34;: \\u0026#34;in_progress\\u0026#34;, \\u0026#34;progress\\u0026#34;: \\u0026#34;75%\\u0026#34;, \\u0026#34;message\\u0026#34;: \\u0026#34;Manager has viewed the request, decision pending...\\u0026#34; } async for event in runner.run_async( session_id=session.id, user_id=\\u0026#34;user1\\u0026#34;, new_message=types.Content( role=\\u0026#34;user\\u0026#34;, parts=[types.Part(function_response=progress)], ), ): if event.is_final_response() and event.content and event.content.parts: print(f\\u0026#34;Agent: {event.content.parts[0].text}\\u0026#34;) Each intermediate update triggers a new agent run, in which the LLM generates a user-friendly status message based on the progress data.\\nHuman-in-the-loop patterns One of the most practical applications for LongRunningFunctionTool is human-in-the-loop workflows. The agent gathers information, prepares a request, and submits it. A human reviewer makes a decision outside the agent\\u0026rsquo;s runtime. The decision flows back, and the agent takes the next action.\\nThis pattern works for approval workflows, content review pipelines, quality assurance checkpoints, and any scenario where a human decision gate sits between agent actions. The key insight is that LongRunningFunctionTool does not perform the long-running work itself. It manages the handoff between the agent and the external process. The actual work happens elsewhere, and the tool is just the communication channel.\\nPutting it all together These four capabilities, OpenAPI tools, agents-as-tools, authentication, and long-running operations, rarely exist in isolation. A real-world agent might use OpenAPIToolset to integrate with a fleet of internal APIs, AgentTool to delegate specialized work to child agents, OAuth2 authentication to access user data on protected services, and LongRunningFunctionTool to handle approval workflows that depend on human reviewers.\\nThe key insight is that all of these are composable. You can authenticate an OpenAPIToolset with OAuth2 credentials. You can wrap an agent that uses authenticated tools inside an AgentTool. You can have a long-running tool inside a child agent that is itself wrapped as an AgentTool. ADK\\u0026rsquo;s tool system is designed so these patterns stack cleanly.\\nIn the next article in this series, we will look at how to integrate tools from third-party agent frameworks, LangChain and CrewAI adapters, to bring an even wider range of capabilities to your ADK agents.\\n\"",
  "url": "https:\/\/ravichaganti.com\/blog\/google-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations\/",
  "datePublished": "2025-12-23T00:00:00Z",
  "dateModified": "2025-12-23T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Ravikanth Chaganti"
    ,"sameAs": ["https://twitter.com/ravikanth"]
  },
  "publisher": {
    "@type": "Person",
    "name": "Ravikanth Chaganti",
    "sameAs": ["https://twitter.com/ravikanth"]
  },
  
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/ravichaganti.com\/images\/adk.png",
    "width": 1200,
    "height": 630
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/ravichaganti.com\/blog\/google-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations\/"
  },
  
  "articleSection": "\"Google\"",
  
  
  
  "timeRequired": "PT21M",
  
  "inLanguage": "en-US",
  "isAccessibleForFree": true
}
</script>




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https:\/\/ravichaganti.com\/"
    }
    ,
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https:\/\/ravichaganti.com\/blog/"
    }
    
    ,
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Google",
      "item": "https:\/\/ravichaganti.com\/categories/google/"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations",
      "item": "https:\/\/ravichaganti.com\/blog\/google-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations\/"
    }
    
    
  ]
}
</script>


</head>

<body class="flex flex-col min-h-screen bg-gray-50 dark:bg-dark-bg">
  <header class="sticky top-0 z-50 bg-white dark:bg-dark-bg-secondary shadow-md relative">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      
      <div class="flex items-center">
        <a href="https://ravichaganti.com/" class="flex items-center gap-3 text-gray-900 dark:text-dark-text hover:text-primary transition-colors no-underline group">
          
          <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
            <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2" class="group-hover:stroke-primary transition-colors"/>
            <text x="20" y="26" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="currentColor">RC</text>
          </svg>
          
          <div class="flex flex-col leading-tight">
            <span class="text-xs sm:text-sm font-semibold">Cloud Native</span>
            <span class="text-xs sm:text-sm font-semibold">Agentic AI</span>
            <span class="text-xs sm:text-sm font-semibold">Infrastructure</span>
          </div>
        </a>
      </div>

      
      <div class="hidden md:flex items-center space-x-8">
        
          <a href="/blog/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Blog
          </a>
        
          <a href="/books/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Books
          </a>
        
          <a href="https://learn.ravichaganti.com" target="_blank" rel="noopener noreferrer" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Courses
          </a>
        
          <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank" rel="noopener noreferrer" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Newsletter
          </a>
        
          <a href="/about/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            About
          </a>
        
      </div>

      
      <div class="hidden md:flex items-center space-x-4 relative" id="social-search-container">
        
        <div id="social-icons" class="flex items-center space-x-3">
          

<a href="https://twitter.com/ravikanth" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Twitter">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
  </svg>
</a>



<a href="https://github.com/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="GitHub">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
  </svg>
</a>



<a href="https://linkedin.com/in/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="LinkedIn">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
  </svg>
</a>




        </div>

        
        <button
          id="theme-toggle"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="search-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <div id="search-box" class="hidden absolute top-full right-0 mt-2 w-80 bg-white dark:bg-dark-bg-secondary shadow-lg p-4 z-50 rounded-lg">
          





<div class="relative search-container" data-mode="desktop">
  <input
    type="text"
    id="search-input-desktop"
    placeholder="Search articles..."
    class="search-input w-full px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results-desktop" class="search-results absolute top-full mt-2 w-full bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-80 overflow-y-auto z-50">
    
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>


<script>
(function() {
  let headerFuse;
  let headerSearchData = [];
  let searchInitialized = false;

  
  fetch('/index.json')
    .then(response => response.json())
    .then(data => {
      headerSearchData = data;

      
      const options = {
        keys: [
          { name: 'title', weight: 3 },
          { name: 'excerpt', weight: 2 },
          { name: 'content', weight: 1 },
          { name: 'categories', weight: 1.5 },
          { name: 'series', weight: 1.5 }
        ],
        threshold: 0.4,
        includeScore: true,
        ignoreLocation: true,
        minMatchCharLength: 2
      };

      headerFuse = new Fuse(headerSearchData, options);
      searchInitialized = true;
    })
    .catch(error => console.error('Error loading search index:', error));

  
  function renderResults(results, resultsContainer) {
    if (results.length === 0) {
      resultsContainer.innerHTML = '<div class="p-4 text-center text-gray-500 dark:text-dark-text-secondary text-sm">No results found</div>';
      resultsContainer.classList.remove('hidden');
      return;
    }

    resultsContainer.innerHTML = results.slice(0, 5).map(result => {
      const item = result.item;
      const date = new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

      return `
        <a href="${item.permalink}" class="block p-3 hover:bg-gray-50 dark:hover:bg-dark-bg-tertiary border-b border-gray-100 dark:border-dark-border last:border-b-0 no-underline">
          <div class="font-medium text-sm text-gray-900 dark:text-dark-text mb-1">${item.title}</div>
          <div class="flex items-center gap-2 mb-1 flex-wrap">
            <span class="text-xs text-gray-500 dark:text-dark-text-secondary">${date}</span>
            ${item.categories ? item.categories.slice(0, 2).map(cat => `
              <span class="inline-block px-1.5 py-0.5 text-xs rounded bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400">
                ${cat}
              </span>
            `).join('') : ''}
          </div>
          ${item.excerpt ? `<p class="text-xs text-gray-600 dark:text-dark-text-secondary line-clamp-2">${item.excerpt}</p>` : ''}
        </a>
      `;
    }).join('');

    resultsContainer.classList.remove('hidden');
  }

  
  function initSearchContainers() {
    const containers = document.querySelectorAll('.search-container');

    containers.forEach(container => {
      const searchInput = container.querySelector('.search-input');
      const searchResults = container.querySelector('.search-results');

      if (!searchInput || !searchResults) return;

      
      searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();

        if (query.length < 2 || !searchInitialized) {
          searchResults.classList.add('hidden');
          return;
        }

        const results = headerFuse.search(query);
        renderResults(results, searchResults);
      });

      
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          searchResults.classList.add('hidden');
          searchInput.blur();
        }
      });
    });

    
    function closeAllResults(e) {
      const containers = document.querySelectorAll('.search-container');
      containers.forEach(container => {
        const searchResults = container.querySelector('.search-results');
        if (searchResults && !container.contains(e.target)) {
          searchResults.classList.add('hidden');
        }
      });
    }

    document.addEventListener('click', closeAllResults);
    document.addEventListener('touchend', closeAllResults);
  }

  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSearchContainers);
  } else {
    initSearchContainers();
  }
})();
</script>


        </div>
      </div>

      
      <div class="md:hidden flex items-center gap-2">
        
        <button id="search-toggle-mobile" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <button
          id="theme-toggle-mobile"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="mobile-menu-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded" aria-label="Menu">
          <svg class="w-6 h-6 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    
    <div id="search-box-mobile" class="hidden md:hidden absolute top-full left-0 right-0 bg-white dark:bg-dark-bg-secondary shadow-lg p-4 z-50">
      





<div class="relative search-container" data-mode="mobile">
  <input
    type="text"
    id="search-input-mobile"
    placeholder="Search articles..."
    class="search-input w-full px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results-mobile" class="search-results absolute top-full mt-2 w-full bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-80 overflow-y-auto z-50">
    
  </div>
</div>




    </div>

    
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4">
      
        <a href="/blog/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Blog
        </a>
      
        <a href="/books/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Books
        </a>
      
        <a href="https://learn.ravichaganti.com" target="_blank" rel="noopener noreferrer" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Courses
        </a>
      
        <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank" rel="noopener noreferrer" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Newsletter
        </a>
      
        <a href="/about/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          About
        </a>
      
    </div>
  </nav>

  
  
    <div id="reading-progress" class="absolute bottom-0 left-0 w-full h-1 bg-primary transition-all duration-200 z-10" style="width: 0%; max-width: 100%;"></div>
  
</header>


<script>
  document.getElementById('mobile-menu-toggle')?.addEventListener('click', function() {
    const menu = document.getElementById('mobile-menu');
    menu?.classList.toggle('hidden');
  });

  
  document.getElementById('search-toggle')?.addEventListener('click', function() {
    const searchBox = document.getElementById('search-box');
    searchBox?.classList.toggle('hidden');
    if (!searchBox?.classList.contains('hidden')) {
      searchBox?.querySelector('.search-input')?.focus();
    }
  });

  
  document.getElementById('search-toggle-mobile')?.addEventListener('click', function() {
    const searchBoxMobile = document.getElementById('search-box-mobile');
    searchBoxMobile?.classList.toggle('hidden');
    if (!searchBoxMobile?.classList.contains('hidden')) {
      searchBoxMobile?.querySelector('.search-input')?.focus();
    }
  });

  
  document.addEventListener('click', function(e) {
    const searchBox = document.getElementById('search-box');
    const searchToggle = document.getElementById('search-toggle');
    if (searchBox && searchToggle && !searchBox.contains(e.target) && !searchToggle.contains(e.target)) {
      searchBox.classList.add('hidden');
    }
  });

  
  document.addEventListener('click', function(e) {
    const searchBoxMobile = document.getElementById('search-box-mobile');
    const searchToggleMobile = document.getElementById('search-toggle-mobile');
    if (searchBoxMobile && searchToggleMobile && !searchBoxMobile.contains(e.target) && !searchToggleMobile.contains(e.target)) {
      searchBoxMobile.classList.add('hidden');
    }
  });
</script>


  <main class="flex-grow">
    
<article class="container mx-auto px-4 sm:px-6 md:px-4 py-8 sm:py-10 md:py-12">
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-[75%_25%] gap-8">
      
      <div class="min-w-0">
        
        <header class="mb-8">
          
          <nav class="text-xs sm:text-sm mb-4">
            <ol class="flex items-center space-x-2 text-gray-600 dark:text-dark-text-secondary">
              <li><a href="https://ravichaganti.com/" class="hover:text-primary dark:hover:text-blue-400">Home</a></li>
              <li><span class="mx-2">/</span></li>
              <li><a href="/blog/" class="hover:text-primary dark:hover:text-blue-400">Blog</a></li>
              
              <li><span class="mx-2">/</span></li>
              <li><a href="/categories/google/" class="hover:text-primary dark:hover:text-blue-400">Google</a></li>
              
            </ol>
          </nav>

          
          <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-dark-text mb-6">
            Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations
          </h1>

          
          <div
            class="flex flex-wrap items-center gap-2 sm:gap-3 md:gap-4 text-sm sm:text-base text-gray-600 dark:text-dark-text-secondary mb-6">
            
            <div class="flex items-center">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <time datetime=" 2025-12-23">December 23, 2025</time>
            </div>

            
            
            <span>•</span>
            <div class="flex items-center">
              <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
              <span>21 min read</span>
            </div>
            

            
            
          </div>

          
          <div class="flex flex-wrap gap-2 mb-6">
            
            
            <a href="/categories/google/"
              class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Google
            </a>
            
            <a href="/categories/agent-development-kit/"
              class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Agent Development Kit
            </a>
            
            <a href="/categories/agents/"
              class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Agents
            </a>
            
            
            
            
            <a href="/series/google-adk/"
              class="inline-block px-3 py-1 text-sm font-medium bg-secondary/10 dark:bg-secondary/20 text-secondary dark:text-purple-400 rounded-full hover:bg-secondary/20 dark:hover:bg-secondary/30 transition-colors no-underline">
              📚 Series: Google ADK
            </a>
            
            
          </div>

          
          
          <div
            class="text-base sm:text-lg md:text-xl text-gray-700 dark:text-dark-text-secondary italic border-l-4 border-primary dark:border-blue-400 pl-4 sm:pl-6 py-2 mb-6 sm:mb-8 bg-gray-50 dark:bg-dark-bg-tertiary rounded-r">
            Your agent needs to talk to the outside world. It needs to call REST APIs, delegate complex work to specialized agents, authenticate with protected services, and kick off operations that take minutes instead of milliseconds. Google ADK provides four powerful patterns to make all of this possible.
          </div>
          
        </header>

        
        


  
  
  
    <aside class="bg-gradient-to-br from-secondary/5 to-primary/5 dark:from-secondary/10 dark:to-primary/10 rounded-lg shadow-md dark:shadow-2xl dark:shadow-black/20 p-4 mb-6 border border-secondary/20 dark:border-secondary/30">
      
      <button
        class="flex items-center justify-between w-full text-left font-semibold text-base text-gray-900 dark:text-dark-text hover:text-secondary dark:hover:text-purple-400 transition-colors"
        aria-expanded="false"
        aria-controls="series-content"
      >
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          Series: Google ADK
        </span>
        <svg
          id="series-chevron"
          class="w-4 h-4 transform transition-transform -rotate-90"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      
      <p class="text-xs text-gray-600 dark:text-dark-text-secondary mt-2 mb-2 collapsed" id="series-description">
        Part of a 9-part series
      </p>

      
      <nav id="series-content" class="series-content collapsed mt-1">
        <ol class="space-y-3">
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                1
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/introduction-to-google-agent-development-kit/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Introduction to Google Agent Development Kit
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 1, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                2
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-types-of-agents/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - types of agents
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 3, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                3
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-sessions-state-and-memory/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - Sessions, state, and memory
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 5, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                4
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-callbacks/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - Callbacks
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 12, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                5
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-runner-and-execution-architecture/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - Runner and execution architecture
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 18, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                6
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Google ADK - MCP tools
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 20, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                7
              </span>
              <div class="flex-grow">
                
                  <span class="font-bold text-secondary dark:text-purple-400">
                    Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations
                    <span class="text-xs ml-2 px-2 py-0.5 bg-secondary dark:bg-purple-600 text-white rounded">You are here</span>
                  </span>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 23, 2025</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                8
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-a-multi-agent-linkedin-newsletter-system-with-google-adk/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building a Multi-Agent LinkedIn Newsletter System with Google ADK
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Jan 26, 2026</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                9
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-multi-agent-systems-with-google-adk-and-the-a2a-protocol/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building multi-agent systems with Google ADK and the A2A protocol
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Jan 27, 2026</p>
              </div>
            </li>
          
        </ol>

        
        <div class="mt-6 pt-6 border-t border-secondary/20 dark:border-secondary/30 grid grid-cols-2 gap-4">
          
          
            
          
            
          
            
          
            
          
            
          
            
          
            
              
            
          
            
          
            
          

          
          
            
            <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/" class="flex items-center text-sm text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline group">
              <svg class="w-4 h-4 mr-1 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              <span class="truncate">Google ADK - MCP tools</span>
            </a>
          

          
          
            
            <a href="https://ravichaganti.com/blog/building-a-multi-agent-linkedin-newsletter-system-with-google-adk/" class="flex items-center justify-end text-sm text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline group">
              <span class="truncate">Building a Multi-Agent LinkedIn Newsletter System with Google ADK</span>
              <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          
        </div>
      </nav>
    </aside>
  



        
        <div class="block lg:hidden mobile-toc-container">
          

  
    <div class="bg-white dark:bg-dark-bg-secondary rounded-lg shadow-md dark:shadow-2xl dark:shadow-black/20 p-4 mb-6 border border-gray-200 dark:border-dark-border">
      
      <button
        class="flex items-center justify-between w-full text-left font-semibold text-base text-gray-900 dark:text-dark-text hover:text-primary dark:hover:text-blue-400 transition-colors"
        aria-expanded="false"
        aria-controls="toc-content"
      >
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
          </svg>
          Table of Contents
        </span>
        <svg
          id="toc-chevron"
          class="w-4 h-4 transform transition-transform -rotate-90"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      
      <nav id="toc-content" class="toc-content collapsed text-sm mt-3">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#openapi-tools">OpenAPI tools</a>
      <ul>
        <li><a href="#the-two-key-classes">The two key classes</a></li>
        <li><a href="#how-the-toolset-generates-tools">How the toolset generates tools</a></li>
        <li><a href="#basic-usage">Basic usage</a></li>
        <li><a href="#working-with-individual-restapitool-instances">Working with individual RestApiTool instances</a></li>
      </ul>
    </li>
    <li><a href="#agents-as-tools-agenttool">Agents-as-tools (AgentTool)</a>
      <ul>
        <li><a href="#how-agenttool-differs-from-sub-agent-transfer">How AgentTool differs from sub-agent transfer</a></li>
        <li><a href="#using-agenttool">Using AgentTool</a></li>
        <li><a href="#the-skip_summarization-option">The skip_summarization option</a></li>
        <li><a href="#building-a-hierarchical-agent-system">Building a hierarchical agent system</a></li>
      </ul>
    </li>
    <li><a href="#authenticated-tools">Authenticated tools</a>
      <ul>
        <li><a href="#authentication-building-blocks">Authentication building blocks</a></li>
        <li><a href="#api-key-authentication">API key authentication</a></li>
        <li><a href="#oauth2-authentication">OAuth2 authentication</a></li>
        <li><a href="#the-interactive-oauth2-flow">The interactive OAuth2 flow</a></li>
        <li><a href="#building-custom-authenticated-tools">Building custom authenticated tools</a></li>
        <li><a href="#security-considerations-for-token-storage">Security considerations for token storage</a></li>
      </ul>
    </li>
    <li><a href="#long-running-function-tools">Long-running function tools</a>
      <ul>
        <li><a href="#how-it-differs-from-regular-tools">How it differs from regular tools</a></li>
        <li><a href="#creating-a-long-running-tool">Creating a long-running tool</a></li>
        <li><a href="#handling-the-client-side-flow">Handling the client-side flow</a></li>
        <li><a href="#sending-intermediate-progress-updates">Sending intermediate progress updates</a></li>
        <li><a href="#human-in-the-loop-patterns">Human-in-the-loop patterns</a></li>
      </ul>
    </li>
    <li><a href="#putting-it-all-together">Putting it all together</a></li>
  </ul>
</nav>
      </nav>
    </div>

    <style>
      #toc-content ul {
        list-style: none;
        padding-left: 1rem;
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
      }
      #toc-content > nav > ul {
        padding-left: 0;
      }
      #toc-content li {
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
      }
      #toc-content a {
        color: #374151;
        text-decoration: none;
        transition: color 0.2s;
      }
      #toc-content a:hover {
        color: #1e40af;
        text-decoration: underline;
      }
       
      .dark #toc-content a {
        color: #cbd5e1;
      }
      .dark #toc-content a:hover {
        color: #60a5fa;
      }
    </style>
  


        </div>

        <style>
          @media (min-width: 1024px) {
            .mobile-toc-container {
              display: none !important;
            }

             
            html,
            body,
            main,
            article,
            .container,
            .max-w-7xl,
            .grid,
            aside {
              overflow: visible !important;
              height: auto !important;
            }

             
            .sidebar-sticky-reinforced {
              position: -webkit-sticky !important;
              position: sticky !important;
              top: 130px !important;
              z-index: 100;
              align-self: start;
              height: fit-content;
            }
          }
        </style>

        
        <div class="prose prose-sm sm:prose-base md:prose-lg max-w-none mb-8 sm:mb-10 md:mb-12">
          <p>Imagine this scenario. Your company has dozens of internal REST APIs, each with an OpenAPI specification already published. You need an agent that can query the inventory service, place orders through the fulfillment API, and check shipment tracking, all without writing individual tool functions for every single endpoint. Now layer on some more complexity. Some of those APIs require OAuth2 tokens. One task, say generating a compliance report, takes ten minutes to complete. And you want a coordinator agent that can delegate research tasks to a specialized sub-agent without losing control of the conversation.</p>
<p>These four problems, connecting to REST APIs at scale, composing agents hierarchically, authenticating with protected services, and handling slow operations gracefully, are exactly what this article covers. Each is a distinct Google ADK capability, but together they form the toolkit you need to build production-grade agents that interact with the real world.</p>
<p>Let us start with <a href="https://google.github.io/adk-docs/tools-custom/openapi-tools/">OpenAPI tools</a>.</p>
<h2 id="openapi-tools">OpenAPI tools</h2>
<p>When your organization already has REST APIs documented with OpenAPI specifications, writing individual <code>FunctionTool</code> wrappers for each endpoint is tedious and error-prone. The <code>OpenAPIToolset</code> class solves this by reading an OpenAPI v3.x specification and automatically generating callable tools for every operation it discovers. You hand ADK a spec file, and it returns a set of tools your agent can use immediately.</p>
<h3 id="the-two-key-classes">The two key classes</h3>
<p>The <a href="https://swagger.io/specification/">OpenAPI</a> integration revolves around two classes working together.</p>
<p><code>OpenAPIToolset</code> is the entry point. You initialize it with your OpenAPI specification, provided as a JSON string, a YAML string, or a Python dictionary, and it handles parsing, reference resolution, and tool generation. Think of it as the factory that reads the blueprint and produces the individual tools.</p>
<p><code>RestApiTool</code> is what the factory produces. Each API operation defined in your spec (every <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code> path) becomes one <code>RestApiTool</code> instance. This tool can construct the correct HTTP request, fill in path parameters, attach query strings and headers, serialize the request body, and return the response, all based on the information in the spec.</p>
<h3 id="how-the-toolset-generates-tools">How the toolset generates tools</h3>
<p>When you create an <code>OpenAPIToolset</code>, several things happen internally:</p>
<ol>
<li>The spec is parsed, and all internal <code>$ref</code> references are resolved to produce a complete API description.</li>
<li>Every valid operation within the <code>paths</code> section is identified.</li>
<li>For each operation, a <code>RestApiTool</code> is created with a name derived from the <code>operationId</code> field (converted to <code>snake_case</code>, capped at 60 characters). If no <code>operationId</code> exists, the name is generated from the HTTP method and path.</li>
<li>The tool&rsquo;s description is pulled from the <code>summary</code> or <code>description</code> field in the spec, which helps the LLM understand when to use it.</li>
<li>Each <code>RestApiTool</code> dynamically creates a <code>FunctionDeclaration</code> that maps the operation&rsquo;s parameters and request body into arguments the LLM can provide.</li>
</ol>
<h3 id="basic-usage">Basic usage</h3>
<p>Here is how you would connect an agent to a task management API using its OpenAPI spec.</p>
<blockquote>
<p>This example uses a mock OpenAPI server created in Python using FastAPI. The code for this server is at <a href="https://gist.github.com/rchaganti/8449850eb83bc7e7834dded9ff275395">A mock OpenAPI server</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools.openapi_tool.openapi_spec_parser.openapi_toolset</span> <span class="kn">import</span> <span class="n">OpenAPIToolset</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.runners</span> <span class="kn">import</span> <span class="n">Runner</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.sessions</span> <span class="kn">import</span> <span class="n">InMemorySessionService</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.genai</span> <span class="kn">import</span> <span class="n">types</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Fetch the spec from the running server</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;http://localhost:3000/openapi.json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">spec_content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create the toolset</span>
</span></span><span class="line"><span class="cl"><span class="n">task_toolset</span> <span class="o">=</span> <span class="n">OpenAPIToolset</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">spec_str</span><span class="o">=</span><span class="n">spec_content</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">spec_str_type</span><span class="o">=</span><span class="s2">&#34;json&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Build the agent with the generated tools</span>
</span></span><span class="line"><span class="cl"><span class="n">task_agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;TaskManager&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;You manage tasks through the Task API. 
</span></span></span><span class="line"><span class="cl"><span class="s2">You can list tasks, create new ones, update their status, and delete completed ones.
</span></span></span><span class="line"><span class="cl"><span class="s2">Always confirm with the user before deleting a task.&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">task_toolset</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>task_toolset</code> automatically generates tools like <code>list_tasks</code>, <code>create_task</code>, <code>update_task</code>, and <code>delete_task</code> based on the operations defined in the spec. The agent can call any of them as needed.</p>
<p>You can also provide the spec as a YAML string or a Python dictionary. When using YAML, set <code>spec_str_type=&quot;yaml&quot;</code>. When passing a dictionary, use the <code>spec_dict</code> parameter instead of <code>spec_str</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># From YAML</span>
</span></span><span class="line"><span class="cl"><span class="n">toolset_from_yaml</span> <span class="o">=</span> <span class="n">OpenAPIToolset</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">spec_str</span><span class="o">=</span><span class="n">yaml_string</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">spec_str_type</span><span class="o">=</span><span class="s2">&#34;yaml&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># From a dictionary</span>
</span></span><span class="line"><span class="cl"><span class="n">toolset_from_dict</span> <span class="o">=</span> <span class="n">OpenAPIToolset</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">spec_dict</span><span class="o">=</span><span class="n">spec_dictionary</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Let us add the execution logic to interact with this agent.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_service</span> <span class="o">=</span> <span class="n">InMemorySessionService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">runner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">agent</span><span class="o">=</span><span class="n">root_agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;task_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;task_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">msg</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;list all tasks in progress.&#34;</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">        <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">new_message</span><span class="o">=</span><span class="n">msg</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">get_function_calls</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">call</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">get_function_calls</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Tool called: </span><span class="si">{</span><span class="n">call</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> with args: </span><span class="si">{</span><span class="n">call</span><span class="o">.</span><span class="n">args</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When you run this, you will see the agent calling the <code>list_tasks_api_tasks_get</code> tool with the argument <code>{'status': 'in-progress'}</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; python.exe .<span class="se">\o</span>penapi<span class="se">\a</span>gent.py
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Tool called: list_tasks_api_tasks_get with args: <span class="o">{</span><span class="s1">&#39;status&#39;</span>: <span class="s1">&#39;in-progress&#39;</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Agent: Here are all the tasks in progress: Review pull request, Deploy to staging, and upload new podcast.
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="working-with-individual-restapitool-instances">Working with individual RestApiTool instances</h3>
<p>Sometimes you need finer control over specific tools. You can retrieve individual tools by name using <code>get_tool()</code> or get all of them with <code>get_tools()</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Get a specific tool</span>
</span></span><span class="line"><span class="cl"><span class="n">get_task_tool</span> <span class="o">=</span> <span class="n">task_toolset</span><span class="o">.</span><span class="n">get_tool</span><span class="p">(</span><span class="s2">&#34;list_tasks_api_tasks_get&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Get all tools as a list</span>
</span></span><span class="line"><span class="cl"><span class="n">all_tools</span> <span class="o">=</span> <span class="n">task_toolset</span><span class="o">.</span><span class="n">get_tools</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Add custom headers to a specific tool</span>
</span></span><span class="line"><span class="cl"><span class="n">get_task_tool</span><span class="o">.</span><span class="n">set_default_headers</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;X-Request-Source&#34;</span><span class="p">:</span> <span class="s2">&#34;adk-agent&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;X-Trace-Id&#34;</span><span class="p">:</span> <span class="s2">&#34;abc123&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This is particularly useful when you want to apply tool-specific configurations, such as custom headers or different authentication credentials, to individual endpoints.</p>
<h2 id="agents-as-tools-agenttool">Agents-as-tools (AgentTool)</h2>
<p>In the <a href="/blog/google-adk-mcp-tools/">MCP tools article</a>, we saw how to extend an agent&rsquo;s capabilities by connecting it to external tool servers. But what if the capability you need is not a simple function but an entire reasoning process that, in turn, requires an LLM? What if you need a &ldquo;research agent&rdquo; that can search, synthesize, and summarize information, and you want a parent agent to be able to call this research agent the same way it would call any other tool?</p>
<p>This is where <code>AgentTool</code> comes in. It wraps an entire agent, with its own instruction, model, and tools, and exposes it as a callable tool for a parent agent. The parent agent sends a request to the wrapped agent, which processes it using its own LLM and tools, and the result flows back to the parent as a standard tool response.</p>
<h3 id="how-agenttool-differs-from-sub-agent-transfer">How AgentTool differs from sub-agent transfer</h3>
<p>ADK provides two ways for agents to work together, and understanding the difference is critical for designing the right architecture.</p>
<p>With <strong>sub-agent transfer</strong> (using <code>sub_agents</code>), the parent agent hands off control of the conversation entirely. The sub-agent takes over, directly responds to the user, and handles all follow-up questions. The parent steps out of the loop. This is like a customer service representative transferring your call to a specialist. You are now speaking with the specialist, not the original representative.</p>
<p>With <strong>AgentTool</strong>, the parent agent remains in control. It formulates a specific question, sends it to the tool agent, receives the result, and then decides what to do next, including how to present the answer to the user. The tool agent never talks to the user directly. This is like a manager asking a team member to research something and report back. The manager still owns the conversation with the client.</p>
<p>Here is a summary of the key differences:</p>
<table>
  <thead>
      <tr>
          <th>Aspect</th>
          <th>Sub-Agent Transfer</th>
          <th>AgentTool</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>Who talks to the user</td>
          <td>The sub-agent</td>
          <td>The parent agent</td>
      </tr>
      <tr>
          <td>Who handles follow-ups</td>
          <td>The sub-agent</td>
          <td>The parent agent</td>
      </tr>
      <tr>
          <td>Does control return?</td>
          <td>No</td>
          <td>Yes</td>
      </tr>
      <tr>
          <td>What is sent to the child</td>
          <td>Full conversation history</td>
          <td>A summarized question from the parent</td>
      </tr>
      <tr>
          <td>Typical LLM calls</td>
          <td>2 (parent decides + sub answers)</td>
          <td>3+ (parent + child + parent again)</td>
      </tr>
      <tr>
          <td>Session context</td>
          <td>Shared</td>
          <td>Separate (encapsulated)</td>
      </tr>
  </tbody>
</table>
<h3 id="using-agenttool">Using AgentTool</h3>
<p>To use an agent as a tool, wrap it with the <code>AgentTool</code> class and add it to the parent agent&rsquo;s <code>tools</code> list.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools.agent_tool</span> <span class="kn">import</span> <span class="n">AgentTool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define a specialist agent</span>
</span></span><span class="line"><span class="cl"><span class="n">code_reviewer</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;CodeReviewer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Reviews code snippets for bugs, style issues, and security vulnerabilities.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;You are an expert code reviewer. 
</span></span></span><span class="line"><span class="cl"><span class="s2">When given code, analyze it for:
</span></span></span><span class="line"><span class="cl"><span class="s2">1. Logical bugs and edge cases
</span></span></span><span class="line"><span class="cl"><span class="s2">2. Style and readability issues
</span></span></span><span class="line"><span class="cl"><span class="s2">3. Security vulnerabilities
</span></span></span><span class="line"><span class="cl"><span class="s2">Provide a structured review with severity ratings.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the parent agent that uses the specialist as a tool</span>
</span></span><span class="line"><span class="cl"><span class="n">dev_assistant</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;DevAssistant&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;You are a software development assistant.
</span></span></span><span class="line"><span class="cl"><span class="s2">When a user shares code and wants a review, use the CodeReviewer tool to analyze it.
</span></span></span><span class="line"><span class="cl"><span class="s2">Then present the findings to the user in a friendly, actionable format.
</span></span></span><span class="line"><span class="cl"><span class="s2">For general coding questions, answer directly without using the tool.&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">AgentTool</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="n">code_reviewer</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When the user asks the <code>DevAssistant</code> to review code, the LLM invokes the <code>CodeReviewer</code> tool. ADK runs the <code>CodeReviewer</code> agent in its own execution context, collects its response, and returns it to the <code>DevAssistant</code> as a tool result. The <code>DevAssistant</code> then summarizes and presents the findings to the user.</p>
<h3 id="the-skip_summarization-option">The skip_summarization option</h3>
<p>By default, when the tool agent returns its result, the parent agent&rsquo;s LLM makes an additional call to summarize or interpret that result before presenting it to the user. This is useful when the tool agent&rsquo;s output is verbose or technical and needs to be adapted for the user.</p>
<p>However, if the tool agent already produces clean, user-ready output, this extra LLM call is wasteful. Setting <code>skip_summarization=True</code> tells ADK to bypass the summarization step and pass the tool agent&rsquo;s output directly to the parent.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Skip summarization when the tool agent&#39;s output is already well-formatted</span>
</span></span><span class="line"><span class="cl"><span class="n">formatted_reporter</span> <span class="o">=</span> <span class="n">AgentTool</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">agent</span><span class="o">=</span><span class="n">code_reviewer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">skip_summarization</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="building-a-hierarchical-agent-system">Building a hierarchical agent system</h3>
<p><code>AgentTool</code> really shines when you build multi-level hierarchies. Consider a research coordinator who delegates to specialized agents.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools.agent_tool</span> <span class="kn">import</span> <span class="n">AgentTool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Level 1: Specialist agents with their own tools</span>
</span></span><span class="line"><span class="cl"><span class="n">web_researcher</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;WebResearcher&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Searches the web for current information on a topic.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;Search for the requested information and return factual findings with sources.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">data_analyst</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;DataAnalyst&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Analyzes numerical data and produces statistical summaries.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;Analyze the provided data. Return key metrics, trends, and anomalies.&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Level 2: Coordinator that uses specialists as tools</span>
</span></span><span class="line"><span class="cl"><span class="n">research_coordinator</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;ResearchCoordinator&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Coordinates research tasks by delegating to specialists.&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;You coordinate research efforts.
</span></span></span><span class="line"><span class="cl"><span class="s2">For questions requiring current information, use the WebResearcher tool.
</span></span></span><span class="line"><span class="cl"><span class="s2">For questions requiring data analysis, use the DataAnalyst tool.
</span></span></span><span class="line"><span class="cl"><span class="s2">Synthesize results from multiple tools when needed.&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="n">AgentTool</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="n">web_researcher</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">AgentTool</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="n">data_analyst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Level 3: Top-level agent that delegates entire research projects</span>
</span></span><span class="line"><span class="cl"><span class="n">project_manager</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;ProjectManager&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;You manage projects and write reports.
</span></span></span><span class="line"><span class="cl"><span class="s2">When you need research done on any topic, use the ResearchCoordinator tool.
</span></span></span><span class="line"><span class="cl"><span class="s2">Focus on synthesizing the research into clear, actionable recommendations.&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="p">[</span><span class="n">AgentTool</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="n">research_coordinator</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The user interacts with the <code>ProjectManager</code>. When it needs research, it calls the <code>ResearchCoordinator</code> as a tool, which in turn calls <code>WebResearcher</code> or <code>DataAnalyst</code> as tools. Results flow back up the hierarchy, with each level adding its own interpretation and context.</p>
<h2 id="authenticated-tools">Authenticated tools</h2>
<p>Many real-world APIs require authentication. Your agent might need to read a user&rsquo;s calendar events (requiring OAuth2 consent), query an internal service protected by API keys, or access enterprise resources behind OpenID Connect. ADK provides a comprehensive authentication system that integrates with <code>OpenAPIToolset</code>, <code>RestApiTool</code>, and custom <code>FunctionTool</code> implementations.</p>
<h3 id="authentication-building-blocks">Authentication building blocks</h3>
<p>ADK&rsquo;s auth system is built on two core concepts.</p>
<p><strong>AuthScheme</strong> defines <em>how</em> an API expects credentials. Is it an API key in a header? An OAuth2 bearer token? A service account? ADK supports the same authentication schemes as OpenAPI 3.0: <code>APIKey</code>, <code>HTTPBearer</code>, <code>OAuth2</code>, and <code>OpenIdConnectWithConfig</code>.</p>
<p><strong>AuthCredential</strong> stores the initial information needed to start the authentication process. This includes your application&rsquo;s OAuth client ID and secret, an API key, or a service account JSON key. It also includes an <code>auth_type</code> field that specifies the credential type.</p>
<p>The supported credential types are:</p>
<table>
  <thead>
      <tr>
          <th>Type</th>
          <th>When to use</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>API_KEY</code></td>
          <td>Simple key-based auth, no exchange needed</td>
      </tr>
      <tr>
          <td><code>HTTP</code></td>
          <td>Pre-obtained bearer tokens</td>
      </tr>
      <tr>
          <td><code>OAUTH2</code></td>
          <td>Standard OAuth2 flows requiring user consent</td>
      </tr>
      <tr>
          <td><code>OPEN_ID_CONNECT</code></td>
          <td>Enterprise OIDC providers like Okta or Auth0</td>
      </tr>
      <tr>
          <td><code>SERVICE_ACCOUNT</code></td>
          <td>Google Cloud service accounts for server-to-server auth</td>
      </tr>
  </tbody>
</table>
<h3 id="api-key-authentication">API key authentication</h3>
<p>The simplest form of authentication is an API key. You can use the <code>token_to_scheme_credential</code> helper to create the required objects.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools.openapi_tool.auth.auth_helpers</span> <span class="kn">import</span> <span class="n">token_to_scheme_credential</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools.openapi_tool.openapi_spec_parser.openapi_toolset</span> <span class="kn">import</span> <span class="n">OpenAPIToolset</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create auth objects for an API key passed as a query parameter</span>
</span></span><span class="line"><span class="cl"><span class="n">auth_scheme</span><span class="p">,</span> <span class="n">auth_credential</span> <span class="o">=</span> <span class="n">token_to_scheme_credential</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;apikey&#34;</span><span class="p">,</span>      <span class="c1"># scheme type</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;query&#34;</span><span class="p">,</span>       <span class="c1"># where to send it (query, header, cookie)</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;api_key&#34;</span><span class="p">,</span>     <span class="c1"># parameter name</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;sk-abc123&#34;</span>   <span class="c1"># the actual key value</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">analytics_toolset</span> <span class="o">=</span> <span class="n">OpenAPIToolset</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">spec_str</span><span class="o">=</span><span class="n">analytics_api_spec</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">spec_str_type</span><span class="o">=</span><span class="s2">&#34;json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth_scheme</span><span class="o">=</span><span class="n">auth_scheme</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth_credential</span><span class="o">=</span><span class="n">auth_credential</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>auth_scheme</code> and <code>auth_credential</code> are applied to every <code>RestApiTool</code> generated by the toolset. Each HTTP request made by these tools will automatically include the API key.</p>
<h3 id="oauth2-authentication">OAuth2 authentication</h3>
<p>OAuth2 is more complex because it requires user interaction. The user must log in and grant your application permission to access their data. ADK handles this through an interactive flow involving your agent and the client application.</p>
<p>Here is how you configure an <code>OpenAPIToolset</code> for OAuth2.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools.openapi_tool.openapi_spec_parser.openapi_toolset</span> <span class="kn">import</span> <span class="n">OpenAPIToolset</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.auth</span> <span class="kn">import</span> <span class="n">AuthCredential</span><span class="p">,</span> <span class="n">AuthCredentialTypes</span><span class="p">,</span> <span class="n">OAuth2Auth</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">fastapi.openapi.models</span> <span class="kn">import</span> <span class="n">OAuth2</span><span class="p">,</span> <span class="n">OAuthFlows</span><span class="p">,</span> <span class="n">OAuthFlowAuthorizationCode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">auth_scheme</span> <span class="o">=</span> <span class="n">OAuth2</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">flows</span><span class="o">=</span><span class="n">OAuthFlows</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">authorizationCode</span><span class="o">=</span><span class="n">OAuthFlowAuthorizationCode</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">authorizationUrl</span><span class="o">=</span><span class="s2">&#34;https://accounts.google.com/o/oauth2/auth&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">tokenUrl</span><span class="o">=</span><span class="s2">&#34;https://oauth2.googleapis.com/token&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">scopes</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;https://www.googleapis.com/auth/calendar.readonly&#34;</span><span class="p">:</span> <span class="s2">&#34;Read calendar events&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">auth_credential</span> <span class="o">=</span> <span class="n">AuthCredential</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth_type</span><span class="o">=</span><span class="n">AuthCredentialTypes</span><span class="o">.</span><span class="n">OAUTH2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">oauth2</span><span class="o">=</span><span class="n">OAuth2Auth</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">client_id</span><span class="o">=</span><span class="s2">&#34;YOUR_CLIENT_ID&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">client_secret</span><span class="o">=</span><span class="s2">&#34;YOUR_CLIENT_SECRET&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">calendar_toolset</span> <span class="o">=</span> <span class="n">OpenAPIToolset</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">spec_str</span><span class="o">=</span><span class="n">calendar_api_spec</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">spec_str_type</span><span class="o">=</span><span class="s2">&#34;yaml&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth_scheme</span><span class="o">=</span><span class="n">auth_scheme</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth_credential</span><span class="o">=</span><span class="n">auth_credential</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="the-interactive-oauth2-flow">The interactive OAuth2 flow</h3>
<p>When an agent attempts to use an OAuth2-protected tool and no valid token is available, ADK triggers an interactive authentication flow. Here is what happens step by step.</p>
<p><strong>Step 1: The agent yields an auth request.</strong> Instead of a normal tool response, the runner emits a special event containing a function call named <code>adk_request_credential</code>. Your client application must detect this event.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">events</span> <span class="o">=</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">user_query</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">auth_function_call_id</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl"><span class="n">auth_config</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">function_call</span> 
</span></span><span class="line"><span class="cl">                <span class="ow">and</span> <span class="n">part</span><span class="o">.</span><span class="n">function_call</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&#34;adk_request_credential&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">long_running_tool_ids</span>
</span></span><span class="line"><span class="cl">                <span class="ow">and</span> <span class="n">part</span><span class="o">.</span><span class="n">function_call</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">long_running_tool_ids</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">auth_function_call_id</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">function_call</span><span class="o">.</span><span class="n">id</span>
</span></span><span class="line"><span class="cl">                <span class="n">auth_config</span> <span class="o">=</span> <span class="n">AuthConfig</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">part</span><span class="o">.</span><span class="n">function_call</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;auth_config&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">break</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Step 2: Redirect the user to the authorization URL.</strong> Extract the <code>auth_uri</code> from the <code>auth_config</code> and append your application&rsquo;s <code>redirect_uri</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">base_auth_uri</span> <span class="o">=</span> <span class="n">auth_config</span><span class="o">.</span><span class="n">exchanged_auth_credential</span><span class="o">.</span><span class="n">oauth2</span><span class="o">.</span><span class="n">auth_uri</span>
</span></span><span class="line"><span class="cl"><span class="n">redirect_uri</span> <span class="o">=</span> <span class="s2">&#34;http://localhost:8000/callback&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">full_auth_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">base_auth_uri</span><span class="si">}</span><span class="s2">&amp;redirect_uri=</span><span class="si">{</span><span class="n">redirect_uri</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># In a web app: redirect the user to full_auth_url</span>
</span></span><span class="line"><span class="cl"><span class="c1"># In a CLI: print the URL and ask the user to visit it</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Please visit: </span><span class="si">{</span><span class="n">full_auth_url</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Step 3: Capture the callback.</strong> After the user logs in and grants permission, the OAuth provider redirects them to your <code>redirect_uri</code> with an authorization code in the URL. Your application captures this full callback URL.</p>
<p><strong>Step 4: Send the auth response back to ADK.</strong> Update the <code>auth_config</code> with the callback URL and send it back to the runner as a <code>FunctionResponse</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Update auth_config with the callback details</span>
</span></span><span class="line"><span class="cl"><span class="n">auth_config</span><span class="o">.</span><span class="n">exchanged_auth_credential</span><span class="o">.</span><span class="n">oauth2</span><span class="o">.</span><span class="n">auth_response_uri</span> <span class="o">=</span> <span class="n">callback_url</span>
</span></span><span class="line"><span class="cl"><span class="n">auth_config</span><span class="o">.</span><span class="n">exchanged_auth_credential</span><span class="o">.</span><span class="n">oauth2</span><span class="o">.</span><span class="n">redirect_uri</span> <span class="o">=</span> <span class="n">redirect_uri</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Build the response message</span>
</span></span><span class="line"><span class="cl"><span class="n">auth_response</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">parts</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="n">types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">function_response</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">FunctionResponse</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nb">id</span><span class="o">=</span><span class="n">auth_function_call_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">name</span><span class="o">=</span><span class="s2">&#34;adk_request_credential&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">response</span><span class="o">=</span><span class="n">auth_config</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Resume the agent with the auth response</span>
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_message</span><span class="o">=</span><span class="n">auth_response</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Step 5: ADK completes the flow.</strong> ADK exchanges the authorization code for tokens, stores them, and retries the original tool call, this time with a valid access token. The agent gets the real API response and generates its final answer.</p>
<h3 id="building-custom-authenticated-tools">Building custom authenticated tools</h3>
<p>When building your own <code>FunctionTool</code> that requires OAuth2, implement the authentication logic within the tool function using <code>ToolContext</code>. The pattern follows three phases: check for cached credentials, check for an auth response from a previous redirect, or initiate a new auth request.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools</span> <span class="kn">import</span> <span class="n">FunctionTool</span><span class="p">,</span> <span class="n">ToolContext</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.auth</span> <span class="kn">import</span> <span class="n">AuthConfig</span><span class="p">,</span> <span class="n">AuthCredential</span><span class="p">,</span> <span class="n">AuthCredentialTypes</span><span class="p">,</span> <span class="n">OAuth2Auth</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.auth.auth_schemes</span> <span class="kn">import</span> <span class="n">OpenIdConnectWithConfig</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Define the auth configuration</span>
</span></span><span class="line"><span class="cl"><span class="n">auth_scheme</span> <span class="o">=</span> <span class="n">OpenIdConnectWithConfig</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">authorization_endpoint</span><span class="o">=</span><span class="s2">&#34;https://your-idp.com/authorize&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">token_endpoint</span><span class="o">=</span><span class="s2">&#34;https://your-idp.com/token&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">scopes</span><span class="o">=</span><span class="p">[</span><span class="s2">&#34;openid&#34;</span><span class="p">,</span> <span class="s2">&#34;profile&#34;</span><span class="p">,</span> <span class="s2">&#34;email&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">auth_credential</span> <span class="o">=</span> <span class="n">AuthCredential</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">auth_type</span><span class="o">=</span><span class="n">AuthCredentialTypes</span><span class="o">.</span><span class="n">OPEN_ID_CONNECT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">oauth2</span><span class="o">=</span><span class="n">OAuth2Auth</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">client_id</span><span class="o">=</span><span class="s2">&#34;YOUR_CLIENT_ID&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">client_secret</span><span class="o">=</span><span class="s2">&#34;YOUR_CLIENT_SECRET&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fetch_user_profile</span><span class="p">(</span><span class="n">tool_context</span><span class="p">:</span> <span class="n">ToolContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Fetches the authenticated user&#39;s profile from the identity provider.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Phase 1: Check for cached credentials</span>
</span></span><span class="line"><span class="cl">    <span class="n">cached_token</span> <span class="o">=</span> <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&#34;user_profile_token&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">cached_token</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Use cached token to make API call</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">call_profile_api</span><span class="p">(</span><span class="n">cached_token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Phase 2: Check if the client just completed the OAuth flow</span>
</span></span><span class="line"><span class="cl">    <span class="n">exchanged</span> <span class="o">=</span> <span class="n">tool_context</span><span class="o">.</span><span class="n">get_auth_response</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">AuthConfig</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_scheme</span><span class="o">=</span><span class="n">auth_scheme</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">raw_auth_credential</span><span class="o">=</span><span class="n">auth_credential</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">exchanged</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ADK already exchanged the code for tokens</span>
</span></span><span class="line"><span class="cl">        <span class="n">access_token</span> <span class="o">=</span> <span class="n">exchanged</span><span class="o">.</span><span class="n">oauth2</span><span class="o">.</span><span class="n">access_token</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Cache the token for future calls</span>
</span></span><span class="line"><span class="cl">        <span class="n">tool_context</span><span class="o">.</span><span class="n">state</span><span class="p">[</span><span class="s2">&#34;user_profile_token&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">access_token</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">call_profile_api</span><span class="p">(</span><span class="n">access_token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Phase 3: No credentials at all — initiate the auth flow</span>
</span></span><span class="line"><span class="cl">    <span class="n">tool_context</span><span class="o">.</span><span class="n">request_credential</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">AuthConfig</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_scheme</span><span class="o">=</span><span class="n">auth_scheme</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">raw_auth_credential</span><span class="o">=</span><span class="n">auth_credential</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;pending&#34;</span><span class="p">,</span> <span class="s2">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Waiting for user to authenticate.&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">my_auth_tool</span> <span class="o">=</span> <span class="n">FunctionTool</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">fetch_user_profile</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The three-phase pattern ensures your tool works correctly regardless of where it is in the authentication lifecycle. On the first call, the flow begins. After the user authenticates, it receives the tokens. On subsequent calls within the same session, it reuses the cached token.</p>
<h3 id="security-considerations-for-token-storage">Security considerations for token storage</h3>
<p>Storing tokens in session state works well for <code>InMemorySessionService</code> during development, since the data is transient. For persistent session backends in production, consider encrypting token data before storing it. For the most sensitive environments, use a dedicated secret manager, such as Google Cloud Secret Manager, to store refresh tokens, and store only short-lived access tokens in session state.</p>
<h2 id="long-running-function-tools">Long-running function tools</h2>
<p>Standard tool functions are synchronous: the agent calls the function, the function executes, and the result comes back in the same event loop iteration. But what about operations that take minutes or hours? Generating a compliance report, processing a large dataset, or waiting for a human to approve a request. None of these can block the agent&rsquo;s event loop.</p>
<p><code>LongRunningFunctionTool</code> addresses this by splitting a tool invocation into two phases: initiation and completion. The tool function starts the operation and returns an initial status. ADK pauses the agent run. The client application monitors the external process and, when it receives an update, sends the result back to the agent. The agent then resumes with the new information.</p>
<h3 id="how-it-differs-from-regular-tools">How it differs from regular tools</h3>
<p>With a regular <code>FunctionTool</code>, the sequence is: agent calls → function executes → result returns → agent continues. The entire cycle happens within a single agent run.</p>
<p>With a <code>LongRunningFunctionTool</code>, the sequence is:</p>
<ol>
<li><strong>First agent run:</strong> Agent calls the tool → function starts the operation and returns an initial status (like a ticket ID or &ldquo;pending&rdquo;) → ADK pauses the run.</li>
<li><strong>Client waits:</strong> The client application monitors the external operation outside the agent runtime.</li>
<li><strong>Second agent run:</strong> Client sends the final (or intermediate) result back → agent resumes and generates a response.</li>
</ol>
<p>This is fundamentally about decoupling <em>starting</em> a task from <em>completing</em> it.</p>
<h3 id="creating-a-long-running-tool">Creating a long-running tool</h3>
<p>You define a regular Python function and wrap it with <code>LongRunningFunctionTool</code> instead of <code>FunctionTool</code>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.agents</span> <span class="kn">import</span> <span class="n">LlmAgent</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.tools</span> <span class="kn">import</span> <span class="n">LongRunningFunctionTool</span><span class="p">,</span> <span class="n">FunctionTool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">request_expense_approval</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Submits an expense report for manager approval.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ticket_id</span> <span class="o">=</span> <span class="n">create_approval_ticket</span><span class="p">(</span><span class="n">description</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;pending_approval&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ticket_id&#34;</span><span class="p">:</span> <span class="n">ticket_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;message&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;Expense report for $</span><span class="si">{</span><span class="n">amount</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> submitted. Awaiting manager review.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">check_policy_compliance</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">float</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Checks if an expense is within company policy limits.&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">limits</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&#34;travel&#34;</span><span class="p">:</span> <span class="mi">5000</span><span class="p">,</span> <span class="s2">&#34;equipment&#34;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span> <span class="s2">&#34;training&#34;</span><span class="p">:</span> <span class="mi">1500</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">limit</span> <span class="o">=</span> <span class="n">limits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;compliant&#34;</span><span class="p">:</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="n">limit</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;limit&#34;</span><span class="p">:</span> <span class="n">limit</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;category&#34;</span><span class="p">:</span> <span class="n">category</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">expense_agent</span> <span class="o">=</span> <span class="n">LlmAgent</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="o">=</span><span class="s2">&#34;ExpenseAssistant&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">=</span><span class="s2">&#34;gemini-2.0-flash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">instruction</span><span class="o">=</span><span class="s2">&#34;&#34;&#34;You help employees submit expense reports.
</span></span></span><span class="line"><span class="cl"><span class="s2">1. First check if the expense is within policy using check_policy_compliance.
</span></span></span><span class="line"><span class="cl"><span class="s2">2. If compliant, submit it for approval using request_expense_approval.
</span></span></span><span class="line"><span class="cl"><span class="s2">3. Once the manager responds, inform the employee of the decision.&#34;&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">tools</span><span class="o">=</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="n">FunctionTool</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">check_policy_compliance</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">LongRunningFunctionTool</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">request_expense_approval</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <code>check_policy_compliance</code> tool runs synchronously. It checks the policy and returns immediately. The <code>request_expense_approval</code> tool, wrapped in <code>LongRunningFunctionTool</code>, creates a ticket and returns a pending status. The agent pauses at this point.</p>
<h3 id="handling-the-client-side-flow">Handling the client-side flow</h3>
<p>After the agent run pauses, the client application is responsible for monitoring the external process and sending results back. Here is the full client-side flow.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncio</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.runners</span> <span class="kn">import</span> <span class="n">Runner</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.adk.sessions</span> <span class="kn">import</span> <span class="n">InMemorySessionService</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">google.genai</span> <span class="kn">import</span> <span class="n">types</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">def</span> <span class="nf">run_expense_workflow</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_service</span> <span class="o">=</span> <span class="n">InMemorySessionService</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">runner</span> <span class="o">=</span> <span class="n">Runner</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">agent</span><span class="o">=</span><span class="n">expense_agent</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;expense_app&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">session_service</span><span class="o">=</span><span class="n">session_service</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">session</span> <span class="o">=</span> <span class="k">await</span> <span class="n">session_service</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_name</span><span class="o">=</span><span class="s2">&#34;expense_app&#34;</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 1: User submits an expense</span>
</span></span><span class="line"><span class="cl">    <span class="n">msg</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&#34;I need to submit a $450 training expense for the Python conference.&#34;</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">        <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">pending_response</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span> <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">new_message</span><span class="o">=</span><span class="n">msg</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Detect the long-running tool&#39;s pending response</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">long_running_tool_ids</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">part</span><span class="o">.</span><span class="n">function_response</span> 
</span></span><span class="line"><span class="cl">                    <span class="ow">and</span> <span class="n">part</span><span class="o">.</span><span class="n">function_response</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">long_running_tool_ids</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">pending_response</span> <span class="o">=</span> <span class="n">part</span><span class="o">.</span><span class="n">function_response</span>
</span></span><span class="line"><span class="cl">                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Tool paused: </span><span class="si">{</span><span class="n">pending_response</span><span class="o">.</span><span class="n">response</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">pending_response</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 2: Simulate waiting for manager approval</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Waiting for manager decision...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># In production, poll an external system</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Step 3: Send the approval result back</span>
</span></span><span class="line"><span class="cl">    <span class="n">approval_result</span> <span class="o">=</span> <span class="n">pending_response</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">approval_result</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;approved&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;approved_by&#34;</span><span class="p">:</span> <span class="s2">&#34;Manager Sarah&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;notes&#34;</span><span class="p">:</span> <span class="s2">&#34;Approved. Great initiative on continuing education.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">new_message</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="n">function_response</span><span class="o">=</span><span class="n">approval_result</span><span class="p">)]</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">run_expense_workflow</span><span class="p">())</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>When you run this, the flow looks like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; python.exe .<span class="se">\e</span>xpense-approval.py
</span></span><span class="line"><span class="cl">Tool paused: <span class="o">{</span><span class="s1">&#39;status&#39;</span>: <span class="s1">&#39;pending_approval&#39;</span>, <span class="s1">&#39;ticket_id&#39;</span>: <span class="s1">&#39;EXP-001&#39;</span>, <span class="s1">&#39;message&#39;</span>: <span class="s1">&#39;Expense report for $450.00 submitted. Awaiting manager review.&#39;</span><span class="o">}</span>
</span></span><span class="line"><span class="cl">Agent: Your expense report <span class="k">for</span> <span class="nv">$450</span> <span class="k">for</span> the Python conference has been submitted <span class="k">for</span> approval. I will <span class="nb">let</span> you know once your manager responds.
</span></span><span class="line"><span class="cl">Waiting <span class="k">for</span> manager decision...
</span></span><span class="line"><span class="cl">Agent: Great news! Your expense report has been approved by Manager Sarah. She noted: <span class="s2">&#34;Great initiative on continuing education.&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="sending-intermediate-progress-updates">Sending intermediate progress updates</h3>
<p>You are not limited to a single final result. The client can send multiple intermediate updates to keep the user informed about progress.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Send a progress update (not the final result)</span>
</span></span><span class="line"><span class="cl"><span class="n">progress</span> <span class="o">=</span> <span class="n">pending_response</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">progress</span><span class="o">.</span><span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;in_progress&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;progress&#34;</span><span class="p">:</span> <span class="s2">&#34;75%&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Manager has viewed the request, decision pending...&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">runner</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="o">=</span><span class="s2">&#34;user1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">new_message</span><span class="o">=</span><span class="n">types</span><span class="o">.</span><span class="n">Content</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">role</span><span class="o">=</span><span class="s2">&#34;user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">parts</span><span class="o">=</span><span class="p">[</span><span class="n">types</span><span class="o">.</span><span class="n">Part</span><span class="p">(</span><span class="n">function_response</span><span class="o">=</span><span class="n">progress</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl"><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_final_response</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Agent: </span><span class="si">{</span><span class="n">event</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Each intermediate update triggers a new agent run, in which the LLM generates a user-friendly status message based on the progress data.</p>
<h3 id="human-in-the-loop-patterns">Human-in-the-loop patterns</h3>
<p>One of the most practical applications for <code>LongRunningFunctionTool</code> is human-in-the-loop workflows. The agent gathers information, prepares a request, and submits it. A human reviewer makes a decision outside the agent&rsquo;s runtime. The decision flows back, and the agent takes the next action.</p>
<p>This pattern works for approval workflows, content review pipelines, quality assurance checkpoints, and any scenario where a human decision gate sits between agent actions. The key insight is that <code>LongRunningFunctionTool</code> does not perform the long-running work itself. It manages the handoff between the agent and the external process. The actual work happens elsewhere, and the tool is just the communication channel.</p>
<h2 id="putting-it-all-together">Putting it all together</h2>
<p>These four capabilities, OpenAPI tools, agents-as-tools, authentication, and long-running operations, rarely exist in isolation. A real-world agent might use <code>OpenAPIToolset</code> to integrate with a fleet of internal APIs, <code>AgentTool</code> to delegate specialized work to child agents, OAuth2 authentication to access user data on protected services, and <code>LongRunningFunctionTool</code> to handle approval workflows that depend on human reviewers.</p>
<p>The key insight is that all of these are composable. You can authenticate an <code>OpenAPIToolset</code> with OAuth2 credentials. You can wrap an agent that uses authenticated tools inside an <code>AgentTool</code>. You can have a long-running tool inside a child agent that is itself wrapped as an <code>AgentTool</code>. ADK&rsquo;s tool system is designed so these patterns stack cleanly.</p>
<p>In the next article in this series, we will look at how to integrate tools from third-party agent frameworks, LangChain and CrewAI adapters, to bring an even wider range of capabilities to your ADK agents.</p>

        </div>

        
        

        
        

<div class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-lg font-bold mb-4 text-center text-gray-900 dark:text-dark-text">Share this article</h3>
  <div class="flex flex-wrap justify-center items-center gap-3 sm:gap-4">
    
    <button onclick="shareNative()"
      class="sm:hidden w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-primary text-primary dark:border-blue-400 dark:text-blue-400 flex items-center justify-center transition-all shadow-sm hover:shadow-md hover:bg-primary hover:text-white dark:hover:bg-blue-600 dark:hover:text-white dark:hover:border-blue-600"
      aria-label="Share" title="Share" id="native-share-btn">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z">
        </path>
      </svg>
    </button>

    
    <a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations%2F&text=Google&#43;ADK&#43;-&#43;OpenAPI&#43;tools%2C&#43;agents-as-tools%2C&#43;authentication%2C&#43;and&#43;long-running&#43;operations"
      target="_blank" rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#1DA1F2] text-[#1DA1F2] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#1DA1F2] hover:text-white hover:scale-105"
      aria-label="Share on Twitter" title="Share on Twitter">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z" />
      </svg>
    </a>

    
    <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations%2F" target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#0077B5] text-[#0077B5] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#0077B5] hover:text-white hover:scale-105"
      aria-label="Share on LinkedIn" title="Share on LinkedIn">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
      </svg>
    </a>

    
    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations%2F" target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#1877F2] text-[#1877F2] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#1877F2] hover:text-white hover:scale-105"
      aria-label="Share on Facebook" title="Share on Facebook">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
      </svg>
    </a>

    
    <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations%2F&title=Google&#43;ADK&#43;-&#43;OpenAPI&#43;tools%2C&#43;agents-as-tools%2C&#43;authentication%2C&#43;and&#43;long-running&#43;operations"
      target="_blank" rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#FF4500] text-[#FF4500] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#FF4500] hover:text-white hover:scale-105"
      aria-label="Share on Reddit" title="Share on Reddit">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z" />
      </svg>
    </a>

    
    <a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fravichaganti.com%2Fblog%2Fgoogle-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations%2F&t=Google&#43;ADK&#43;-&#43;OpenAPI&#43;tools%2C&#43;agents-as-tools%2C&#43;authentication%2C&#43;and&#43;long-running&#43;operations"
      target="_blank" rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-[#FF6600] text-[#FF6600] flex items-center justify-center transition-all no-underline shadow-sm hover:shadow-md hover:bg-[#FF6600] hover:text-white hover:scale-105"
      aria-label="Share on Hacker News" title="Share on Hacker News">
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M0 0v24h24V0H0zm12.8 13.4v5.2H11v-5.2L6.6 5.4h2.1l3.3 6.2 3.3-6.2h2.1l-4.6 8z" />
      </svg>
    </a>

    
    <button onclick="copyToClipboard('https:\/\/ravichaganti.com\/blog\/google-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations\/')"
      class="w-12 h-12 rounded-full bg-white dark:bg-dark-bg-secondary border-2 border-amber-500 text-amber-500 flex items-center justify-center transition-all shadow-sm hover:shadow-md hover:bg-amber-500 hover:text-white hover:scale-105"
      aria-label="Copy link" title="Copy link" id="copy-link-btn">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
        </path>
      </svg>
    </button>
  </div>
</div>

<script>
  
  function shareNative() {
    if (navigator.share) {
      navigator.share({
        title: 'Google ADK - OpenAPI tools, agents-as-tools, authentication, and long-running operations',
        text: 'Your agent needs to talk to the outside world. It needs to call REST APIs, delegate complex work to specialized agents, authenticate with protected services, and kick off operations that take minutes instead of milliseconds. Google ADK provides four powerful patterns to make all of this possible.',
        url: 'https:\/\/ravichaganti.com\/blog\/google-adk-openapi-tools-agents-as-tools-authentication-and-long-running-operations\/'
      }).catch(function (error) {
        console.log('Error sharing:', error);
      });
    }
  }

  
  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function () {
      const btn = document.getElementById('copy-link-btn');
      const originalHTML = btn.innerHTML;
      const originalTitle = btn.title;

      
      btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
      btn.title = 'Copied!';

      
      setTimeout(function () {
        btn.innerHTML = originalHTML;
        btn.title = originalTitle;
      }, 2000);
    }).catch(function (error) {
      console.error('Failed to copy:', error);
      alert('Failed to copy link. Please copy manually: ' + text);
    });
  }
</script>


        
        
<nav class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border" aria-label="Post navigation">
  
  
  
  

  
  
  
    
    
    

    
    
    

    
    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
      
    

    
    
      
        
        
      
      
        
        
      
    
  

  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    
    <div class="flex">
      
        <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/"
           class="flex-1 group card hover:shadow-xl transition-all hover:scale-[1.02] no-underline"
           aria-label="Previous in Google ADK: Google ADK - MCP tools">
          <div class="flex items-start gap-3">
            
            <div class="flex-shrink-0 text-primary dark:text-blue-400 group-hover:text-secondary dark:group-hover:text-purple-400 transition-colors mt-1">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </div>

            
            <div class="flex-1 min-w-0">
              <p class="text-xs text-gray-500 dark:text-dark-text-muted mb-1 uppercase tracking-wide">Previous in Google ADK</p>
              <h3 class="text-base font-bold text-gray-900 dark:text-dark-text mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                Google ADK - MCP tools
              </h3>
              
                <p class="text-sm text-gray-600 dark:text-dark-text-secondary line-clamp-2">An agent that can only use the tools you hard-code into it has a ceiling. The Model Context Protocol (MCP) shatters that ceiling by giving your ADK agents a standardized way to discover and use tools hosted anywhere — local processes, remote servers, or cloud services.</p>
              
            </div>
          </div>
        </a>
      
    </div>

    
    <div class="flex">
      
        <a href="https://ravichaganti.com/blog/building-a-multi-agent-linkedin-newsletter-system-with-google-adk/"
           class="flex-1 group card hover:shadow-xl transition-all hover:scale-[1.02] no-underline"
           aria-label="Next in Google ADK: Building a Multi-Agent LinkedIn Newsletter System with Google ADK">
          <div class="flex items-start gap-3">
            
            <div class="flex-1 min-w-0 text-right md:text-left md:order-1">
              <p class="text-xs text-gray-500 dark:text-dark-text-muted mb-1 uppercase tracking-wide">Next in Google ADK</p>
              <h3 class="text-base font-bold text-gray-900 dark:text-dark-text mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                Building a Multi-Agent LinkedIn Newsletter System with Google ADK
              </h3>
              
                <p class="text-sm text-gray-600 dark:text-dark-text-secondary line-clamp-2">Automating content creation with a team of AI agents that research, write, edit, and publish</p>
              
            </div>

            
            <div class="flex-shrink-0 text-primary dark:text-blue-400 group-hover:text-secondary dark:group-hover:text-purple-400 transition-colors mt-1 md:order-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
          </div>
        </a>
      
    </div>
  </div>
</nav>


        
        

        
        

        
        

<div class="comments-section mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-xl sm:text-2xl font-bold mb-6 text-gray-900 dark:text-dark-text">Comments</h3>

  
  <div id="comments-placeholder" class="hidden">
    <div class="bg-gray-100 dark:bg-dark-bg border-2 border-dashed border-gray-300 dark:border-dark-border rounded-lg p-8 text-center">
      <svg class="w-12 h-12 mx-auto mb-4 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      <h4 class="text-lg font-semibold text-gray-900 dark:text-dark-text mb-2">
        Comments Require Consent
      </h4>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
        The comment system (Giscus) uses GitHub and may set authentication cookies.
        Enable comments to join the discussion.
      </p>
      <button onclick="window.cookieConsent.enableComments()"
              class="px-6 py-2 bg-primary hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
        Enable Comments
      </button>
    </div>
  </div>

  
  <div id="giscus-wrapper" class="giscus-wrapper"></div>

  
  <script>
    (function() {
      'use strict';

      let giscusLoaded = false;
      let themeObserver = null;

      
      function loadGiscus() {
        if (giscusLoaded) return;

        const wrapper = document.getElementById('giscus-wrapper');
        const placeholder = document.getElementById('comments-placeholder');

        if (!wrapper) return;

        
        if (placeholder) placeholder.classList.add('hidden');
        wrapper.classList.remove('hidden');

        
        const script = document.createElement('script');
        script.src = 'https://giscus.app/client.js';
        script.setAttribute('data-repo', 'rchaganti\/rchaganti.github.io');
        script.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkyNzcwNTE0Mjc=');
        script.setAttribute('data-category', 'Announcements');
        script.setAttribute('data-category-id', 'DIC_kwDOEIN4I84CS4rW');
        script.setAttribute('data-mapping', 'pathname');
        script.setAttribute('data-strict', '0');
        script.setAttribute('data-reactions-enabled', '1');
        script.setAttribute('data-emit-metadata', '0');
        script.setAttribute('data-input-position', 'bottom');
        script.setAttribute('data-theme', 'light');
        script.setAttribute('data-lang', 'en');
        script.setAttribute('data-loading', 'lazy');
        script.setAttribute('crossorigin', 'anonymous');
        script.async = true;

        wrapper.appendChild(script);
        giscusLoaded = true;

        
        setupThemeObserver();
      }

      
      function updateGiscusTheme() {
        const isDark = document.documentElement.classList.contains('dark');
        const theme = isDark ? 'dark' : 'light';

        const iframe = document.querySelector('iframe.giscus-frame');
        if (iframe) {
          iframe.contentWindow.postMessage(
            { giscus: { setConfig: { theme: theme } } },
            'https://giscus.app'
          );
        }
      }

      
      function setupThemeObserver() {
        if (themeObserver) return;

        
        themeObserver = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
              updateGiscusTheme();
            }
          });
        });

        themeObserver.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ['class']
        });

        
        window.addEventListener('message', function(event) {
          if (event.origin !== 'https://giscus.app') return;
          if (!(typeof event.data === 'object' && event.data.giscus)) return;

          
          if (event.data.giscus.discussion) {
            updateGiscusTheme();
          }
        });
      }

      
      function checkConsentAndLoad() {
        if (window.cookieConsent && window.cookieConsent.hasConsent('comments')) {
          loadGiscus();
        } else {
          
          const placeholder = document.getElementById('comments-placeholder');
          if (placeholder) placeholder.classList.remove('hidden');
        }
      }

      
      window.addEventListener('loadComments', loadGiscus);
      window.addEventListener('consentChanged', checkConsentAndLoad);

      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkConsentAndLoad);
      } else {
        checkConsentAndLoad();
      }
    })();
  </script>
</div>


      </div>
      

      
      <aside class="hidden lg:block relative">
        <div class="mb-6">
          
<div class="bg-white dark:bg-dark-bg-secondary rounded-xl shadow-md dark:shadow-lg dark:shadow-black/20 p-6 mb-6">
  <div class="flex items-center gap-3 mb-4">
    <div class="w-10 h-10 bg-[#0A66C2]/10 rounded-full flex items-center justify-center">
      <svg class="w-5 h-5 text-[#0A66C2]" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
      </svg>
    </div>
    <h3 class="font-semibold text-gray-900 dark:text-dark-text">Newsletter</h3>
  </div>
  <p class="text-sm text-gray-600 dark:text-dark-text-secondary mb-4">
    Get notified about new articles on cloud, AI, and infrastructure.
  </p>
  <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank"
    rel="noopener noreferrer"
    class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-[#0A66C2] hover:bg-[#004182] !text-white text-sm font-semibold rounded-lg transition-colors no-underline">
    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
      <path
        d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
    </svg>
    Subscribe on LinkedIn
  </a>
</div>
        </div>
        <div class="mb-6">
          


  <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700">
    <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-gray-100">
      You May Also Like
    </h3>
    <div>
      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-mcp-tools/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - MCP tools
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-20">
      Dec 20, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-runner-and-execution-architecture/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - Runner and execution architecture
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-18">
      Dec 18, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-callbacks/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - Callbacks
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-12">
      Dec 12, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-sessions-state-and-memory/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - Sessions, state, and memory
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-05">
      Dec 5, 2025
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/google-adk-types-of-agents/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Google ADK - types of agents
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2025-12-03">
      Dec 3, 2025
    </time>
  </a>
</article>

      
    </div>
  </div>


        </div>
        <div class="sidebar-sticky-reinforced">
          


<div class="bg-white dark:bg-dark-bg-secondary rounded-xl shadow-md dark:shadow-lg dark:shadow-black/20 p-6 mb-6">
  <h3 class="font-semibold text-gray-900 dark:text-dark-text mb-4 flex items-center">
    <svg class="w-5 h-5 mr-2 text-gray-500 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path>
    </svg>
    Table of Contents
  </h3>

  <nav id="sidebar-toc" class="toc-sidebar text-sm max-h-[calc(100vh-200px)] overflow-y-auto custom-scrollbar">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#openapi-tools">OpenAPI tools</a>
      <ul>
        <li><a href="#the-two-key-classes">The two key classes</a></li>
        <li><a href="#how-the-toolset-generates-tools">How the toolset generates tools</a></li>
        <li><a href="#basic-usage">Basic usage</a></li>
        <li><a href="#working-with-individual-restapitool-instances">Working with individual RestApiTool instances</a></li>
      </ul>
    </li>
    <li><a href="#agents-as-tools-agenttool">Agents-as-tools (AgentTool)</a>
      <ul>
        <li><a href="#how-agenttool-differs-from-sub-agent-transfer">How AgentTool differs from sub-agent transfer</a></li>
        <li><a href="#using-agenttool">Using AgentTool</a></li>
        <li><a href="#the-skip_summarization-option">The skip_summarization option</a></li>
        <li><a href="#building-a-hierarchical-agent-system">Building a hierarchical agent system</a></li>
      </ul>
    </li>
    <li><a href="#authenticated-tools">Authenticated tools</a>
      <ul>
        <li><a href="#authentication-building-blocks">Authentication building blocks</a></li>
        <li><a href="#api-key-authentication">API key authentication</a></li>
        <li><a href="#oauth2-authentication">OAuth2 authentication</a></li>
        <li><a href="#the-interactive-oauth2-flow">The interactive OAuth2 flow</a></li>
        <li><a href="#building-custom-authenticated-tools">Building custom authenticated tools</a></li>
        <li><a href="#security-considerations-for-token-storage">Security considerations for token storage</a></li>
      </ul>
    </li>
    <li><a href="#long-running-function-tools">Long-running function tools</a>
      <ul>
        <li><a href="#how-it-differs-from-regular-tools">How it differs from regular tools</a></li>
        <li><a href="#creating-a-long-running-tool">Creating a long-running tool</a></li>
        <li><a href="#handling-the-client-side-flow">Handling the client-side flow</a></li>
        <li><a href="#sending-intermediate-progress-updates">Sending intermediate progress updates</a></li>
        <li><a href="#human-in-the-loop-patterns">Human-in-the-loop patterns</a></li>
      </ul>
    </li>
    <li><a href="#putting-it-all-together">Putting it all together</a></li>
  </ul>
</nav>
  </nav>
</div>

<style>
  #sidebar-toc ul {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }

  #sidebar-toc ul ul {
    padding-left: 1rem;
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
    border-left: 1px solid #e5e7eb;
     
  }

  .dark #sidebar-toc ul ul {
    border-color: #374151;
     
  }

  #sidebar-toc li {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }

  #sidebar-toc a {
    display: block;
    color: #4b5563;
     
    text-decoration: none;
    transition: all 0.2s;
    padding-left: 0.5rem;
    border-left: 2px solid transparent;
    margin-left: -1px;
     
  }

  #sidebar-toc a:hover {
    color: #1e40af;
     
    text-decoration: none;
  }

   
  #sidebar-toc a.active {
    color: #2563eb;
     
    font-weight: 600;
    border-left-color: #2563eb;
  }

   
  .dark #sidebar-toc a {
    color: #9ca3af;
     
  }

  .dark #sidebar-toc a:hover {
    color: #60a5fa;
     
  }

  .dark #sidebar-toc a.active {
    color: #60a5fa;
     
    border-left-color: #60a5fa;
  }

   
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #e5e7eb;
    border-radius: 20px;
  }

  .dark .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #374151;
  }
</style>


        </div>
      </aside>
    </div>
    
  </div>

  
  <script src="/js/collapse.js"></script>
  <script src="/js/code-copy.js"></script>
  <script src="/js/toc-scrollspy.js"></script>
  <script src="/js/heading-anchors.js"></script>
</article>

  </main>

  <footer class="bg-gray-900 dark:bg-dark-bg text-gray-300 dark:text-dark-text-secondary mt-16">
  <div class="container mx-auto px-4 py-8">
    <div class="text-center text-sm">
      <p>&copy; 2026 Ravikanth Chaganti. All rights reserved.</p>
    </div>
  </div>
</footer>


  
  <button id="back-to-top"
          class="fixed bottom-8 right-8 w-12 h-12 bg-primary text-white rounded-full shadow-lg hover:bg-blue-700 transition-all opacity-0 pointer-events-none z-40"
          aria-label="Back to top"
          title="Back to top">
    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
    </svg>
  </button>

  
  

  
  <script>
    
    
    
  </script>

  
  
    <script src="/js/reading-progress.js"></script>
  

  
  <script src="/js/back-to-top.js"></script>

  
  <script src="/js/theme-toggle.js"></script>

  
  <script src="/js/cookie-consent.js"></script>

  
  

  
  <script
    data-goatcounter="https://ravichaganti.goatcounter.com/count"
    async
    src="//gc.zgo.at/count.js">
  </script>



  
  
<div id="cookie-consent-banner"
     class="hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg z-50 transition-transform duration-300">
  <div class="container mx-auto px-4 py-2">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-4">

      
      <div class="flex-1">
        <p class="text-xs sm:text-sm text-gray-700 dark:text-gray-200">
          This site may load third-party content (comments, embeds) that could set cookies.
          <a href="#"
             id="cookie-learn-more"
             class="text-primary hover:underline font-medium ml-1"
             onclick="document.getElementById('cookie-customize').click(); return false;">
            Learn more
          </a>
        </p>
      </div>

      
      <div class="flex flex-row gap-2 w-full sm:w-auto flex-shrink-0">
        <button id="cookie-reject-all"
                class="px-3 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors">
          Reject
        </button>
        <button id="cookie-customize"
                class="px-3 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors">
          Settings
        </button>
        <button id="cookie-accept-all"
                class="px-3 py-1 text-xs font-medium text-white bg-primary hover:bg-blue-700 rounded transition-colors">
          Accept
        </button>
      </div>
    </div>
  </div>
</div>


<div id="cookie-settings-modal"
     class="hidden fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 z-50 flex items-center justify-center p-4 overflow-y-auto">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl my-8">

    
    <div class="bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3 rounded-t-lg">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold text-gray-900 dark:text-gray-100">
          Cookie Preferences
        </h2>
        <button id="cookie-modal-close"
                class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
                aria-label="Close">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    
    <div class="px-6 py-4 space-y-4 max-h-[calc(90vh-140px)] overflow-y-auto bg-white dark:bg-gray-800">

      
      <div class="text-sm text-gray-600 dark:text-gray-300">
        <p>
          Control what third-party content is loaded. We use privacy-friendly analytics with no cookies.
        </p>
      </div>

      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Essential
            </h3>
            <div class="flex items-center justify-center w-10 h-5 bg-primary rounded-full flex-shrink-0">
              <span class="text-xs font-medium text-white">ON</span>
            </div>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Required for the website to function. Cannot be disabled.
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>• Theme preference</li>
            <li>• Privacy-friendly analytics</li>
          </ul>
        </div>

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Comments
            </h3>
            <label class="relative inline-block w-10 h-5 flex-shrink-0">
              <input type="checkbox"
                     id="consent-comments"
                     class="peer sr-only">
              <span class="absolute inset-0 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer transition-colors peer-checked:bg-primary"></span>
              <span class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
            </label>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Giscus comment system (GitHub Discussions).
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>• Authentication cookies</li>
            <li>• GitHub privacy policy</li>
          </ul>
        </div>

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Embedded Content
            </h3>
            <label class="relative inline-block w-10 h-5 flex-shrink-0">
              <input type="checkbox"
                     id="consent-embeds"
                     class="peer sr-only">
              <span class="absolute inset-0 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer transition-colors peer-checked:bg-primary"></span>
              <span class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
            </label>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Videos, code snippets, presentations.
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>• YouTube, Gists, SlideShare</li>
            <li>• May set tracking cookies</li>
          </ul>
        </div>
      </div>

      
      <div class="bg-blue-50 dark:bg-blue-950 dark:bg-opacity-50 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
          <div class="text-sm">
            <p class="font-semibold mb-1 text-blue-800 dark:text-blue-200">Privacy First</p>
            <p class="text-xs text-gray-700 dark:text-gray-300">
              No tracking cookies. Third-party content only loads with your consent. Preferences stored locally in your browser.
            </p>
          </div>
        </div>
      </div>
    </div>

    
    <div class="bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 px-4 py-3 rounded-b-lg">
      <div class="flex justify-end">
        <button id="cookie-save-preferences"
                class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-blue-700 dark:hover:bg-blue-600 rounded transition-colors shadow-sm">
          Save Preferences
        </button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
