<!DOCTYPE html>
<html lang="en-us">
<head>
  
  <script>
    (function() {
      const stored = localStorage.getItem('theme-preference');
      const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = stored || (prefersDark ? 'dark' : 'light');

      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Building Azure Resource Manager Templates – Using Copy Object | Ravikanth Chaganti</title>

  
  <meta name="description" content="If you are following this series, by now you know how to use parameters and variables in ARM template language. We used that knowledge to create a template that creates relevant things to like storage account and virtual network. Let us revisit the scenario.

  
    
  

In this part, we will extend the template to add publicIP, load balancer, and RDP endpoints for the virtual machines. Before we do that, let us review what we need. To achieve what we want in this, we will use copy object in the template.">
  <meta name="author" content="Ravikanth Chaganti">

  
  
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
  

  
  <meta property="og:title" content="Building Azure Resource Manager Templates – Using Copy Object">
  <meta property="og:description" content="If you are following this series, by now you know how to use parameters and variables in ARM template language. We used that knowledge to create a template that creates relevant things to like storage account and virtual network. Let us revisit the scenario.

  
    
  

In this part, we will extend the template to add publicIP, load balancer, and RDP endpoints for the virtual machines. Before we do that, let us review what we need. To achieve what we want in this, we will use copy object in the template.">
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-copy-object/">
  <meta property="og:site_name" content="Ravikanth Chaganti">
  <meta property="og:locale" content="en_US">
  
  <meta property="og:image" content="https://ravichaganti.com/images/default-post.svg">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:image:alt" content="Building Azure Resource Manager Templates – Using Copy Object">

  
  
    <meta property="article:published_time" content="2015-11-17T00:00:00Z">
    <meta property="article:modified_time" content="2015-11-17T00:00:00Z">
    <meta property="article:author" content="Ravikanth Chaganti">
    <meta property="article:section" content="Azure Resource Manager">
    <meta property="article:tag" content="Azure Resource Manager"><meta property="article:tag" content="Azure"><meta property="article:tag" content="ARM Templates">
  

  
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Building Azure Resource Manager Templates – Using Copy Object">
  <meta name="twitter:description" content="If you are following this series, by now you know how to use parameters and variables in ARM template language. We used that knowledge to create a template that creates relevant things to like storage account and virtual network. Let us revisit the scenario.

  
    
  

In this part, we will extend the template to add publicIP, load balancer, and RDP endpoints for the virtual machines. Before we do that, let us review what we need. To achieve what we want in this, we will use copy object in the template.">
  <meta name="twitter:image" content="https://ravichaganti.com/images/default-post.svg">
  <meta name="twitter:site" content="@ravikanth">

  
  <link rel="canonical" href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-copy-object/">

  
  <link rel="alternate" type="application/rss+xml" href="https://ravichaganti.com/index.xml">

  
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <link rel="alternate icon" type="image/x-icon" href="/favicon.ico">

  
  <link rel="stylesheet" href="/css/main.css">

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">

  
  






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Building Azure Resource Manager Templates – Using Copy Object",
  "description": "If you are following this series, by now you know how to use parameters and variables in ARM template language. We used that knowledge to create a template that creates relevant things to like storage …",
  "articleBody": "\"If you are following this series, by now you know how to use parameters and variables in ARM template language. We used that knowledge to create a template that creates relevant things to like storage account and virtual network. Let us revisit the scenario.\\nIn this part, we will extend the template to add publicIP, load balancer, and RDP endpoints for the virtual machines. Before we do that, let us review what we need. To achieve what we want in this, we will use copy object in the template.\\nWhat is Copy Object? In our template, we already have the storage account and virtual network configuration defined. What we now need is a load balancer with a public IP so that we can access this deployment from the Internet. Also, we need the inbound NAT rules for enabling RDP access to the VMs in this deployment. But before we create the RDP rules for each VM, we need to know how many VM instances we are deploying. As shown in the scenario diagram, we need to be able to deploy this template within development, test, or production environment. Depending on the selected environment, we will have one AD DC VM along with 1 (development) or 2 (test) or 3 (production) VMs that join the AD domain. Therefore, we need a way to capture the environment type as an input parameter. Also, based on the environment type selected by the user, we need to decide on the number of VM instances required for the deployment and then create only relevant number of inbound NAT rules within the load balancer.\\nThere are multiple ways to achieve this.\\nAdd multiple resource definitions; one for each resource instance we need. This does not give the flexibility to dynamically add or remove instances based on the VM count we need. This method is not efficient. Use some kind of iterator, like other programming languages, within a resource definition and tell ARM how many resource instances we need. This can be achieved using copy object technique in ARM templates. Before we go to the copy object discussion, let us first add more parameters and variables that are needed for this template. These additional parameters will also help us with defining the iteration count within the copy object.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 \\u0026#34;parameters\\u0026#34;: { \\u0026#34;storageAccount\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Unique name for the storage account.\\u0026#34; } }, \\u0026#34;storageAccountType\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;defaultValue\\u0026#34;: \\u0026#34;Standard_LRS\\u0026#34;, \\u0026#34;allowedValues\\u0026#34;: [ \\u0026#34;Standard_LRS\\u0026#34;, \\u0026#34;Standard_GRS\\u0026#34;, \\u0026#34;Standard_ZRS\\u0026#34; ], \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Account type based on the storage redundancy requirements.\\u0026#34; } }, \\u0026#34;vNetName\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Name for the virtual network.\\u0026#34; } }, \\u0026#34;DnsName\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Unique public DNS prefix for the deployment. The fqdn will look something like \\u0026#39;\\u0026amp;lt;dnsname\\u0026amp;gt;.westus.cloudapp.azure.com\\u0026#39;.\\u0026#34; } }, \\u0026#34;environmentType\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;allowedValues\\u0026#34;: [ \\u0026#34;Development\\u0026#34;, \\u0026#34;Test\\u0026#34;, \\u0026#34;Production\\u0026#34; ], \\u0026#34;defaultValue\\u0026#34;: \\u0026#34;Development\\u0026#34;, \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Type of environment where this deployment should occur. This has an impact on the number of VMs to be depoloyed.\\u0026#34; } } } Within the new parameters, we have the dnsName parameter that will be for external access. The environmentType parameter is used to capture whether the user is deploying this template for dev, test, or production. However, based on this selection, we need a way to find out the number of VMs we need in the domain. That is, we need know the instance count for each environment. Remember our discussion on free-form vs known configurations? We don’t want to leave such choices to the end user. So, the place where this decision can be made will be in the variables element.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 \\u0026#34;variables\\u0026#34;: { \\u0026#34;vNetPrefix\\u0026#34;: \\u0026#34;10.0.0.0/16\\u0026#34;, \\u0026#34;vNetSubnet1Name\\u0026#34;: \\u0026#34;[concat(resourceGroup().Location, \\u0026#39;-\\u0026#39;, parameters(\\u0026#39;vNetName\\u0026#39;), \\u0026#39;-\\u0026#39;, \\u0026#39;Subnet\\u0026#39;)]\\u0026#34;, \\u0026#34;vNetSubnet1Prefix\\u0026#34;: \\u0026#34;10.0.0.0/24\\u0026#34;, \\u0026#34;vNetSubnet1ID\\u0026#34;: \\u0026#34;[concat(resourceId(\\u0026#39;Microsoft.Network/virtualNetworks\\u0026#39;,parameters(\\u0026#39;vNetName\\u0026#39;)),\\u0026#39;/subnets/\\u0026#39;,variables(\\u0026#39;vNetSubnet1Name\\u0026#39;))]\\u0026#34;, \\u0026#34;dnsServerPrivateIp\\u0026#34;: \\u0026#34;10.0.0.8\\u0026#34;, \\u0026#34;deploymentSize\\u0026#34;: { \\u0026#34;Development\\u0026#34;: { \\u0026#34;instancesCount\\u0026#34;: 1 }, \\u0026#34;Test\\u0026#34;: { \\u0026#34;instancesCount\\u0026#34;: 2 }, \\u0026#34;Production\\u0026#34;: { \\u0026#34;instancesCount\\u0026#34;: 3 } }, \\u0026#34;selectedDeployment\\u0026#34;: \\u0026#34;[variables(\\u0026#39;deploymentSize\\u0026#39;)[parameters(\\u0026#39;environmentType\\u0026#39;)]]\\u0026#34; } Within the variables element, we defined new variables for making it easier to select the environment type. The deploymentSize variable defines a JSON object. Within this, we are associating instancesCount to every deployment type.\\n1 2 3 4 5 6 7 8 9 10 11 \\u0026#34;deploymentSize\\u0026#34;: { \\u0026#34;Development\\u0026#34;: { \\u0026#34;instancesCount\\u0026#34;: 1 }, \\u0026#34;Test\\u0026#34;: { \\u0026#34;instancesCount\\u0026#34;: 2 }, \\u0026#34;Production\\u0026#34;: { \\u0026#34;instancesCount\\u0026#34;: 3 } } We use the selectedDeployment variable to retrieve the value of deploymentSize variable. This is done by associating the value of environmentType parameter and looking up for that in the deploymentSize variable.\\n1 \\u0026#34;selectedDeployment\\u0026#34;: \\u0026#34;[variables(\\u0026#39;deploymentSize\\u0026#39;)[parameters(\\u0026#39;environmentType\\u0026#39;)]]\\u0026#34; This works because deploymentSize is a JSON object similar to a dictionary. We can index into it using one of the key names. So, in this case, the key names will match the value passed to the environmentType parameter and indexing into that will give us the right object within _deploymentSize. _Once we have the selectedDeployment variable populated, we can access the instancesCount value by dot-referencing the property name. For example,\\n1 [variables(\\u0026#39;selectedDeployment\\u0026#39;).instancesCount]\\u0026#34; This should not be alien to us. We use variables() function and pass the selectedDeployment variable name to it. The resulting object has the instancesCount property which can then be retrieved using dot-referencing. Now that we figured this out, let us go back to the discussion around multiple instance creation within a template.\\nWorking with Copy Object As stated earlier, the reason we need instancesCount value is because we need to tell ARM how many times it has to iterate for creating the resource for which we need multiple instances. This is done within the copy object syntax.\\n1 2 3 4 \\u0026#34;copy\\u0026#34;: { \\u0026#34;name\\u0026#34;: \\u0026#34;copy loop name\\u0026#34;, \\u0026#34;count\\u0026#34;: \\u0026#34;integer value\\u0026#34; } The name property within the copy element defines a name for the iterator which can later be used for defining dependencies. The _count _property defines the number of times the iterator has to run. In our case, we will set the value of count property to the instancesCount value we retrieve from the selectedDeployment.\\nWe place this inside the resource definition. In our scenario, we will use the copy object within Microsoft.Network/loadBalancers/inboundNatRules resource type. Let us first see the new resources that we need to enable public IP and load balancer configuration. We will then review the resource definition to understand how we use the copy object.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 \\u0026#34;resources\\u0026#34;: [ { \\u0026#34;name\\u0026#34;: \\u0026#34;[parameters(\\u0026#39;storageAccountName\\u0026#39;)]\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Storage/storageAccounts\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[ResourceGroup().Location]\\u0026#34;, \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-05-01-preview\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;accountType\\u0026#34;: \\u0026#34;[parameters(\\u0026#39;storageAccountType\\u0026#39;)]\\u0026#34; } }, { \\u0026#34;name\\u0026#34;: \\u0026#34;[parameters(\\u0026#39;vNetName\\u0026#39;)]\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Network/virtualNetworks\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[ResourceGroup().Location]\\u0026#34;, \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-05-01-preview\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;addressSpace\\u0026#34;: { \\u0026#34;addressPrefixes\\u0026#34;: [ \\u0026#34;[variables(\\u0026#39;vNetPrefix\\u0026#39;)]\\u0026#34; ] }, \\u0026#34;subnets\\u0026#34;: [ { \\u0026#34;name\\u0026#34;: \\u0026#34;[variables(\\u0026#39;vNetSubnet1Name\\u0026#39;)]\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;addressPrefix\\u0026#34;: \\u0026#34;[variables(\\u0026#39;vNetSubnet1Prefix\\u0026#39;)]\\u0026#34; } } ] } }, { \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-05-01-preview\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Network/publicIPAddresses\\u0026#34;, \\u0026#34;name\\u0026#34;: \\u0026#34;publicIp\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[resourceGroup().location]\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;publicIPAllocationMethod\\u0026#34;: \\u0026#34;Dynamic\\u0026#34;, \\u0026#34;dnsSettings\\u0026#34;: { \\u0026#34;domainNameLabel\\u0026#34;: \\u0026#34;[parameters(\\u0026#39;DnsName\\u0026#39;)]\\u0026#34; } } }, { \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-05-01-preview\\u0026#34;, \\u0026#34;name\\u0026#34;: \\u0026#34;loadBalancer\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Network/loadBalancers\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[resourceGroup().location]\\u0026#34;, \\u0026#34;dependsOn\\u0026#34;: [ \\u0026#34;Microsoft.Network/publicIPAddresses/publicIp\\u0026#34; ], \\u0026#34;properties\\u0026#34;: { \\u0026#34;frontendIPConfigurations\\u0026#34;: [ { \\u0026#34;name\\u0026#34;: \\u0026#34;[variables(\\u0026#39;lbFrontend\\u0026#39;)]\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;publicIPAddress\\u0026#34;: { \\u0026#34;id\\u0026#34;: \\u0026#34;[resourceId(\\u0026#39;Microsoft.Network/publicIPAddresses\\u0026#39;,\\u0026#39;publicIp\\u0026#39;)]\\u0026#34; } } } ], \\u0026#34;backendAddressPools\\u0026#34;: [ { \\u0026#34;name\\u0026#34;: \\u0026#34;[variables(\\u0026#39;lbBackendAddrPool\\u0026#39;)]\\u0026#34; } ] } }, { \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-06-15\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Network/loadBalancers/inboundNatRules\\u0026#34;, \\u0026#34;copy\\u0026#34;: { \\u0026#34;name\\u0026#34;: \\u0026#34;lbRdpNatLoop\\u0026#34;, \\u0026#34;count\\u0026#34;: \\u0026#34;[variables(\\u0026#39;selectedDeployment\\u0026#39;).instancesCount]\\u0026#34; }, \\u0026#34;name\\u0026#34;: \\u0026#34;[concat(\\u0026#39;/loadbalancer/\\u0026#39;,\\u0026#39;VM-\\u0026#39;, copyIndex(1),\\u0026#39;-RDP\\u0026#39;)]\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[resourceGroup().location]\\u0026#34;, \\u0026#34;dependsOn\\u0026#34;: [ \\u0026#34;[concat(\\u0026#39;Microsoft.Network/loadBalancers/loadBalancer\\u0026#39;)]\\u0026#34; ], \\u0026#34;properties\\u0026#34;: { \\u0026#34;frontendIPConfiguration\\u0026#34;: { \\u0026#34;id\\u0026#34;: \\u0026#34;[resourceId(\\u0026#39;Microsoft.Network/loadBalancers/frontendIPConfigurations\\u0026#39;,\\u0026#39;loadBalancer\\u0026#39;,variables(\\u0026#39;lbFrontend\\u0026#39;))]\\u0026#34; }, \\u0026#34;protocol\\u0026#34;: \\u0026#34;tcp\\u0026#34;, \\u0026#34;frontendPort\\u0026#34;: \\u0026#34;[add(3389, copyIndex(1))]\\u0026#34;, \\u0026#34;backendPort\\u0026#34;: 3389, \\u0026#34;enableFloatingIP\\u0026#34;: false } } ] In this updated resource collection, we have added three resource types. A public IP address to assign it to the load balancer, a load balancer that will act as a container for the VM endpoints, and finally, RDP endpoints based on the number of VM instances we need.\\nObserve the highlighted lines in the resource collection. The copy object that we used within the inboundNATRules resource type tells ARM how many instances we need to create based on the VM count we need.\\n1 2 3 4 \\u0026#34;copy\\u0026#34;: { \\u0026#34;name\\u0026#34;: \\u0026#34;lbRdpNatLoop\\u0026#34;, \\u0026#34;count\\u0026#34;: \\u0026#34;[variables(\\u0026#39;selectedDeployment\\u0026#39;).instancesCount]\\u0026#34; }, Within an ARM template, for each resource type and its instances, the name property should carry a unique value. Without this, you will see an error during deployment that multiple instances cannot use the same name. So, if you look at line number 77, we are dynamically constructing the value for name.\\n1 \\u0026#34;name\\u0026#34;: \\u0026#34;[concat(\\u0026#39;/loadbalancer/\\u0026#39;,\\u0026#39;VM-\\u0026#39;, copyIndex(1),\\u0026#39;-RDP\\u0026#39;)]\\u0026#34; As you see here, we are concatenating ‘/loadbalancer/’ with ‘VM-‘ and then using the copyIndex() function and finally add ‘-RDP’. The copyIndex() function gives us the iteration number. So, if we are creating three VM endpoints within this resource definition, we get iteration values 0, 1, and 2. The index always starts from 0. However, if we want to offset it to different value than zero, we can specify the value inside the copyIndex() function. In my example, I am using 1 so that the values the template receives will be 1, 2, and 3. Since we are using the iteration number within the name value, we always get an unique identifier.\\nAnother function that we are using within this template update is the add() function. This function, as its name suggests, adds integers. I am using this function to dynamically derive the frontend port number for the VM RDP endpoint.\\n1 \\u0026#34;frontendPort\\u0026#34;: \\u0026#34;[add(3389, copyIndex(1))]\\u0026#34; We are doing this since all VM RDP endpoints should be accessible through the load balancer. By using add function, we are adding the iteration value to the RDP port (3389) to derive a unique value.\\nNow that we have completed our discussion on the copy object and its usage, let us move on to see the ARM template update that creates storage account, virtual network, public IP, load balancer, and finally the VM RDP endpoints. We are not creating an RDP endpoint for the DC VM.\\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 { \\u0026#34;$schema\\u0026#34;: \\u0026#34;https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\\u0026#34;, \\u0026#34;contentVersion\\u0026#34;: \\u0026#34;1.0.0.0\\u0026#34;, \\u0026#34;parameters\\u0026#34;: { \\u0026#34;storageAccountName\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Unique name for the storage account.\\u0026#34; } }, \\u0026#34;storageAccountType\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;defaultValue\\u0026#34;: \\u0026#34;Standard_LRS\\u0026#34;, \\u0026#34;allowedValues\\u0026#34;: [ \\u0026#34;Standard_LRS\\u0026#34;, \\u0026#34;Standard_GRS\\u0026#34;, \\u0026#34;Standard_ZRS\\u0026#34;, \\u0026#34;Premium_LRS\\u0026#34;, \\u0026#34;Standard_RAGRS\\u0026#34; ], \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Account type based on the storage redundancy requirements.\\u0026#34; } }, \\u0026#34;vNetName\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Name for the virtual network.\\u0026#34; } }, \\u0026#34;DnsName\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Unique public DNS prefix for the deployment. The fqdn will look something like \\u0026#39;\\u0026amp;lt;dnsname\\u0026amp;gt;.westus.cloudapp.azure.com\\u0026#39;.\\u0026#34; } }, \\u0026#34;environmentType\\u0026#34;: { \\u0026#34;type\\u0026#34;: \\u0026#34;string\\u0026#34;, \\u0026#34;allowedValues\\u0026#34;: [ \\u0026#34;Development\\u0026#34;, \\u0026#34;Test\\u0026#34;, \\u0026#34;Production\\u0026#34; ], \\u0026#34;defaultValue\\u0026#34;: \\u0026#34;Development\\u0026#34;, \\u0026#34;metadata\\u0026#34;: { \\u0026#34;description\\u0026#34;: \\u0026#34;Type of environment where this deployment should occur. This has an impact on the number of VMs to be depoloyed.\\u0026#34; } } }, \\u0026#34;variables\\u0026#34;: { \\u0026#34;vNetPrefix\\u0026#34;: \\u0026#34;10.0.0.0/16\\u0026#34;, \\u0026#34;vNetSubnet1Name\\u0026#34;: \\u0026#34;[concat(resourceGroup().Location, \\u0026#39;-\\u0026#39;, parameters(\\u0026#39;vNetName\\u0026#39;), \\u0026#39;-\\u0026#39;, \\u0026#39;Subnet\\u0026#39;)]\\u0026#34;, \\u0026#34;vNetSubnet1Prefix\\u0026#34;: \\u0026#34;10.0.0.0/24\\u0026#34;, \\u0026#34;vNetSubnet1ID\\u0026#34;: \\u0026#34;[concat(resourceId(\\u0026#39;Microsoft.Network/virtualNetworks\\u0026#39;,parameters(\\u0026#39;vNetName\\u0026#39;)),\\u0026#39;/subnets/\\u0026#39;,variables(\\u0026#39;vNetSubnet1Name\\u0026#39;))]\\u0026#34;, \\u0026#34;dnsServerPrivateIp\\u0026#34;: \\u0026#34;10.0.0.8\\u0026#34;, \\u0026#34;lbFrontend\\u0026#34;: \\u0026#34;lbFrontEnd\\u0026#34;, \\u0026#34;lbBackendAddrPool\\u0026#34;: \\u0026#34;lbBackEndPool\\u0026#34;, \\u0026#34;deploymentSize\\u0026#34;: { \\u0026#34;Development\\u0026#34;: { \\u0026#34;instancesCount\\u0026#34;: 1 }, \\u0026#34;Test\\u0026#34;: { \\u0026#34;instancesCount\\u0026#34;: 2 }, \\u0026#34;Production\\u0026#34;: { \\u0026#34;instancesCount\\u0026#34;: 3 } }, \\u0026#34;selectedDeployment\\u0026#34;: \\u0026#34;[variables(\\u0026#39;deploymentSize\\u0026#39;)[parameters(\\u0026#39;environmentType\\u0026#39;)]]\\u0026#34; }, \\u0026#34;resources\\u0026#34;: [ { \\u0026#34;name\\u0026#34;: \\u0026#34;[parameters(\\u0026#39;storageAccountName\\u0026#39;)]\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Storage/storageAccounts\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[ResourceGroup().Location]\\u0026#34;, \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-05-01-preview\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;accountType\\u0026#34;: \\u0026#34;[parameters(\\u0026#39;storageAccountType\\u0026#39;)]\\u0026#34; } }, { \\u0026#34;name\\u0026#34;: \\u0026#34;[parameters(\\u0026#39;vNetName\\u0026#39;)]\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Network/virtualNetworks\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[ResourceGroup().Location]\\u0026#34;, \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-05-01-preview\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;addressSpace\\u0026#34;: { \\u0026#34;addressPrefixes\\u0026#34;: [ \\u0026#34;[variables(\\u0026#39;vNetPrefix\\u0026#39;)]\\u0026#34; ] }, \\u0026#34;subnets\\u0026#34;: [ { \\u0026#34;name\\u0026#34;: \\u0026#34;[variables(\\u0026#39;vNetSubnet1Name\\u0026#39;)]\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;addressPrefix\\u0026#34;: \\u0026#34;[variables(\\u0026#39;vNetSubnet1Prefix\\u0026#39;)]\\u0026#34; } } ] } }, { \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-05-01-preview\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Network/publicIPAddresses\\u0026#34;, \\u0026#34;name\\u0026#34;: \\u0026#34;publicIp\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[resourceGroup().location]\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;publicIPAllocationMethod\\u0026#34;: \\u0026#34;Dynamic\\u0026#34;, \\u0026#34;dnsSettings\\u0026#34;: { \\u0026#34;domainNameLabel\\u0026#34;: \\u0026#34;[parameters(\\u0026#39;DnsName\\u0026#39;)]\\u0026#34; } } }, { \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-05-01-preview\\u0026#34;, \\u0026#34;name\\u0026#34;: \\u0026#34;loadBalancer\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Network/loadBalancers\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[resourceGroup().location]\\u0026#34;, \\u0026#34;dependsOn\\u0026#34;: [ \\u0026#34;Microsoft.Network/publicIPAddresses/publicIp\\u0026#34; ], \\u0026#34;properties\\u0026#34;: { \\u0026#34;frontendIPConfigurations\\u0026#34;: [ { \\u0026#34;name\\u0026#34;: \\u0026#34;[variables(\\u0026#39;lbFrontend\\u0026#39;)]\\u0026#34;, \\u0026#34;properties\\u0026#34;: { \\u0026#34;publicIPAddress\\u0026#34;: { \\u0026#34;id\\u0026#34;: \\u0026#34;[resourceId(\\u0026#39;Microsoft.Network/publicIPAddresses\\u0026#39;,\\u0026#39;publicIp\\u0026#39;)]\\u0026#34; } } } ], \\u0026#34;backendAddressPools\\u0026#34;: [ { \\u0026#34;name\\u0026#34;: \\u0026#34;[variables(\\u0026#39;lbBackendAddrPool\\u0026#39;)]\\u0026#34; } ] } }, { \\u0026#34;apiVersion\\u0026#34;: \\u0026#34;2015-06-15\\u0026#34;, \\u0026#34;type\\u0026#34;: \\u0026#34;Microsoft.Network/loadBalancers/inboundNatRules\\u0026#34;, \\u0026#34;copy\\u0026#34;: { \\u0026#34;name\\u0026#34;: \\u0026#34;lbRdpNatLoop\\u0026#34;, \\u0026#34;count\\u0026#34;: \\u0026#34;[variables(\\u0026#39;selectedDeployment\\u0026#39;).instancesCount]\\u0026#34; }, \\u0026#34;name\\u0026#34;: \\u0026#34;[concat(\\u0026#39;/loadbalancer/\\u0026#39;,\\u0026#39;VM-\\u0026#39;, copyIndex(1),\\u0026#39;-RDP\\u0026#39;)]\\u0026#34;, \\u0026#34;location\\u0026#34;: \\u0026#34;[resourceGroup().location]\\u0026#34;, \\u0026#34;dependsOn\\u0026#34;: [ \\u0026#34;[concat(\\u0026#39;Microsoft.Network/loadBalancers/loadBalancer\\u0026#39;)]\\u0026#34; ], \\u0026#34;properties\\u0026#34;: { \\u0026#34;frontendIPConfiguration\\u0026#34;: { \\u0026#34;id\\u0026#34;: \\u0026#34;[resourceId(\\u0026#39;Microsoft.Network/loadBalancers/frontendIPConfigurations\\u0026#39;,\\u0026#39;loadBalancer\\u0026#39;,variables(\\u0026#39;lbFrontend\\u0026#39;))]\\u0026#34; }, \\u0026#34;protocol\\u0026#34;: \\u0026#34;tcp\\u0026#34;, \\u0026#34;frontendPort\\u0026#34;: \\u0026#34;[add(3389, copyIndex(1))]\\u0026#34;, \\u0026#34;backendPort\\u0026#34;: 3389, \\u0026#34;enableFloatingIP\\u0026#34;: false } } ] } You can go ahead and deploy this update by clicking on the button below. This brings up the portal and prompts for the parameter values we need for the deployment. Within the parameters, you will see the environmentType dropdown with three possible values. I have selected Production as the input here and I expect to see three RDP endpoints created at the end of template deployment. Let us see if this worked.\\nAs you see here, the endpoints with respective frontend port numbers are created. We will have to associate these endpoints to VM network interfaces and we will take that up in a later part. Stay tuned.\\n\"",
  "url": "https:\/\/ravichaganti.com\/blog\/building-azure-resource-manager-templates-using-copy-object\/",
  "datePublished": "2015-11-17T00:00:00Z",
  "dateModified": "2015-11-17T00:00:00Z",
  "author": {
    "@type": "Person",
    "name": "Ravikanth Chaganti"
    ,"sameAs": ["https://twitter.com/ravikanth"]
  },
  "publisher": {
    "@type": "Person",
    "name": "Ravikanth Chaganti",
    "sameAs": ["https://twitter.com/ravikanth"]
  },
  
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/ravichaganti.com\/images\/default-post.svg",
    "width": 1200,
    "height": 630
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/ravichaganti.com\/blog\/building-azure-resource-manager-templates-using-copy-object\/"
  },
  
  "articleSection": "\"Azure Resource Manager\"",
  
  
  "keywords": "[\"Azure Resource Manager\",\"Azure\",\"ARM Templates\"]",
  
  
  "timeRequired": "PT11M",
  
  "inLanguage": "en-US",
  "isAccessibleForFree": true
}
</script>




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https:\/\/ravichaganti.com\/"
    }
    ,
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Blog",
      "item": "https:\/\/ravichaganti.com\/blog/"
    }
    
    ,
    {
      "@type": "ListItem",
      "position": 3,
      "name": "Azure Resource Manager",
      "item": "https:\/\/ravichaganti.com\/categories/azure-resource-manager/"
    },
    {
      "@type": "ListItem",
      "position": 4,
      "name": "Building Azure Resource Manager Templates – Using Copy Object",
      "item": "https:\/\/ravichaganti.com\/blog\/building-azure-resource-manager-templates-using-copy-object\/"
    }
    
    
  ]
}
</script>


</head>

<body class="flex flex-col min-h-screen bg-gray-50 dark:bg-dark-bg">
  <header class="sticky top-0 z-50 bg-white dark:bg-dark-bg-secondary shadow-md relative">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      
      <div class="flex items-center">
        <a href="https://ravichaganti.com/" class="flex items-center gap-3 text-gray-900 dark:text-dark-text hover:text-primary transition-colors no-underline group">
          
          <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
            <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2" class="group-hover:stroke-primary transition-colors"/>
            <text x="20" y="26" font-family="sans-serif" font-size="16" font-weight="bold" text-anchor="middle" fill="currentColor">RC</text>
          </svg>
          
          <div class="flex flex-col leading-tight">
            <span class="text-xs sm:text-sm font-semibold">Cloud Native</span>
            <span class="text-xs sm:text-sm font-semibold">Agentic AI</span>
            <span class="text-xs sm:text-sm font-semibold">Infrastructure</span>
          </div>
        </a>
      </div>

      
      <div class="hidden md:flex items-center space-x-8">
        
          <a href="/blog/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Blog
          </a>
        
          <a href="/books/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Books
          </a>
        
          <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank" rel="noopener noreferrer" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            Newsletter
          </a>
        
          <a href="/about/" class="text-gray-700 dark:text-dark-text-secondary hover:text-primary font-medium transition-all no-underline hover:underline hover:decoration-blue-500 hover:decoration-2 hover:underline-offset-4">
            About
          </a>
        
      </div>

      
      <div class="hidden md:flex items-center space-x-4 relative" id="social-search-container">
        
        <div id="social-icons" class="flex items-center space-x-3">
          

<a href="https://twitter.com/ravikanth" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Twitter">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
  </svg>
</a>



<a href="https://github.com/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="GitHub">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"/>
  </svg>
</a>



<a href="https://linkedin.com/in/rchaganti" target="_blank" rel="noopener noreferrer" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="LinkedIn">
  <svg class="w-5 h-5 text-gray-700 dark:text-dark-text hover:text-primary dark:hover:text-blue-400" fill="currentColor" viewBox="0 0 24 24">
    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
  </svg>
</a>




        </div>

        
        <button
          id="theme-toggle"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="search-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <div id="search-box" class="hidden absolute top-full right-0 mt-2 w-80 bg-white dark:bg-dark-bg-secondary shadow-lg p-4 z-50 rounded-lg">
          





<div class="relative search-container" data-mode="desktop">
  <input
    type="text"
    id="search-input-desktop"
    placeholder="Search articles..."
    class="search-input w-full px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results-desktop" class="search-results absolute top-full mt-2 w-full bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-80 overflow-y-auto z-50">
    
  </div>
</div>



<script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>


<script>
(function() {
  let headerFuse;
  let headerSearchData = [];
  let searchInitialized = false;

  
  fetch('/index.json')
    .then(response => response.json())
    .then(data => {
      headerSearchData = data;

      
      const options = {
        keys: [
          { name: 'title', weight: 3 },
          { name: 'excerpt', weight: 2 },
          { name: 'content', weight: 1 },
          { name: 'categories', weight: 1.5 },
          { name: 'series', weight: 1.5 }
        ],
        threshold: 0.4,
        includeScore: true,
        ignoreLocation: true,
        minMatchCharLength: 2
      };

      headerFuse = new Fuse(headerSearchData, options);
      searchInitialized = true;
    })
    .catch(error => console.error('Error loading search index:', error));

  
  function renderResults(results, resultsContainer) {
    if (results.length === 0) {
      resultsContainer.innerHTML = '<div class="p-4 text-center text-gray-500 dark:text-dark-text-secondary text-sm">No results found</div>';
      resultsContainer.classList.remove('hidden');
      return;
    }

    resultsContainer.innerHTML = results.slice(0, 5).map(result => {
      const item = result.item;
      const date = new Date(item.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

      return `
        <a href="${item.permalink}" class="block p-3 hover:bg-gray-50 dark:hover:bg-dark-bg-tertiary border-b border-gray-100 dark:border-dark-border last:border-b-0 no-underline">
          <div class="font-medium text-sm text-gray-900 dark:text-dark-text mb-1">${item.title}</div>
          <div class="flex items-center gap-2 mb-1 flex-wrap">
            <span class="text-xs text-gray-500 dark:text-dark-text-secondary">${date}</span>
            ${item.categories ? item.categories.slice(0, 2).map(cat => `
              <span class="inline-block px-1.5 py-0.5 text-xs rounded bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400">
                ${cat}
              </span>
            `).join('') : ''}
          </div>
          ${item.excerpt ? `<p class="text-xs text-gray-600 dark:text-dark-text-secondary line-clamp-2">${item.excerpt}</p>` : ''}
        </a>
      `;
    }).join('');

    resultsContainer.classList.remove('hidden');
  }

  
  function initSearchContainers() {
    const containers = document.querySelectorAll('.search-container');

    containers.forEach(container => {
      const searchInput = container.querySelector('.search-input');
      const searchResults = container.querySelector('.search-results');

      if (!searchInput || !searchResults) return;

      
      searchInput.addEventListener('input', function(e) {
        const query = e.target.value.trim();

        if (query.length < 2 || !searchInitialized) {
          searchResults.classList.add('hidden');
          return;
        }

        const results = headerFuse.search(query);
        renderResults(results, searchResults);
      });

      
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          searchResults.classList.add('hidden');
          searchInput.blur();
        }
      });
    });

    
    function closeAllResults(e) {
      const containers = document.querySelectorAll('.search-container');
      containers.forEach(container => {
        const searchResults = container.querySelector('.search-results');
        if (searchResults && !container.contains(e.target)) {
          searchResults.classList.add('hidden');
        }
      });
    }

    document.addEventListener('click', closeAllResults);
    document.addEventListener('touchend', closeAllResults);
  }

  
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initSearchContainers);
  } else {
    initSearchContainers();
  }
})();
</script>


        </div>
      </div>

      
      <div class="md:hidden flex items-center gap-2">
        
        <button id="search-toggle-mobile" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors" aria-label="Search">
          <svg class="w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </button>

        
        <button
          id="theme-toggle-mobile"
          class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded-full transition-colors"
          aria-label="Toggle dark mode"
          title="Toggle dark mode"
        >
          
          <svg class="theme-icon-sun w-5 h-5 text-gray-700 dark:text-dark-text hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>

          
          <svg class="theme-icon-moon w-5 h-5 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>

        
        <button id="mobile-menu-toggle" class="p-2 hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary rounded" aria-label="Menu">
          <svg class="w-6 h-6 text-gray-700 dark:text-dark-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>

    
    <div id="search-box-mobile" class="hidden md:hidden absolute top-full left-0 right-0 bg-white dark:bg-dark-bg-secondary shadow-lg p-4 z-50">
      





<div class="relative search-container" data-mode="mobile">
  <input
    type="text"
    id="search-input-mobile"
    placeholder="Search articles..."
    class="search-input w-full px-4 py-2 text-sm border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-bg-secondary text-gray-900 dark:text-dark-text rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"
    aria-label="Search"
    autocomplete="off"
  >
  <div id="search-results-mobile" class="search-results absolute top-full mt-2 w-full bg-white dark:bg-dark-bg-secondary border border-gray-200 dark:border-dark-border rounded-lg shadow-xl hidden max-h-80 overflow-y-auto z-50">
    
  </div>
</div>




    </div>

    
    <div id="mobile-menu" class="hidden md:hidden mt-4 pb-4">
      
        <a href="/blog/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Blog
        </a>
      
        <a href="/books/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Books
        </a>
      
        <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384" target="_blank" rel="noopener noreferrer" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          Newsletter
        </a>
      
        <a href="/about/" class="block py-3 px-2 text-base text-gray-700 dark:text-dark-text-secondary hover:text-primary hover:bg-gray-100 dark:hover:bg-dark-bg-tertiary transition-colors no-underline rounded-md min-h-[44px] flex items-center">
          About
        </a>
      
    </div>
  </nav>

  
  
    <div id="reading-progress" class="absolute bottom-0 left-0 w-full h-1 bg-primary transition-all duration-200 z-10" style="width: 0%; max-width: 100%;"></div>
  
</header>


<script>
  document.getElementById('mobile-menu-toggle')?.addEventListener('click', function() {
    const menu = document.getElementById('mobile-menu');
    menu?.classList.toggle('hidden');
  });

  
  document.getElementById('search-toggle')?.addEventListener('click', function() {
    const searchBox = document.getElementById('search-box');
    searchBox?.classList.toggle('hidden');
    if (!searchBox?.classList.contains('hidden')) {
      searchBox?.querySelector('.search-input')?.focus();
    }
  });

  
  document.getElementById('search-toggle-mobile')?.addEventListener('click', function() {
    const searchBoxMobile = document.getElementById('search-box-mobile');
    searchBoxMobile?.classList.toggle('hidden');
    if (!searchBoxMobile?.classList.contains('hidden')) {
      searchBoxMobile?.querySelector('.search-input')?.focus();
    }
  });

  
  document.addEventListener('click', function(e) {
    const searchBox = document.getElementById('search-box');
    const searchToggle = document.getElementById('search-toggle');
    if (searchBox && searchToggle && !searchBox.contains(e.target) && !searchToggle.contains(e.target)) {
      searchBox.classList.add('hidden');
    }
  });

  
  document.addEventListener('click', function(e) {
    const searchBoxMobile = document.getElementById('search-box-mobile');
    const searchToggleMobile = document.getElementById('search-toggle-mobile');
    if (searchBoxMobile && searchToggleMobile && !searchBoxMobile.contains(e.target) && !searchToggleMobile.contains(e.target)) {
      searchBoxMobile.classList.add('hidden');
    }
  });
</script>


  <main class="flex-grow">
    
<article class="container mx-auto px-4 sm:px-6 md:px-4 py-8 sm:py-10 md:py-12">
  <div class="max-w-7xl mx-auto">
    <div class="grid grid-cols-1 lg:grid-cols-[75%_25%] gap-8">
      
      <div class="min-w-0">
        
        <header class="mb-8">
      
      <nav class="text-xs sm:text-sm mb-4">
        <ol class="flex items-center space-x-2 text-gray-600 dark:text-dark-text-secondary">
          <li><a href="https://ravichaganti.com/" class="hover:text-primary dark:hover:text-blue-400">Home</a></li>
          <li><span class="mx-2">/</span></li>
          <li><a href="/blog/" class="hover:text-primary dark:hover:text-blue-400">Blog</a></li>
          
            <li><span class="mx-2">/</span></li>
            <li><a href="/categories/azure-resource-manager/" class="hover:text-primary dark:hover:text-blue-400">Azure Resource Manager</a></li>
          
        </ol>
      </nav>

      
      <h1 class="text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 dark:text-dark-text mb-6">
        Building Azure Resource Manager Templates – Using Copy Object
      </h1>

      
      <div class="flex flex-wrap items-center gap-2 sm:gap-3 md:gap-4 text-sm sm:text-base text-gray-600 dark:text-dark-text-secondary mb-6">
        
        <div class="flex items-center">
          <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <time datetime="2015-11-17">November 17, 2015</time>
        </div>

        
        
          <span>•</span>
          <div class="flex items-center">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <span>11 min read</span>
          </div>
        

        
        

        
        
          <span>•</span>
          

  <div class="inline-flex items-center gap-2 text-sm text-gray-600 dark:text-dark-text-secondary">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
    </svg>
    <span id="view-count" class="font-medium">
      <span class="inline-block w-12 h-4 bg-gray-200 dark:bg-dark-bg-tertiary animate-pulse rounded"></span>
    </span>
    <span>views</span>
  </div>

  <script>
    (function() {
      
      const path = window.location.pathname;

      
      
      const apiUrl = `https://ravichaganti.goatcounter.com/counter/${encodeURIComponent(path)}.json`;

      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Stats not available');
          }
          return response.json();
        })
        .then(data => {
          const viewCount = data.count || 0;
          const formattedCount = viewCount.toLocaleString();
          document.getElementById('view-count').textContent = formattedCount;
        })
        .catch(error => {
          
          console.log('View count not available:', error);
          document.getElementById('view-count').textContent = '—';
        });
    })();
  </script>


        
      </div>

      
      <div class="flex flex-wrap gap-2 mb-6">
        
          
            <a href="/categories/azure-resource-manager/" class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Azure Resource Manager
            </a>
          
            <a href="/categories/azure/" class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              Azure
            </a>
          
            <a href="/categories/arm-templates/" class="inline-block px-3 py-1 text-sm font-medium bg-primary/10 dark:bg-primary/20 text-primary dark:text-blue-400 rounded-full hover:bg-primary/20 dark:hover:bg-primary/30 transition-colors no-underline">
              ARM Templates
            </a>
          
        
        
          
            <a href="/series/arm-templates/" class="inline-block px-3 py-1 text-sm font-medium bg-secondary/10 dark:bg-secondary/20 text-secondary dark:text-purple-400 rounded-full hover:bg-secondary/20 dark:hover:bg-secondary/30 transition-colors no-underline">
              📚 Series: ARM Templates
            </a>
          
        
      </div>

      
      
    </header>

    
    


  
  
  
    <aside class="bg-gradient-to-br from-secondary/5 to-primary/5 dark:from-secondary/10 dark:to-primary/10 rounded-lg shadow-md dark:shadow-2xl dark:shadow-black/20 p-4 mb-6 border border-secondary/20 dark:border-secondary/30">
      
      <button
        class="flex items-center justify-between w-full text-left font-semibold text-base text-gray-900 dark:text-dark-text hover:text-secondary dark:hover:text-purple-400 transition-colors"
        aria-expanded="false"
        aria-controls="series-content"
      >
        <span class="flex items-center">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
          </svg>
          Series: ARM Templates
        </span>
        <svg
          id="series-chevron"
          class="w-4 h-4 transform transition-transform -rotate-90"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
        </svg>
      </button>

      
      <p class="text-xs text-gray-600 dark:text-dark-text-secondary mt-2 mb-2 collapsed" id="series-description">
        Part of a 11-part series
      </p>

      
      <nav id="series-content" class="series-content collapsed mt-1">
        <ol class="space-y-3">
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                1
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-an-introduction/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building Azure Resource Manager Templates – An Introduction
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Nov 2, 2015</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                2
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-the-basics/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building Azure Resource Manager Templates – The Basics
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Nov 6, 2015</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                3
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-parameters/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building Azure Resource Manager Templates – Using Parameters
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Nov 10, 2015</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                4
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-variables/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building Azure Resource Manager Templates – Using Variables
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Nov 15, 2015</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                5
              </span>
              <div class="flex-grow">
                
                  <span class="font-bold text-secondary dark:text-purple-400">
                    Building Azure Resource Manager Templates – Using Copy Object
                    <span class="text-xs ml-2 px-2 py-0.5 bg-secondary dark:bg-purple-600 text-white rounded">You are here</span>
                  </span>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Nov 17, 2015</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                6
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-defining-resource-dependencies/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building Azure Resource Manager Templates – Defining Resource Dependencies
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 8, 2015</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                7
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-linked-templates/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building Azure Resource Manager Templates – Using Linked Templates
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 14, 2015</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                8
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-putting-it-all-together/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building Azure Resource Manager Templates – Putting it all together
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Dec 18, 2015</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                9
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-domain-join-extension/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building Azure Resource Manager Templates – Using Domain Join Extension
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Feb 13, 2016</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                10
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-forcing-wmf-4-0-when-using-dsc-extension/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Building Azure Resource Manager Templates – Forcing WMF 4.0 when using DSC Extension
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Feb 15, 2016</p>
              </div>
            </li>
          
            <li class="flex items-start">
              <span class="flex-shrink-0 w-6 h-6 rounded-full bg-secondary/20 dark:bg-secondary/30 text-secondary dark:text-purple-400 flex items-center justify-center text-xs font-bold mr-3 mt-0.5">
                11
              </span>
              <div class="flex-grow">
                
                  <a href="https://ravichaganti.com/blog/custom-template-deployment-improvements-in-azure-portal/" class="text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline hover:underline">
                    Custom Template Deployment Improvements in Azure Portal
                  </a>
                
                <p class="text-xs text-gray-500 dark:text-dark-text-muted mt-1">Mar 29, 2016</p>
              </div>
            </li>
          
        </ol>

        
        <div class="mt-6 pt-6 border-t border-secondary/20 dark:border-secondary/30 grid grid-cols-2 gap-4">
          
          
            
          
            
          
            
          
            
          
            
              
            
          
            
          
            
          
            
          
            
          
            
          
            
          

          
          
            
            <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-variables/" class="flex items-center text-sm text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline group">
              <svg class="w-4 h-4 mr-1 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
              <span class="truncate">Building Azure Resource Manager Templates – Using Variables</span>
            </a>
          

          
          
            
            <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-defining-resource-dependencies/" class="flex items-center justify-end text-sm text-gray-700 dark:text-dark-text-secondary hover:text-secondary dark:hover:text-purple-400 transition-colors no-underline group">
              <span class="truncate">Building Azure Resource Manager Templates – Defining Resource Dependencies</span>
              <svg class="w-4 h-4 ml-1 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </a>
          
        </div>
      </nav>
    </aside>
  



    
    



    
    <div class="prose prose-sm sm:prose-base md:prose-lg max-w-none mb-8 sm:mb-10 md:mb-12">
      <p>If you are following this series, by now you know how to use parameters and variables in ARM template language. We used that knowledge to create a template that creates relevant things to like storage account and virtual network. Let us revisit the scenario.</p>
<figure class="figure " style="max-width: 100%; margin: 1.5rem auto;">
  <a href="/images/armtemplate5-1.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/armtemplate5-1.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<p>In this part, we will extend the template to add publicIP, load balancer, and RDP endpoints for the virtual machines. Before we do that, let us review what we need. To achieve what we want in this, we will use copy object in the template.</p>
<h4 id="what-iscopy-object">What is Copy Object?</h4>
<p>In our template, we already have the storage account and virtual network configuration defined. What we now need is a load balancer with a public IP so that we can access this deployment from the Internet. Also, we need the inbound NAT rules for enabling RDP access to the VMs in this deployment. But before we create the RDP rules for each VM, we need to know how many VM instances we are deploying. As shown in the scenario diagram, we need to be able to deploy this template within development, test, or production environment. Depending on the selected environment, we will have one AD DC VM along with 1 (development) or 2 (test) or 3 (production) VMs that join the AD domain. Therefore, we need a way to capture the environment type as an input parameter. Also, based on the environment type selected by the user, we need to decide on the number of VM instances required for the deployment and then create only relevant number of inbound NAT rules within the load balancer.</p>
<p>There are multiple ways to achieve this.</p>
<ol>
<li>Add multiple resource definitions; one for each resource instance we need. This does not give the flexibility to dynamically add or remove instances based on the VM count we need. This method is not efficient.</li>
<li>Use some kind of iterator, like other programming languages, within a resource definition and tell ARM how many resource instances we need. This can be achieved using copy object technique in ARM templates.</li>
</ol>
<p>Before we go to the copy object discussion, let us first add more parameters and variables that are needed for this template. These additional parameters will also help us with defining the iteration count within the copy object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;parameters&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;storageAccount&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Unique name for the storage account.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;storageAccountType&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;defaultValue&#34;</span><span class="p">:</span> <span class="s2">&#34;Standard_LRS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;allowedValues&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Standard_LRS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Standard_GRS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Standard_ZRS&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Account type based on the storage redundancy requirements.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vNetName&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Name for the virtual network.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;DnsName&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Unique public DNS prefix for the deployment. The fqdn will look something like &#39;&amp;lt;dnsname&amp;gt;.westus.cloudapp.azure.com&#39;.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;environmentType&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;allowedValues&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Test&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Production&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;defaultValue&#34;</span><span class="p">:</span> <span class="s2">&#34;Development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Type of environment where this deployment should occur. This has an impact on the number of VMs to be depoloyed.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Within the new parameters, we have the <em>dnsName</em> parameter that will be for external access. The <em>environmentType</em> parameter is used to capture whether the user is deploying this template for dev, test, or production. However, based on this selection, we need a way to find out the number of VMs we need in the domain. That is, we need know the instance count for each environment. Remember our discussion on free-form vs known configurations? We don’t want to leave such choices to the end user. So, the place where this decision can be made will be in the variables element.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;variables&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vNetPrefix&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.0/16&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vNetSubnet1Name&#34;</span><span class="p">:</span> <span class="s2">&#34;[concat(resourceGroup().Location, &#39;-&#39;, parameters(&#39;vNetName&#39;), &#39;-&#39;, &#39;Subnet&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vNetSubnet1Prefix&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.0/24&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;vNetSubnet1ID&#34;</span><span class="p">:</span> <span class="s2">&#34;[concat(resourceId(&#39;Microsoft.Network/virtualNetworks&#39;,parameters(&#39;vNetName&#39;)),&#39;/subnets/&#39;,variables(&#39;vNetSubnet1Name&#39;))]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;dnsServerPrivateIp&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;deploymentSize&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;Development&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;instancesCount&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;Test&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;instancesCount&#34;</span><span class="p">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;Production&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;instancesCount&#34;</span><span class="p">:</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;selectedDeployment&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;deploymentSize&#39;)[parameters(&#39;environmentType&#39;)]]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Within the variables element, we defined new variables for making it easier to select the environment type. The <em>deploymentSize</em> variable defines a JSON object. Within this, we are associating <em>instancesCount</em> to every deployment type.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;deploymentSize&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Development&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;instancesCount&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Test&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;instancesCount&#34;</span><span class="p">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;Production&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;instancesCount&#34;</span><span class="p">:</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We use the <em>selectedDeployment</em> variable to retrieve the value of <em>deploymentSize</em> variable. This is done by associating the value of environmentType parameter and looking up for that in the <em>deploymentSize</em> variable.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;selectedDeployment&#34;</span><span class="err">:</span> <span class="s2">&#34;[variables(&#39;deploymentSize&#39;)[parameters(&#39;environmentType&#39;)]]&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This works because <em>deploymentSize</em> is a JSON object similar to a dictionary. We can index into it using one of the key names. So, in this case, the key names will match the value passed to the <em>environmentType</em> parameter and indexing into that will give us the right object within _deploymentSize. _Once we have the selectedDeployment variable populated, we can access the <em>instancesCount</em> value by dot-referencing the property name. For example,</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="p">[</span><span class="n">variables</span><span class="p">(</span><span class="s1">&#39;selectedDeployment&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">instancesCount</span><span class="p">]</span><span class="s2">&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>This should not be alien to us. We use <em>variables()</em> function and pass the <em>selectedDeployment</em> variable name to it. The resulting object has the <em>instancesCount</em> property which can then be retrieved using dot-referencing. Now that we figured this out, let us go back to the discussion around multiple instance creation within a template.</p>
<h4 id="working-with-copy-object">Working with Copy Object</h4>
<p>As stated earlier, the reason we need <em>instancesCount</em> value is because we need to tell ARM how many times it has to iterate for creating the resource for which we need multiple instances. This is done within the <a href="https://azure.microsoft.com/en-us/documentation/articles/resource-group-create-multiple/#copy-copyindex-and-length">copy object syntax</a>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;copy&#34;: { 
</span></span><span class="line"><span class="cl">    &#34;name&#34;: &#34;copy loop name&#34;, 
</span></span><span class="line"><span class="cl">    &#34;count&#34;: &#34;integer value&#34; 
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>The <em>name</em> property within the <em>copy</em> element defines a name for the iterator which can later be used for defining dependencies. The _count _property defines the number of times the iterator has to run. In our case, we will set the value of count property to the <em>instancesCount</em> value we retrieve from the <em>selectedDeployment.</em></p>
<p>We place this inside the resource definition. In our scenario, we will use the copy object within <em>Microsoft.Network/loadBalancers/inboundNatRules</em> resource type. Let us first see the new resources that we need to enable public IP and load balancer configuration. We will then review the resource definition to understand how we use the copy object.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;resources&#34;</span><span class="err">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[parameters(&#39;storageAccountName&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Storage/storageAccounts&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[ResourceGroup().Location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-05-01-preview&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;accountType&#34;</span><span class="p">:</span> <span class="s2">&#34;[parameters(&#39;storageAccountType&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[parameters(&#39;vNetName&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Network/virtualNetworks&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[ResourceGroup().Location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-05-01-preview&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;addressSpace&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;addressPrefixes&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;[variables(&#39;vNetPrefix&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;subnets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;vNetSubnet1Name&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;addressPrefix&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;vNetSubnet1Prefix&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-05-01-preview&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Network/publicIPAddresses&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;publicIp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceGroup().location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;publicIPAllocationMethod&#34;</span><span class="p">:</span> <span class="s2">&#34;Dynamic&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;dnsSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;domainNameLabel&#34;</span><span class="p">:</span> <span class="s2">&#34;[parameters(&#39;DnsName&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-05-01-preview&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;loadBalancer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Network/loadBalancers&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceGroup().location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;dependsOn&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;Microsoft.Network/publicIPAddresses/publicIp&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;frontendIPConfigurations&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;lbFrontend&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;publicIPAddress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceId(&#39;Microsoft.Network/publicIPAddresses&#39;,&#39;publicIp&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;backendAddressPools&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;lbBackendAddrPool&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-06-15&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Network/loadBalancers/inboundNatRules&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;copy&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;lbRdpNatLoop&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;count&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;selectedDeployment&#39;).instancesCount]&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[concat(&#39;/loadbalancer/&#39;,&#39;VM-&#39;, copyIndex(1),&#39;-RDP&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceGroup().location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;dependsOn&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;[concat(&#39;Microsoft.Network/loadBalancers/loadBalancer&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;frontendIPConfiguration&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceId(&#39;Microsoft.Network/loadBalancers/frontendIPConfigurations&#39;,&#39;loadBalancer&#39;,variables(&#39;lbFrontend&#39;))]&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;frontendPort&#34;</span><span class="p">:</span> <span class="s2">&#34;[add(3389, copyIndex(1))]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;backendPort&#34;</span><span class="p">:</span> <span class="mi">3389</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;enableFloatingIP&#34;</span><span class="p">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In this updated resource collection, we have added three resource types. A public IP address to assign it to the load balancer, a load balancer that will act as a container for the VM endpoints, and finally, RDP endpoints based on the number of VM instances we need.</p>
<p>Observe the highlighted lines in the resource collection. The copy object that we used within the inboundNATRules resource type tells ARM how many instances we need to create based on the VM count we need.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="s2">&#34;copy&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;lbRdpNatLoop&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;count&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;selectedDeployment&#39;).instancesCount]&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Within an ARM template, for each resource type and its instances, the <em>name</em> property should carry a unique value. Without this, you will see an error during deployment that multiple instances cannot use the same name. So, if you look at line number 77, we are dynamically constructing the value for <em>name.</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="s2">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[concat(&#39;/loadbalancer/&#39;,&#39;VM-&#39;, copyIndex(1),&#39;-RDP&#39;)]&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As you see here, we are concatenating ‘/loadbalancer/’ with ‘VM-‘ and then using the <a href="https://azure.microsoft.com/en-us/documentation/articles/resource-group-template-functions/#copyindex"><em>copyIndex()</em></a> function and finally add ‘-RDP’. The <em>copyIndex()</em> function gives us the iteration number. So, if we are creating three VM endpoints within this resource definition, we get iteration values 0, 1, and 2. The index always starts from 0. However, if we want to offset it to different value than zero, we can specify the value inside the <em>copyIndex()</em> function. In my example, I am using 1 so that the values the template receives will be 1, 2, and 3. Since we are using the iteration number within the name value, we always get an unique identifier.</p>
<p>Another function that we are using within this template update is the <em><a href="https://azure.microsoft.com/en-us/documentation/articles/resource-group-template-functions/#add">add()</a></em> function. This function, as its name suggests, adds integers. I am using this function to dynamically derive the frontend port number for the VM RDP endpoint.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;frontendPort&#34;: &#34;[add(3389, copyIndex(1))]&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>We are doing this since all VM RDP endpoints should be accessible through the load balancer. By using add function, we are adding the iteration value to the RDP port (3389) to derive a unique value.</p>
<p>Now that we have completed our discussion on the copy object and its usage, let us move on to see the ARM template update that creates storage account, virtual network, public IP, load balancer, and finally the VM RDP endpoints. We are not creating an RDP endpoint for the DC VM.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;$schema&#34;</span><span class="p">:</span> <span class="s2">&#34;https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;contentVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;1.0.0.0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;storageAccountName&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Unique name for the storage account.&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;storageAccountType&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;defaultValue&#34;</span><span class="p">:</span> <span class="s2">&#34;Standard_LRS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;allowedValues&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Standard_LRS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Standard_GRS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Standard_ZRS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Premium_LRS&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Standard_RAGRS&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Account type based on the storage redundancy requirements.&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;vNetName&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Name for the virtual network.&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;DnsName&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Unique public DNS prefix for the deployment. The fqdn will look something like &#39;&amp;lt;dnsname&amp;gt;.westus.cloudapp.azure.com&#39;.&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;environmentType&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;string&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;allowedValues&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Test&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Production&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;defaultValue&#34;</span><span class="p">:</span> <span class="s2">&#34;Development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Type of environment where this deployment should occur. This has an impact on the number of VMs to be depoloyed.&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;variables&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;vNetPrefix&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.0/16&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;vNetSubnet1Name&#34;</span><span class="p">:</span> <span class="s2">&#34;[concat(resourceGroup().Location, &#39;-&#39;, parameters(&#39;vNetName&#39;), &#39;-&#39;, &#39;Subnet&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;vNetSubnet1Prefix&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.0/24&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;vNetSubnet1ID&#34;</span><span class="p">:</span> <span class="s2">&#34;[concat(resourceId(&#39;Microsoft.Network/virtualNetworks&#39;,parameters(&#39;vNetName&#39;)),&#39;/subnets/&#39;,variables(&#39;vNetSubnet1Name&#39;))]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;dnsServerPrivateIp&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.8&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;lbFrontend&#34;</span><span class="p">:</span> <span class="s2">&#34;lbFrontEnd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;lbBackendAddrPool&#34;</span><span class="p">:</span> <span class="s2">&#34;lbBackEndPool&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;deploymentSize&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Development&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;instancesCount&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Test&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;instancesCount&#34;</span><span class="p">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;Production&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;instancesCount&#34;</span><span class="p">:</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;selectedDeployment&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;deploymentSize&#39;)[parameters(&#39;environmentType&#39;)]]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;resources&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[parameters(&#39;storageAccountName&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Storage/storageAccounts&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[ResourceGroup().Location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-05-01-preview&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;accountType&#34;</span><span class="p">:</span> <span class="s2">&#34;[parameters(&#39;storageAccountType&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[parameters(&#39;vNetName&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Network/virtualNetworks&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[ResourceGroup().Location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-05-01-preview&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;addressSpace&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;addressPrefixes&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;[variables(&#39;vNetPrefix&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;subnets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;vNetSubnet1Name&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;addressPrefix&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;vNetSubnet1Prefix&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-05-01-preview&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Network/publicIPAddresses&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;publicIp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceGroup().location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;publicIPAllocationMethod&#34;</span><span class="p">:</span> <span class="s2">&#34;Dynamic&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;dnsSettings&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;domainNameLabel&#34;</span><span class="p">:</span> <span class="s2">&#34;[parameters(&#39;DnsName&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-05-01-preview&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;loadBalancer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Network/loadBalancers&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceGroup().location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;dependsOn&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Microsoft.Network/publicIPAddresses/publicIp&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;frontendIPConfigurations&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;lbFrontend&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;publicIPAddress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceId(&#39;Microsoft.Network/publicIPAddresses&#39;,&#39;publicIp&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;backendAddressPools&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;lbBackendAddrPool&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;apiVersion&#34;</span><span class="p">:</span> <span class="s2">&#34;2015-06-15&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Network/loadBalancers/inboundNatRules&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;copy&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;lbRdpNatLoop&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;count&#34;</span><span class="p">:</span> <span class="s2">&#34;[variables(&#39;selectedDeployment&#39;).instancesCount]&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[concat(&#39;/loadbalancer/&#39;,&#39;VM-&#39;, copyIndex(1),&#39;-RDP&#39;)]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;location&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceGroup().location]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;dependsOn&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;[concat(&#39;Microsoft.Network/loadBalancers/loadBalancer&#39;)]&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;frontendIPConfiguration&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;[resourceId(&#39;Microsoft.Network/loadBalancers/frontendIPConfigurations&#39;,&#39;loadBalancer&#39;,variables(&#39;lbFrontend&#39;))]&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;protocol&#34;</span><span class="p">:</span> <span class="s2">&#34;tcp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;frontendPort&#34;</span><span class="p">:</span> <span class="s2">&#34;[add(3389, copyIndex(1))]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;backendPort&#34;</span><span class="p">:</span> <span class="mi">3389</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;enableFloatingIP&#34;</span><span class="p">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can go ahead and deploy this update by clicking on the button below. </p>
<div style="margin: 1.5rem 0;">
  <a href="https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fraw.githubusercontent.com%2Frchaganti%2Farmseries%2Fmaster%2Farm-series_Storage-VirtualNet-LB.json" target="_blank" rel="noopener noreferrer">
    <img src="https://aka.ms/deploytoazurebutton" alt="Deploy to Azure" style="height: 32px; border: none;">
  </a>
</div>

<figure class="figure " style="max-width: 100%; margin: 1.5rem auto;">
  <a href="/images/armtemplate5-2.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/armtemplate5-2.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<p>This brings up the portal and prompts for the parameter values we need for the deployment. Within the parameters, you will see the <em>environmentType</em> dropdown with three possible values. I have selected Production as the input here and I expect to see three RDP endpoints created at the end of template deployment. Let us see if this worked.</p>
<figure class="figure " style="max-width: 100%; margin: 1.5rem auto;">
  <a href="/images/armtemplate5-3.png" class="glightbox" data-gallery="post-images" data-glightbox="description: ">
    <img src="/images/armtemplate5-3.png" alt="" loading="lazy" style="width: 100%; height: auto; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
  </a></figure>

<p><a href="http://139.59.40.198/blog/uploads/2015/11/RDPEndpoints.png"></a></p>
<p>As you see here, the endpoints with respective frontend port numbers are created. We will have to associate these endpoints to VM network interfaces and we will take that up in a later part. Stay tuned.</p>

    </div>

    
    
      <div class="mb-8">
        <h3 class="text-sm font-semibold text-gray-600 dark:text-dark-text-secondary mb-3">Tags:</h3>
        <div class="flex flex-wrap gap-2">
          
            <a href="/tags/azure-resource-manager/" class="inline-block px-3 py-1 text-sm bg-gray-100 dark:bg-dark-bg-tertiary text-gray-700 dark:text-dark-text rounded hover:bg-gray-200 dark:hover:bg-dark-border transition-colors no-underline">
              #Azure Resource Manager
            </a>
          
            <a href="/tags/azure/" class="inline-block px-3 py-1 text-sm bg-gray-100 dark:bg-dark-bg-tertiary text-gray-700 dark:text-dark-text rounded hover:bg-gray-200 dark:hover:bg-dark-border transition-colors no-underline">
              #Azure
            </a>
          
            <a href="/tags/arm-templates/" class="inline-block px-3 py-1 text-sm bg-gray-100 dark:bg-dark-bg-tertiary text-gray-700 dark:text-dark-text rounded hover:bg-gray-200 dark:hover:bg-dark-border transition-colors no-underline">
              #ARM Templates
            </a>
          
        </div>
      </div>
    

    
    

<div class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-lg font-bold mb-4 text-center text-gray-900 dark:text-dark-text">Share this article</h3>
  <div class="flex flex-wrap justify-center items-center gap-3 sm:gap-4">
    
    <button
      onclick="shareNative()"
      class="sm:hidden w-12 h-12 rounded-full bg-primary hover:bg-primary/90 dark:bg-blue-600 dark:hover:bg-blue-700 text-white flex items-center justify-center transition-colors shadow-md hover:shadow-lg"
      aria-label="Share"
      title="Share"
      id="native-share-btn"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
      </svg>
    </button>

    
    <a
      href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fbuilding-azure-resource-manager-templates-using-copy-object%2F&text=Building&#43;Azure&#43;Resource&#43;Manager&#43;Templates&#43;%E2%80%93&#43;Using&#43;Copy&#43;Object"
      target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-[#1DA1F2] hover:bg-[#1a8cd8] text-white flex items-center justify-center transition-all no-underline shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Share on Twitter"
      title="Share on Twitter"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
      </svg>
    </a>

    
    <a
      href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fravichaganti.com%2Fblog%2Fbuilding-azure-resource-manager-templates-using-copy-object%2F"
      target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-[#0077B5] hover:bg-[#006399] text-white flex items-center justify-center transition-all no-underline shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Share on LinkedIn"
      title="Share on LinkedIn"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
      </svg>
    </a>

    
    <a
      href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fravichaganti.com%2Fblog%2Fbuilding-azure-resource-manager-templates-using-copy-object%2F"
      target="_blank"
      rel="noopener noreferrer"
      class="w-12 h-12 rounded-full bg-[#1877F2] hover:bg-[#1564d3] text-white flex items-center justify-center transition-all no-underline shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Share on Facebook"
      title="Share on Facebook"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </svg>
    </a>

    
    <button
      onclick="copyToClipboard('https:\/\/ravichaganti.com\/blog\/building-azure-resource-manager-templates-using-copy-object\/')"
      class="w-12 h-12 rounded-full bg-accent hover:bg-amber-600 dark:bg-amber-500 dark:hover:bg-amber-600 text-white flex items-center justify-center transition-all shadow-md hover:shadow-lg hover:scale-105"
      aria-label="Copy link"
      title="Copy link"
      id="copy-link-btn"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
      </svg>
    </button>
  </div>
</div>

<script>

function shareNative() {
  if (navigator.share) {
    navigator.share({
      title: 'Building Azure Resource Manager Templates – Using Copy Object',
      text: 'If you are following this series, by now you know how to use parameters and variables in ARM template language. We used that knowledge to create a template that creates relevant things to like storage …',
      url: 'https:\/\/ravichaganti.com\/blog\/building-azure-resource-manager-templates-using-copy-object\/'
    }).catch(function(error) {
      console.log('Error sharing:', error);
    });
  }
}


function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(function() {
    const btn = document.getElementById('copy-link-btn');
    const originalHTML = btn.innerHTML;
    const originalTitle = btn.title;

    
    btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
    btn.title = 'Copied!';

    
    setTimeout(function() {
      btn.innerHTML = originalHTML;
      btn.title = originalTitle;
    }, 2000);
  }).catch(function(error) {
    console.error('Failed to copy:', error);
    alert('Failed to copy link. Please copy manually: ' + text);
  });
}
</script>



    
    
<nav class="mt-12 pt-8 border-t border-gray-200 dark:border-dark-border" aria-label="Post navigation">
  
  
  
  

  
  
  
    
    
    

    
    
    

    
    
    
      
    
      
    
      
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    

    
    
      
        
        
      
      
        
        
      
    
  

  
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    
    <div class="flex">
      
        <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-variables/"
           class="flex-1 group card hover:shadow-xl transition-all hover:scale-[1.02] no-underline"
           aria-label="Previous in ARM Templates: Building Azure Resource Manager Templates – Using Variables">
          <div class="flex items-start gap-3">
            
            <div class="flex-shrink-0 text-primary dark:text-blue-400 group-hover:text-secondary dark:group-hover:text-purple-400 transition-colors mt-1">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
              </svg>
            </div>

            
            <div class="flex-1 min-w-0">
              <p class="text-xs text-gray-500 dark:text-dark-text-muted mb-1 uppercase tracking-wide">Previous in ARM Templates</p>
              <h3 class="text-base font-bold text-gray-900 dark:text-dark-text mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                Building Azure Resource Manager Templates – Using Variables
              </h3>
              
            </div>
          </div>
        </a>
      
    </div>

    
    <div class="flex">
      
        <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-defining-resource-dependencies/"
           class="flex-1 group card hover:shadow-xl transition-all hover:scale-[1.02] no-underline"
           aria-label="Next in ARM Templates: Building Azure Resource Manager Templates – Defining Resource Dependencies">
          <div class="flex items-start gap-3">
            
            <div class="flex-1 min-w-0 text-right md:text-left md:order-1">
              <p class="text-xs text-gray-500 dark:text-dark-text-muted mb-1 uppercase tracking-wide">Next in ARM Templates</p>
              <h3 class="text-base font-bold text-gray-900 dark:text-dark-text mb-2 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">
                Building Azure Resource Manager Templates – Defining Resource Dependencies
              </h3>
              
            </div>

            
            <div class="flex-shrink-0 text-primary dark:text-blue-400 group-hover:text-secondary dark:group-hover:text-purple-400 transition-colors mt-1 md:order-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
              </svg>
            </div>
          </div>
        </a>
      
    </div>
  </div>
</nav>


    
    

    
    

    
    

<div class="comments-section mt-12 pt-8 border-t border-gray-200 dark:border-dark-border">
  <h3 class="text-xl sm:text-2xl font-bold mb-6 text-gray-900 dark:text-dark-text">Comments</h3>

  
  <div id="comments-placeholder" class="hidden">
    <div class="bg-gray-100 dark:bg-dark-bg border-2 border-dashed border-gray-300 dark:border-dark-border rounded-lg p-8 text-center">
      <svg class="w-12 h-12 mx-auto mb-4 text-gray-400 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      <h4 class="text-lg font-semibold text-gray-900 dark:text-dark-text mb-2">
        Comments Require Consent
      </h4>
      <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
        The comment system (Giscus) uses GitHub and may set authentication cookies.
        Enable comments to join the discussion.
      </p>
      <button onclick="window.cookieConsent.enableComments()"
              class="px-6 py-2 bg-primary hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">
        Enable Comments
      </button>
    </div>
  </div>

  
  <div id="giscus-wrapper" class="giscus-wrapper"></div>

  
  <script>
    (function() {
      'use strict';

      let giscusLoaded = false;
      let themeObserver = null;

      
      function loadGiscus() {
        if (giscusLoaded) return;

        const wrapper = document.getElementById('giscus-wrapper');
        const placeholder = document.getElementById('comments-placeholder');

        if (!wrapper) return;

        
        if (placeholder) placeholder.classList.add('hidden');
        wrapper.classList.remove('hidden');

        
        const script = document.createElement('script');
        script.src = 'https://giscus.app/client.js';
        script.setAttribute('data-repo', 'rchaganti\/rchaganti.github.io');
        script.setAttribute('data-repo-id', 'MDEwOlJlcG9zaXRvcnkyNzcwNTE0Mjc=');
        script.setAttribute('data-category', 'Announcements');
        script.setAttribute('data-category-id', 'DIC_kwDOEIN4I84CS4rW');
        script.setAttribute('data-mapping', 'pathname');
        script.setAttribute('data-strict', '0');
        script.setAttribute('data-reactions-enabled', '1');
        script.setAttribute('data-emit-metadata', '0');
        script.setAttribute('data-input-position', 'bottom');
        script.setAttribute('data-theme', 'light');
        script.setAttribute('data-lang', 'en');
        script.setAttribute('data-loading', 'lazy');
        script.setAttribute('crossorigin', 'anonymous');
        script.async = true;

        wrapper.appendChild(script);
        giscusLoaded = true;

        
        setupThemeObserver();
      }

      
      function updateGiscusTheme() {
        const isDark = document.documentElement.classList.contains('dark');
        const theme = isDark ? 'dark' : 'light';

        const iframe = document.querySelector('iframe.giscus-frame');
        if (iframe) {
          iframe.contentWindow.postMessage(
            { giscus: { setConfig: { theme: theme } } },
            'https://giscus.app'
          );
        }
      }

      
      function setupThemeObserver() {
        if (themeObserver) return;

        
        themeObserver = new MutationObserver(function(mutations) {
          mutations.forEach(function(mutation) {
            if (mutation.attributeName === 'class') {
              updateGiscusTheme();
            }
          });
        });

        themeObserver.observe(document.documentElement, {
          attributes: true,
          attributeFilter: ['class']
        });

        
        window.addEventListener('message', function(event) {
          if (event.origin !== 'https://giscus.app') return;
          if (!(typeof event.data === 'object' && event.data.giscus)) return;

          
          if (event.data.giscus.discussion) {
            updateGiscusTheme();
          }
        });
      }

      
      function checkConsentAndLoad() {
        if (window.cookieConsent && window.cookieConsent.hasConsent('comments')) {
          loadGiscus();
        } else {
          
          const placeholder = document.getElementById('comments-placeholder');
          if (placeholder) placeholder.classList.remove('hidden');
        }
      }

      
      window.addEventListener('loadComments', loadGiscus);
      window.addEventListener('consentChanged', checkConsentAndLoad);

      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', checkConsentAndLoad);
      } else {
        checkConsentAndLoad();
      }
    })();
  </script>
</div>


      </div>
      

      
      <aside class="hidden lg:block">
        
<div class="bg-white dark:bg-dark-bg-secondary rounded-xl shadow-md dark:shadow-lg dark:shadow-black/20 p-6 mb-6 sticky top-4">
  <div class="flex items-center gap-3 mb-4">
    <div class="w-10 h-10 bg-[#0A66C2]/10 rounded-full flex items-center justify-center">
      <svg class="w-5 h-5 text-[#0A66C2]" fill="currentColor" viewBox="0 0 24 24">
        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
      </svg>
    </div>
    <h3 class="font-semibold text-gray-900 dark:text-dark-text">Newsletter</h3>
  </div>
  <p class="text-sm text-gray-600 dark:text-dark-text-secondary mb-4">
    Get notified about new articles on cloud, AI, and infrastructure.
  </p>
  <a href="https://www.linkedin.com/build-relation/newsletter-follow?entityUrn=7418529089365520384"
     target="_blank"
     rel="noopener noreferrer"
     class="flex items-center justify-center gap-2 w-full px-4 py-2 bg-[#0A66C2] hover:bg-[#004182] !text-white text-sm font-semibold rounded-lg transition-colors no-underline">
    <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
      <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
    </svg>
    Subscribe on LinkedIn
  </a>
</div>

        


  <div class="bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700">
    <h3 class="text-lg font-bold mb-4 text-gray-900 dark:text-gray-100">
      You May Also Like
    </h3>
    <div>
      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-putting-it-all-together/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Building Azure Resource Manager Templates – Putting it all together
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2015-12-18">
      Dec 18, 2015
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-linked-templates/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Building Azure Resource Manager Templates – Using Linked Templates
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2015-12-14">
      Dec 14, 2015
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-defining-resource-dependencies/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Building Azure Resource Manager Templates – Defining Resource Dependencies
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2015-12-08">
      Dec 8, 2015
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-variables/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Building Azure Resource Manager Templates – Using Variables
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2015-11-15">
      Nov 15, 2015
    </time>
  </a>
</article>

      
        
<article class="mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 last:border-b-0 last:mb-0 last:pb-0">
  <a href="https://ravichaganti.com/blog/building-azure-resource-manager-templates-using-parameters/" class="no-underline block group">
    
    <h4 class="text-sm font-bold text-gray-900 dark:text-gray-100 group-hover:text-primary dark:group-hover:text-blue-400 transition-colors line-clamp-2 mb-1">
      Building Azure Resource Manager Templates – Using Parameters
    </h4>

    
    <time class="text-xs text-gray-500 dark:text-gray-400" datetime="2015-11-10">
      Nov 10, 2015
    </time>
  </a>
</article>

      
    </div>
  </div>


      </aside>
    </div>
    
  </div>

  
  <script src="/js/collapse.js"></script>
  <script src="/js/code-copy.js"></script>
</article>

  </main>

  <footer class="bg-gray-900 dark:bg-dark-bg text-gray-300 dark:text-dark-text-secondary mt-16">
  <div class="container mx-auto px-4 py-8">
    <div class="text-center text-sm">
      <p>&copy; 2026 Ravikanth Chaganti. All rights reserved.</p>
    </div>
  </div>
</footer>


  
  <button id="back-to-top"
          class="fixed bottom-8 right-8 w-12 h-12 bg-primary text-white rounded-full shadow-lg hover:bg-blue-700 transition-all opacity-0 pointer-events-none z-40"
          aria-label="Back to top"
          title="Back to top">
    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
    </svg>
  </button>

  
  

  
  <script>
    
    
    
  </script>

  
  
    <script src="/js/reading-progress.js"></script>
  

  
  <script src="/js/back-to-top.js"></script>

  
  <script src="/js/theme-toggle.js"></script>

  
  <script src="/js/cookie-consent.js"></script>

  
  

  
  <script
    data-goatcounter="https://ravichaganti.goatcounter.com/count"
    async
    src="//gc.zgo.at/count.js">
  </script>



  
  
<div id="cookie-consent-banner"
     class="hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg z-50 transition-transform duration-300">
  <div class="container mx-auto px-4 py-2">
    <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-2 sm:gap-4">

      
      <div class="flex-1">
        <p class="text-xs sm:text-sm text-gray-700 dark:text-gray-200">
          This site may load third-party content (comments, embeds) that could set cookies.
          <a href="#"
             id="cookie-learn-more"
             class="text-primary hover:underline font-medium ml-1"
             onclick="document.getElementById('cookie-customize').click(); return false;">
            Learn more
          </a>
        </p>
      </div>

      
      <div class="flex flex-row gap-2 w-full sm:w-auto flex-shrink-0">
        <button id="cookie-reject-all"
                class="px-3 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors">
          Reject
        </button>
        <button id="cookie-customize"
                class="px-3 py-1 text-xs font-medium text-gray-700 dark:text-gray-200 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 rounded transition-colors">
          Settings
        </button>
        <button id="cookie-accept-all"
                class="px-3 py-1 text-xs font-medium text-white bg-primary hover:bg-blue-700 rounded transition-colors">
          Accept
        </button>
      </div>
    </div>
  </div>
</div>


<div id="cookie-settings-modal"
     class="hidden fixed inset-0 bg-black bg-opacity-50 dark:bg-opacity-70 z-50 flex items-center justify-center p-4 overflow-y-auto">
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl my-8">

    
    <div class="bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3 rounded-t-lg">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-bold text-gray-900 dark:text-gray-100">
          Cookie Preferences
        </h2>
        <button id="cookie-modal-close"
                class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors"
                aria-label="Close">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    
    <div class="px-6 py-4 space-y-4 max-h-[calc(90vh-140px)] overflow-y-auto bg-white dark:bg-gray-800">

      
      <div class="text-sm text-gray-600 dark:text-gray-300">
        <p>
          Control what third-party content is loaded. We use privacy-friendly analytics with no cookies.
        </p>
      </div>

      
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-gray-50 dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Essential
            </h3>
            <div class="flex items-center justify-center w-10 h-5 bg-primary rounded-full flex-shrink-0">
              <span class="text-xs font-medium text-white">ON</span>
            </div>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Required for the website to function. Cannot be disabled.
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>• Theme preference</li>
            <li>• Privacy-friendly analytics</li>
          </ul>
        </div>

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Comments
            </h3>
            <label class="relative inline-block w-10 h-5 flex-shrink-0">
              <input type="checkbox"
                     id="consent-comments"
                     class="peer sr-only">
              <span class="absolute inset-0 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer transition-colors peer-checked:bg-primary"></span>
              <span class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
            </label>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Giscus comment system (GitHub Discussions).
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>• Authentication cookies</li>
            <li>• GitHub privacy policy</li>
          </ul>
        </div>

        
        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 bg-white dark:bg-gray-900">
          <div class="flex items-start justify-between gap-2 mb-2">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">
              Embedded Content
            </h3>
            <label class="relative inline-block w-10 h-5 flex-shrink-0">
              <input type="checkbox"
                     id="consent-embeds"
                     class="peer sr-only">
              <span class="absolute inset-0 bg-gray-300 dark:bg-gray-600 rounded-full cursor-pointer transition-colors peer-checked:bg-primary"></span>
              <span class="absolute left-0.5 top-0.5 w-4 h-4 bg-white rounded-full transition-transform peer-checked:translate-x-5"></span>
            </label>
          </div>
          <p class="text-xs text-gray-600 dark:text-gray-300 mb-2">
            Videos, code snippets, presentations.
          </p>
          <ul class="text-xs text-gray-500 dark:text-gray-400 space-y-1">
            <li>• YouTube, Gists, SlideShare</li>
            <li>• May set tracking cookies</li>
          </ul>
        </div>
      </div>

      
      <div class="bg-blue-50 dark:bg-blue-950 dark:bg-opacity-50 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
        <div class="flex items-start gap-3">
          <svg class="w-5 h-5 text-blue-600 dark:text-blue-400 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
          </svg>
          <div class="text-sm">
            <p class="font-semibold mb-1 text-blue-800 dark:text-blue-200">Privacy First</p>
            <p class="text-xs text-gray-700 dark:text-gray-300">
              No tracking cookies. Third-party content only loads with your consent. Preferences stored locally in your browser.
            </p>
          </div>
        </div>
      </div>
    </div>

    
    <div class="bg-gray-50 dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700 px-4 py-3 rounded-b-lg">
      <div class="flex justify-end">
        <button id="cookie-save-preferences"
                class="px-4 py-2 text-sm font-medium text-white bg-primary hover:bg-blue-700 dark:hover:bg-blue-600 rounded transition-colors shadow-sm">
          Save Preferences
        </button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
