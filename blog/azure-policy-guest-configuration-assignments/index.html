<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <script src="https://ravichaganti.com/js/view.js"></script>
    <script id="dsq-count-scr" src="//ravikanth.disqus.com/count.js" async></script>
    <link rel="stylesheet" href="https://ravichaganti.com/css/syntax.css">
    <meta name="author" content="Ravikanth Chaganti">
    <meta name="description" content="In the last part of this series around Azure Policy Guest Configuration, you got an introduction to what is Guest Configuration. In this part, you will learn about assigning Guest Configuration policies and initiatives.
Azure Policy Guest Configuration (GC) is an extension to Azure Policy and therefore use the same JSON definition structure. For example, here is the (redacted) GC definition for the policy Audit Windows machines that do not have the specified Windows PowerShell execution policy.">
    <meta name="keywords" content="blog,microsoft,mvp,powershell,automation,author, innovator, speaker">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Azure Policy Guest Configuration - Assignments"/>
<meta name="twitter:description" content="In the last part of this series around Azure Policy Guest Configuration, you got an introduction to what is Guest Configuration. In this part, you will learn about assigning Guest Configuration policies and initiatives.
Azure Policy Guest Configuration (GC) is an extension to Azure Policy and therefore use the same JSON definition structure. For example, here is the (redacted) GC definition for the policy Audit Windows machines that do not have the specified Windows PowerShell execution policy."/>

    <meta property="og:title" content="Azure Policy Guest Configuration - Assignments" />
<meta property="og:description" content="In the last part of this series around Azure Policy Guest Configuration, you got an introduction to what is Guest Configuration. In this part, you will learn about assigning Guest Configuration policies and initiatives.
Azure Policy Guest Configuration (GC) is an extension to Azure Policy and therefore use the same JSON definition structure. For example, here is the (redacted) GC definition for the policy Audit Windows machines that do not have the specified Windows PowerShell execution policy." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ravichaganti.com/blog/azure-policy-guest-configuration-assignments/" />
<meta property="article:published_time" content="2021-08-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-08-01T00:00:00+00:00" />




    
      <base href="https://ravichaganti.com/blog/azure-policy-guest-configuration-assignments/">
    
    <title>
  Azure Policy Guest Configuration - Assignments · Ravikanth Chaganti
</title>

    
      <link rel="canonical" href="https://ravichaganti.com/blog/azure-policy-guest-configuration-assignments/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://ravichaganti.com/css/coder.min.897f2f761ca1c7df1614de4c088e4ebbb7f5984b520994e5ee0a0fc4ba52f7de.css" integrity="sha256-iX8vdhyhx98WFN5MCI5Ou7f1mEtSCZTl7goPxLpS994=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="https://ravichaganti.com/css/coder-dark.min.e78e80fc3a585a4d1c8fc7f58623b6ff852411e38431a9cd1792877ecaa160f6.css" integrity="sha256-546A/DpYWk0cj8f1hiO2/4UkEeOEManNF5KHfsqhYPY=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="https://ravichaganti.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://ravichaganti.com/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.73.0" />
  </head>

  
  
    
  
  
    <body onload="getViews( &#34;https://ravichaganti.com/blog/azure-policy-guest-configuration-assignments/&#34; )" class="colorscheme-auto">
  
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://ravichaganti.com/">
      Ravikanth Chaganti
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/about/">About</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/blog/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://ravichaganti.com/books/">Books</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Azure Policy Guest Configuration - Assignments</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2021-08-01T00:00:00Z'>
                August 1, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              5-minute read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://ravichaganti.com/categories/azure/">Azure</a>
      <span class="separator">•</span>
    <a href="https://ravichaganti.com/categories/azure-policy/">Azure Policy</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://ravichaganti.com/tags/azure/">azure</a>
      <span class="separator">•</span>
    <a href="https://ravichaganti.com/tags/azure-policy/">azure policy</a></div>

        </div>
        <div class="post-meta">
          <span class="reading-time">
            <i class="fas fa-comments"></i>
            <a href="https://ravichaganti.com/blog/azure-policy-guest-configuration-assignments/#disqus_thread"> Comments</a>
          </span>
        </div>
        <div class="post-meta">
          <span class="reading-time">
            <i class="fas fa-eye"></i>
            <strong id="views"></strong>
            Readers
          </span>
        </div>        
      </header>
      <hr>
      <div>
        
        
        <p>In the <a href="https://ravichaganti.com/blog/azure-policy-guest-configuration-introduction/">last part of this series</a> around <a href="https://ravichaganti.com/series/azure-policy-guest-configuration/">Azure Policy Guest Configuration</a>, you got an introduction to what is Guest Configuration. In this part, you will learn about assigning Guest Configuration policies and initiatives.</p>
<p>Azure Policy Guest Configuration (GC) is an extension to Azure Policy and therefore use the same JSON definition structure. For example, here is the (redacted) GC definition for the policy <em>Audit Windows machines that do not have the specified Windows PowerShell execution policy</em>.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;properties&#34;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&#34;displayName&#34;</span><span class="p">:</span> <span class="s2">&#34;Audit Windows machines that do not have the specified Windows PowerShell execution policy&#34;</span><span class="p">,</span>
    <span class="nt">&#34;policyType&#34;</span><span class="p">:</span> <span class="s2">&#34;BuiltIn&#34;</span><span class="p">,</span>
    <span class="nt">&#34;mode&#34;</span><span class="p">:</span> <span class="s2">&#34;Indexed&#34;</span><span class="p">,</span>
    <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if  the Windows PowerShell command Get-ExecutionPolicy returns a value other than what was selected in the policy parameter.&#34;</span><span class="p">,</span>
    <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;category&#34;</span><span class="p">:</span> <span class="s2">&#34;Guest Configuration&#34;</span><span class="p">,</span>
      <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;3.0.0&#34;</span><span class="p">,</span>
      <span class="nt">&#34;requiredProviders&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&#34;Microsoft.GuestConfiguration&#34;</span>
      <span class="p">],</span>
      <span class="nt">&#34;guestConfiguration&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;WindowsPowerShellExecutionPolicy&#34;</span><span class="p">,</span>
        <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;1.*&#34;</span><span class="p">,</span>
        <span class="nt">&#34;configurationParameter&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;ExecutionPolicy&#34;</span><span class="p">:</span> <span class="s2">&#34;[PowerShellExecutionPolicy]PowerShellExecutionPolicy1;ExecutionPolicy&#34;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;parameters&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;IncludeArcMachines&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;String&#34;</span><span class="p">,</span>
        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;displayName&#34;</span><span class="p">:</span> <span class="s2">&#34;Include Arc connected servers&#34;</span><span class="p">,</span>
          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;By selecting this option, you agree to be charged monthly per Arc connected machine.&#34;</span><span class="p">,</span>
          <span class="nt">&#34;portalReview&#34;</span><span class="p">:</span> <span class="s2">&#34;true&#34;</span>
        <span class="p">},</span>
        <span class="nt">&#34;allowedValues&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&#34;true&#34;</span><span class="p">,</span>
          <span class="s2">&#34;false&#34;</span>
        <span class="p">],</span>
        <span class="nt">&#34;defaultValue&#34;</span><span class="p">:</span> <span class="s2">&#34;false&#34;</span>
      <span class="p">},</span>
      <span class="nt">&#34;ExecutionPolicy&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;String&#34;</span><span class="p">,</span>
        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;displayName&#34;</span><span class="p">:</span> <span class="s2">&#34;PowerShell Execution Policy&#34;</span><span class="p">,</span>
          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;The expected PowerShell execution policy.&#34;</span>
        <span class="p">},</span>
        <span class="nt">&#34;allowedValues&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&#34;AllSigned&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Bypass&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Default&#34;</span><span class="p">,</span>
          <span class="s2">&#34;RemoteSigned&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Restricted&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Undefined&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Unrestricted&#34;</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&#34;effect&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;String&#34;</span><span class="p">,</span>
        <span class="nt">&#34;metadata&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;displayName&#34;</span><span class="p">:</span> <span class="s2">&#34;Effect&#34;</span><span class="p">,</span>
          <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Enable or disable the execution of this policy&#34;</span>
        <span class="p">},</span>
        <span class="nt">&#34;allowedValues&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="s2">&#34;AuditIfNotExists&#34;</span><span class="p">,</span>
          <span class="s2">&#34;Disabled&#34;</span>
        <span class="p">],</span>
        <span class="nt">&#34;defaultValue&#34;</span><span class="p">:</span> <span class="s2">&#34;AuditIfNotExists&#34;</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&#34;policyRule&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;if&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;anyOf&#34;</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="nt">&#34;allOf&#34;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;type&#34;</span><span class="p">,</span>
                <span class="nt">&#34;equals&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Compute/virtualMachines&#34;</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="nt">&#34;then&#34;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&#34;effect&#34;</span><span class="p">:</span> <span class="s2">&#34;[parameters(&#39;effect&#39;)]&#34;</span><span class="p">,</span>
        <span class="nt">&#34;details&#34;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.GuestConfiguration/guestConfigurationAssignments&#34;</span><span class="p">,</span>
          <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;[concat(&#39;WindowsPowerShellExecutionPolicy$pid&#39;, uniqueString(policy().assignmentId, policy().definitionReferenceId))]&#34;</span><span class="p">,</span>
          <span class="nt">&#34;existenceCondition&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;allOf&#34;</span><span class="p">:</span> <span class="p">[</span>
              <span class="p">{</span>
                <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus&#34;</span><span class="p">,</span>
                <span class="nt">&#34;equals&#34;</span><span class="p">:</span> <span class="s2">&#34;Compliant&#34;</span>
              <span class="p">},</span>
              <span class="p">{</span>
                <span class="nt">&#34;field&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash&#34;</span><span class="p">,</span>
                <span class="nt">&#34;equals&#34;</span><span class="p">:</span> <span class="s2">&#34;[base64(concat(&#39;[PowerShellExecutionPolicy]PowerShellExecutionPolicy1;ExecutionPolicy&#39;, &#39;=&#39;, parameters(&#39;ExecutionPolicy&#39;)))]&#34;</span>
              <span class="p">}</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;/providers/Microsoft.Authorization/policyDefinitions/c648fbbb-591c-4acd-b465-ce9b176ca173&#34;</span><span class="p">,</span>
  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Microsoft.Authorization/policyDefinitions&#34;</span><span class="p">,</span>
  <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;c648fbbb-591c-4acd-b465-ce9b176ca173&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As you see in this definition, the overall document structure is same as an Azure Policy definition. However, the category in the metadata section at the top identifies this as a GC policy. This is a built-in GC policy definition.</p>
<h3 id="working-with-gc-policies">Working with GC Policies</h3>
<p>The following examples in this section use Azure CLI to work with GC policies. The <code>az policy</code> command helps you in working with policy definitions.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">az policy definition list --query <span class="s2">&#34;[?metadata.category==&#39;Guest Configuration&#39;].{DisplayName:displayName, Mode:mode, PolicyType:policyType, Name:name}&#34;</span> --output json
</code></pre></td></tr></table>
</div>
</div><p>This command filters policy definitions to only GC policies and then returns JSON output containing only a few selected properties. Here is the sample output.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json">  <span class="p">{</span>
    <span class="nt">&#34;DisplayName&#34;</span><span class="p">:</span> <span class="s2">&#34;[Deprecated]: Show audit results from Windows VMs configurations in &#39;Security Options - Microsoft Network Client&#39;&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Mode&#34;</span><span class="p">:</span> <span class="s2">&#34;All&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;fcbc55c9-f25a-4e55-a6cb-33acb3be778b&#34;</span><span class="p">,</span>
    <span class="nt">&#34;PolicyType&#34;</span><span class="p">:</span> <span class="s2">&#34;BuiltIn&#34;</span>
  <span class="p">}</span><span class="err">,</span>
  <span class="p">{</span>
    <span class="nt">&#34;DisplayName&#34;</span><span class="p">:</span> <span class="s2">&#34;[Deprecated]: Show audit results from Linux VMs that do not have the specified applications installed&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Mode&#34;</span><span class="p">:</span> <span class="s2">&#34;All&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;fee5cb2b-9d9b-410e-afe3-2902d90d0004&#34;</span><span class="p">,</span>
    <span class="nt">&#34;PolicyType&#34;</span><span class="p">:</span> <span class="s2">&#34;BuiltIn&#34;</span>
  <span class="p">}</span><span class="err">,</span>
  <span class="p">{</span>
    <span class="nt">&#34;DisplayName&#34;</span><span class="p">:</span> <span class="s2">&#34;Azure Stack HCI Best Practices&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Mode&#34;</span><span class="p">:</span> <span class="s2">&#34;Indexed&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;Azure Stack HCI Best Practices&#34;</span><span class="p">,</span>
    <span class="nt">&#34;PolicyType&#34;</span><span class="p">:</span> <span class="s2">&#34;Custom&#34;</span>
  <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>As you see in the output, you can see there are built-in and custom GC policies. The custom policies are what you as an end user can create and publish to your Azure subscription. Also, there are different modes &ndash; All and Indexed.  The policies that are defined as <em>all</em> mode, the policy gets evaluated for all resource groups, subscriptions, and all resource types. When the policy is in <em>indexed</em> mode, it gets evaluated only for resources types that support tags and location.</p>
<p>To retrieve a single policy definition, you can use the <code>az policy definition show</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">az policy definition show -n <span class="s2">&#34;e068b215-0026-4354-b347-8fb2766f73a2&#34;</span>
</code></pre></td></tr></table>
</div>
</div><p>You can assign a GC policy using the <code>az policy assignment</code> command.</p>
<blockquote>
<p>Note: There is a <a href="https://docs.microsoft.com/en-us/cli/azure/guestconfig?view=azure-cli-latest">guestconfig extension</a> that you can use to manage guest configuration assignments. However, I prefer az policy.</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">az policy assignment create --name <span class="s2">&#34;testAssignment&#34;</span> --policy <span class="s2">&#34;e068b215-0026-4354-b347-8fb2766f73a2&#34;</span> -g azconf
</code></pre></td></tr></table>
</div>
</div><p>The argument to the <code>--policy</code> parameter is the value of name property you saw in the output of all policy definitions. Once this assignment is complete, you can see it in the portal.</p>
<p>
<link rel="stylesheet" href="https://ravichaganti.com/css/hugo-easy-gallery.css" />
<div class="box" >
  <figure  itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject">
    <div class="img">
      <img itemprop="thumbnail" src="https://ravichaganti.com/images/az-gc-assignment.png" />
    </div>
    <a href="https://ravichaganti.com/images/az-gc-assignment.png" itemprop="contentUrl"></a>
  </figure>
</div>
 



  


<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://ravichaganti.com/js/load-photoswipe.js"></script>


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.css" integrity="sha256-sCl5PUOGMLfFYctzDW3MtRib0ctyUvI9Qsmq2wXOeBY=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/default-skin/default-skin.min.css" integrity="sha256-BFeI1V+Vh1Rk37wswuOYn5lsTcaU96hGaI7OUVCLjPc=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe.min.js" integrity="sha256-UplRCs9v4KXVJvVY+p+RSo5Q4ilAUXh7kpjyIP5odyc=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.1/photoswipe-ui-default.min.js" integrity="sha256-PWHOlUzc96pMc8ThwRIXPn8yH4NOLu42RQ0b9SpnpFk=" crossorigin="anonymous"></script>


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>
</p>
<p>You can trigger a policy compliance run using the <code>az policy state</code> command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">az policy state trigger-scan -g azconf
</code></pre></td></tr></table>
</div>
</div><p>This will trigger the compliance run and wait for the task to return. If you do not want to block console until the task is complete, add <code>--no-wait</code> parameter.</p>
<p>You can check the policy assignment compliance state using the <code>az policy state summarize</code> command.</p>
<h3 id="working-with-gc-initiatives">Working with GC initiatives</h3>
<p>Initiatives are groups of policy definition. Initiatives help group related policy definitions and assign them at once to a Azure scope. You can list all available GC initiatives by running the following command.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">az policy set-definition list --query <span class="s2">&#34;[?metadata.category==&#39;Guest Configuration&#39;].{DisplayName:displayName, PolicyType:pol
</span><span class="s2">icyType, Name:name}&#34;</span> --output json
</code></pre></td></tr></table>
</div>
</div><p>This returns output similar to what is shown below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;DisplayName&#34;</span><span class="p">:</span> <span class="s2">&#34;[Deprecated]: Audit Windows VMs on which the Log Analytics agent is not connected as expected&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;06c5e415-a662-463a-bb85-ede14286b979&#34;</span><span class="p">,</span>
    <span class="nt">&#34;PolicyType&#34;</span><span class="p">:</span> <span class="s2">&#34;BuiltIn&#34;</span>
  <span class="p">}</span><span class="err">,</span>
  <span class="p">{</span>
    <span class="nt">&#34;DisplayName&#34;</span><span class="p">:</span> <span class="s2">&#34;Audit machines with insecure password security settings&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;095e4ed9-c835-4ab6-9439-b5644362a06c&#34;</span><span class="p">,</span>
    <span class="nt">&#34;PolicyType&#34;</span><span class="p">:</span> <span class="s2">&#34;BuiltIn&#34;</span>
  <span class="p">}</span><span class="err">,</span>
  <span class="p">{</span>
    <span class="nt">&#34;DisplayName&#34;</span><span class="p">:</span> <span class="s2">&#34;Deploy prerequisites to enable Guest Configuration policies on virtual machines&#34;</span><span class="p">,</span>
    <span class="nt">&#34;Name&#34;</span><span class="p">:</span> <span class="s2">&#34;12794019-7a00-42cf-95c2-882eed337cc8&#34;</span><span class="p">,</span>
    <span class="nt">&#34;PolicyType&#34;</span><span class="p">:</span> <span class="s2">&#34;BuiltIn&#34;</span>
  <span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You can now assign an GC initiative using the <code>az policy assignment command</code> and using <code>--policy-set-definition</code> parameter.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">az policy assignment create --name &#34;testInitiativeAssignment&#34; --policy-set-definition &#34;095e4ed9-c835-4ab6-9439-b5644362a06c&#34; -g azconf
</code></pre></td></tr></table>
</div>
</div><p>Checking the compliance state of an initiative assignment is similar to how you did that for policies.</p>
<p>This is all for today and in the next part of this series, you will learn about writing custom GC policies.</p>

        

<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
position: relative;
text-align: left; 
height: 36px; 
width: 32px; 
float: left; 
text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<span style="color: rgb(77, 77, 95);">Share on: </span><div id="share-buttons">
<div class="facebook" title="Share this on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https:\/\/ravichaganti.com\/blog\/azure-policy-guest-configuration-assignments\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
<div class="twitter" title="Share this on Twitter" onclick="window.open('https://twitter.com/intent/tweet?text=https:\/\/ravichaganti.com\/blog\/azure-policy-guest-configuration-assignments\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
<div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/sharing/share-offsite/?url=https:\/\/ravichaganti.com\/blog\/azure-policy-guest-configuration-assignments\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
<div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https:\/\/ravichaganti.com\/blog\/azure-policy-guest-configuration-assignments\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>
      </div>


      <footer>
        

<section class="see-also">
  
    
    
    
      <h3>See also in Azure Policy Guest Configuration</h3>
      <nav>
        <ul>
        
        
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/azure-policy-guest-configuration-introduction/">Azure Policy Guest Configuration - Introduction</a>
            </li>
          
        
        </ul>
      </nav>
    
  
    
    
    
      <h3>See also in Azure Resource Manager In 30 Days</h3>
      <nav>
        <ul>
        
        
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/azure-policy-guest-configuration-introduction/">Azure Policy Guest Configuration - Introduction</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/azure-resource-manager-using-secrets-in-arm-templates/">Azure Resource Manager - Using secrets in ARM templates</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/azure-resource-manager-using-functions-in-arm-templates/">Azure Resource Manager - Using functions in ARM templates</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/azure-resource-manager-in-30-days-using-expressions-and-variables-in-arm-templates/">Azure Resource Manager - Using expressions and variables in ARM templates</a>
            </li>
          
        
          
            <li>
              <a href="https://ravichaganti.com/blog/azure-resource-manager-adding-parameters-to-arm-templates/">Azure Resource Manager - Adding parameters to ARM templates</a>
            </li>
          
        
        </ul>
      </nav>
    
  
</section>


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ravikanth" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
        
          
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-3619442-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p>All Rights Reserved.</p>
      
      
        ©
        
          2019 -
        
        2023
         Ravikanth Chaganti 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a> and hosted using <a href="https://pages.github.com/">GitHub Pages</a>.
      
      
    </section>
  </footer>

    </main>

    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-3619442-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
    

  </body>

</html>
